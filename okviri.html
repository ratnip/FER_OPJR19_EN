<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Let’s program in R</title>
  <meta name="description" content="R Coursebook">
  <meta name="generator" content="bookdown 0.7 and GitBook 2.6.7">

  <meta property="og:title" content="Let’s program in R" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="R Coursebook" />
  <meta name="github-repo" content="rstudio/bookdown-demo" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Let’s program in R" />
  
  <meta name="twitter:description" content="R Coursebook" />
  

<meta name="author" content="Damir Pintar">


<meta name="date" content="2019-12-06">

  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  
<link rel="prev" href="vektori.html">

<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />








<style type="text/css">
.showopt {
  background-color: #004c93;
  color: #FFFFFF; 
  width: 140px;
  height: 4	0px;
  text-align: center;
  vertical-align: middle !important;
  float: right;
  font-family: sans-serif;
  font-size:10 pt;
  border-radius: 8px;
}

.showopt:hover {
    background-color: #dfe4f2;
    color: #004c93;
}

pre.plot {
  background-color: white !important;
}
</style>

<script>
 $(document).ready(function() {

  $chunks = $('.fold');

  $chunks.each(function () {

    // add button to source code chunks
    if ( $(this).hasClass('s') ) {
      $('pre.r', this).prepend("<div class=\"showopt\">Show solution</div><br style=\"line-height:22px;\"/>");
      $('pre.r', this).children('code').attr('class', 'folded');
    }

    // add button to output chunks
    if ( $(this).hasClass('o') ) {
      $('pre:not(.r)', this).has('code').prepend("<div class=\"showopt\">Show results</div><br style=\"line-height:22px;\"/>");
      $('pre:not(.r)', this).children('code:not(r)').addClass('folded');

      // add button to plots
      $(this).find('img').wrap('<pre class=\"plot\"></pre>');
      $('pre.plot', this).prepend("<div class=\"showopt\">Show figure</div><br style=\"line-height:22px;\"/>");
      $('pre.plot', this).children('img').addClass('folded');

    }
  });

  // hide all chunks when document is loaded
  $('.folded').css('display', 'none')

  // function to toggle the visibility
  $('.showopt').click(function() {
    var label = $(this).html();
    if (label.indexOf("Show") >= 0) {
      $(this).html(label.replace("Show", "Hide"));
    } else {
      $(this).html(label.replace("Hide", "Show"));
    }
    $(this).siblings('code, img').slideToggle('fast', 'swing');
  });
});
</script>


<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(title);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>(“Introduction to programming language R” course book)</a><ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#foreword"><i class="fa fa-check"></i>Foreword</a></li>
</ul></li>
<li class="part"><span><b>I Basic elements of R</b></span></li>
<li class="chapter" data-level="1" data-path="introduction.html"><a href="introduction.html"><i class="fa fa-check"></i><b>1</b> Introduction</a><ul>
<li class="chapter" data-level="1.1" data-path="introduction.html"><a href="introduction.html#what-is-r"><i class="fa fa-check"></i><b>1.1</b> What is R?</a><ul>
<li class="chapter" data-level="1.1.1" data-path="introduction.html"><a href="introduction.html#general-facts-about-r"><i class="fa fa-check"></i><b>1.1.1</b> General facts about R</a></li>
<li class="chapter" data-level="1.1.2" data-path="introduction.html"><a href="introduction.html#r-alternatives"><i class="fa fa-check"></i><b>1.1.2</b> R alternatives</a></li>
</ul></li>
<li class="chapter" data-level="1.2" data-path="introduction.html"><a href="introduction.html#installing-software-support"><i class="fa fa-check"></i><b>1.2</b> Installing Software Support</a></li>
<li class="chapter" data-level="1.3" data-path="introduction.html"><a href="introduction.html#overview-of-the-development-interface-rstudio"><i class="fa fa-check"></i><b>1.3</b> Overview of the development interface <em>RStudio</em></a><ul>
<li class="chapter" data-level="1.3.1" data-path="introduction.html"><a href="introduction.html#interactive-console"><i class="fa fa-check"></i><b>1.3.1</b> Interactive console</a></li>
<li class="chapter" data-level="1.3.2" data-path="introduction.html"><a href="introduction.html#writing-r-scripts"><i class="fa fa-check"></i><b>1.3.2</b> Writing R scripts</a></li>
<li class="chapter" data-level="1.3.3" data-path="introduction.html"><a href="introduction.html#r-markdown"><i class="fa fa-check"></i><b>1.3.3</b> <em>R Markdown</em></a></li>
</ul></li>
<li class="chapter" data-level="1.4" data-path="introduction.html"><a href="introduction.html#how-to-use-this-coursebook"><i class="fa fa-check"></i><b>1.4</b> How to use this coursebook?</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="tipovi.html"><a href="tipovi.html"><i class="fa fa-check"></i><b>2</b> Basic data types and operators</a><ul>
<li class="chapter" data-level="2.1" data-path="tipovi.html"><a href="tipovi.html#basic-data-types"><i class="fa fa-check"></i><b>2.1</b> Basic data types</a></li>
<li class="chapter" data-level="2.2" data-path="tipovi.html"><a href="tipovi.html#operators"><i class="fa fa-check"></i><b>2.2</b> Operators</a></li>
<li class="chapter" data-level="2.3" data-path="tipovi.html"><a href="tipovi.html#missing-unknown-and-non-existent-values"><i class="fa fa-check"></i><b>2.3</b> Missing, unknown, and non-existent values</a></li>
<li class="chapter" data-level="" data-path="tipovi.html"><a href="tipovi.html#exercises"><i class="fa fa-check"></i>Exercises</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="vektori.html"><a href="vektori.html"><i class="fa fa-check"></i><b>3</b> Vectors, matrices and lists</a><ul>
<li class="chapter" data-level="3.1" data-path="vektori.html"><a href="vektori.html#vector"><i class="fa fa-check"></i><b>3.1</b> Vector</a><ul>
<li class="chapter" data-level="3.1.1" data-path="vektori.html"><a href="vektori.html#create-a-vector"><i class="fa fa-check"></i><b>3.1.1</b> Create a vector</a></li>
<li class="chapter" data-level="3.1.2" data-path="vektori.html"><a href="vektori.html#operator"><i class="fa fa-check"></i><b>3.1.2</b> Operator <code>[</code></a></li>
<li class="chapter" data-level="3.1.3" data-path="vektori.html"><a href="vektori.html#principle-of-vectorization-and-recycling"><i class="fa fa-check"></i><b>3.1.3</b> Principle of vectorization and recycling</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="vektori.html"><a href="vektori.html#index-vectors"><i class="fa fa-check"></i><b>3.2</b> Index vectors</a><ul>
<li class="chapter" data-level="3.2.1" data-path="vektori.html"><a href="vektori.html#location-indexing"><i class="fa fa-check"></i><b>3.2.1</b> Location Indexing</a></li>
<li class="chapter" data-level="3.2.2" data-path="vektori.html"><a href="vektori.html#conditional-indexing"><i class="fa fa-check"></i><b>3.2.2</b> Conditional indexing</a></li>
<li class="chapter" data-level="3.2.3" data-path="vektori.html"><a href="vektori.html#label-based-indexing"><i class="fa fa-check"></i><b>3.2.3</b> Label-based indexing</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="vektori.html"><a href="vektori.html#matrices-and-arrays"><i class="fa fa-check"></i><b>3.3</b> Matrices and arrays</a><ul>
<li class="chapter" data-level="3.3.1" data-path="vektori.html"><a href="vektori.html#matrix-splicing"><i class="fa fa-check"></i><b>3.3.1</b> Matrix splicing</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="vektori.html"><a href="vektori.html#lists"><i class="fa fa-check"></i><b>3.4</b> Lists</a></li>
<li class="chapter" data-level="" data-path="vektori.html"><a href="vektori.html#exercises-1"><i class="fa fa-check"></i>Exercises</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="okviri.html"><a href="okviri.html"><i class="fa fa-check"></i><b>4</b> Data frames and factors</a><ul>
<li class="chapter" data-level="4.1" data-path="okviri.html"><a href="okviri.html#data-frames"><i class="fa fa-check"></i><b>4.1</b> Data frames</a></li>
<li class="chapter" data-level="4.2" data-path="okviri.html"><a href="okviri.html#selecting-rows-and-columns"><i class="fa fa-check"></i><b>4.2</b> Selecting rows and columns</a><ul>
<li class="chapter" data-level="4.2.1" data-path="okviri.html"><a href="okviri.html#theposixct-andposixlt-classes"><i class="fa fa-check"></i><b>4.2.1</b> The<code>POSIXct</code> and<code>POSIXlt</code> classes</a></li>
<li class="chapter" data-level="4.2.2" data-path="okviri.html"><a href="okviri.html#the-lubridate-package"><i class="fa fa-check"></i><b>4.2.2</b> The <code>lubridate</code> package</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="okviri.html"><a href="okviri.html#working-with-character-strings"><i class="fa fa-check"></i><b>4.3</b> Working with character strings</a><ul>
<li class="chapter" data-level="4.3.1" data-path="okviri.html"><a href="okviri.html#text-analysis-and-regular-expressions"><i class="fa fa-check"></i><b>4.3.1</b> Text analysis and regular expressions</a></li>
<li class="chapter" data-level="4.3.2" data-path="okviri.html"><a href="okviri.html#the-stringr-package"><i class="fa fa-check"></i><b>4.3.2</b> The <code>stringr</code> package</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="okviri.html"><a href="okviri.html#exercise-tasks-1"><i class="fa fa-check"></i>Exercise Tasks</a></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Let’s program in R</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="okviri" class="section level1">
<h1><span class="header-section-number">4</span> Data frames and factors</h1>
<hr />
<div id="data-frames" class="section level2">
<h2><span class="header-section-number">4.1</span> Data frames</h2>
<p>As already mentioned, the data frame is by far the most popular element of the programming language R. The language R’s primary fnction is data analysis, and the data frame is actually an object representation of the data set we intend to analyze. In other words, the data frame is an object similar in function to a sheet in <em>Microsoft Excel</em> or a table in a relational database. Almost every session in R is oriented around manipulating data frames - but while in <em>Excel</em> we manage the table with the help of a graphical interface, and in relational database via the query language <em>SQL</em>, in R we manage data programatically through the data frames.</p>
<p>Take for example the following table:</p>
<table>
<thead>
<tr class="header">
<th>zipCode</th>
<th>cityName</th>
<th>avgSalKn</th>
<th>population</th>
<th>cityTax</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>10000</td>
<td>Zagreb</td>
<td>6359.00</td>
<td>790017</td>
<td>18</td>
</tr>
<tr class="even">
<td>51000</td>
<td>Rijeka</td>
<td>5418.00</td>
<td>128384</td>
<td>15</td>
</tr>
<tr class="odd">
<td>21000</td>
<td>Split</td>
<td>5170.00</td>
<td>167121</td>
<td>10</td>
</tr>
<tr class="even">
<td>31000</td>
<td>Osijek</td>
<td>4892.00</td>
<td>84104</td>
<td>13</td>
</tr>
<tr class="odd">
<td>20000</td>
<td>Dubrovnik</td>
<td>5348.00</td>
<td>28434</td>
<td>10</td>
</tr>
</tbody>
</table>
<p>This data set that contains certain parameters related to cities in the Republic of Croatia (these valuesdo not necessarily correspond to the current state but are used only for demonstration). We can easily imagine how to write this data in <em>Excel</em> or create a relational table of names, for example, where we store the data. Let’s show now how to manipulate the same information within the R language, ie let’s try to create a data frame that will contain this data.</p>
<hr />
<p>In the last lesson we noted that the list as a complex type which serves as a kind of “template” with the help of which we can collect a number of different objects within the same structure. The data frame is in fact nothing but a list - that is, a “container” that can contain other data containers of different types. But while the “list” is actually a <em>universal</em> container, ie we do not have the limitations about stuff we place into it, the data frame has certain restrictions.</p>
<p>The most important limit imposed by the data frame is that <strong>each element within the data frame must have the same number of elements</strong>. Why is that so? Let’s imagine a list in which each element has the same number of sub-elements. If each element is sketched vertically, with subelements written one below another, then these sub-elements will be “aligned” by the rows, which means that we have achieved classical data organization in columns (list elements) and rows (aligned sub-elements). Thus, this restriction directly imposes a “tabular” or “matrix” list structure with clearly defined rows and columns, which actually allows us to manage the data frame by using not only list methods, but also methods primarily intended for matrices.</p>
<hr />
<p>There are several ways to create data frames, and we’ll show two of the most frequently encountered scenarios in practice:</p>
<ul>
<li>Programatic creation via the <code>data.frame</code> function</li>
<li>Load data from an external source using the <code>read.csv</code> function</li>
</ul>
<p>Let’s see both of these cases. First, we will create a data frame programatically.</p>
<hr />
<p><strong>Assignment 4.1 - creating data frames programatically</strong></p>
<div class="sourceCode" id="cb126"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb126-1" title="1">cities &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">zipCode =</span> <span class="kw">c</span>(<span class="dv">10000</span>, <span class="dv">51000</span>, <span class="dv">21000</span>, <span class="dv">31000</span>, <span class="dv">2000</span>),</a>
<a class="sourceLine" id="cb126-2" title="2">  <span class="dt">cityName =</span> <span class="kw">c</span>(<span class="st">&quot;Zagreb&quot;</span>, <span class="st">&quot;Rijeka&quot;</span>, <span class="st">&quot;Split&quot;</span>, <span class="st">&quot;Osijek&quot;</span>, <span class="st">&quot;Dubrovnik&quot;</span>),</a>
<a class="sourceLine" id="cb126-3" title="3">  <span class="dt">avgSalKn =</span> <span class="kw">c</span>(<span class="fl">6359.</span>, <span class="fl">5418.</span>, <span class="fl">5170.</span>, <span class="fl">4892.</span>, <span class="fl">5348.</span>),</a>
<a class="sourceLine" id="cb126-4" title="4">  <span class="dt">population =</span> <span class="kw">c</span>(<span class="dv">790017</span>, <span class="dv">128384</span>, <span class="dv">167121</span>, <span class="dv">84104</span>, <span class="dv">28434</span>),</a>
<a class="sourceLine" id="cb126-5" title="5">  <span class="dt">cityTax =</span> <span class="kw">c</span>(<span class="dv">18</span>, <span class="dv">15</span>, <span class="dv">10</span>, <span class="dv">13</span>, <span class="dv">10</span>))</a>
<a class="sourceLine" id="cb126-6" title="6"></a>
<a class="sourceLine" id="cb126-7" title="7"></a>
<a class="sourceLine" id="cb126-8" title="8"><span class="co"># print the variable `cities`</span></a></code></pre></div>
<div class="fold s o">
<div class="sourceCode" id="cb127"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb127-1" title="1">cities &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">zipCode =</span> <span class="kw">c</span>(<span class="dv">10000</span>, <span class="dv">51000</span>, <span class="dv">21000</span>, <span class="dv">31000</span>, <span class="dv">2000</span>),</a>
<a class="sourceLine" id="cb127-2" title="2">  <span class="dt">cityName =</span> <span class="kw">c</span>(<span class="st">&quot;Zagreb&quot;</span>, <span class="st">&quot;Rijeka&quot;</span>, <span class="st">&quot;Split&quot;</span>, <span class="st">&quot;Osijek&quot;</span>, <span class="st">&quot;Dubrovnik&quot;</span>),</a>
<a class="sourceLine" id="cb127-3" title="3">  <span class="dt">avgSalKn =</span> <span class="kw">c</span>(<span class="fl">6359.</span>, <span class="fl">5418.</span>, <span class="fl">5170.</span>, <span class="fl">4892.</span>, <span class="fl">5348.</span>),</a>
<a class="sourceLine" id="cb127-4" title="4">  <span class="dt">population =</span> <span class="kw">c</span>(<span class="dv">790017</span>, <span class="dv">128384</span>, <span class="dv">167121</span>, <span class="dv">84104</span>, <span class="dv">28434</span>),</a>
<a class="sourceLine" id="cb127-5" title="5">  <span class="dt">cityTax =</span> <span class="kw">c</span>(<span class="dv">18</span>, <span class="dv">15</span>, <span class="dv">10</span>, <span class="dv">13</span>, <span class="dv">10</span>))</a>
<a class="sourceLine" id="cb127-6" title="6"></a>
<a class="sourceLine" id="cb127-7" title="7"><span class="co"># print the variable `cities`</span></a>
<a class="sourceLine" id="cb127-8" title="8">cities</a></code></pre></div>
<pre><code>##   zipCode  cityName avgSalKn population cityTax
## 1   10000    Zagreb     6359     790017      18
## 2   51000    Rijeka     5418     128384      15
## 3   21000     Split     5170     167121      10
## 4   31000    Osijek     4892      84104      13
## 5    2000 Dubrovnik     5348      28434      10</code></pre>
</div>
<hr />
<p>If you like, try creatint the upper data frame again, but with different numbers of vector element numbers that make up the columns. This operation will result in an error with a appropriate message and the data frame will not be created - R tries to keep the matrix nature of the frame always preserved.</p>
<p>A little note regarding terminology: the “data frame” is often referred to as simply a “frame” or a “table”. Likewise, we often use the “column”, “variable” or “attribute” terms for the vertical data frame elements, while referring to the horizontal frame elements as “rows” or “observations”. These terms are in line with the standard way of referencing the table elements and the statistical terms referring to the datasets. If there is a chance of ambiguity from the context, the term that clearly describes the referenced element will be used.</p>
<hr />
<p>Let’s try to load the table from an external source now. Although R allows different forms of external data, we will assume that the data is obtained in a standard “CSV form” (CSV - <em>comma-separated values</em>). This form is one of the most popular data storage methods in a pure text format that has the advantage of being easy to create manually, and most data management tools implement logic to import/export data as a CSV file.</p>
<p>Below we can see an example of a CSV file that matches the data frame created in the previous example. Suppose the file is named <code>cities.csv</code>. The data is separated by a comma (no spaces!), Every observation in your line, and the optional first line represents the column names.</p>
<hr />
<div class="sourceCode" id="cb129"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb129-1" title="1">zipCode,cityName,avgSalKn,population,cityTax</a>
<a class="sourceLine" id="cb129-2" title="2"><span class="dv">10000</span>,Zagreb,<span class="fl">6359.00</span>,<span class="dv">790017</span>,<span class="dv">18</span> </a>
<a class="sourceLine" id="cb129-3" title="3"><span class="dv">51000</span>,Rijeka,<span class="fl">5418.00</span>,<span class="dv">128384</span>,<span class="dv">15</span></a>
<a class="sourceLine" id="cb129-4" title="4"><span class="dv">21000</span>,Split,<span class="fl">5170.00</span>,<span class="dv">167121</span>,<span class="dv">10</span></a>
<a class="sourceLine" id="cb129-5" title="5"><span class="dv">31000</span>,Osijek,<span class="fl">4892.00</span>,<span class="dv">84104</span>,<span class="dv">13</span> </a>
<a class="sourceLine" id="cb129-6" title="6"><span class="dv">20000</span>,Dubrovnik,<span class="fl">5348.00</span>,<span class="dv">28434</span>,<span class="dv">10</span></a></code></pre></div>
<hr />
<p>One of the potential problems with CSV files is that they use the comma as separator (<em>delimiter</em>) of column elements, and in certain languages, as a standard, a “decimal comma” is used instead of a decimal point. Because of this fact, there is an “alternative” CSV standard that uses a semi-colon as a separator so that our CSV file in this case looks like this (let’s call it <code>citiesAlt.csv</code>):</p>
<hr />
<div class="sourceCode" id="cb130"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb130-1" title="1">zipCode;cityName;avgSalKn;population;cityTax</a>
<a class="sourceLine" id="cb130-2" title="2"><span class="dv">10000</span>;Zagreb;<span class="dv">6359</span>,<span class="dv">00</span>;<span class="dv">790017</span>;<span class="dv">18</span> </a>
<a class="sourceLine" id="cb130-3" title="3"><span class="dv">51000</span>;Rijeka;<span class="dv">5418</span>,<span class="dv">00</span>;<span class="dv">128384</span>;<span class="dv">15</span></a>
<a class="sourceLine" id="cb130-4" title="4"><span class="dv">21000</span>;Split;<span class="dv">5170</span>,<span class="dv">00</span>;<span class="dv">167121</span>;<span class="dv">10</span></a>
<a class="sourceLine" id="cb130-5" title="5"><span class="dv">31000</span>;Osijek;<span class="dv">4892</span>,<span class="dv">00</span>;<span class="dv">84104</span>;<span class="dv">13</span> </a>
<a class="sourceLine" id="cb130-6" title="6"><span class="dv">20000</span>;Dubrovnik;<span class="dv">5348</span>,<span class="dv">00</span>;<span class="dv">28434</span>;<span class="dv">10</span></a></code></pre></div>
<hr />
<p>Since the decimal point is a standard in the Republic of Croatia, in working with CSV files we have to be careful which of the two standard records is used. Luckily, the R language offers support functions for both standards, so we do not have to adapt the input files specifically, just be careful what function we will choose.</p>
<p>Suppose we have these two files in the workbook:</p>
<ul>
<li><code>cities.csv</code></li>
<li><code>citiesAlt.csv</code></li>
</ul>
<p>(If we do not have these files available, we can easily create them with the help of plain text editors (eg <em>Notepad</em> or <em>gedit</em>) and copying the above rows.)</p>
<hr />
<p>To create data frames from CSV files we use the following functions:
- <code>read.csv</code> - for “normal” CSV files with a comma as separator
- <code>read.csv2</code> - for an alternative CSV standard that use semi-colons</p>
<p>The main input parameter of these functions is the path to the CSV file that we load. Functions also have a rich set of additional parameters that allow them to be adapted to different scenarios, and if we get some of the “exotic” forms of CSV files, it is worth looking at the <code>read.table</code> function which is very flexible with respect to the number of different parameters and data load settings. Functions <code>read.csv</code> and<code>read.csv2</code> are actually derived from the <code>read.table</code> function by defaulting certain parameters to standard CSV features.</p>
<hr />
<p>Some of the parameters and associated values of <code>read.csv</code> (or <code>read.table</code>) functions that are useful to know are:</p>
<ul>
<li><code>header = FALSE</code> - for files without a header</li>
<li><code>sep = "#"</code> - for files that use some more “exotic” separator, in this case <code>#</code></li>
<li><code>na.strings = 'NULL'</code> - the term used in the dataset to represent the missing values that will become <code>NA</code> in R</li>
<li><code>nrows = 2000</code> - maximum number of lines to be read, in this case 2000</li>
<li><code>stringsAsFactors = F</code> - preventing automatic creation of factor columns (which we will learn in the lesson below)</li>
<li><code>encoding = 'UTF-8'</code> - for non-ASCII text encoding standards (especially if we are working with Croatian speaking area data using diacritical characters)</li>
</ul>
<p>Let’s try to load data from available CSV files now. This data will not require special parameters, and will only be loaded by providing the path to the associated files (one that uses the comma and the other that uses the semi-colon as a separator).</p>
<hr />
<p><strong>Assignment 4.2 - reading CSV files</strong></p>
<div class="sourceCode" id="cb131"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb131-1" title="1"><span class="co"># load data from files `cities.csv` and` citiesAlt.csv`</span></a>
<a class="sourceLine" id="cb131-2" title="2"><span class="co"># save data in variables called `cities2` and` cities3` </span></a>
<a class="sourceLine" id="cb131-3" title="3"></a>
<a class="sourceLine" id="cb131-4" title="4"><span class="co"># print `cities2` and` cities3` </span></a></code></pre></div>
<div class="fold s o">
<div class="sourceCode" id="cb132"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb132-1" title="1"><span class="co"># load data from files `cities.csv` and` citiesAlt.csv`</span></a>
<a class="sourceLine" id="cb132-2" title="2"><span class="co"># save data in variables called `cities2` and` cities3` </span></a>
<a class="sourceLine" id="cb132-3" title="3">cities2 &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;cities.csv&quot;</span>)</a>
<a class="sourceLine" id="cb132-4" title="4">cities3 &lt;-<span class="st"> </span><span class="kw">read.csv2</span>(<span class="st">&quot;citiesAlt.csv&quot;</span>)</a>
<a class="sourceLine" id="cb132-5" title="5"></a>
<a class="sourceLine" id="cb132-6" title="6"><span class="co"># print `cities2` and` cities3` </span></a>
<a class="sourceLine" id="cb132-7" title="7">cities2</a>
<a class="sourceLine" id="cb132-8" title="8"><span class="kw">cat</span>(<span class="st">&quot;-----------</span><span class="ch">\n</span><span class="st">&quot;</span>)</a>
<a class="sourceLine" id="cb132-9" title="9">cities3 </a></code></pre></div>
<pre><code>##   zipCode  cityName avgSalKn population cityTax
## 1   10000    Zagreb     6359     790017      18
## 2   51000    Rijeka     5418     128384      15
## 3   21000     Split     5170     167121      10
## 4   31000    Osijek     4892      84104      13
## 5   20000 Dubrovnik     5348      28434      10
## -----------
##   zipCode  cityName avgSalKn population cityTax
## 1   10000    Zagreb     6359     790017      18
## 2   51000    Rijeka     5418     128384      15
## 3   21000     Split     5170     167121      10
## 4   31000    Osijek     4892      84104      13
## 5   20000 Dubrovnik     5348      28434      10</code></pre>
</div>
<hr />
<p>Let’s look at some useful functions for working with data frames, ie tables. A good part of them is already known from experience in working with lists and matrices:</p>
<ul>
<li><code>nrow</code> - number of lines</li>
<li><code>ncol</code> or<code>length</code> - the number of columns (since the frame behaves both as a matrix and as a list)</li>
<li><code>dim</code> - table dimensions</li>
<li><code>names</code> - column names</li>
<li><code>head</code> - prints several rows from the beginning of the table</li>
<li><code>tail</code> - prints several rows from the end of the table</li>
<li><code>str</code> - prints table structure</li>
<li><code>summary</code> - summarizes the statistical information about table columns</li>
</ul>
<p>Let’s try some of these functions:</p>
<hr />
<p><strong>Assignment 4.3 - working with data frames</strong></p>
<div class="sourceCode" id="cb134"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb134-1" title="1"><span class="co"># print the dimensions of the data frame `cities`</span></a>
<a class="sourceLine" id="cb134-2" title="2"></a>
<a class="sourceLine" id="cb134-3" title="3"></a>
<a class="sourceLine" id="cb134-4" title="4"><span class="co"># print the table structure of `cities`</span></a>
<a class="sourceLine" id="cb134-5" title="5"></a>
<a class="sourceLine" id="cb134-6" title="6"></a>
<a class="sourceLine" id="cb134-7" title="7"><span class="co"># print the first few rows of the data frame `cities`</span></a>
<a class="sourceLine" id="cb134-8" title="8"></a>
<a class="sourceLine" id="cb134-9" title="9"></a>
<a class="sourceLine" id="cb134-10" title="10"><span class="co"># print summarized statistical information about  `cities` </span></a></code></pre></div>
<div class="fold s o">
<div class="sourceCode" id="cb135"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb135-1" title="1"><span class="co"># print the dimensions of the data frame `cities`</span></a>
<a class="sourceLine" id="cb135-2" title="2"><span class="kw">dim</span>(cities)</a>
<a class="sourceLine" id="cb135-3" title="3"></a>
<a class="sourceLine" id="cb135-4" title="4"><span class="kw">cat</span>(<span class="st">&quot;-----------</span><span class="ch">\n</span><span class="st">&quot;</span>)</a>
<a class="sourceLine" id="cb135-5" title="5"></a>
<a class="sourceLine" id="cb135-6" title="6"><span class="co"># print the table structure of `cities`</span></a>
<a class="sourceLine" id="cb135-7" title="7"><span class="kw">str</span>(cities)</a>
<a class="sourceLine" id="cb135-8" title="8"></a>
<a class="sourceLine" id="cb135-9" title="9"><span class="kw">cat</span>(<span class="st">&quot;-----------</span><span class="ch">\n</span><span class="st">&quot;</span>)</a>
<a class="sourceLine" id="cb135-10" title="10"></a>
<a class="sourceLine" id="cb135-11" title="11"><span class="co"># print the first few rows of the data frame `cities`</span></a>
<a class="sourceLine" id="cb135-12" title="12"><span class="kw">head</span>(cities)</a>
<a class="sourceLine" id="cb135-13" title="13"></a>
<a class="sourceLine" id="cb135-14" title="14"><span class="kw">cat</span>(<span class="st">&quot;-----------</span><span class="ch">\n</span><span class="st">&quot;</span>)</a>
<a class="sourceLine" id="cb135-15" title="15"></a>
<a class="sourceLine" id="cb135-16" title="16"><span class="co"># print summarized statistical information about  `cities` </span></a>
<a class="sourceLine" id="cb135-17" title="17"><span class="kw">summary</span>(cities)</a></code></pre></div>
<pre><code>## [1] 5 5
## -----------
## &#39;data.frame&#39;:    5 obs. of  5 variables:
##  $ zipCode   : num  10000 51000 21000 31000 2000
##  $ cityName  : Factor w/ 5 levels &quot;Dubrovnik&quot;,&quot;Osijek&quot;,..: 5 3 4 2 1
##  $ avgSalKn  : num  6359 5418 5170 4892 5348
##  $ population: num  790017 128384 167121 84104 28434
##  $ cityTax   : num  18 15 10 13 10
## -----------
##   zipCode  cityName avgSalKn population cityTax
## 1   10000    Zagreb     6359     790017      18
## 2   51000    Rijeka     5418     128384      15
## 3   21000     Split     5170     167121      10
## 4   31000    Osijek     4892      84104      13
## 5    2000 Dubrovnik     5348      28434      10
## -----------
##     zipCode           cityName    avgSalKn      population    
##  Min.   : 2000   Dubrovnik:1   Min.   :4892   Min.   : 28434  
##  1st Qu.:10000   Osijek   :1   1st Qu.:5170   1st Qu.: 84104  
##  Median :21000   Rijeka   :1   Median :5348   Median :128384  
##  Mean   :23000   Split    :1   Mean   :5437   Mean   :239612  
##  3rd Qu.:31000   Zagreb   :1   3rd Qu.:5418   3rd Qu.:167121  
##  Max.   :51000                 Max.   :6359   Max.   :790017  
##     cityTax    
##  Min.   :10.0  
##  1st Qu.:10.0  
##  Median :13.0  
##  Mean   :13.2  
##  3rd Qu.:15.0  
##  Max.   :18.0</code></pre>
</div>
<hr />
</div>
<div id="selecting-rows-and-columns" class="section level2">
<h2><span class="header-section-number">4.2</span> Selecting rows and columns</h2>
<p>We’ve already said that data frames behave both as matrices and as lists, which is a feature we often use when selecting rows and columns of data frames. Specifically, we use the following:</p>
<ul>
<li>for selecting rows and columns: two-dimensional indexing with the help of index vectors</li>
<li>for select a column: operator <code>$</code></li>
</ul>
<p>Here we are actually quite flexible - we can, for example, first get certain matrix rows with the help of location indexing and then only single column with the help of <code>$</code>. In practice, one of the most common combinations is the conditional selection of rows with the named selection of columns (<em>SQL</em> experts will recognize this as a standard combination of <em>WHERE</em> and <em>SELECT</em>).</p>
<p>Let’s try to apply our knowledge of index vectors, matrices, and lists.</p>
<hr />
<p><strong>Assignment 4.4 - selecting rows and columns</strong></p>
<div class="sourceCode" id="cb137"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb137-1" title="1"><span class="co"># print the table `cities` (for reference)</span></a>
<a class="sourceLine" id="cb137-2" title="2"></a>
<a class="sourceLine" id="cb137-3" title="3"><span class="co"># print the first three rows, the third and fifth column</span></a>
<a class="sourceLine" id="cb137-4" title="4"></a>
<a class="sourceLine" id="cb137-5" title="5"><span class="co"># print column &quot;cityTax&quot;</span></a>
<a class="sourceLine" id="cb137-6" title="6"></a>
<a class="sourceLine" id="cb137-7" title="7"><span class="co"># print zipCodes and city names of all cities which </span></a>
<a class="sourceLine" id="cb137-8" title="8"><span class="co"># have cityTax greater than 12% and a population of more than 100,000</span></a></code></pre></div>
<div class="fold s o">
<div class="sourceCode" id="cb138"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb138-1" title="1"><span class="co"># print the table `cities` (for reference)</span></a>
<a class="sourceLine" id="cb138-2" title="2">cities</a>
<a class="sourceLine" id="cb138-3" title="3"></a>
<a class="sourceLine" id="cb138-4" title="4"><span class="kw">cat</span>(<span class="st">&quot;-----------</span><span class="ch">\n</span><span class="st">&quot;</span>)</a>
<a class="sourceLine" id="cb138-5" title="5"></a>
<a class="sourceLine" id="cb138-6" title="6"><span class="co"># print the first three rows, the third and fifth column</span></a>
<a class="sourceLine" id="cb138-7" title="7"></a>
<a class="sourceLine" id="cb138-8" title="8">cities[<span class="dv">1</span><span class="op">:</span><span class="dv">3</span>, <span class="kw">c</span>(<span class="dv">2</span>,<span class="dv">5</span>)]</a>
<a class="sourceLine" id="cb138-9" title="9"></a>
<a class="sourceLine" id="cb138-10" title="10"><span class="kw">cat</span>(<span class="st">&quot;-----------</span><span class="ch">\n</span><span class="st">&quot;</span>)</a>
<a class="sourceLine" id="cb138-11" title="11"></a>
<a class="sourceLine" id="cb138-12" title="12"><span class="co"># print column &quot;cityTax&quot;</span></a>
<a class="sourceLine" id="cb138-13" title="13">cities<span class="op">$</span>cityTax</a>
<a class="sourceLine" id="cb138-14" title="14"></a>
<a class="sourceLine" id="cb138-15" title="15"><span class="kw">cat</span>(<span class="st">&quot;-----------</span><span class="ch">\n</span><span class="st">&quot;</span>)</a>
<a class="sourceLine" id="cb138-16" title="16"></a>
<a class="sourceLine" id="cb138-17" title="17"><span class="co"># print zipCodes and city names of all cities which </span></a>
<a class="sourceLine" id="cb138-18" title="18"><span class="co"># have cityTax greater than 12% and a population of more than 100,000</span></a>
<a class="sourceLine" id="cb138-19" title="19">cities[cities<span class="op">$</span>cityTax <span class="op">&gt;</span><span class="st"> </span><span class="dv">12</span> <span class="op">&amp;</span><span class="st"> </span>cities<span class="op">$</span>population <span class="op">&gt;</span><span class="st"> </span><span class="dv">100000</span>, <span class="kw">c</span>(<span class="st">&quot;zipCode&quot;</span>, <span class="st">&quot;cityName&quot;</span>)]</a></code></pre></div>
<pre><code>##   zipCode  cityName avgSalKn population cityTax
## 1   10000    Zagreb     6359     790017      18
## 2   51000    Rijeka     5418     128384      15
## 3   21000     Split     5170     167121      10
## 4   31000    Osijek     4892      84104      13
## 5    2000 Dubrovnik     5348      28434      10
## -----------
##   cityName cityTax
## 1   Zagreb      18
## 2   Rijeka      15
## 3    Split      10
## -----------
## [1] 18 15 10 13 10
## -----------
##   zipCode cityName
## 1   10000   Zagreb
## 2   51000   Rijeka</code></pre>
<hr />
<p>Notice the similarity between the last expression and SQL query:</p>
<div class="sourceCode" id="cb140"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb140-1" title="1">SELECT zipCode, cityName</a>
<a class="sourceLine" id="cb140-2" title="2">FROM cities</a>
<a class="sourceLine" id="cb140-3" title="3">WHERE cities.cityTax <span class="op">&gt;</span><span class="st"> </span><span class="dv">12</span> AND cities.population <span class="op">&gt;</span><span class="st"> </span><span class="dv">100000</span></a></code></pre></div>
<p>Choosing columns and rows is not difficult if we are well acquainted with index vector knowledge, but as it can be seen in the last example of syntax, it is often not too readable (as compared to, for example, the SQL syntax that performs the same job). For this reason, there are different R extensions that greatly facilitate this work, which we will elaborate in detail in one of the future lessons.</p>
<hr />
<h2 id="adding-and-deleting-rows-and-columns"><span class="header-section-number">4.2</span> Adding and deleting rows and columns</h2>
<p>To add and delete rows and columns, remember that the data frame is a kind of hybrid of a matrix and a list, ie if we know how to add rows and columns to a matrix or add new elements in a list, then we can add data to the data frame in an equivalent way. When working with data frames, adding new columns is a bit more common than adding rows.</p>
<p>As we have said, we add columns to the data frame in the same way as we add list elements - while paying attention that the added column has the same number of elements as the other columns. New columns are often derived from existing columns to create new binary indicators, the results of arithmetic data expressions using other columns, etc.</p>
<hr />
<p><strong>Assignment 4.5 - adding new columns to a data frame</strong></p>
<div class="sourceCode" id="cb141"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb141-1" title="1"><span class="co"># add the logical column` highCityTax` to the  `cities` table</span></a>
<a class="sourceLine" id="cb141-2" title="2"><span class="co"># which will indicate whether the cityTax is greater than 12%</span></a>
<a class="sourceLine" id="cb141-3" title="3"></a>
<a class="sourceLine" id="cb141-4" title="4"></a>
<a class="sourceLine" id="cb141-5" title="5"><span class="co"># assume the following (imaginary) way of calculating city tax income</span></a>
<a class="sourceLine" id="cb141-6" title="6"><span class="co"># - cities have about 60% of working population</span></a>
<a class="sourceLine" id="cb141-7" title="7"><span class="co"># - each worker pays a tax that is roughly equal to 10% of net salary</span></a>
<a class="sourceLine" id="cb141-8" title="8"><span class="co"># - income from city tax per worker is (cityTaxa percentage)*(tax income)</span></a>
<a class="sourceLine" id="cb141-9" title="9"><span class="co">#</span></a>
<a class="sourceLine" id="cb141-10" title="10"><span class="co"># add a `monthlyTaxIncome` column which will use the average salary, city tax </span></a>
<a class="sourceLine" id="cb141-11" title="11"><span class="co"># rate and population to estimate hte monthly tax income of the cities</span></a>
<a class="sourceLine" id="cb141-12" title="12"><span class="co"># (in million Kns)</span></a>
<a class="sourceLine" id="cb141-13" title="13"><span class="co"># i broja stanovnika procijeniti koliki prihod pojedino cities dobija od cityTaxa </span></a>
<a class="sourceLine" id="cb141-14" title="14"><span class="co"># round up to two decimals ( using the `round` function,</span></a>
<a class="sourceLine" id="cb141-15" title="15"><span class="co">#  .e.g. : round(100.12345, 2) ==&gt;  100.12  )</span></a>
<a class="sourceLine" id="cb141-16" title="16"></a>
<a class="sourceLine" id="cb141-17" title="17"></a>
<a class="sourceLine" id="cb141-18" title="18"><span class="co"># print `cities`</span></a></code></pre></div>
<div class="fold s o">
<div class="sourceCode" id="cb142"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb142-1" title="1"><span class="co"># add the logical column` highCityTax` to the  `cities` table</span></a>
<a class="sourceLine" id="cb142-2" title="2"><span class="co"># which will indicate whether the cityTax is greater than 12%</span></a>
<a class="sourceLine" id="cb142-3" title="3">cities<span class="op">$</span>highCityTax &lt;-<span class="st"> </span>cities<span class="op">$</span>cityTax <span class="op">&gt;</span><span class="st"> </span><span class="dv">12</span></a>
<a class="sourceLine" id="cb142-4" title="4"></a>
<a class="sourceLine" id="cb142-5" title="5"></a>
<a class="sourceLine" id="cb142-6" title="6"><span class="co"># assume the following (imaginary) way of calculating city tax income</span></a>
<a class="sourceLine" id="cb142-7" title="7"><span class="co"># - cities have about 60% of working population</span></a>
<a class="sourceLine" id="cb142-8" title="8"><span class="co"># - each worker pays a tax that is roughly equal to 10% of net salary</span></a>
<a class="sourceLine" id="cb142-9" title="9"><span class="co"># - income from city tax per worker is (cityTaxa percentage)*(tax income)</span></a>
<a class="sourceLine" id="cb142-10" title="10"><span class="co">#</span></a>
<a class="sourceLine" id="cb142-11" title="11"><span class="co"># add a `monthlyTaxIncome` column which will use the average salary, city tax </span></a>
<a class="sourceLine" id="cb142-12" title="12"><span class="co"># rate and population to estimate hte monthly tax income of the cities</span></a>
<a class="sourceLine" id="cb142-13" title="13"><span class="co"># (in million Kns)</span></a>
<a class="sourceLine" id="cb142-14" title="14"><span class="co"># i broja stanovnika procijeniti koliki prihod pojedino cities dobija od cityTaxa </span></a>
<a class="sourceLine" id="cb142-15" title="15"><span class="co"># round up to two decimals ( using the `round` function,</span></a>
<a class="sourceLine" id="cb142-16" title="16"><span class="co">#  .e.g. : round(100.12345, 2) ==&gt;  100.12  )</span></a>
<a class="sourceLine" id="cb142-17" title="17">cities<span class="op">$</span>monthlyTaxIncome&lt;-<span class="st"> </span><span class="kw">round</span>(<span class="fl">0.6</span> <span class="op">*</span><span class="st"> </span>cities<span class="op">$</span>population <span class="op">*</span><span class="st"> </span><span class="fl">0.01</span> <span class="op">*</span><span class="st"> </span></a>
<a class="sourceLine" id="cb142-18" title="18"><span class="st">                          </span>cities<span class="op">$</span>avgSalKn  <span class="op">*</span><span class="st"> </span><span class="fl">0.01</span> <span class="op">*</span><span class="st"> </span>cities<span class="op">$</span>cityTax <span class="op">/</span><span class="st"> </span><span class="fl">1e6</span> , <span class="dv">2</span>)</a>
<a class="sourceLine" id="cb142-19" title="19"></a>
<a class="sourceLine" id="cb142-20" title="20"></a>
<a class="sourceLine" id="cb142-21" title="21"><span class="co"># print `cities`</span></a>
<a class="sourceLine" id="cb142-22" title="22">cities</a></code></pre></div>
<pre><code>##   zipCode  cityName avgSalKn population cityTax highCityTax
## 1   10000    Zagreb     6359     790017      18        TRUE
## 2   51000    Rijeka     5418     128384      15        TRUE
## 3   21000     Split     5170     167121      10       FALSE
## 4   31000    Osijek     4892      84104      13        TRUE
## 5    2000 Dubrovnik     5348      28434      10       FALSE
##   monthlyTaxIncome
## 1             5.43
## 2             0.63
## 3             0.52
## 4             0.32
## 5             0.09</code></pre>
</div>
<hr />
<p>You can also add rows and columns similar to adding rows and columns to a matrix - with the <code>rbind</code> and<code>cbind</code> functions. For <code>rbind</code> we usually add a new data frame with rows that have the appropriate order and type of elements, while we can add a completely new vector with <code>cbind</code>, keeping in mind that the number of elements corresponds to the number of rows of the original data frame.</p>
<p>Let’s try these functions on small “artificial” data frames to better demonstrate their functionality.</p>
<hr />
<p><strong>Assignment 4.6 - data frames and <code>rbind</code>/<code>cbind</code> functions</strong></p>
<div class="sourceCode" id="cb144"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb144-1" title="1">df1 &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">a =</span> <span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>), <span class="dt">b =</span> <span class="kw">c</span>(<span class="st">&quot;A&quot;</span>, <span class="st">&quot;B&quot;</span>, <span class="st">&quot;C&quot;</span>), <span class="dt">c =</span> <span class="kw">c</span>(T, F, T))</a>
<a class="sourceLine" id="cb144-2" title="2">df2 &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">a =</span> <span class="dv">1</span>, <span class="dt">b =</span> <span class="st">&quot;A&quot;</span>, <span class="dt">c =</span> <span class="dv">3</span>)</a>
<a class="sourceLine" id="cb144-3" title="3"></a>
<a class="sourceLine" id="cb144-4" title="4"><span class="co"># make a data frame which has `df1` and `df2` as rows</span></a>
<a class="sourceLine" id="cb144-5" title="5"><span class="co"># name it `df12`</span></a>
<a class="sourceLine" id="cb144-6" title="6"></a>
<a class="sourceLine" id="cb144-7" title="7"></a>
<a class="sourceLine" id="cb144-8" title="8"><span class="co"># add a `firstNames` columns containing names Ivo, Ana, Pero and Stipe</span></a>
<a class="sourceLine" id="cb144-9" title="9"><span class="co"># use `cbind`</span></a>
<a class="sourceLine" id="cb144-10" title="10"></a>
<a class="sourceLine" id="cb144-11" title="11"><span class="co"># print `df12`</span></a></code></pre></div>
<div class="fold s o">
<div class="sourceCode" id="cb145"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb145-1" title="1">df1 &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">a =</span> <span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>), <span class="dt">b =</span> <span class="kw">c</span>(<span class="st">&quot;A&quot;</span>, <span class="st">&quot;B&quot;</span>, <span class="st">&quot;C&quot;</span>), <span class="dt">c =</span> <span class="kw">c</span>(T, F, T))</a>
<a class="sourceLine" id="cb145-2" title="2">df2 &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">a =</span> <span class="dv">1</span>, <span class="dt">b =</span> <span class="st">&quot;A&quot;</span>, <span class="dt">c =</span> <span class="dv">3</span>)</a>
<a class="sourceLine" id="cb145-3" title="3"></a>
<a class="sourceLine" id="cb145-4" title="4"><span class="co"># make a data frame which has `df1` and `df2` as rows</span></a>
<a class="sourceLine" id="cb145-5" title="5"><span class="co"># name it `df12`</span></a>
<a class="sourceLine" id="cb145-6" title="6">df12 &lt;-<span class="st"> </span><span class="kw">rbind</span>(df1, df2)</a>
<a class="sourceLine" id="cb145-7" title="7"></a>
<a class="sourceLine" id="cb145-8" title="8"><span class="co"># add a `firstNames` columns containing names Ivo, Ana, Pero and Stipe</span></a>
<a class="sourceLine" id="cb145-9" title="9"><span class="co"># use `cbind`</span></a>
<a class="sourceLine" id="cb145-10" title="10">df12 &lt;-<span class="st"> </span><span class="kw">cbind</span>(df12, <span class="dt">firstNames =</span> <span class="kw">c</span>(<span class="st">&quot;Ivo&quot;</span>, <span class="st">&quot;Ana&quot;</span>, <span class="st">&quot;Pero&quot;</span>, <span class="st">&quot;Stipe&quot;</span>))</a>
<a class="sourceLine" id="cb145-11" title="11"></a>
<a class="sourceLine" id="cb145-12" title="12"><span class="co"># print `df12`</span></a>
<a class="sourceLine" id="cb145-13" title="13">df12</a></code></pre></div>
<pre><code>##   a b c firstNames
## 1 1 A 1        Ivo
## 2 2 B 0        Ana
## 3 3 C 1       Pero
## 4 1 A 3      Stipe</code></pre>
</div>
<hr />
<p>For <em>deleting rows and columns</em> we can also use the same methods for managing the matrices and lists. Specifically:</p>
<ul>
<li>deleting rows and columns can be done by using two-dimensional indexing of rows and columns that we want to “keep”</li>
<li>deleting columns can be done by assigning the value <code>NULL</code> to the selected column</li>
</ul>
<p>Let’s try this in the example.
***</p>
<p><strong>Assignment 4.7 - deleting rows and columns</strong></p>
<div class="sourceCode" id="cb147"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb147-1" title="1"><span class="co"># delete the first row and second column from `df12`</span></a>
<a class="sourceLine" id="cb147-2" title="2"><span class="co"># use the indexing method</span></a>
<a class="sourceLine" id="cb147-3" title="3"></a>
<a class="sourceLine" id="cb147-4" title="4"></a>
<a class="sourceLine" id="cb147-5" title="5"><span class="co"># delete the `firstNames` column by using the `NULL` method</span></a>
<a class="sourceLine" id="cb147-6" title="6"></a>
<a class="sourceLine" id="cb147-7" title="7"></a>
<a class="sourceLine" id="cb147-8" title="8"><span class="co"># print `df12`</span></a></code></pre></div>
<div class="fold s o">
<div class="sourceCode" id="cb148"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb148-1" title="1"><span class="co"># delete the first row and second column from `df12`</span></a>
<a class="sourceLine" id="cb148-2" title="2"><span class="co"># use the indexing method</span></a>
<a class="sourceLine" id="cb148-3" title="3">df12 &lt;-<span class="st"> </span>df12[<span class="op">-</span><span class="dv">1</span>, <span class="dv">-4</span>]    </a>
<a class="sourceLine" id="cb148-4" title="4"></a>
<a class="sourceLine" id="cb148-5" title="5"><span class="co"># delete the `firstNames` column by using the `NULL` method</span></a>
<a class="sourceLine" id="cb148-6" title="6">df12<span class="op">$</span>firstNames &lt;-<span class="st"> </span><span class="ot">NULL</span></a>
<a class="sourceLine" id="cb148-7" title="7"></a>
<a class="sourceLine" id="cb148-8" title="8"><span class="co"># print `df12`</span></a>
<a class="sourceLine" id="cb148-9" title="9">df12</a></code></pre></div>
<pre><code>##   a b c
## 2 2 B 0
## 3 3 C 1
## 4 1 A 3</code></pre>
</div>
<hr />
<p>Data frames will continue to be dealt with in the chapter on data management, where we will learn how to work with frameworks with far more data than the examples we have used in this lesson, and how to work with additional packages that significantly facilitate frequently used data actions in data frameworks. Below we will deal with another new (and slightly controversial) data structure.</p>
<hr />
<h2 id="factors"><span class="header-section-number">4.2</span> Factors</h2>
<p><strong>Factors</strong> in R are actually the type of data that represents what is referred to in statistics as a <strong>nominal</strong> or <strong>categorical</strong> variable. Namely, the attribute of some observation often takes on a value from a set of previously known categories (eg gender, age category, education, city of birth, political party preference, etc.). Categories are often identified by a unique set of characters, and in the process of analyzing them we often spend various aggregations and groupings (for example, in a sports race we can calculate the average time depending on gender or age category) or we share a set of data depending on the category.</p>
<p>Factors in R are often the subject of discussion since it is a construct that can facilitate data processing but also cause problems, especially if we are not aware that at some point we are working with a factor (this scenario is actually easily avoided, as we will explain at the end of this chapter).</p>
<hr />
<p>To begin with, we will show you what factors are, with the help of a simple example. Let’s imagine that the next character vector describes the blood pressure level in ten patients:</p>
<div class="sourceCode" id="cb150"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb150-1" title="1">bloodPressure &lt;-<span class="st"> </span><span class="kw">c</span> (<span class="st">&quot;low&quot;</span>, <span class="st">&quot;high&quot;</span>, <span class="st">&quot;high&quot;</span>, <span class="st">&quot;normal&quot;</span>, <span class="st">&quot;normal&quot;</span>,</a>
<a class="sourceLine" id="cb150-2" title="2">          <span class="st">&quot;low&quot;</span>, <span class="st">&quot;high&quot;</span>, <span class="st">&quot;low&quot;</span>, <span class="st">&quot;normal&quot;</span>, <span class="st">&quot;normal&quot;</span>)</a></code></pre></div>
<p>This is obviously a “categorical” variable since it can take one of three discrete values - <code>low</code>, <code>normal</code> and <code>high</code>. Thus, this vector is a typical candidate for “factorizing”, ie for converting to a <code>factor</code> class object. We create these vectors by using the <code>factor</code> function to which we forward the character vector of category names as a parameter.</p>
<hr />
<p><strong>Assignment 4.8 - factorizing a character vector</strong></p>
<div class="sourceCode" id="cb151"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb151-1" title="1">bloodPressure &lt;-<span class="st"> </span><span class="kw">c</span> (<span class="st">&quot;low&quot;</span>, <span class="st">&quot;high&quot;</span>, <span class="st">&quot;high&quot;</span>, <span class="st">&quot;normal&quot;</span>, <span class="st">&quot;normal&quot;</span>,</a>
<a class="sourceLine" id="cb151-2" title="2">          <span class="st">&quot;low&quot;</span>, <span class="st">&quot;high&quot;</span>, <span class="st">&quot;low&quot;</span>, <span class="st">&quot;normal&quot;</span>, <span class="st">&quot;normal&quot;</span>)</a>
<a class="sourceLine" id="cb151-3" title="3"></a>
<a class="sourceLine" id="cb151-4" title="4"><span class="co"># print the variable `bloodPressure`</span></a>
<a class="sourceLine" id="cb151-5" title="5"></a>
<a class="sourceLine" id="cb151-6" title="6"><span class="co"># print its class</span></a>
<a class="sourceLine" id="cb151-7" title="7"></a>
<a class="sourceLine" id="cb151-8" title="8"><span class="co"># create a variable `bloodPressure.f` by factorizing</span></a>
<a class="sourceLine" id="cb151-9" title="9"><span class="co"># the variable `bloodPressure`</span></a>
<a class="sourceLine" id="cb151-10" title="10"></a>
<a class="sourceLine" id="cb151-11" title="11"><span class="co"># print the variable `bloodPressure.f`</span></a>
<a class="sourceLine" id="cb151-12" title="12"></a>
<a class="sourceLine" id="cb151-13" title="13"><span class="co"># print its class</span></a></code></pre></div>
<div class="fold s o">
<div class="sourceCode" id="cb152"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb152-1" title="1">bloodPressure &lt;-<span class="st"> </span><span class="kw">c</span> (<span class="st">&quot;low&quot;</span>, <span class="st">&quot;high&quot;</span>, <span class="st">&quot;high&quot;</span>, <span class="st">&quot;normal&quot;</span>, <span class="st">&quot;normal&quot;</span>,</a>
<a class="sourceLine" id="cb152-2" title="2">          <span class="st">&quot;low&quot;</span>, <span class="st">&quot;high&quot;</span>, <span class="st">&quot;low&quot;</span>, <span class="st">&quot;normal&quot;</span>, <span class="st">&quot;normal&quot;</span>)</a>
<a class="sourceLine" id="cb152-3" title="3"></a>
<a class="sourceLine" id="cb152-4" title="4"></a>
<a class="sourceLine" id="cb152-5" title="5"><span class="co"># print the variable `bloodPressure`</span></a>
<a class="sourceLine" id="cb152-6" title="6">bloodPressure</a>
<a class="sourceLine" id="cb152-7" title="7"></a>
<a class="sourceLine" id="cb152-8" title="8"><span class="co"># print its class</span></a>
<a class="sourceLine" id="cb152-9" title="9"><span class="kw">class</span>(bloodPressure)</a>
<a class="sourceLine" id="cb152-10" title="10"></a>
<a class="sourceLine" id="cb152-11" title="11"></a>
<a class="sourceLine" id="cb152-12" title="12"></a>
<a class="sourceLine" id="cb152-13" title="13"><span class="co"># create a variable `bloodPressure.f` by factorizing</span></a>
<a class="sourceLine" id="cb152-14" title="14"><span class="co"># the variable `bloodPressure`</span></a>
<a class="sourceLine" id="cb152-15" title="15">bloodPressure.f &lt;-<span class="st"> </span><span class="kw">factor</span>(bloodPressure)</a>
<a class="sourceLine" id="cb152-16" title="16"></a>
<a class="sourceLine" id="cb152-17" title="17"><span class="kw">cat</span>(<span class="st">&quot;-----------</span><span class="ch">\n</span><span class="st">&quot;</span>)</a>
<a class="sourceLine" id="cb152-18" title="18"></a>
<a class="sourceLine" id="cb152-19" title="19"><span class="co"># print the variable `bloodPressure.f`</span></a>
<a class="sourceLine" id="cb152-20" title="20">bloodPressure.f</a>
<a class="sourceLine" id="cb152-21" title="21"></a>
<a class="sourceLine" id="cb152-22" title="22"><span class="co"># print its class</span></a>
<a class="sourceLine" id="cb152-23" title="23"><span class="kw">class</span>(bloodPressure.f)</a></code></pre></div>
<pre><code>##  [1] &quot;low&quot;    &quot;high&quot;   &quot;high&quot;   &quot;normal&quot; &quot;normal&quot; &quot;low&quot;    &quot;high&quot;  
##  [8] &quot;low&quot;    &quot;normal&quot; &quot;normal&quot;
## [1] &quot;character&quot;
## -----------
##  [1] low    high   high   normal normal low    high   low    normal normal
## Levels: high low normal
## [1] &quot;factor&quot;</code></pre>
</div>
<hr />
<p>We see that the factor print was given an additional attribute <code>Levels</code>. This means that its actually a categorical variable with listed exact categories it is allowed to take. If we try to add a new value to a factor that is not present in the current categories (e.g., “very high”) we get a warning, and instead of the category we have specified, a new item will have the value of <code>NA</code>.</p>
<p>This is sometimes not the scenario we want. If we know in advance that the character vector we categorize does not contain all the possible categories that may generally appear, we have the option of adding the <code>levels</code> parameter in which we will explicitly specify a series of" possible "categories with the help of the vector vector.</p>
<hr />
<p><strong>Assignment 4.9 - using the <code>levels</code> attribute</strong></p>
<div class="sourceCode" id="cb154"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb154-1" title="1"><span class="co"># add an 11th element to `bloodPressure.f` called &quot;very low&quot; </span></a>
<a class="sourceLine" id="cb154-2" title="2"></a>
<a class="sourceLine" id="cb154-3" title="3"><span class="co"># print the variable `bloodPressure.f`</span></a>
<a class="sourceLine" id="cb154-4" title="4"></a>
<a class="sourceLine" id="cb154-5" title="5"><span class="co"># create a variable `bloodPressure.f2` by factorizing</span></a>
<a class="sourceLine" id="cb154-6" title="6"><span class="co"># the variable `bloodPressure`</span></a>
<a class="sourceLine" id="cb154-7" title="7"><span class="co"># add the `levels` attribute which will also contain</span></a>
<a class="sourceLine" id="cb154-8" title="8"><span class="co"># values &quot;very low&quot; and &quot;very high&quot;</span></a>
<a class="sourceLine" id="cb154-9" title="9"></a>
<a class="sourceLine" id="cb154-10" title="10"><span class="co"># add an 11th element to `bloodPressure.f2` called &quot;very low&quot; </span></a>
<a class="sourceLine" id="cb154-11" title="11"></a>
<a class="sourceLine" id="cb154-12" title="12"><span class="co"># print the variable `bloodPressure.f2`</span></a></code></pre></div>
<div class="fold s o">
<div class="sourceCode" id="cb155"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb155-1" title="1"><span class="co"># add an 11th element to `bloodPressure.f` called &quot;very low&quot; </span></a>
<a class="sourceLine" id="cb155-2" title="2">bloodPressure.f[<span class="dv">11</span>] &lt;-<span class="st"> &quot;very low&quot;</span></a></code></pre></div>
<pre><code>## Warning in `[&lt;-.factor`(`*tmp*`, 11, value = &quot;very low&quot;): invalid factor
## level, NA generated</code></pre>
<div class="sourceCode" id="cb157"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb157-1" title="1"><span class="co"># print the variable `bloodPressure.f`</span></a>
<a class="sourceLine" id="cb157-2" title="2">bloodPressure.f</a>
<a class="sourceLine" id="cb157-3" title="3"></a>
<a class="sourceLine" id="cb157-4" title="4"></a>
<a class="sourceLine" id="cb157-5" title="5"><span class="kw">cat</span>(<span class="st">&quot;-----------</span><span class="ch">\n</span><span class="st">&quot;</span>)</a>
<a class="sourceLine" id="cb157-6" title="6"></a>
<a class="sourceLine" id="cb157-7" title="7"><span class="co"># create a variable `bloodPressure.f2` by factorizing</span></a>
<a class="sourceLine" id="cb157-8" title="8"><span class="co"># the variable `bloodPressure`</span></a>
<a class="sourceLine" id="cb157-9" title="9"><span class="co"># add the `levels` attribute which will also contain</span></a>
<a class="sourceLine" id="cb157-10" title="10"><span class="co"># values &quot;very low&quot; and &quot;very high&quot;</span></a>
<a class="sourceLine" id="cb157-11" title="11">bloodPressure.f2 &lt;-<span class="st"> </span><span class="kw">factor</span>(bloodPressure,</a>
<a class="sourceLine" id="cb157-12" title="12">        <span class="dt">levels =</span> <span class="kw">c</span>(<span class="st">&quot;very low&quot;</span>, <span class="st">&quot;low&quot;</span>, <span class="st">&quot;normal&quot;</span>, <span class="st">&quot;high&quot;</span>, <span class="st">&quot;very high&quot;</span>))</a>
<a class="sourceLine" id="cb157-13" title="13"></a>
<a class="sourceLine" id="cb157-14" title="14"><span class="co"># add an 11th element to `bloodPressure.f2` called &quot;very low&quot; </span></a>
<a class="sourceLine" id="cb157-15" title="15">bloodPressure.f2[<span class="dv">11</span>] &lt;-<span class="st"> &quot;very low&quot;</span></a>
<a class="sourceLine" id="cb157-16" title="16"></a>
<a class="sourceLine" id="cb157-17" title="17"><span class="co"># print the variable `bloodPressure.f2`</span></a>
<a class="sourceLine" id="cb157-18" title="18">bloodPressure.f2</a></code></pre></div>
<pre><code>##  [1] low    high   high   normal normal low    high   low    normal normal
## [11] &lt;NA&gt;  
## Levels: high low normal
## -----------
##  [1] low      high     high     normal   normal   low      high    
##  [8] low      normal   normal   very low
## Levels: very low low normal high very high</code></pre>
</div>
<hr />
<p>What is the advantage of using factors? Why not leave the variables in the original, “character” form? The reason for the factoring of categorical columns, ie variables, is that certain statistical and visualization functions “know” how to correctly interpret and use factors and treat them differently from ordinary “character” columns. For this reason, it is a very good long-term strategy that, at the beginning of R’s learning, we are used to factorizing columns that are really categorical variables (but we also note that we must not factorize columns that are not categorical variables, which can happen if we are not careful).</p>
<p>One of the frequently asked questions about the category variables is - how are individual categories represented? The answer to this question is provided by the <code>table</code> function to which we pass the selected factor.</p>
<hr />
<p><strong>Assignment 4.10 - the <code>table</code> function</strong></p>
<div class="sourceCode" id="cb159"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb159-1" title="1"><span class="co"># print how are the categories represented in `bloodPressure.f2`</span></a></code></pre></div>
<div class="fold s o">
<div class="sourceCode" id="cb160"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb160-1" title="1"><span class="co"># print how are the categories represented in `bloodPressure.f2`</span></a>
<a class="sourceLine" id="cb160-2" title="2"><span class="kw">table</span>(bloodPressure.f2)</a></code></pre></div>
<pre><code>## bloodPressure.f2
##  very low       low    normal      high very high 
##         1         3         4         3         0</code></pre>
</div>
<p>The <code>table</code> function does not necessarily require a factor and will work even with the character vector. But in that case, we would not get information about categories that were not represented at all.</p>
<hr />
<p>The categorical variable in our examples actually has the so-called ordinal nature. Ordinal category variables means that the categories have a natural order (“low” blood pressure is lower than “normal” which in turn is lower than “high”). If desired, this fact can be “embedded” in the initialization factor by simply adding the <code>order</code> parameter set to <code>TRUE</code>. The advantage of the ordinal factor is that it allows us to compare factor values with the help of comparative operators.</p>
<hr />
<p><strong>Assignment 4.11 - ordinal factor</strong></p>
<div class="sourceCode" id="cb162"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb162-1" title="1"><span class="co"># create a variable `bloodPressure.f3` by factorizing</span></a>
<a class="sourceLine" id="cb162-2" title="2"><span class="co"># the variable `bloodPressure`</span></a>
<a class="sourceLine" id="cb162-3" title="3"><span class="co"># add the `levels` attribute which will also contain</span></a>
<a class="sourceLine" id="cb162-4" title="4"><span class="co"># values &quot;very low&quot; and &quot;very high&quot;</span></a>
<a class="sourceLine" id="cb162-5" title="5"><span class="co"># also set the `order` paramater to `TRUE`</span></a>
<a class="sourceLine" id="cb162-6" title="6"><span class="co"># watch out for category ordering!</span></a>
<a class="sourceLine" id="cb162-7" title="7"></a>
<a class="sourceLine" id="cb162-8" title="8"></a>
<a class="sourceLine" id="cb162-9" title="9"><span class="co"># print the variable `bloodPressure.f3`</span></a>
<a class="sourceLine" id="cb162-10" title="10"></a>
<a class="sourceLine" id="cb162-11" title="11"></a>
<a class="sourceLine" id="cb162-12" title="12"><span class="co"># check if it is in fact the ordinal factor now</span></a>
<a class="sourceLine" id="cb162-13" title="13"><span class="co"># use the `is.ordered` function</span></a>
<a class="sourceLine" id="cb162-14" title="14"></a>
<a class="sourceLine" id="cb162-15" title="15"></a>
<a class="sourceLine" id="cb162-16" title="16"><span class="co"># check if the first patient has lower blood pressure</span></a>
<a class="sourceLine" id="cb162-17" title="17"><span class="co"># than the third</span></a></code></pre></div>
<div class="fold s o">
<div class="sourceCode" id="cb163"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb163-1" title="1"><span class="co"># create a variable `bloodPressure.f3` by factorizing</span></a>
<a class="sourceLine" id="cb163-2" title="2"><span class="co"># the variable `bloodPressure`</span></a>
<a class="sourceLine" id="cb163-3" title="3"><span class="co"># add the `levels` attribute which will also contain</span></a>
<a class="sourceLine" id="cb163-4" title="4"><span class="co"># values &quot;very low&quot; and &quot;very high&quot;</span></a>
<a class="sourceLine" id="cb163-5" title="5"><span class="co"># also set the `order` paramater to `TRUE`</span></a>
<a class="sourceLine" id="cb163-6" title="6"><span class="co"># watch out for category ordering!</span></a>
<a class="sourceLine" id="cb163-7" title="7">bloodPressure.f3 &lt;-<span class="st"> </span><span class="kw">factor</span>(bloodPressure,</a>
<a class="sourceLine" id="cb163-8" title="8">        <span class="dt">levels =</span> <span class="kw">c</span>(<span class="st">&quot;very low&quot;</span>, <span class="st">&quot;low&quot;</span>, <span class="st">&quot;normal&quot;</span>, <span class="st">&quot;high&quot;</span>, <span class="st">&quot;very high&quot;</span>),</a>
<a class="sourceLine" id="cb163-9" title="9">        <span class="dt">order =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb163-10" title="10"></a>
<a class="sourceLine" id="cb163-11" title="11"></a>
<a class="sourceLine" id="cb163-12" title="12"><span class="co"># print the variable `bloodPressure.f3`</span></a>
<a class="sourceLine" id="cb163-13" title="13">bloodPressure.f3</a>
<a class="sourceLine" id="cb163-14" title="14"></a>
<a class="sourceLine" id="cb163-15" title="15"></a>
<a class="sourceLine" id="cb163-16" title="16"><span class="co"># check if it is in fact the ordinal factor now</span></a>
<a class="sourceLine" id="cb163-17" title="17"><span class="co"># use the `is.ordered` function</span></a>
<a class="sourceLine" id="cb163-18" title="18"><span class="kw">is.ordered</span>(bloodPressure.f3)</a>
<a class="sourceLine" id="cb163-19" title="19"></a>
<a class="sourceLine" id="cb163-20" title="20"></a>
<a class="sourceLine" id="cb163-21" title="21"><span class="co"># check if the first patient has lower blood pressure</span></a>
<a class="sourceLine" id="cb163-22" title="22"><span class="co"># than the third</span></a>
<a class="sourceLine" id="cb163-23" title="23">bloodPressure.f3[<span class="dv">1</span>] <span class="op">&lt;</span><span class="st"> </span>bloodPressure.f3[<span class="dv">3</span>]</a></code></pre></div>
<pre><code>##  [1] low    high   high   normal normal low    high   low    normal normal
## Levels: very low &lt; low &lt; normal &lt; high &lt; very high
## [1] TRUE
## [1] TRUE</code></pre>
</div>
<hr />
<p>We have already seen that in R “everything is a vector” - numbers are one-dimensional numeric vectors, matrices are vectors with added dimension parameter, lists are vectors of small lists, data frames are lists with added restrictions. We may wonder - what are factors?</p>
<p>The implementation of a factor is actually a coded or enumerated set of values of initially defined character sequences, along with their associated code table. Simplifiedly, vector factorization includes:</p>
<ul>
<li>a “listing” of all detected categories (or ones set with the <code>levels</code> parameter)</li>
<li>assigning numeric values in the order of each category (eg: “low” -&gt; <code>1</code>, “normal” -&gt; <code>2</code> etc.)</li>
<li>“packing” together a newly created numeric vector and the associated “code table”</li>
</ul>
<p>Although these steps R works out automatically, the internal factor structure can be determined by converting the factor into a pure numeric or pure character type.</p>
<hr />
<p><strong>Assignment 4.12 - internal structure of a factor</strong></p>
<div class="sourceCode" id="cb165"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb165-1" title="1"><span class="co"># print `bloodPressure.f3` converted to character</span></a>
<a class="sourceLine" id="cb165-2" title="2"></a>
<a class="sourceLine" id="cb165-3" title="3"><span class="co"># print `bloodPressure.f3` converted to numeric</span></a></code></pre></div>
<div class="fold s o">
<div class="sourceCode" id="cb166"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb166-1" title="1"><span class="co"># print `bloodPressure.f3` converted to character</span></a>
<a class="sourceLine" id="cb166-2" title="2"><span class="kw">as.character</span>(bloodPressure.f3)</a>
<a class="sourceLine" id="cb166-3" title="3"></a>
<a class="sourceLine" id="cb166-4" title="4"><span class="co"># print `bloodPressure.f3` converted to numeric</span></a>
<a class="sourceLine" id="cb166-5" title="5"><span class="kw">as.numeric</span>(bloodPressure.f3)</a></code></pre></div>
<pre><code>##  [1] &quot;low&quot;    &quot;high&quot;   &quot;high&quot;   &quot;normal&quot; &quot;normal&quot; &quot;low&quot;    &quot;high&quot;  
##  [8] &quot;low&quot;    &quot;normal&quot; &quot;normal&quot;
##  [1] 2 4 4 3 3 2 4 2 3 3</code></pre>
</div>
<hr />
<p>By converting the factor to the character type we actually do the operation of inverse factorization, ie, we get the original character vector. On the other hand, by converting the factor into a numerical type, we actually get “pre-coded” numbers that the internal factor is used to represent each category. We may wonder - why would this be useful to us? The answer is - no, this is in practice usually has no direct benefit. Butthis is something which can help us understand a potential big problems which can catch us unaware.</p>
<p>The above-mentioned “controversy” around the factor as a data type is actually contained in the numerical conversion of factors. It is not actually related to the factors themselves, but rather to some of the default R settings of R when it comes to loading data. Let’s look at the detailed steps that happen during the creation of the data frame from a CSV file and try to figure out where a potential problem arises:</p>
<ol style="list-style-type: decimal">
<li>R opens a CSV file</li>
<li>Based on the read data R tries to determine column types</li>
<li>all character columns are automatically factorized unless the <code>stringsAsFactors = FALSE</code> parameter is specified</li>
<li>The final data frame is formed</li>
</ol>
<p>Do you see a possible problem? Suppose the following scenario: in a single numeric column, a non-numeric value has somehow ocurred (e.g. a <code>NULL</code> character string due to the missing value in the database). This can be just one value in more than one million rows, but that’s enough for R to classify the column as a “character column”. Since R automatically factorizes the character columns, the numeric column in the final data frame becomes categorical (although the category names are actually numbers). A clumsy analyst (or an automatic script) does not notice that it is a factor, and performs the conversion of said column into a numeric type - and obtains a completely semantically meaningless set of “transcoded” integers that, if not noticed, can be used as input data for further analysis.</p>
<hr />
<p>How to avoid this scenario? The procedure is actually very simple:</p>
<ul>
<li>When using the <code>read.csv</code> or<code>read.table</code> functions, always use the string <code>stringsAsFactors = FALSE</code></li>
<li>carefully check <strong>column type data</strong> of loaded data frame</li>
<li>perform appropriate column conversions</li>
<li>check the results again</li>
</ul>
<p>If we adhere to these steps we will almost never come to the situation which causes us real problems. There are alternate procedures (for example, explicitly telling column types read from a file with the help of <code>colClasses</code> parameters, or using the <code>as.numeric (as.character ())</code> syntax for converting columns to a numeric type that will perform the correct conversion independently of whether it is a character column or a “concealed” factor), but the above steps should in most cases be completely sufficient. The most important thing to remember is the key role of the parameter setting <code>stringsAsFactors = FALSE</code> (which is sometimes described as in literature as “mandatory”, often without any further explanation).</p>
<hr />
<h2 id="exercises-2" class="unnumbered">Exercises</h2>
<ol style="list-style-type: decimal">
<li>In the folder along with this notebook, locate the file <code>citiesNOHEADER.csv</code> which represents the file that is the same as <code>cities.csv</code> except for the following features:</li>
</ol>
<ul>
<li>column names are missing</li>
<li>the gap is used as a separator</li>
</ul>
<p>Try using the documentation to load the data from this file into the variable ’citiesNH` which will be the same variable as the cities used in the lesson.</p>
<ol start="2" style="list-style-type: decimal">
<li>In the folder along with this notebook, locate the file <code>receipt.csv</code> and load it into the <code>receipt</code> variable. Make sure that character sequences are not automatically converted into factors. Print to the screen:</li>
</ol>
<ul>
<li>the number of rows in this table</li>
<li>the number of columns in the table</li>
<li>column names</li>
</ul>
<ol start="3" style="list-style-type: decimal">
<li>For the <code>receipt</code> table, do the following:</li>
</ol>
<ul>
<li>factorize the <code>itemCategory</code> column</li>
<li>print the code, name and price of all items of the category “sweets and snacks” cheaper than 12 Kn</li>
<li>print how many products each category has in the receipt</li>
<li>add a <code>total</code> column that will contain the total price of eacg bought item set using the price and quantity</li>
<li>calculate the total amount of the account</li>
</ul>
<ol start="4" style="list-style-type: decimal">
<li>In the folder along with this note find the file <code>citiesNULL.csv</code> which, if loaded without the<code>stringsAsFactors = FALSE</code> parameter, can result in a problematic scenario described in the lesson.</li>
</ol>
<p>Try to do the following:</p>
<ul>
<li>load the data from this file into the variable <code>citiesNULL</code> where you deliberately omit the string<code>stringsAsFactors = F</code></li>
<li>add <code>avgSal1</code> column that will represent the result of using the <code>as.numeric</code> function over the <code>avgSalKn</code> column</li>
<li>add <code>avgSal2</code> column that will represent the result of using the <code>as.character</code> / <code>as.numeric</code> functions over the <code>avgSalKn</code> column (be careful of the order)</li>
<li>print out <code>citiesNULL</code> and comment the results</li>
</ul>
<hr />
<p><a rel="license" href="http://creativecommons.org/licenses/by-nc-nd/4.0/"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by-nc-nd/4.0/88x31.png" /></a><br /><span xmlns:dct="http://purl.org/dc/terms/" property="dct:title">Programirajmo u R-u</span> by <a xmlns:cc="http://creativecommons.org/ns#" href="https://www.fer.unizg.hr/en/damir.pintar" property="cc:attributionName" rel="cc:attributionURL">Damir Pintar</a> is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-nc-nd/4.0/">Creative Commons Attribution-NonCommercial-NoDerivatives 4.0 International License</a>.<br />Based on a work at <a xmlns:dct="http://purl.org/dc/terms/" href="https://ratnip.github.io/FER_OPJR/" rel="dct:source">https://ratnip.github.io/FER_OPJR/</a></p>

<h1 id="control"><span class="header-section-number">4.2</span> Flow control and objects</h1>
<hr />
<h2 id="flow-control-commands"><span class="header-section-number">4.2</span> Flow control commands</h2>
<p>Under flow control commands we mostly refer to constructs for conditional execution and so-called “program loops” where the segment of the program is continually executed until (optionally) certain conditions are fulfulled.</p>
<h3 id="conditional-execution-of-commands"><span class="header-section-number">4.2</span> Conditional execution of commands</h3>
<p>For conditional execution we use the so-called <code>if-then</code> block:</p>
<p><code>if (condition) {block} else {block}</code></p>
<p>This command is pretty straightforward. In the next exercise we will show how to avoid a relatively common error when writing <code>if</code> commands. Try to spot and correct it.</p>
<hr />
<p><strong>Assignment 5.1 - <code>if</code> command</strong></p>
<div class="sourceCode" id="cb168"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb168-1" title="1"><span class="co"># execute the next conditional execution command</span></a>
<a class="sourceLine" id="cb168-2" title="2"><span class="cf">if</span> (<span class="dv">2</span> <span class="op">&gt;</span><span class="st"> </span><span class="dv">1</span>) <span class="kw">print</span> (<span class="st">&quot;Success!&quot;</span>)</a>
<a class="sourceLine" id="cb168-3" title="3"></a>
<a class="sourceLine" id="cb168-4" title="4"></a>
<a class="sourceLine" id="cb168-5" title="5"><span class="co"># find the error in the next `if-else` command and correct it</span></a>
<a class="sourceLine" id="cb168-6" title="6"><span class="cf">if</span> (<span class="dv">1</span> <span class="op">&gt;</span><span class="st"> </span><span class="dv">2</span>) <span class="kw">print</span> (<span class="st">&quot;Success!&quot;</span>)</a>
<a class="sourceLine" id="cb168-7" title="7"><span class="cf">else</span> <span class="kw">print</span> (<span class="st">&quot;Fail!&quot;</span>)</a></code></pre></div>
<div class="fold s o">
<div class="sourceCode" id="cb169"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb169-1" title="1"><span class="co"># execute the next conditional execution command</span></a>
<a class="sourceLine" id="cb169-2" title="2"><span class="cf">if</span> (<span class="dv">2</span> <span class="op">&gt;</span><span class="st"> </span><span class="dv">1</span>) <span class="kw">print</span> (<span class="st">&quot;Success!&quot;</span>)</a>
<a class="sourceLine" id="cb169-3" title="3"></a>
<a class="sourceLine" id="cb169-4" title="4"></a>
<a class="sourceLine" id="cb169-5" title="5"><span class="co"># find the error in the next `if-else` command and correct it</span></a>
<a class="sourceLine" id="cb169-6" title="6"><span class="cf">if</span> (<span class="dv">1</span> <span class="op">&gt;</span><span class="st"> </span><span class="dv">2</span>) {<span class="kw">print</span> (<span class="st">&quot;Success!&quot;</span>)</a>
<a class="sourceLine" id="cb169-7" title="7">  } <span class="cf">else</span> <span class="kw">print</span> (<span class="st">&quot;Failed!&quot;</span>)</a></code></pre></div>
<pre><code>## [1] &quot;Success!&quot;
## [1] &quot;Failed!&quot;</code></pre>
</div>
<hr />
<p>The error occurs because R is an interpreting language that normally executes a row per line, unless we forward an “incomplete” command to R, whereby it will wait for the “rest” before it starts executing. In the previous example, the second <code>if</code>command is actually completed in the first line, so R is “surprised” when the next line starts with <code>else</code>. In order to prevent this scenario, it is sufficient to explain in some way to R that the command has not yet been completed, which is most easily accomplished by opening the block in the first line and closing it in the line with <code>else</code>.</p>
<p>The readers who are programming in C or Java will recognize the so-called “ternary operator” that actually represents a compact version of the <code>if-else</code> block:</p>
<div class="sourceCode" id="cb171"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb171-1" title="1">x =<span class="st"> </span>(a <span class="op">&lt;</span>b) ? c<span class="op">:</span><span class="st"> </span>d <span class="co"># not R language!</span></a></code></pre></div>
<p>The role of this operator in R is performed by the <code>ifelse</code> function.</p>
<hr />
<p><strong>Assignment 5.2 - <code>ifelse</code> function</strong></p>
<div class="sourceCode" id="cb172"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb172-1" title="1">a &lt;-<span class="st"> </span><span class="dv">1</span><span class="op">:</span><span class="dv">3</span></a>
<a class="sourceLine" id="cb172-2" title="2">b &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">2</span>, <span class="dv">4</span>)</a>
<a class="sourceLine" id="cb172-3" title="3"></a>
<a class="sourceLine" id="cb172-4" title="4"><span class="co"># what does the vector `x` look like after executing the following command?</span></a>
<a class="sourceLine" id="cb172-5" title="5"><span class="co"># Think about the answer and then check the correctness of the solution</span></a>
<a class="sourceLine" id="cb172-6" title="6"></a>
<a class="sourceLine" id="cb172-7" title="7">x &lt;-<span class="st"> </span><span class="kw">ifelse</span> (a <span class="op">&lt;</span><span class="st"> </span>b, <span class="dv">2</span>, <span class="dv">5</span>)</a></code></pre></div>
<div class="fold s o">
<div class="sourceCode" id="cb173"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb173-1" title="1"><span class="co"># what does the vector `x` look like after executing the following command?</span></a>
<a class="sourceLine" id="cb173-2" title="2"><span class="co"># Think about the answer and then check the correctness of the solution</span></a>
<a class="sourceLine" id="cb173-3" title="3">x &lt;-<span class="st"> </span><span class="kw">ifelse</span> (a <span class="op">&lt;</span>b, <span class="dv">2</span>, <span class="dv">5</span>)</a>
<a class="sourceLine" id="cb173-4" title="4">x</a></code></pre></div>
<pre><code>## [1] 2 2 2 2</code></pre>
</div>
<p>Note that the <code>ifelse</code> function is vectorized, which is why it is particularly suitable for creating new columns of data frames derived from certain conditions related to the existing columns.</p>
<hr />
<h2 id="program-loops"><span class="header-section-number">4.2</span> Program Loops</h2>
<p>In the programming language R we have three types of loops:</p>
<ul>
<li><code>repeat</code> - infinite loop</li>
<li><code>while</code> - loop with checking conditions at the beginning</li>
<li><code>for</code> - iterator loop (“loop with known number of repetitions”)</li>
</ul>
<h3 id="loop-repeat"><span class="header-section-number">4.2</span> Loop <code>repeat</code></h3>
<p><code>repeat</code> is the simplest loop. It has the following syntax:</p>
<p><code>repeat {block}</code></p>
<p>It is an “infinite” loop where, once the block is completed, it is re-executed again so on. The only way to exit this loop is to use the <code>break</code> command. In addition to this we have a <code>next</code> command that will skip the rest of the block, but it will not exit loop.</p>
<p>Let’s see how this loop works in the next exercise.</p>
<p><strong>Assignment 5.3 - <code>repeat</code> loop</strong></p>
<div class="sourceCode" id="cb175"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb175-1" title="1"><span class="co"># answer the following questions before running the next block:</span></a>
<a class="sourceLine" id="cb175-2" title="2"><span class="co"># - will the loop run indefinitely?</span></a>
<a class="sourceLine" id="cb175-3" title="3"><span class="co"># - what will be printed on the screen?</span></a>
<a class="sourceLine" id="cb175-4" title="4"></a>
<a class="sourceLine" id="cb175-5" title="5">i &lt;-<span class="st"> </span><span class="dv">1</span></a>
<a class="sourceLine" id="cb175-6" title="6"><span class="cf">repeat</span> {</a>
<a class="sourceLine" id="cb175-7" title="7">    i &lt;-<span class="st"> </span>i <span class="op">+</span><span class="st"> </span><span class="dv">1</span></a>
<a class="sourceLine" id="cb175-8" title="8">    <span class="cf">if</span> (i <span class="op">%%</span><span class="st"> </span><span class="dv">2</span> <span class="op">==</span><span class="st"> </span><span class="dv">0</span>) <span class="cf">next</span></a>
<a class="sourceLine" id="cb175-9" title="9">    <span class="kw">print</span> (i)</a>
<a class="sourceLine" id="cb175-10" title="10">    <span class="cf">if</span> (i<span class="op">&gt;</span><span class="st"> </span><span class="dv">10</span>) <span class="cf">break</span></a>
<a class="sourceLine" id="cb175-11" title="11">}</a></code></pre></div>
<div class="fold s o">
<pre><code>## [1] 3
## [1] 5
## [1] 7
## [1] 9
## [1] 11</code></pre>
</div>
<p>We often know the exact condition for exiting the loop and want to place it in a clearly visible place so it is not “hidden” in the body of the loop. Hence, we may find the <code>while</code> loop to be more useful.</p>
<h3 id="while-loop"><span class="header-section-number">4.2</span> <code>while</code> loop</h3>
<p><code>while</code> represents the “purest” form of the program loop whose syntax literally means “while the condition is met, repeat the specified code”:</p>
<p><code>while (condition) {block}</code></p>
<p><strong>Assignment 5.4 - <code>while</code> loop</strong></p>
<div class="sourceCode" id="cb177"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb177-1" title="1"><span class="co"># add the loop condition so it loops</span></a>
<a class="sourceLine" id="cb177-2" title="2"><span class="co"># exactly 7 times</span></a>
<a class="sourceLine" id="cb177-3" title="3"></a>
<a class="sourceLine" id="cb177-4" title="4">i &lt;-<span class="st"> </span><span class="dv">1</span></a>
<a class="sourceLine" id="cb177-5" title="5"></a>
<a class="sourceLine" id="cb177-6" title="6"><span class="cf">while</span> () {</a>
<a class="sourceLine" id="cb177-7" title="7">  <span class="kw">print</span>(i)</a>
<a class="sourceLine" id="cb177-8" title="8">  i &lt;-<span class="st"> </span>i <span class="op">+</span><span class="st"> </span><span class="dv">1</span></a>
<a class="sourceLine" id="cb177-9" title="9">}</a></code></pre></div>
<div class="fold s o">
<div class="sourceCode" id="cb178"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb178-1" title="1"><span class="co"># add the loop requirement so that it does</span></a>
<a class="sourceLine" id="cb178-2" title="2"><span class="co"># exactly 7 times</span></a>
<a class="sourceLine" id="cb178-3" title="3"></a>
<a class="sourceLine" id="cb178-4" title="4">i &lt;-<span class="st"> </span><span class="dv">1</span></a>
<a class="sourceLine" id="cb178-5" title="5"></a>
<a class="sourceLine" id="cb178-6" title="6"><span class="cf">while</span> (i <span class="op">&lt;=</span><span class="st"> </span><span class="dv">7</span>) {</a>
<a class="sourceLine" id="cb178-7" title="7">  <span class="kw">print</span>(i)</a>
<a class="sourceLine" id="cb178-8" title="8">  i &lt;-<span class="st"> </span>i <span class="op">+</span><span class="st"> </span><span class="dv">1</span></a>
<a class="sourceLine" id="cb178-9" title="9">}</a></code></pre></div>
<pre><code>## [1] 1
## [1] 2
## [1] 3
## [1] 4
## [1] 5
## [1] 6
## [1] 7</code></pre>
</div>
<p>With this loop we have to make sure that in a certain iteration conditions for exiting will be met, otherwise it also becomes an “infinite” loop. We are also free to use the <code>next</code> and<code>break</code> commands, which have the same function as in the <code>repeat</code> loop.</p>
<h3 id="for-loop"><span class="header-section-number">4.2</span> <code>for</code> loop</h3>
<p>A <code>for</code> loop or “iterator loop” serves to easily “walk” over a data structure (most commonly vector), getting element by element and doing something with it. It uses the <code>for</code> keyword, the name of the new iterator variable, the keyword<code>in</code>, and the vector whose values are taken one by one and used within the loop (note that the specified <code>in</code> is not the same as the <code>%in%</code> operator which checks if some element is contained in the vector!). The syntax of this loop is as follows:</p>
<p><code>for (i in v) {do something with i}</code></p>
<p>Note that here the variable <code>i</code> is not a “counter” - in every loop iteration it becomes the value of the element we come across. If we want to iterate by the indexes, not by the elements themselves, then we can use the construct <code>for (i in 1:length (a))</code>.</p>
<p><strong>Assignment 5.5 - <code>for</code> loop</strong></p>
<div class="sourceCode" id="cb180"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb180-1" title="1">a &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="op">-</span><span class="dv">10</span>, <span class="dv">10</span>, <span class="dv">4</span>)</a>
<a class="sourceLine" id="cb180-2" title="2"></a>
<a class="sourceLine" id="cb180-3" title="3"><span class="co"># print vector elements of `a` one by one</span></a>
<a class="sourceLine" id="cb180-4" title="4"><span class="co"># with the help of `for` loop </span></a>
<a class="sourceLine" id="cb180-5" title="5"><span class="co"># access the elements directly</span></a>
<a class="sourceLine" id="cb180-6" title="6"></a>
<a class="sourceLine" id="cb180-7" title="7"></a>
<a class="sourceLine" id="cb180-8" title="8"><span class="co"># do the same, but iterate by indexes</span></a></code></pre></div>
<div class="fold s o">
<div class="sourceCode" id="cb181"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb181-1" title="1">a &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="op">-</span><span class="dv">10</span>, <span class="dv">10</span>, <span class="dv">4</span>)</a>
<a class="sourceLine" id="cb181-2" title="2"></a>
<a class="sourceLine" id="cb181-3" title="3"><span class="co"># print vector elements of `a` one by one</span></a>
<a class="sourceLine" id="cb181-4" title="4"><span class="co"># with the help of `for` loop </span></a>
<a class="sourceLine" id="cb181-5" title="5"><span class="co"># access the elements directly</span></a>
<a class="sourceLine" id="cb181-6" title="6"><span class="cf">for</span> (i <span class="cf">in</span> a)  <span class="kw">print</span>(i)</a>
<a class="sourceLine" id="cb181-7" title="7"></a>
<a class="sourceLine" id="cb181-8" title="8"><span class="co"># do the same, but iterate by indexes</span></a>
<a class="sourceLine" id="cb181-9" title="9"><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="kw">length</span> (a)) <span class="kw">print</span>(a[i])</a></code></pre></div>
<pre><code>## [1] -10
## [1] -6
## [1] -2
## [1] 2
## [1] 6
## [1] 10
## [1] -10
## [1] -6
## [1] -2
## [1] 2
## [1] 6
## [1] 10</code></pre>
</div>
<p>Notice that the second way is better if you want to change the vector elements or need information on where the element is located in the original vector.</p>
<hr />
<p>Now that now that we have learned the loop syntax, it is important to emphasize one fact - <strong>in programming language R, it is generally not recommended to use program loops</strong>. Although this may initially seem unexpected and somewhat shocking, the reason is simple - R language is designed to work by the declarative “all at once” principle. We have already seen that the principle of vectorization and recycling effectively perform jobs that would require a loop in other programming languages, and in the chapters that follow, we will see that R also offers many other constructs that avoid explicit code repetition with the requirement of a declarative syntax that automatically performs it.</p>
<p>For example, the following example is syntactically correct:</p>
<div class="sourceCode" id="cb183"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb183-1" title="1"><span class="co"># example of unnecessary loop usage</span></a>
<a class="sourceLine" id="cb183-2" title="2">a &lt;-<span class="st"> </span><span class="dv">1</span><span class="op">:</span><span class="st"> </span><span class="dv">5</span></a>
<a class="sourceLine" id="cb183-3" title="3">b &lt;-<span class="st"> </span><span class="dv">6</span><span class="op">:</span><span class="dv">10</span></a>
<a class="sourceLine" id="cb183-4" title="4">c &lt;-<span class="st"> </span><span class="kw">numeric</span>()</a>
<a class="sourceLine" id="cb183-5" title="5"></a>
<a class="sourceLine" id="cb183-6" title="6"><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="kw">length</span> (a)) c[i] &lt;-<span class="st"> </span>a[i] <span class="op">+</span><span class="st"> </span>b[i]</a></code></pre></div>
<p>but probably works slower and is much less readable than:</p>
<div class="sourceCode" id="cb184"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb184-1" title="1"><span class="co"># R syntax</span></a>
<a class="sourceLine" id="cb184-2" title="2">a &lt;-<span class="st"> </span><span class="dv">1</span><span class="op">:</span><span class="dv">5</span></a>
<a class="sourceLine" id="cb184-3" title="3">b &lt;-<span class="st"> </span><span class="dv">6</span><span class="op">:</span><span class="dv">10</span></a>
<a class="sourceLine" id="cb184-4" title="4"></a>
<a class="sourceLine" id="cb184-5" title="5">c &lt;-<span class="st"> </span>a <span class="op">+</span><span class="st"> </span>b</a></code></pre></div>
<p>All of this does not mean that we should not use loops in R, but that their use should be accompanied by an additional consideration of whether the loop is really needed and whether there is an alternative syntax that completes the same task but can be written declaratively (and is potentially faster, since many routines in R are implemented in language C). Early adoption of the “R” mode of thinking will result in long-term benefits that will be reflected in a more compact, cleaner, and often more effective program code.</p>
<hr />
<h2 id="object-models-in-r-language"><span class="header-section-number">4.2</span> Object models in R language</h2>
<p>R is designed as an object-oriented language, together with the mechanisms that the object-oriented paradigm requires - <em>encapsulation</em> (enveloping various attributes into a common entity), <em>polymorphism</em> (using the same function over different objects results in different operations depending on the nature of the object) and <em>inheritance</em> (creating new objects from the existing ones by expanding them with additional elements).</p>
<p>R has taken its initial way of object modeling from the S language and therefore such objects are known as “S3 objects” (according to the S language version from which they were originally taken). This object model, which we will learn very soon, is actually very unconventional and simple but also as such fairly suitable for using in R, it being primarily a domain-oriented language. With the increasing number of programmersin the R community, the pressure to bring support to objects that will be more similar to the way they work in the other programming languages has increased, in order to bring better robustness in design and management of objects.</p>
<p>All this has led to the fact that today we have formally four types of objects in the programming language R:</p>
<ul>
<li>“base”" classes - basic R elements (functions, vectors, data frames)</li>
<li>S3 objects - principle of object design taken from S language (version 3)</li>
<li>S4 objects - a more formal and rigorous way of creating objects approaching standard object-oriented mechanisms from other languages</li>
<li>RC objects (<em>reference classes</em>) - the most recent way of creating objects (introduced in version 2.12) that replicates the “classical” object-oriented principles based on the exchange of messages</li>
</ul>
<p>The existence of three different models of defining objects (we can ignore the basic since we can not formally expand it with new objects) can seem disheartening - is it necessary to learn all three models? How to distinguish them? Which one to choose? However, despite the fact that the story about the object nature of R during its development is (unnecessarily) complicated, the good news is that for most needs, it’s quite enough to learn how the S3 model works, which is also the simplest. A large number of popular R packages use only S3 classes and it is possible to work in language R for a very long time without meeting the need for learning S4 or RC models. For this reason, we will focus on the S3 objects only (readers who want more information on other models can look at a very good book called <em>Advanced R</em>, by the author Hadley Wickham, which deals, among other things, with the object models in R).</p>
<hr />
<h3 id="overview-of-the-s3-object-model"><span class="header-section-number">4.2</span> Overview of the S3 object model</h3>
<p>As already mentioned, S3 objects are actually taken from S programming language and represent a relatively primitive implementation of the concept of “object”, as far as expectations go regarding standard methods of object creation. <strong>S3 object is actually just a list with the additional <code>class</code> attribute</strong>.</p>
<div class="sourceCode" id="cb185"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb185-1" title="1"><span class="co"># we are creating a new object of a class `Person`</span></a>
<a class="sourceLine" id="cb185-2" title="2">pero &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">oib =</span> <span class="st">&quot;12345678&quot;</span>, <span class="dt">lastname =</span> <span class="st">&quot;Peric&quot;</span>, <span class="dt">weight =</span> <span class="dv">78</span>)</a>
<a class="sourceLine" id="cb185-3" title="3"><span class="kw">class</span>(pero) &lt;-<span class="st"> &quot;Person&quot;</span></a></code></pre></div>
<p>And that’s it! Notice that we do not have a formally defined “template” of the class that we instance in the object as is the established practice in other programming languages. For S3 objects, we simply create a list and then declare that that list is an object of a certain class, although the structure of that class is only implied by the object’s appearance (and does not have to match the structure of another object declared to belong to the same class).</p>
<p>Of course, such a convenient way of constructing objects is not advisable so we recommend that we in practice do not construct the class “manually”, but rather to write and use a special constructor function whose parameters will actually define the object’s appearance (this will be learned in the lesson about creating user-defined functions)</p>
<p>What about inheritance, where class-child inherits properties from its parent?</p>
<p>R enables inheritance, but also in a very informal and relatively trivial way. Rather than just listing a single “class” name with the <code>class</code> attribute, we create a character vector where the first element will be the class name, and the other elements will be parent classes, sorted by ‘importance’. For example, if we created a new <code>mate</code> object of class <code>Employee</code> which inherits the class <code>Person</code>, then it is enough to do the following:</p>
<div class="sourceCode" id="cb186"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb186-1" title="1">mate &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">oib =</span> <span class="st">&quot;12345678&quot;</span>, <span class="dt">lastname =</span> <span class="st">&quot;Peric&quot;</span>, <span class="dt">weight =</span> <span class="dv">78</span>, <span class="dt">yearEmpl =</span> <span class="dv">2001</span>)</a>
<a class="sourceLine" id="cb186-2" title="2"><span class="kw">class</span>(mate) &lt;-<span class="st"> </span><span class="kw">c</span> (<span class="st">&quot;Employee&quot;</span>, <span class="st">&quot;Person&quot;</span>)</a></code></pre></div>
<p>We note that all the attribute inheritance work must be done “manually”, that is, we have to make sure that the parent has the attributes of the <code>Person</code> class.</p>
<h3 id="generic-functions"><span class="header-section-number">4.2</span> Generic functions</h3>
<p>Looking at the above way of the object design, it is legitimate to ask an additional question - where are the methods? As we know, standard object-oriented principles assume the encapsulation of the attribute but also the methods in the form of an object. Here is the basic difference between the S3 object and the “standard” objects from the other programming languages - <strong>in S3 object model the method is defined outside of the object, in the form of so-called generic functions</strong>.</p>
<p>Why is that so? The idea is the following: when working with objects, the user (programmer, analyst) often calls the same functions (eg “print”, “draw”, “summary description”) over objects of different types. The function of the same name will work differently depending on the object over which it is called - hence the name <strong>generic function</strong>. So, the <code>print</code> function always results in some kind of print, but how the printing actually works depends on the object we are printing.</p>
<p>This way of designing an object can be extremely unconventional, but the fact is that the call of a generic function makes it look far more intuitive, especially for users who do not have a big experience in programming. Specifically, let’s compare the command:</p>
<div class="sourceCode" id="cb187"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb187-1" title="1"><span class="kw">start</span>(car, <span class="dt">speed =</span> <span class="dv">20</span>)</a></code></pre></div>
<p>with the command:</p>
<div class="sourceCode" id="cb188"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb188-1" title="1"><span class="kw">car.start</span>(<span class="dt">speed =</span> <span class="dv">20</span>)</a></code></pre></div>
<p>By reading the first command, the car is perceived as an “object” (in terms of word service in a sentence), that is, something we do “to” this object. The second command sets the car as a subject, which is common practice in object-oriented languages, but is not in line with the general understanding of doing things to some objects.</p>
<p>In working with programming language R we often do “similar” tasks over different objects - we print their contents, draw them on a graph, look for some concise details of them, etc. For this reason, and the fact that R is often interactive, R is designed in a way that we think <strong>what</strong> we want to do instead of asking ourselves <strong>where</strong> the function we want to call is. If we want to print an object, it is logical to just forward it to the <code>print</code> function ,if we want to draw it the <code>plot</code> function, ans if we want to summarize it - the <code>summary</code> function.</p>
<p>How does a single function “know” what to do with an object? The answer is simple - the generic function is just “interface” to the “right” function we call, and the logic to find the right function is trivial - if the generic name of the function is <code>genFun</code>, and the name of the object class is <code>className</code>, the function actually being called is <code>genFun.className</code>. If no such function exists, the function <code>genFun.default</code> is called.</p>
<p>This can easily be seen in the next exercise.</p>
<p><strong>Assignment 5.6 - generic functions</strong></p>
<div class="sourceCode" id="cb189"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb189-1" title="1"><span class="co"># print the `summary` function (only the function name!)</span></a>
<a class="sourceLine" id="cb189-2" title="2"></a>
<a class="sourceLine" id="cb189-3" title="3"><span class="co"># print a function that is actually being called when you call</span></a>
<a class="sourceLine" id="cb189-4" title="4"><span class="co"># the `summary` function of the `factor` class object</span></a></code></pre></div>
<div class="fold s o">
<div class="sourceCode" id="cb190"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb190-1" title="1"><span class="co"># print the `summary` function (only the function name!)</span></a>
<a class="sourceLine" id="cb190-2" title="2">summary</a>
<a class="sourceLine" id="cb190-3" title="3"></a>
<a class="sourceLine" id="cb190-4" title="4"></a>
<a class="sourceLine" id="cb190-5" title="5"><span class="co"># print a function that is actually being called when you call</span></a>
<a class="sourceLine" id="cb190-6" title="6"><span class="co"># the `summary` function of the `factor` class object</span></a>
<a class="sourceLine" id="cb190-7" title="7">summary.factor</a></code></pre></div>
<pre><code>## standardGeneric for &quot;summary&quot; defined from package &quot;base&quot;
## 
## function (object, ...) 
## standardGeneric(&quot;summary&quot;)
## &lt;environment: 0x00000000145c2450&gt;
## Methods may be defined for arguments: object
## Use  showMethods(&quot;summary&quot;)  for currently available ones.
## function (object, maxsum = 100L, ...) 
## {
##     nas &lt;- is.na(object)
##     ll &lt;- levels(object)
##     if (ana &lt;- any(nas)) 
##         maxsum &lt;- maxsum - 1L
##     tbl &lt;- table(object)
##     tt &lt;- c(tbl)
##     names(tt) &lt;- dimnames(tbl)[[1L]]
##     if (length(ll) &gt; maxsum) {
##         drop &lt;- maxsum:length(ll)
##         o &lt;- sort.list(tt, decreasing = TRUE)
##         tt &lt;- c(tt[o[-drop]], `(Other)` = sum(tt[o[drop]]))
##     }
##     if (ana) 
##         c(tt, `NA&#39;s` = sum(nas))
##     else tt
## }
## &lt;bytecode: 0x000000001b674ed0&gt;
## &lt;environment: namespace:base&gt;</code></pre>
<p>By understanding the principle of generic functions, we have completed a picture of S3 objects. The most important thing we have to adopt is that in this model functions are not part of the object itself, they are defined separately, and the link between the object and its “method” is only in the function name by which R “links” the generic function and that object. Although this principle is primitive and vulnerable to faults in the hands of inattentive developers, it is easy to use and very effective. Finally, let’s note that this approach is not entirely unique to the language R - similar principles can be found in other programming languages. It is specific to R in that the principle is used openly and almost exclusively.</p>
<p>Objects and generic functions will be re-visited when we learn to create our own functions, which will enable us to create both the constructors of our objects and their generic functions.</p>
<h3 id="conclusion-on-s3-objects"><span class="header-section-number">4.2</span> Conclusion on S3 objects</h3>
<p>In short, the conclusions about S3 objects can be as follows:</p>
<ul>
<li>S3 objects function in <strong>in a simple, informal way</strong> - they are simply lists with the arbitrary value of <code>class</code> attributes</li>
<li>Much of this is left to <strong>the responsibility of the programmer</strong></li>
<li>the S3 object methods are not encapsulated within the objects, but are designed “out of” objects in the form of generic functions</li>
<li>S3 objects <strong>are not suitable for complex object models</strong> due to heavy model maintenance and large potential of errors</li>
</ul>
<h2 id="exercises-3" class="unnumbered">Exercises</h2>
<ol style="list-style-type: decimal">
<li>Create a data frame with the following command:</li>
</ol>
<div class="sourceCode" id="cb192"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb192-1" title="1">cities &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">zipcode =</span> <span class="kw">c</span>(<span class="dv">10000</span>, <span class="dv">51000</span>, <span class="dv">21000</span>, <span class="dv">31000</span>, <span class="dv">2000</span>),</a>
<a class="sourceLine" id="cb192-2" title="2">         <span class="dt">cityName =</span> <span class="kw">c</span>(<span class="st">&quot;Zagreb&quot;</span>, <span class="st">&quot;Rijeka&quot;</span>, <span class="st">&quot;Split&quot;</span>, <span class="st">&quot;Osijek&quot;</span>, <span class="st">&quot;Dubrovnik&quot;</span>),</a>
<a class="sourceLine" id="cb192-3" title="3">         <span class="dt">cityTax=</span> <span class="kw">c</span>(<span class="dv">18</span>, <span class="dv">15</span>, <span class="dv">10</span>, <span class="dv">13</span>, <span class="dv">10</span>))</a></code></pre></div>
<p>Add thie “taxLevel” which will be the ordinal factor variable with the levels “small”, “medium” and “high” depending on whether the percentage of tax is strictly smaller than 12, between 12 and 15 or strictly greater than 15. Use the <code>ifelse</code> command.</p>
<ol start="2" style="list-style-type: decimal">
<li>Replace the loops in the next block with equivalent vectorized operations (for the second loop, review the <code>sum</code> function documentation).</li>
</ol>
<div class="sourceCode" id="cb193"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb193-1" title="1">a &lt;-<span class="st"> </span><span class="kw">numeric</span>()</a>
<a class="sourceLine" id="cb193-2" title="2">i &lt;-<span class="st"> </span><span class="dv">1</span></a>
<a class="sourceLine" id="cb193-3" title="3"></a>
<a class="sourceLine" id="cb193-4" title="4"><span class="cf">while</span> (i <span class="op">&lt;=</span><span class="st"> </span><span class="dv">100</span>) {</a>
<a class="sourceLine" id="cb193-5" title="5">  a &lt;-<span class="st"> </span><span class="kw">c</span>(a, i)</a>
<a class="sourceLine" id="cb193-6" title="6">  i &lt;-<span class="st"> </span>i <span class="op">+</span><span class="st"> </span><span class="dv">1</span></a>
<a class="sourceLine" id="cb193-7" title="7">}</a>
<a class="sourceLine" id="cb193-8" title="8"></a>
<a class="sourceLine" id="cb193-9" title="9">total &lt;-<span class="st"> </span><span class="dv">0</span></a>
<a class="sourceLine" id="cb193-10" title="10"></a>
<a class="sourceLine" id="cb193-11" title="11"><span class="cf">for</span> (i <span class="cf">in</span> a) {</a>
<a class="sourceLine" id="cb193-12" title="12">  <span class="cf">if</span> (i <span class="op">%%</span><span class="st"> </span><span class="dv">2</span> <span class="op">==</span><span class="st"> </span><span class="dv">0</span>) total &lt;-<span class="st"> </span>total <span class="op">+</span><span class="st"> </span>i <span class="op">*</span><span class="st"> </span>i</a>
<a class="sourceLine" id="cb193-13" title="13">}</a>
<a class="sourceLine" id="cb193-14" title="14"></a>
<a class="sourceLine" id="cb193-15" title="15"><span class="kw">print</span> (total)</a></code></pre></div>
<ol start="3" style="list-style-type: decimal">
<li>Create a class object <code>Block</code> with the attributes <code>height</code>, <code>width</code> and <code>depth</code> equal to<code>10</code>, <code>20</code> and <code>30</code> respectively.</li>
</ol>
<hr />
<p><a rel="license" href="http://creativecommons.org/licenses/by-nc-nd/4.0/"> <img alt = "Creative Commons License" style = "border-width: 0" src = "https://i.creativecommons.org/l/by-nc-nd/4.0/88x31.png" /> </a> <br /> <span xmlns: dct = "http://purl.org/ dc / terms / "property =" dct: title "> Program in Ru &lt;/ span&gt; by <a xmlns: cc =" http://creativecommons.org/ns# "href =" https: //www.fer. unizg.hr/en/damir.pintar "property =" cc: attributionName "rel =" cc: attributionURL "> Damir Pintar </a> is licensed under <a rel =" license "href =" http: // creativecommons .org / licenses / by-nc-nd / 4.0 / "> Creative Commons Attribution-NonCommercial-NoDerivative 4.0 International License </a> <br /> Based on a work at <a xmlns: dct =" http: // purl.org/dc/terms/ "href =" https://ratnip.github.io/FER_OPJR/ "rel =" dct: source "> https://ratnip.github.io/FER_OPJR/ </a></p>

<h1 id="packages"><span class="header-section-number">4.2</span> Packages, built-in functions and environments</h1>
<hr />
<h2 id="working-with-packages"><span class="header-section-number">4.2</span> Working with packages</h2>
<p>The standard R distribution comes with two collections of packages (called <code>r-base</code> and <code>r-recommended</code>) that contain a kind of “core” of the language R-set of elements sufficient for conducting standard types of data analysis using the programming language R. In addition, <strong>CRAN</strong> (<em>Comprehensive R Archive Network</em>) is a rich repository of additional packages for a wide variety of applications, from “repairing” the basic elements of the language R to strictly specialized packages for specific types of analyses.</p>
<p>As is common practice in other programming languages, R uses a “package” or “library” system to logically organize already “programmed” collections of data, functions, and compiled code.</p>
<p>When starting the R environment, certain packages are automatically loaded in memory, making their content available for use. The list of loaded packages can be obtained using the <code>search</code> function.</p>
<hr />
<p><strong>Assignment 6.1 - search path</strong></p>
<div class="sourceCode" id="cb194"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb194-1" title="1"><span class="co"># Call the `search` function (no parameters) </span></a>
<a class="sourceLine" id="cb194-2" title="2"><span class="co"># and see which packages are loaded into the environment</span></a></code></pre></div>
<div class="fold s o">
<div class="sourceCode" id="cb195"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb195-1" title="1"><span class="co"># Call the `search` function (no parameters) </span></a>
<a class="sourceLine" id="cb195-2" title="2"><span class="co"># and see which packages are loaded into the environment</span></a>
<a class="sourceLine" id="cb195-3" title="3"><span class="kw">search</span>()</a></code></pre></div>
<pre><code>##  [1] &quot;.GlobalEnv&quot;        &quot;package:broom&quot;     &quot;package:caret&quot;    
##  [4] &quot;package:e1071&quot;     &quot;package:car&quot;       &quot;package:carData&quot;  
##  [7] &quot;package:Hmisc&quot;     &quot;package:Formula&quot;   &quot;package:survival&quot; 
## [10] &quot;package:lattice&quot;   &quot;package:sn&quot;        &quot;package:stats4&quot;   
## [13] &quot;package:gridExtra&quot; &quot;package:RSQLite&quot;   &quot;package:hflights&quot; 
## [16] &quot;package:lubridate&quot; &quot;package:GGally&quot;    &quot;package:forcats&quot;  
## [19] &quot;package:stringr&quot;   &quot;package:dplyr&quot;     &quot;package:purrr&quot;    
## [22] &quot;package:readr&quot;     &quot;package:tidyr&quot;     &quot;package:tibble&quot;   
## [25] &quot;package:ggplot2&quot;   &quot;package:tidyverse&quot; &quot;package:MASS&quot;     
## [28] &quot;package:stats&quot;     &quot;package:graphics&quot;  &quot;package:grDevices&quot;
## [31] &quot;package:utils&quot;     &quot;package:datasets&quot;  &quot;package:methods&quot;  
## [34] &quot;Autoloads&quot;         &quot;package:base&quot;</code></pre>
</div>
<hr />
<p>We see that most packages are listed as <code>package::package_name</code>. The layout of the package also represents their “priority” in the namespace traversal path, which will be discussed later.</p>
<p>If we want to load a new package into our environment, we can do this by using the <code>library</code> function with the package name provided as parameter (without quotes).</p>
<hr />
<p><strong>Assignment 6.2 - loading packages in the working environment</strong></p>
<div class="sourceCode" id="cb197"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb197-1" title="1"><span class="co"># load the `dplyr` package </span></a></code></pre></div>
<div class="fold s o">
<div class="sourceCode" id="cb198"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb198-1" title="1"><span class="co"># load the `dplyr` package </span></a>
<a class="sourceLine" id="cb198-2" title="2"><span class="kw">library</span>(dplyr)</a></code></pre></div>
</div>
<hr />
<p>The command from the previous example can have two outcomes: if the package exists on a local computer (in a folder set for additional packages), it will be loaded into the working environment. Package loading can be accompanied by messages about objects that are “masked” after loading. This in particular means that the new package has temporarily denied access to certain elements from previously loaded packages because their names match. This often does not pose any problems, but if the user has the need to access the masked elements they will have to use their “full name” - e.g. they will also have to specify the name of the package where they are located. For example, if the <code>filter</code> function of the <code>stats</code> package is masked after loading the new package, it is still available through the full name <code>stats:: filter</code>, but not directly through the name<code>filter</code>, as this will call the function from the latest loaded package. More details about how R resolves the names of variables and functions will be given below in this lesson.</p>
<p>If we do not have the above package on the local computer, we receive an error message that this package does not exist. In this case, it is necessary to retrieve the package from the CRAN repository using the <code>install.packages</code> function, which gives the name of one or more packages (with quotation marks!) as parameters. This function assumes that the R environment has a defined CRAN <em>mirror</em> ie. the specific address of the CRAN repository from where the package will be downloaded. A large number of countries have their own “copy” of the CRAN repository, but unfortunately, for unclear reasons, the Republic of Croatia no longer has its own CRAN repository, and at the time of writing this notebook there is no indication that the same will be established. If we are working in the <em>RStudio</em> interface, we have very likely placed the CRAN repository at the first startup (ie we have selected the <em>Global</em> option which our package installation requests automatically forward to the nearest CRAN repository), but if we did not do or work in another development then we need to look for a method of setting up a CRAN repository with the help of documentation, if we want to load additional packages.</p>
<hr />
<p><strong>Assignment 6.3 - installing a package from a CRAN repository</strong></p>
<div class="sourceCode" id="cb199"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb199-1" title="1"><span class="co"># install the `dplyr` package from the CRAN repository</span></a>
<a class="sourceLine" id="cb199-2" title="2"><span class="co"># (You can do this even if you already have the specified package)</span></a>
<a class="sourceLine" id="cb199-3" title="3"></a>
<a class="sourceLine" id="cb199-4" title="4"><span class="co"># load the package again into the work environment</span></a>
<a class="sourceLine" id="cb199-5" title="5"></a>
<a class="sourceLine" id="cb199-6" title="6"><span class="co"># print the search path</span></a></code></pre></div>
<div class="fold s o">
<div class="sourceCode" id="cb200"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb200-1" title="1"><span class="co"># install the `dplyr` package from the CRAN repository</span></a>
<a class="sourceLine" id="cb200-2" title="2"><span class="co"># (You can do this even if you already have the specified package)</span></a>
<a class="sourceLine" id="cb200-3" title="3"><span class="kw">install.packages</span>(<span class="st">&quot;dplyr&quot;</span>)</a>
<a class="sourceLine" id="cb200-4" title="4"></a>
<a class="sourceLine" id="cb200-5" title="5"></a>
<a class="sourceLine" id="cb200-6" title="6"><span class="co"># load the package again into the work environment</span></a>
<a class="sourceLine" id="cb200-7" title="7"><span class="kw">library</span>(dplyr)</a></code></pre></div>
</div>
<div class="fold s o">
<div class="sourceCode" id="cb201"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb201-1" title="1"><span class="co"># print the search path</span></a>
<a class="sourceLine" id="cb201-2" title="2"><span class="kw">search</span>()</a></code></pre></div>
<pre><code>##  [1] &quot;.GlobalEnv&quot;        &quot;package:broom&quot;     &quot;package:caret&quot;    
##  [4] &quot;package:e1071&quot;     &quot;package:car&quot;       &quot;package:carData&quot;  
##  [7] &quot;package:Hmisc&quot;     &quot;package:Formula&quot;   &quot;package:survival&quot; 
## [10] &quot;package:lattice&quot;   &quot;package:sn&quot;        &quot;package:stats4&quot;   
## [13] &quot;package:gridExtra&quot; &quot;package:RSQLite&quot;   &quot;package:hflights&quot; 
## [16] &quot;package:lubridate&quot; &quot;package:GGally&quot;    &quot;package:forcats&quot;  
## [19] &quot;package:stringr&quot;   &quot;package:dplyr&quot;     &quot;package:purrr&quot;    
## [22] &quot;package:readr&quot;     &quot;package:tidyr&quot;     &quot;package:tibble&quot;   
## [25] &quot;package:ggplot2&quot;   &quot;package:tidyverse&quot; &quot;package:MASS&quot;     
## [28] &quot;package:stats&quot;     &quot;package:graphics&quot;  &quot;package:grDevices&quot;
## [31] &quot;package:utils&quot;     &quot;package:datasets&quot;  &quot;package:methods&quot;  
## [34] &quot;Autoloads&quot;         &quot;package:base&quot;</code></pre>
</div>
<p>Note: as a rule, we install packages only once, through the console so that there is never a need to install the package installations in <em>R Markdown</em> documents; also, for easier organization of reports, loading all required packages is usually done by at the beginning of the document, in the code snippet called <code>setup</code>.</p>
<hr />
<p>We can notice that installing and loading packages will automatically acquire and load all the packages that are prerequisites for using the requested package, which greatly facilitates the user’s work, whu does not have to worry about what “extra” needs to be installed in order to use package features.</p>
<p>If we want to find out more information about a package, we can also do this by using the <code>library</code> function with the <code>help</code> parameter set to the package name.</p>
<div class="sourceCode" id="cb203"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb203-1" title="1"><span class="kw">library</span>(<span class="dt">help =</span> dplyr)  <span class="co"># recommendation: try directly in the console</span></a></code></pre></div>
<p>Another quite popular way of perusing documentation of the package is with the help of the so-called “vignettes”. Vignettes are actually “mini-tutorials” of a package done in HTML which present the functionality of the package in an accessible, easlly legible way with the help of detailed explanations and the associated program code. We can look at which vignettes are installed on the system by calling the <code>browseVignettes()</code> function without parameters (or optionally adding as the parameter the package name if we only care about its vignettes). If the package has only one vignette (for example, <code>stringr</code>), we can also open the vignette immediately with the help of the <code>vignette</code> option.</p>
<div class="sourceCode" id="cb204"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb204-1" title="1"><span class="kw">vignette</span>(<span class="st">&quot;stringr&quot;</span>)  <span class="co"># recommendation: try directly in the console</span></a></code></pre></div>
<hr />
<h2 id="built-in-functions"><span class="header-section-number">4.2</span> Built-in functions</h2>
<p>In previous chapters, we have already introduced some of the functions that we get together with our R distribution. These are, for example, numeric functions (<code>log</code>,<code>abs</code>, <code>sqrt</code>,<code>round</code>, etc.), vector creation functions (<code>rep</code>,<code>seq</code>, etc.), package functions (<code>install.packages</code>, <code>library</code>, etc.) and so on.</p>
<p>R rarely uses the term “built-in” functions since - as it was already shown - the R environment automatically loads some commonly used packages whose elements are immediately available for use, without necessarily indicating the name of the package they are in.</p>
<p>For example. the <code>stats</code> package contains a rich set of functions related to statistical processing. One of these functions is <code>rnorm</code>, which returns the numerical vector of the desired length whose elements are randomly selected from the normal distribution with arithmetic mean 0 and standard deviation 1 (these values can also be changed using the<code>mean</code> and <code>sd</code> parameters). If we want, we can invoke this function using the <code>package_name::function_name(parameters)</code> syntax.</p>
<hr />
<p><strong>Assignment 6.4 - calling a package function</strong></p>
<div class="sourceCode" id="cb205"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb205-1" title="1"><span class="co"># create a vector `x` that will have 10 random elements</span></a>
<a class="sourceLine" id="cb205-2" title="2"><span class="co"># drawn from standard normal distribution</span></a>
<a class="sourceLine" id="cb205-3" title="3"><span class="co"># use the full name of the `rnorm` function of the` stats` package</span></a>
<a class="sourceLine" id="cb205-4" title="4"></a>
<a class="sourceLine" id="cb205-5" title="5"></a>
<a class="sourceLine" id="cb205-6" title="6"><span class="co"># round the elements of vector `x` to two decimal places</span></a>
<a class="sourceLine" id="cb205-7" title="7"><span class="co"># use the full name of the `round` function from the `base` package</span></a>
<a class="sourceLine" id="cb205-8" title="8"></a>
<a class="sourceLine" id="cb205-9" title="9"><span class="co"># print vector `x`</span></a></code></pre></div>
<div class="fold s o">
<div class="sourceCode" id="cb206"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb206-1" title="1"><span class="co"># create a vector `x` that will have 10 random elements</span></a>
<a class="sourceLine" id="cb206-2" title="2"><span class="co"># drawn from standard normal distribution</span></a>
<a class="sourceLine" id="cb206-3" title="3"><span class="co"># use the full name of the `rnorm` function of the` stats` package</span></a>
<a class="sourceLine" id="cb206-4" title="4">x &lt;-<span class="st"> </span>stats<span class="op">::</span><span class="kw">rnorm</span>(<span class="dv">10</span>)</a>
<a class="sourceLine" id="cb206-5" title="5"></a>
<a class="sourceLine" id="cb206-6" title="6"><span class="co"># round the elements of vector `x` to two decimal places</span></a>
<a class="sourceLine" id="cb206-7" title="7"><span class="co"># use the full name of the `round` function from the `base` package</span></a>
<a class="sourceLine" id="cb206-8" title="8">x &lt;-<span class="st"> </span>base<span class="op">::</span><span class="kw">round</span>(x, <span class="dv">2</span>)</a>
<a class="sourceLine" id="cb206-9" title="9"></a>
<a class="sourceLine" id="cb206-10" title="10"><span class="co"># print vector `x`</span></a>
<a class="sourceLine" id="cb206-11" title="11">x </a></code></pre></div>
<pre><code>##  [1]  0.04  0.11  1.43  0.98 -0.62 -0.73 -0.52 -1.75  0.88  1.37</code></pre>
</div>
<hr />
<p>Although this is a syntactically correct way of calling a function, R allows us to exclude package names and simply name the function directly.</p>
<hr />
<p><strong>Assignment 6.5 - removing the package reference</strong></p>
<div class="sourceCode" id="cb208"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb208-1" title="1"><span class="co"># create vector `y` by the same principle as vector x</span></a>
<a class="sourceLine" id="cb208-2" title="2"><span class="co"># use only one line of code</span></a>
<a class="sourceLine" id="cb208-3" title="3"><span class="co"># use the function names without the name of the package</span></a>
<a class="sourceLine" id="cb208-4" title="4"></a>
<a class="sourceLine" id="cb208-5" title="5"><span class="co"># print vector `y`</span></a></code></pre></div>
<div class="fold s o">
<div class="sourceCode" id="cb209"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb209-1" title="1"><span class="co"># create vector `y` by the same principle as vector x</span></a>
<a class="sourceLine" id="cb209-2" title="2"><span class="co"># use only one line of code</span></a>
<a class="sourceLine" id="cb209-3" title="3"><span class="co"># use the function names without the name of the package</span></a>
<a class="sourceLine" id="cb209-4" title="4">y &lt;-<span class="st"> </span><span class="kw">round</span>(<span class="kw">rnorm</span>(<span class="dv">10</span>), <span class="dv">2</span>)</a>
<a class="sourceLine" id="cb209-5" title="5"></a>
<a class="sourceLine" id="cb209-6" title="6"><span class="co"># print vector `y`</span></a>
<a class="sourceLine" id="cb209-7" title="7">y</a></code></pre></div>
<pre><code>##  [1] -1.69 -0.63  0.02  0.71 -0.65  0.87  0.38  0.31  0.01 -0.04</code></pre>
</div>
<hr />
<p>We can ask ourselves - how does R know where the function we want to call is, if we did not explicitly load or specify a package containing that function? We will explain the exact reason in the next chapter dealing with the environmenst and already seen concept of the “search path”.</p>
<p>Listingg all available functions, even those that are more commonly used, would be redundant since R language is best learned with specific application in mind, and after a certain time of use the user slowly creates his/her “own” collection of functions that represent his usual “analysis toolset”. In any case, it is recommended that you select one of the publicly available R reminders (<em>reference cards</em> or <em>cheat sheets</em>) which will then always be at hand during R programming.</p>
<p>Some R reference cards are also available on the CRAN itself (it is enough to enter the <code>CRAN reference card</code> in the search engine and view the results), but here we will take the opportunity and recommend excellent cheat sheets on the pages of the RStudio interface available on the following link: <em><a href="https://www.rstudio.com/resources/cheatsheets/" class="uri">https://www.rstudio.com/resources/cheatsheets/</a></em> (Alternatively, type <code>RStudio cheat sheets</code> into the search engine). These reminders cover the majority of useful things related to the general elements of the language R (<em>Base R</em>, <em>Advanced R</em>), but also specific packages that we will later learn (<em>dplyr</em>, <em>ggplot2</em>) and represent very valuable resources both for learning R and for long-term use. To easily follow the future lessons, we recommend that you print out the mentioned reminders and get acquainted with the elements they contain.</p>
<p>Finally, let’s say that R allows us to quickly get help on the function by simply calling <code>? function_name</code> or <code>help(function_name)</code>, and that we can get examples of using the function through <code>example(function_name)</code>. We should use these calls very often even if we think that we are well acquainted with the function we are calling - it is possible that there is an additional parameter (or a related function that is also often listed in the documentation), which will further help us in carrying out the task relted to the function we want to use.</p>
<hr />
<h2 id="environments"><span class="header-section-number">4.2</span> Environments</h2>
<p>As already mentioned, work in R is usually related to managing different objects. In order to manage these objects at all, we need mechanisms to help us refer to the objects concerned. In R (and other programming languages), this is called “binding”. When we create the <code>x</code> variable of the numeric type and assign it the number <code>5</code>, we actually created a (one-element) numerical vector and created a reference to that data using a character string <code>x</code>, which we can then use to acquire that data.</p>
<p>Therefore, when we want to access some variables, R must search its internal “records” which state whichvariables currently exist, of what types they are and how to access them. In order to find the variable, R uses a mechanism called “lexical scoping”" based on the concept of “environments”.</p>
<p>The “environment” is often referred to as a “bag of names”. It helps us to logically group the names of the objects we use and to help R find the name in other environments if the variable does not exist in the current environment. The latter is enabled with the help of a fact that (almost) each environment has a parent environment. This system of parent-environment links creates a kind of “environment hierarchy”, often referred to as “search path”; R, looking for the default variable name, searches the environments “upwards” until it finds the first appearance of the requested name or encounters an the final environment (the so-called “empty environment” ). What is interesting is the fact that the environment itself is an object - we can create a reference to it, send it to functions, and so on.</p>
<p>The “default” environment in which we work and in which we create new variables is the so-called “global environment”, or <code>.GlobalEnv</code> (watch out for the dot!). It is at the bottom of the environment hierarchy. We can get a reference to it via the mentioned name of the variable, or by using the <code>globalenv()</code> function.</p>
<hr />
<p><strong>Assignment 6.6 - global environment</strong></p>
<div class="sourceCode" id="cb211"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb211-1" title="1"><span class="co"># create a variable `e` which refers to the global environment</span></a>
<a class="sourceLine" id="cb211-2" title="2"></a>
<a class="sourceLine" id="cb211-3" title="3"><span class="co"># print `e`</span></a>
<a class="sourceLine" id="cb211-4" title="4"></a>
<a class="sourceLine" id="cb211-5" title="5"><span class="co"># create a variable `x` and assign the number `5` to it</span></a>
<a class="sourceLine" id="cb211-6" title="6"></a>
<a class="sourceLine" id="cb211-7" title="7"><span class="co"># execute the `ls` function, without parameters</span></a>
<a class="sourceLine" id="cb211-8" title="8"></a>
<a class="sourceLine" id="cb211-9" title="9"><span class="co"># execute the `ls` function with `e` as a parameter</span></a>
<a class="sourceLine" id="cb211-10" title="10"></a>
<a class="sourceLine" id="cb211-11" title="11"><span class="co"># print `x`</span></a>
<a class="sourceLine" id="cb211-12" title="12"></a>
<a class="sourceLine" id="cb211-13" title="13"><span class="co"># print `e$x`    (notice the list syntax!)</span></a></code></pre></div>
<div class="fold s o">
<div class="sourceCode" id="cb212"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb212-1" title="1"><span class="co"># create a variable `e` which refers to the global environment</span></a>
<a class="sourceLine" id="cb212-2" title="2">e &lt;-<span class="st"> </span>.GlobalEnv  <span class="co"># or e &lt;- globalenv()</span></a>
<a class="sourceLine" id="cb212-3" title="3"></a>
<a class="sourceLine" id="cb212-4" title="4"><span class="co"># print `e`</span></a>
<a class="sourceLine" id="cb212-5" title="5">e</a>
<a class="sourceLine" id="cb212-6" title="6"></a>
<a class="sourceLine" id="cb212-7" title="7"><span class="co"># create a variable `x` and assign the number `5` to it</span></a>
<a class="sourceLine" id="cb212-8" title="8">x &lt;-<span class="st"> </span><span class="dv">5</span></a>
<a class="sourceLine" id="cb212-9" title="9"></a>
<a class="sourceLine" id="cb212-10" title="10"><span class="co"># execute the `ls` function, without parameters</span></a>
<a class="sourceLine" id="cb212-11" title="11"><span class="co">#ls()  # try directly on console!</span></a>
<a class="sourceLine" id="cb212-12" title="12"></a>
<a class="sourceLine" id="cb212-13" title="13"><span class="co"># execute the `ls` function with `e` as a parameter</span></a>
<a class="sourceLine" id="cb212-14" title="14"><span class="co">#ls(e)  # try directly on console!</span></a>
<a class="sourceLine" id="cb212-15" title="15"></a>
<a class="sourceLine" id="cb212-16" title="16"><span class="co"># print `x`</span></a>
<a class="sourceLine" id="cb212-17" title="17">x</a>
<a class="sourceLine" id="cb212-18" title="18"></a>
<a class="sourceLine" id="cb212-19" title="19"><span class="co"># print `e$x`    (notice the list syntax!)</span></a>
<a class="sourceLine" id="cb212-20" title="20">e<span class="op">$</span>x</a></code></pre></div>
<pre><code>## &lt;environment: R_GlobalEnv&gt;
## [1] 5
## [1] 5</code></pre>
</div>
<hr />
<p>From the last example, we can see that the environment also references itself, so this is completely correct (although unnecessarily complicated) syntax for printing the <code>x</code> variable:</p>
<div class="sourceCode" id="cb214"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb214-1" title="1">e<span class="op">$</span>e<span class="op">$</span>e<span class="op">$</span>e<span class="op">$</span>e<span class="op">$</span>e<span class="op">$</span>e<span class="op">$</span>e<span class="op">$</span>e<span class="op">$</span>e<span class="op">$</span>e<span class="op">$</span>e<span class="op">$</span>e<span class="op">$</span>e<span class="op">$</span>e<span class="op">$</span>e<span class="op">$</span>e<span class="op">$</span>e<span class="op">$</span>e<span class="op">$</span>e<span class="op">$</span>x</a></code></pre></div>
<p>The environments are somewhat similar to lists, which are in fact a kind of “encapsulation” of a number of objects in a unique structure. The most important differences between the environment and the list are:</p>
<ul>
<li>the order of elements in the environment is irrelevant</li>
<li>the environment (as a rule) has a link to the environment of the parent</li>
</ul>
<p>Let’s look at who the parent environment is to the global environment with the help of <code>parent.env</code> function.</p>
<hr />
<p><strong>Assignment 6.7 - parent environments</strong></p>
<div class="sourceCode" id="cb215"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb215-1" title="1"><span class="co"># print out the parent environment of the global environment and explain the result</span></a></code></pre></div>
<div class="fold s o">
<div class="sourceCode" id="cb216"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb216-1" title="1"><span class="co"># print out the parent environment of the global environment and explain the result</span></a>
<a class="sourceLine" id="cb216-2" title="2"><span class="kw">parent.env</span>(e)</a></code></pre></div>
<pre><code>## &lt;environment: package:broom&gt;
## attr(,&quot;name&quot;)
## [1] &quot;package:broom&quot;
## attr(,&quot;path&quot;)
## [1] &quot;C:/R/R-3.5.1/library/broom&quot;</code></pre>
</div>
<hr />
<p>Slightly unexpectedly, the parent of the global environment is the last loaded package! This is not really unusual - the global environment has a “priority” in referencing the variable, but immediately below it are the objects and functions that we last loaded into the work environment (which suits us as the assumption holds that the “most recent” package is the one that we intend to use immediately). In other words, by loading a package, the new package is always “set” between the global environment and the package that was previously loaded last. When we called <code>search</code> function, we actually got the hierarchy of environments that represented loaded packages. This environmenthierarchy is the already mentioned “search path”.</p>
<p>With the help of <code>parent.env</code>, we can determine what environment the environment will consider as a parent. In this way, we can make our own hierarchy of environments. Furthermore, the variables we create do not have to use references from the global environment (which is actually the basic function of the operator <code>&lt;-</code>), we can store them in any environment we want, but we need to use <code>assign</code> and <code>get</code>, or a combination of operators <code>$</code> and <code>&lt;-</code>.</p>
<p>Look at the example below to get the feeling how custom environments work.</p>
<hr />
<div class="fold o">
<div class="sourceCode" id="cb218"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb218-1" title="1"><span class="co"># example - a small hierarchy of custom environments</span></a>
<a class="sourceLine" id="cb218-2" title="2"></a>
<a class="sourceLine" id="cb218-3" title="3">e2 &lt;-<span class="st"> </span><span class="kw">new.env</span>()</a>
<a class="sourceLine" id="cb218-4" title="4">e3 &lt;-<span class="st"> </span><span class="kw">new.env</span>()</a>
<a class="sourceLine" id="cb218-5" title="5"></a>
<a class="sourceLine" id="cb218-6" title="6"><span class="co">#  hierarchy `e3` --&gt; `e2` --&gt; `e` (global)</span></a>
<a class="sourceLine" id="cb218-7" title="7"><span class="kw">parent.env</span>(e2) &lt;-<span class="st"> </span>e       </a>
<a class="sourceLine" id="cb218-8" title="8"><span class="kw">parent.env</span>(e3) &lt;-<span class="st"> </span>e2</a>
<a class="sourceLine" id="cb218-9" title="9"></a>
<a class="sourceLine" id="cb218-10" title="10"><span class="co"># creating variable `x` in `e2`</span></a>
<a class="sourceLine" id="cb218-11" title="11"><span class="kw">assign</span>(<span class="st">&quot;x&quot;</span>, <span class="dv">5</span>, e2)     <span class="co">#  or e2$x &lt;- 5   </span></a>
<a class="sourceLine" id="cb218-12" title="12"></a>
<a class="sourceLine" id="cb218-13" title="13"><span class="co"># checking if there is an `x` in `e2`</span></a>
<a class="sourceLine" id="cb218-14" title="14"><span class="kw">exists</span>(<span class="st">&quot;x&quot;</span>, e2)</a>
<a class="sourceLine" id="cb218-15" title="15"></a>
<a class="sourceLine" id="cb218-16" title="16"><span class="co"># printing `x` from `e2`</span></a>
<a class="sourceLine" id="cb218-17" title="17"><span class="kw">get</span>(<span class="st">&quot;x&quot;</span>, e2)       <span class="co"># or e2$x</span></a></code></pre></div>
<pre><code>## [1] TRUE
## [1] 5</code></pre>
</div>
<hr />
<p>Why use the environment in practice? The environment is a convenient way of “wrapping” a set of variables that we can then send together in a function - which is especially convenient if the relevant variables refer to some large datasets. As we will see in the next lesson, R does not support the so-called <em>call-by-reference</em> principle when sending objects to the function, but rather uses the so-called <em>copy-on-modify </em> mechanism. This means that the <strong>function will use the reference to the original object sent to it as a parameter up to the command that will try to change the object</strong>; at that moment a copy of that object is created and all the changes pertain to the copy. This can lead to a significant slowdown of programs with developers who are not familiar with this fact and who, for example, program a function that transforms the data frame. If the function instead of referring to the data frame sends a reference to the environment in which the “wrapped” frame is copied, then copying the variable will not occur because the environment is the only object for which <em>copy-on-modify</em> is not valid. We note that the special case of this method is to “send” the global environment to a function, which is actually reduced to the use of a “global variable” - something that is often avoided in other programming languages, but is not that uncommon in R.</p>
<p>Finally, let’s demonstrate the <code>attach</code> function that analysts often use to speed up the analysis process, but which can cause problems if we are not careful with its use. This function will insert the data frame directly into the search path to allow us “easier” access to variables, and with potential accidental side effects. Let’s take a look at this example.</p>
<hr />
<p><strong>Assignment 6.8 - <code>attach</code> function</strong></p>
<div class="sourceCode" id="cb220"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb220-1" title="1">cities &lt;-<span class="st"> </span><span class="kw">data.frame</span>( <span class="dt">zipcode =</span> <span class="kw">c</span>(<span class="dv">10000</span>, <span class="dv">51000</span>, <span class="dv">21000</span>, <span class="dv">31000</span>, <span class="dv">2000</span>),</a>
<a class="sourceLine" id="cb220-2" title="2">         <span class="dt">cityName =</span> <span class="kw">c</span>(<span class="st">&quot;Zagreb&quot;</span>, <span class="st">&quot;Rijeka&quot;</span>, <span class="st">&quot;Split&quot;</span>, <span class="st">&quot;Osijek&quot;</span>, <span class="st">&quot;Dubrovnik&quot;</span>),</a>
<a class="sourceLine" id="cb220-3" title="3">         <span class="dt">avgSalary =</span> <span class="kw">c</span>(<span class="fl">6359.</span>, <span class="fl">5418.</span>, <span class="fl">5170.</span>, <span class="fl">4892.</span>, <span class="fl">5348.</span>),</a>
<a class="sourceLine" id="cb220-4" title="4">         <span class="dt">population =</span> <span class="kw">c</span>(<span class="dv">790017</span>, <span class="dv">128384</span>, <span class="dv">167121</span>, <span class="dv">84104</span>, <span class="dv">28434</span>),</a>
<a class="sourceLine" id="cb220-5" title="5">         <span class="dt">tax =</span> <span class="kw">c</span>(<span class="dv">18</span>, <span class="dv">15</span>, <span class="dv">10</span>, <span class="dv">13</span>, <span class="dv">10</span>))</a>
<a class="sourceLine" id="cb220-6" title="6"></a>
<a class="sourceLine" id="cb220-7" title="7"><span class="co"># execute function `attach` with `cities` as parameter</span></a>
<a class="sourceLine" id="cb220-8" title="8"><span class="co"># do this only once!</span></a>
<a class="sourceLine" id="cb220-9" title="9"></a>
<a class="sourceLine" id="cb220-10" title="10"></a>
<a class="sourceLine" id="cb220-11" title="11"><span class="co"># print the search path and comment on the result</span></a>
<a class="sourceLine" id="cb220-12" title="12"></a>
<a class="sourceLine" id="cb220-13" title="13"></a>
<a class="sourceLine" id="cb220-14" title="14"><span class="co"># print the `zipcode` variable </span></a>
<a class="sourceLine" id="cb220-15" title="15"></a>
<a class="sourceLine" id="cb220-16" title="16"></a>
<a class="sourceLine" id="cb220-17" title="17"><span class="co"># change the third element from the `tax` variable to 12</span></a>
<a class="sourceLine" id="cb220-18" title="18"></a>
<a class="sourceLine" id="cb220-19" title="19"></a>
<a class="sourceLine" id="cb220-20" title="20"><span class="co"># print `cities`</span></a>
<a class="sourceLine" id="cb220-21" title="21"></a>
<a class="sourceLine" id="cb220-22" title="22"></a>
<a class="sourceLine" id="cb220-23" title="23"><span class="co"># execute the `ls` function</span></a>
<a class="sourceLine" id="cb220-24" title="24"></a>
<a class="sourceLine" id="cb220-25" title="25"></a>
<a class="sourceLine" id="cb220-26" title="26"><span class="co"># use the `detach` function to remove `cities` from the search path</span></a></code></pre></div>
<div class="fold s o">
<div class="sourceCode" id="cb221"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb221-1" title="1"><span class="co"># execute function `attach` with `cities` as parameter</span></a>
<a class="sourceLine" id="cb221-2" title="2"><span class="co"># do this only once!</span></a>
<a class="sourceLine" id="cb221-3" title="3"><span class="kw">attach</span>(cities)</a></code></pre></div>
<pre><code>## The following object is masked from package:tidyr:
## 
##     population</code></pre>
<div class="sourceCode" id="cb223"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb223-1" title="1"><span class="co"># print the search path and comment on the result</span></a>
<a class="sourceLine" id="cb223-2" title="2"><span class="kw">search</span>()</a>
<a class="sourceLine" id="cb223-3" title="3"></a>
<a class="sourceLine" id="cb223-4" title="4"><span class="kw">cat</span>(<span class="st">&quot;-------------------------</span><span class="ch">\n</span><span class="st">&quot;</span>)    </a>
<a class="sourceLine" id="cb223-5" title="5"></a>
<a class="sourceLine" id="cb223-6" title="6"><span class="co"># print the `zipcode` variable </span></a>
<a class="sourceLine" id="cb223-7" title="7">zipcode</a>
<a class="sourceLine" id="cb223-8" title="8"></a>
<a class="sourceLine" id="cb223-9" title="9"><span class="kw">cat</span>(<span class="st">&quot;-------------------------</span><span class="ch">\n</span><span class="st">&quot;</span>)    </a>
<a class="sourceLine" id="cb223-10" title="10"></a>
<a class="sourceLine" id="cb223-11" title="11"><span class="co"># change the third element from the `tax` variable to 12</span></a>
<a class="sourceLine" id="cb223-12" title="12">tax[<span class="dv">3</span>] &lt;-<span class="st"> </span><span class="dv">12</span></a>
<a class="sourceLine" id="cb223-13" title="13"></a>
<a class="sourceLine" id="cb223-14" title="14"><span class="co"># print `cities`</span></a>
<a class="sourceLine" id="cb223-15" title="15">cities</a>
<a class="sourceLine" id="cb223-16" title="16"></a>
<a class="sourceLine" id="cb223-17" title="17"><span class="kw">cat</span>(<span class="st">&quot;-------------------------</span><span class="ch">\n</span><span class="st">&quot;</span>)    </a>
<a class="sourceLine" id="cb223-18" title="18"></a>
<a class="sourceLine" id="cb223-19" title="19"><span class="co"># execute the `ls` function</span></a>
<a class="sourceLine" id="cb223-20" title="20"><span class="co">#ls()  # try it on console!</span></a>
<a class="sourceLine" id="cb223-21" title="21"></a>
<a class="sourceLine" id="cb223-22" title="22"><span class="co"># use the `detach` function to remove `cities` from the search path</span></a>
<a class="sourceLine" id="cb223-23" title="23"><span class="kw">detach</span>(cities)</a></code></pre></div>
<pre><code>##  [1] &quot;.GlobalEnv&quot;        &quot;cities&quot;            &quot;package:broom&quot;    
##  [4] &quot;package:caret&quot;     &quot;package:e1071&quot;     &quot;package:car&quot;      
##  [7] &quot;package:carData&quot;   &quot;package:Hmisc&quot;     &quot;package:Formula&quot;  
## [10] &quot;package:survival&quot;  &quot;package:lattice&quot;   &quot;package:sn&quot;       
## [13] &quot;package:stats4&quot;    &quot;package:gridExtra&quot; &quot;package:RSQLite&quot;  
## [16] &quot;package:hflights&quot;  &quot;package:lubridate&quot; &quot;package:GGally&quot;   
## [19] &quot;package:forcats&quot;   &quot;package:stringr&quot;   &quot;package:dplyr&quot;    
## [22] &quot;package:purrr&quot;     &quot;package:readr&quot;     &quot;package:tidyr&quot;    
## [25] &quot;package:tibble&quot;    &quot;package:ggplot2&quot;   &quot;package:tidyverse&quot;
## [28] &quot;package:MASS&quot;      &quot;package:stats&quot;     &quot;package:graphics&quot; 
## [31] &quot;package:grDevices&quot; &quot;package:utils&quot;     &quot;package:datasets&quot; 
## [34] &quot;package:methods&quot;   &quot;Autoloads&quot;         &quot;package:base&quot;     
## -------------------------
## [1] 10000 51000 21000 31000  2000
## -------------------------
##   zipcode  cityName avgSalary population tax
## 1   10000    Zagreb      6359     790017  18
## 2   51000    Rijeka      5418     128384  15
## 3   21000     Split      5170     167121  10
## 4   31000    Osijek      4892      84104  13
## 5    2000 Dubrovnik      5348      28434  10
## -------------------------</code></pre>
</div>
<hr />
<p>Let’s explain what happened in the example above. With the <code>attach</code> function, the <code>cities</code> data frame became a “mini-environment”, i.e. its columns became available within the search path. The obvious benefit of this is that we can refer to the columns directly, without referencing the original data frame and operator <code>$</code>. But this seemingly practical trick has hidden traps - first, if the column names match those of the global environment, then those columns will not be visible (we will be notified of this with an adequate warning). Second - and much more problematic - if we try to change the column of the data frame by directly referencing it, R will prevent it and will quietly apply the <em>copy-on-modify</em> principle by creating a new, global variable that will be a copy of the referenced column. An inattentive analyst can miss the fact that the changes are not reflected at the data frame itself, which can have far-reaching consequences.</p>
<p>These potential problems are very widespread among R beginners, so in the R literature it is commonly suggested that the <code>attach</code> function is not used unless it is deemed very necessary. For example. <a href ="https://google.github.io/styleguide/Rguide.xml"> Google’s R-style guide</a> says “the error potentials for using the <code>attach</code> function are numerous, so avoid it” . If we really want to simplify our code and avoid repeating the name of the data frame every time we refer to one of its columns, it is recommended to use additional packages that are designed to facilitate the management of data frames. These packages will be introduced in some of the next chapters.</p>
<hr />
<h2 id="exercises-4" class="unnumbered">Exercises</h2>
<ol style="list-style-type: decimal">
<li><p>Load the following packages in the working environment: <code>magrittr</code>, <code>dplyr</code>, <code>tidyr</code>,<code>ggplot2</code>. Print the search path and check where the loaded packages are.</p></li>
<li><p>The following commands will create a vector of 20 randomly selected natural numbers from 1 to 100.</p></li>
</ol>
<div class="sourceCode" id="cb225"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb225-1" title="1"><span class="co"># 20 random natural numbers from 1 to 100, with repetition</span></a>
<a class="sourceLine" id="cb225-2" title="2"></a>
<a class="sourceLine" id="cb225-3" title="3"><span class="kw">set.seed</span>(<span class="dv">1234</span>)</a>
<a class="sourceLine" id="cb225-4" title="4">a &lt;-<span class="st"> </span><span class="kw">sample</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">100</span>, <span class="dv">20</span>, <span class="dt">replace =</span> T)</a></code></pre></div>
<p>Use the cheat sheets and/or official documentation to find built-in functions that perform the following tasks.</p>
<p>Print</p>
<ul>
<li>vector <code>a</code></li>
<li>the values of the vector <code>a</code> arranged in reverse order</li>
<li>unique values from the vector <code>a</code></li>
<li>the values of the vector <code>a</code> sorted in ascending order</li>
</ul>
<ol start="3" style="list-style-type: decimal">
<li>We mentioned that loaded packages are actually “environments”. If we want to get a direct reference to them, we need to use <code>as.environment</code> and the package name. Try to get a reference to the <code>package::magrittr</code> package in the form of an environment, and use <code>ls</code> to check which names are contained in it.</li>
</ol>
<hr />
<p><a rel="license" href="http://creativecommons.org/licenses/by-nc-nd/4.0/"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by-nc-nd/4.0/88x31.png" /></a><br /><span xmlns:dct="http://purl.org/dc/terms/" property="dct:title">Programirajmo u R-u</span> by <a xmlns:cc="http://creativecommons.org/ns#" href="https://www.fer.unizg.hr/en/damir.pintar" property="cc:attributionName" rel="cc:attributionURL">Damir Pintar</a> is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-nc-nd/4.0/">Creative Commons Attribution-NonCommercial-NoDerivatives 4.0 International License</a>.<br />Based on a work at <a xmlns:dct="http://purl.org/dc/terms/" href="https://ratnip.github.io/FER_OPJR/" rel="dct:source">https://ratnip.github.io/FER_OPJR/</a></p>

<h1 id="user"><span class="header-section-number">4.2</span> User Defined Functions</h1>
<hr />
<p>Although R is an object-oriented programming language, it leans heavily towards the realm of functional programming. This functional paradigm is not new (it dates back to the 1950s), but has recently gained considerable popularity as a kind of complement to object-oriented programming, which might be said was the dominant programming paradigm in the last few decades.</p>
<p>In order not to delve too deep into the subject of functional programming and its relationship to object-oriented principles, we will list only a few indicative features and guidelines related to these two paradigms.</p>
<p><strong>Object-oriented programming</strong> in principle, sees the program as a system of <strong>nouns</strong> where the components are realized in the form of objects that encapsulate the attributes of the mentioned noun and the methods that perform certain tasks related to the given noun. Also, object-oriented systems focus on the <strong>controlled change of the components’ state</strong> as a result of the exchange of messages between them.</p>
<p><strong>Functional programming </strong> sees the program as system of <strong>verbs</strong> where the functions, ie the tasks we want to execute, have priority over the components over which these tasks are executed. Functional programming models the information system through <strong>components that generally do not change their own state</strong>, so that the result of the program is strictly dependent on the inputs, which facilitates testing and maintenance.</p>
<p>In short, the distinction between object-oriented programming and function programming is often stated as follows: <em>“For object-oriented programming, we create data that contains functions, and in fuctional programming we create functions containing data”</em>.</p>
<p>We do not have to be too bothered with the features of functional programming to learn R, nor should it be necessary to adopt a completely new programming paradigm. But for successful mastering of R, adapting some of the functional programming concepts can prove to be extremely useful since it will allow us to write a cleaner and more efficient code that will be in accordance with the way in which R is designed as a language.</p>
<p>In R, the following is true: <em>functions are “first-order” objects</em>, we can <em>reference them with a variable</em> of the selected environment, <em>send them to functions</em> as arguments, <em>receive as return values</em> function and <em>store them in data structures</em>, such as a list. The function in R is simply an “executable” object. A large number of functions - especially those that replace the program loop construct - work on the principle of functional languages where we perform the work in a manner that declaratively specifies which function we want to apply on which data structure, and let the programming language itself perform low-level tasks such as iteration by structure and preparation of the result. Examples of this will be learned soon, and now let’s first get to know the syntax of user defined functions in R.</p>
<hr />
<h2 id="how-to-define-a-function"><span class="header-section-number">4.2</span> How to define a function</h2>
<p>In the general case, the definition of a new function looks like this:</p>
<div class="sourceCode" id="cb226"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb226-1" title="1">function_name &lt;-<span class="st"> </span><span class="cf">function</span>(input arguments) {</a>
<a class="sourceLine" id="cb226-2" title="2">    function_body</a>
<a class="sourceLine" id="cb226-3" title="3">    return_statement</a>
<a class="sourceLine" id="cb226-4" title="4">}</a></code></pre></div>
<p>We can notice that in the function definition we use the operator <code>&lt;-</code>. This is not a coincidence - the definition of a function is nothing else than creating a `function ’object that we then associate with a particular variable; the name of the variable is actually the “name” of the function.</p>
<p>In R we do not define the types of input and output arguments. Input arguments have the name and optional default value. The function formally returns one value, which is not necessarily restrictive if we want to return more values -we simply encapsulate them in the form of a vector or list. The <code>return</code> keyword is optional - the function returns the result of the last expression in the function, so it is often enough to specify only the variable that represents the return value as the last order of the function.</p>
<p>Finally, if we want to increase the robustness of the function in such a way that we reject the execution of the logic within a function if certain conditions are not satisfied, we can use the <code>stopifnot</code> function. This function calculates the default logical expression and terminates the function if the specified condition <em>is not true</em>.</p>
<hr />
<p><strong>Assignment 7.1 - first user defined function</strong></p>
<div class="sourceCode" id="cb227"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb227-1" title="1"><span class="co"># write the function `parallelMax` which requires two numeric vectors as input</span></a>
<a class="sourceLine" id="cb227-2" title="2"><span class="co"># and returns a vector of the same size containing the larger </span></a>
<a class="sourceLine" id="cb227-3" title="3"><span class="co"># between two corresponding elements of the original vectors</span></a>
<a class="sourceLine" id="cb227-4" title="4"><span class="co"># if one or both vectors aren&#39;t numeric or aren&#39;t the same size</span></a>
<a class="sourceLine" id="cb227-5" title="5"><span class="co"># the function must throw an error</span></a>
<a class="sourceLine" id="cb227-6" title="6"><span class="co"># do not use loops!</span></a>
<a class="sourceLine" id="cb227-7" title="7"></a>
<a class="sourceLine" id="cb227-8" title="8"><span class="co"># execute this new function over the following vector pairs</span></a>
<a class="sourceLine" id="cb227-9" title="9"><span class="co"># c(T, F, T) i c(1, 2, 3)</span></a>
<a class="sourceLine" id="cb227-10" title="10"><span class="co"># c(1, 2, 3, 4) i c(5, 6, 7)</span></a>
<a class="sourceLine" id="cb227-11" title="11"><span class="co"># c(1, 2, 3) i c(0, 4, 2)</span></a>
<a class="sourceLine" id="cb227-12" title="12"></a>
<a class="sourceLine" id="cb227-13" title="13"><span class="co"># (second part of the exercise should be tested inside the console!)</span></a></code></pre></div>
<div class="fold s o">
<div class="sourceCode" id="cb228"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb228-1" title="1"><span class="co"># write the function `parallelMax` which requires two numeric vectors as input</span></a>
<a class="sourceLine" id="cb228-2" title="2"><span class="co"># and returns a vector of the same size containing the larger </span></a>
<a class="sourceLine" id="cb228-3" title="3"><span class="co"># between two corresponding elements of the original vectors</span></a>
<a class="sourceLine" id="cb228-4" title="4"><span class="co"># if one or both vectors aren&#39;t numeric or aren&#39;t the same size</span></a>
<a class="sourceLine" id="cb228-5" title="5"><span class="co"># the function must throw an error</span></a>
<a class="sourceLine" id="cb228-6" title="6"><span class="co"># do not use loops!</span></a>
<a class="sourceLine" id="cb228-7" title="7"></a>
<a class="sourceLine" id="cb228-8" title="8">parallelMax &lt;-<span class="st"> </span><span class="cf">function</span>(a, b) {</a>
<a class="sourceLine" id="cb228-9" title="9">    <span class="kw">stopifnot</span>(<span class="kw">is.numeric</span>(a) <span class="op">&amp;&amp;</span><span class="st"> </span><span class="kw">is.numeric</span>(b) <span class="op">&amp;&amp;</span><span class="st"> </span><span class="kw">length</span>(a) <span class="op">==</span><span class="st"> </span><span class="kw">length</span>(b));</a>
<a class="sourceLine" id="cb228-10" title="10">    <span class="kw">ifelse</span>(a <span class="op">&gt;</span><span class="st"> </span>b, a, b)</a>
<a class="sourceLine" id="cb228-11" title="11">}</a></code></pre></div>
</div>
<hr />
<p>When calling a function, we can optionally specify the parameter names, and R will even allow the mixing of named and unnamed parameters (although this is not something we should often use in practice). When R connects the sent values with formal parameters, the named parameters will have priority and will be resolved first, after which the unnamed parameters will be resolved in te order they were provided.</p>
<p>We can see this in the next exercise, in which we will use the opportunity to showcase a very useful function - <code>paste</code>. This function concatenates character strings with the addition of a space separator (there is an alternative function <code>paste0</code> for joining without spaces).</p>
<hr />
<p><strong>Assignment 7.2 - function parameters</strong></p>
<div class="sourceCode" id="cb229"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb229-1" title="1">printABC &lt;-<span class="st"> </span><span class="cf">function</span>(a, b, c) {</a>
<a class="sourceLine" id="cb229-2" title="2">   <span class="kw">print</span>(<span class="kw">paste</span>(<span class="st">&quot;A:&quot;</span>, a, <span class="st">&quot;B:&quot;</span>, b, <span class="st">&quot;C:&quot;</span>, c))   </a>
<a class="sourceLine" id="cb229-3" title="3">}</a>
<a class="sourceLine" id="cb229-4" title="4"></a>
<a class="sourceLine" id="cb229-5" title="5"><span class="co"># think before executing - what will be printed with the following command? </span></a>
<a class="sourceLine" id="cb229-6" title="6"><span class="kw">printABC</span>(<span class="dv">1</span>, <span class="dt">a =</span> <span class="dv">2</span>, <span class="dv">3</span>)</a></code></pre></div>
<div class="fold s o">
<div class="sourceCode" id="cb230"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb230-1" title="1">printABC &lt;-<span class="st"> </span><span class="cf">function</span>(a, b, c) {</a>
<a class="sourceLine" id="cb230-2" title="2">   <span class="kw">print</span>(<span class="kw">paste</span>(<span class="st">&quot;A:&quot;</span>, a, <span class="st">&quot;B:&quot;</span>, b, <span class="st">&quot;C:&quot;</span>, c))   </a>
<a class="sourceLine" id="cb230-3" title="3">}</a>
<a class="sourceLine" id="cb230-4" title="4"></a>
<a class="sourceLine" id="cb230-5" title="5"><span class="kw">printABC</span>(<span class="dv">1</span>, <span class="dt">a =</span> <span class="dv">2</span>, <span class="dv">3</span>)</a></code></pre></div>
<pre><code>## [1] &quot;A: 2 B: 1 C: 3&quot;</code></pre>
</div>
<hr />
<p>In practice, we should stick to conventions to first use unnamed parameters, and then named. It is customary to set only those named parameters whose default value does not suit us, whereas strict ordering does not matter (although using the order provided in the function definition will increase the legibility of our code).</p>
<p>If we want to write a function that receives an arbitrary number of arguments, we use the element <code>...</code>, i.e. the ellipsis. An example of this feature is the built-in <code>paste</code> function which can receive an arbitrary number of character strings. If we use the ellipsis in our functions, we should place them at the end of the list of input arguments, and within the function itself we simply convert it into a list, and then access its parameters in the way that suits us.</p>
<hr />
<p><strong>Assignment 7.3 - function with an arbitrary number of parameters</strong></p>
<div class="sourceCode" id="cb232"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb232-1" title="1">printParams &lt;-<span class="st"> </span><span class="cf">function</span>(...) {</a>
<a class="sourceLine" id="cb232-2" title="2">   params &lt;-<span class="st"> </span><span class="kw">list</span>(...)</a>
<a class="sourceLine" id="cb232-3" title="3">   <span class="cf">for</span> (p <span class="cf">in</span> params) <span class="kw">print</span>(p)</a>
<a class="sourceLine" id="cb232-4" title="4">}</a>
<a class="sourceLine" id="cb232-5" title="5"></a>
<a class="sourceLine" id="cb232-6" title="6"><span class="co"># call the above function with any random parameters</span></a></code></pre></div>
<div class="fold s o">
<div class="sourceCode" id="cb233"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb233-1" title="1"><span class="kw">printParams</span>(<span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>), <span class="dv">5</span>, T, <span class="kw">data.frame</span>(<span class="dt">x =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">2</span>, <span class="dt">y =</span> <span class="kw">c</span>(T, F)))</a></code></pre></div>
<pre><code>## [1] 1 2 3
## [1] 5
## [1] TRUE
##   x     y
## 1 1  TRUE
## 2 2 FALSE</code></pre>
</div>
<hr />
<p>Finally, let’s recall the chapter in which we talked about S3 objects and the fact that R does not have a formal system for creating and using objects, but it is recommended that you use a separate constructor function that replaces the “manual” matching of the object and the declaration of its class. Now that we know how to create our own functions, we can look at how a potential constructor of the ‘Person’ class would look.</p>
<div class="sourceCode" id="cb235"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb235-1" title="1"><span class="co"># constructor of the `Person` class</span></a>
<a class="sourceLine" id="cb235-2" title="2"></a>
<a class="sourceLine" id="cb235-3" title="3">Person &lt;-<span class="st"> </span><span class="cf">function</span>(id, surname, weight) {</a>
<a class="sourceLine" id="cb235-4" title="4"></a>
<a class="sourceLine" id="cb235-5" title="5">    <span class="kw">stopifnot</span>(<span class="kw">is.character</span>(id))</a>
<a class="sourceLine" id="cb235-6" title="6">    <span class="kw">stopifnot</span>(<span class="kw">is.character</span>(surname))</a>
<a class="sourceLine" id="cb235-7" title="7">    <span class="kw">stopifnot</span>(<span class="kw">is.numeric</span>(weight) <span class="op">&amp;&amp;</span><span class="st"> </span>weight <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>)</a>
<a class="sourceLine" id="cb235-8" title="8"></a>
<a class="sourceLine" id="cb235-9" title="9">    p &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">id =</span> id, <span class="dt">surname =</span> surname, <span class="dt">weight =</span> weight)</a>
<a class="sourceLine" id="cb235-10" title="10">    <span class="kw">class</span>(p) &lt;-<span class="st"> &quot;Person&quot;</span></a>
<a class="sourceLine" id="cb235-11" title="11"></a>
<a class="sourceLine" id="cb235-12" title="12">    p</a>
<a class="sourceLine" id="cb235-13" title="13">}</a></code></pre></div>
<p>Let’s try to create a new object of the <code>Person</code> class with the help of this constructor.</p>
<hr />
<p><strong>Assignment 7.4 - constructor function</strong></p>
<div class="sourceCode" id="cb236"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb236-1" title="1"><span class="co"># create `john`, a `Person` with the following characeristics:</span></a>
<a class="sourceLine" id="cb236-2" title="2"><span class="co"># id: 1357135713, surname: Watson, weight: 76</span></a>
<a class="sourceLine" id="cb236-3" title="3"></a>
<a class="sourceLine" id="cb236-4" title="4"><span class="co"># print `john`</span></a></code></pre></div>
<div class="fold s o">
<div class="sourceCode" id="cb237"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb237-1" title="1">john &lt;-<span class="st"> </span><span class="kw">Person</span>(<span class="st">&quot;135135713&quot;</span>, <span class="st">&quot;Watson&quot;</span>, <span class="dv">76</span>)</a>
<a class="sourceLine" id="cb237-2" title="2"></a>
<a class="sourceLine" id="cb237-3" title="3">john</a></code></pre></div>
<pre><code>## $id
## [1] &quot;135135713&quot;
## 
## $surname
## [1] &quot;Watson&quot;
## 
## $weight
## [1] 76
## 
## attr(,&quot;class&quot;)
## [1] &quot;Person&quot;</code></pre>
</div>
<hr />
<p>The advantage of the constructor is additional robustness in the form of exactly defined attribute names, as well as the capabilities of embedding additional checks (eg <code>id</code> and <code>surname</code> must be character strings and the <code>weight</code> must be a number, etc.). If we create our own S3 objects, it is recommended that we define the corresponding constructor functions for them.</p>
<hr />
<h3 id="the-copy-on-modify-principle"><span class="header-section-number">4.2</span> The “copy-on-modify” principle</h3>
<p>One of the more common questions raised when learning a new programming language is whether the functions work in “call-by-value” or “call-by-reference” mode. The difference is basically whether the function may change the content of the variables sent at the place of the formal argument or not; <em>call-by-value</em> principle forward only copies of original arguments. On the other hand, the <em>call-by-reference</em> principle makes it so the function receives “references” of the original variables, i.e. it behaves as if the original variables were passed to the function and all changes to them would be reflected in the calling function or program.</p>
<p>The language R uses a hybrid principle known as <em>copy-on-modify</em>. With this principle, references are forwarded to the function, which allows us to transmit “large” variables without fear of unnecessary copying. But this is only valid if the function does not change the value of the resulting variables - at the moment when the function attempts to make any changes, copying the variable is carried out and the function continues to work on the copy. Because of this it is said that R as such does not support <em>call-by-reference</em> (one reason for introducing “reference class” objects, i.e. “RC object model” into language R, is precisely the introduction of this principle).</p>
<p>Let’s check the above statements in a following example.</p>
<hr />
<div class="sourceCode" id="cb239"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb239-1" title="1"><span class="co"># attempt to change variables from the calling environment</span></a>
<a class="sourceLine" id="cb239-2" title="2"></a>
<a class="sourceLine" id="cb239-3" title="3">f &lt;-<span class="st"> </span><span class="cf">function</span>() {</a>
<a class="sourceLine" id="cb239-4" title="4">    <span class="kw">cat</span>(<span class="st">&quot;x inside function:&quot;</span>, x, <span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>)</a>
<a class="sourceLine" id="cb239-5" title="5">    x &lt;-<span class="st"> </span>x <span class="op">+</span><span class="st"> </span><span class="dv">1</span></a>
<a class="sourceLine" id="cb239-6" title="6">    <span class="kw">cat</span>(<span class="st">&quot;x after change:&quot;</span>, x, <span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>)</a>
<a class="sourceLine" id="cb239-7" title="7">}</a>
<a class="sourceLine" id="cb239-8" title="8"></a>
<a class="sourceLine" id="cb239-9" title="9">x &lt;-<span class="st"> </span><span class="dv">5</span></a>
<a class="sourceLine" id="cb239-10" title="10"><span class="kw">f</span>()</a>
<a class="sourceLine" id="cb239-11" title="11"><span class="kw">cat</span>(<span class="st">&quot;x after return:&quot;</span>, x, <span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>)</a></code></pre></div>
<pre><code>## x inside function: 5 
## x after change: 6 
## x after return: 5</code></pre>
<hr />
<p>The function actually creates a new temporary environment within which it stores “local” variables. In the above example, the <code>f</code> function introduces a new <code>x</code> variable that masks the external variable <code>x</code> so that all changes no longer reflect the value of the external variable.</p>
<p>It is important to note that the function could access an external variable even without sending it to the function, since by referencing the <code>x</code> variable that does not exist in the local environment the R search function will continue in the parent’s environment, which in this case would be the global environment. Attempting to change this variable would still fail - R would detect an attempt to change the variable and create a local copy of the same name.</p>
<p>Does this mean that a function can never change variables from the calling environment? Of course not. One way to do this is to send a reference to the environment within which the object we are changing exists (or, alternatively, let the function itself get a reference to the global environment if the variable is there).</p>
<hr />
<p><strong>Assignment 7.5 - changing global environment variables</strong></p>
<div class="sourceCode" id="cb241"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb241-1" title="1"><span class="co"># implement function `f` which gets a reference to the global environment</span></a>
<a class="sourceLine" id="cb241-2" title="2"><span class="co"># and increases the &quot;outer&quot; `x` by 1</span></a>
<a class="sourceLine" id="cb241-3" title="3"></a>
<a class="sourceLine" id="cb241-4" title="4">x &lt;-<span class="st"> </span><span class="dv">5</span></a>
<a class="sourceLine" id="cb241-5" title="5"><span class="co"># call `f(x)` and then print `x`</span></a></code></pre></div>
<div class="fold s o">
<div class="sourceCode" id="cb242"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb242-1" title="1"><span class="co"># implement function `f` which gets a reference to the global environment</span></a>
<a class="sourceLine" id="cb242-2" title="2"><span class="co"># and increases the &quot;outer&quot; `x` by 1</span></a>
<a class="sourceLine" id="cb242-3" title="3">f &lt;-<span class="st"> </span><span class="cf">function</span>() {</a>
<a class="sourceLine" id="cb242-4" title="4">  e &lt;-<span class="st"> </span><span class="kw">globalenv</span>()</a>
<a class="sourceLine" id="cb242-5" title="5">  e<span class="op">$</span>x &lt;-<span class="st"> </span>e<span class="op">$</span>x <span class="op">+</span><span class="st"> </span><span class="dv">1</span></a>
<a class="sourceLine" id="cb242-6" title="6">}</a>
<a class="sourceLine" id="cb242-7" title="7"></a>
<a class="sourceLine" id="cb242-8" title="8">x &lt;-<span class="st"> </span><span class="dv">5</span></a>
<a class="sourceLine" id="cb242-9" title="9"><span class="co"># call `f(x)` and then print `x`</span></a>
<a class="sourceLine" id="cb242-10" title="10"><span class="kw">f</span>()</a>
<a class="sourceLine" id="cb242-11" title="11"><span class="kw">print</span>(x)</a></code></pre></div>
<pre><code>## [1] 6</code></pre>
</div>
<hr />
<p>A simpler way of solving the above task would be using the <code>&lt;&lt;-</code> operator. This operator’s function is to change the variable of the given name that is located somewhere in the search path. R will follow the search path, and change the first occurrence of the specified variable. If the variable of this name does not exist anywhere in the search path, R will create a new variable in the first environment above the environment of the function.</p>
<div class="sourceCode" id="cb244"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb244-1" title="1"><span class="co"># operator `&lt;&lt;-`</span></a>
<a class="sourceLine" id="cb244-2" title="2">f &lt;-<span class="st"> </span><span class="cf">function</span>(x) {</a>
<a class="sourceLine" id="cb244-3" title="3">    x &lt;&lt;-<span class="st"> </span><span class="dv">7</span></a>
<a class="sourceLine" id="cb244-4" title="4">    x &lt;-<span class="st"> </span><span class="dv">6</span></a>
<a class="sourceLine" id="cb244-5" title="5">}</a>
<a class="sourceLine" id="cb244-6" title="6"></a>
<a class="sourceLine" id="cb244-7" title="7">x &lt;-<span class="st"> </span><span class="dv">5</span></a>
<a class="sourceLine" id="cb244-8" title="8"><span class="kw">f</span>()</a>
<a class="sourceLine" id="cb244-9" title="9">x</a></code></pre></div>
<pre><code>## [1] 7</code></pre>
<p>This operator is potentially unpredictable and we will achieve greater robustness using the <code>assign</code> or<code>$</code>operator with reference to the environment where the variable we want to change is.</p>
<p>Finally, we must mention one feature of functions in R - the so-called. “lazy evaluation”. This simply means that R will not evaluate the received parameter until it is explicitly used. Up to that moment, this object is so-called. “promise” - R “knows” how to evaluate that object but it will not do so until it really needs it. This increases the efficiency of the language; if a parameter is used only in a conditional branch, then in scenarios when it is not needed it will not consume memory. But equally, we need to be careful because a lazy evaluation can lead to unexpected problems if we do not take into account its existence.</p>
<h3 id="function-as-an-object"><span class="header-section-number">4.2</span> Function as an object</h3>
<p>We have already said that R has good support for the so-called “functional programming” which represents a programming paradigm that puts emphasis on designing functions without reliance on objects with interchangeable states. One of the characteristics of such languages are “first class functions”, which means that the language supports the definition of functions in such a way that they are equal objects to all other types of objects - they can be stored in a variable, used as an input argument of another function or as a return value, stored in other data structures, etc.</p>
<p>Let us show this on a trivial example. We know that R offers the function <code>sum</code> within the <code>base</code> package, and this function calculates the arithmetic sum of the vector elements we send to it as an input parameter. But <code>sum</code> is actually <em>the name of the variable</em> that references the code that implements this function. If we want, we can very easily bind this function to some other variable by which we have effectively changed its name, or - better said - provided an alternative way of calling from a completely different environment.</p>
<div class="sourceCode" id="cb246"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb246-1" title="1">sum2 &lt;-<span class="st"> </span>sum</a>
<a class="sourceLine" id="cb246-2" title="2"></a>
<a class="sourceLine" id="cb246-3" title="3"><span class="kw">sum2</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>)  <span class="co"># same as sum(1:10)</span></a></code></pre></div>
<p>This is easiest to understand in a way that the function is simply an “callable variable”, whereby the “call” refers to the use of a syntax that includes a reference to the function and input arguments framed in parentheses, which will return some value after execution in the R environment.</p>
<hr />
<p>The function can also be a return value from another function.</p>
<div class="sourceCode" id="cb247"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb247-1" title="1">funcCreator &lt;-<span class="st"> </span><span class="cf">function</span>() {</a>
<a class="sourceLine" id="cb247-2" title="2">    f &lt;-<span class="st"> </span><span class="cf">function</span>(x) x <span class="op">+</span><span class="st"> </span><span class="dv">1</span></a>
<a class="sourceLine" id="cb247-3" title="3">    <span class="kw">return</span>(f)</a>
<a class="sourceLine" id="cb247-4" title="4">}</a>
<a class="sourceLine" id="cb247-5" title="5"></a>
<a class="sourceLine" id="cb247-6" title="6">newFunc &lt;-<span class="st"> </span><span class="kw">funcCreator</span>() <span class="co"># we get the &quot;add one&quot; function</span></a>
<a class="sourceLine" id="cb247-7" title="7"><span class="kw">newFunc</span>(<span class="dv">5</span>)  </a></code></pre></div>
<pre><code>## [1] 6</code></pre>
<p>The function simply creats a new function and returns it to the calling program as it would have done with any other object. The return value is stored in the variable that is now “callable” - if we add brackets and parameters it will be executed in the way it is defined within the function that created it.</p>
<p>Note that we could use the fact that the function returns the result of the last expression and define the function even shorter:</p>
<div class="sourceCode" id="cb249"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb249-1" title="1"><span class="co"># shorter definition</span></a>
<a class="sourceLine" id="cb249-2" title="2">funcCreator &lt;-<span class="st"> </span><span class="cf">function</span>() {</a>
<a class="sourceLine" id="cb249-3" title="3">    <span class="cf">function</span>(x) x <span class="op">+</span><span class="st"> </span><span class="dv">1</span></a>
<a class="sourceLine" id="cb249-4" title="4">}</a></code></pre></div>
<p>These functions are often referred to as “factories” or “generators” of functions, and in contrast to the above example, in practice, the function generator often receives some parameters that determine how the returned function will behave.</p>
<p>Try to create a function factory that returns the multiplication functions using a pre-set parameter.</p>
<hr />
<p><strong>Assignment 7.6 - function factory</strong></p>
<div class="sourceCode" id="cb250"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb250-1" title="1"><span class="co"># create the `multiplicationFactory` function that creates </span></a>
<a class="sourceLine" id="cb250-2" title="2"><span class="co"># multiplication functions by the pre-set constant</span></a>
<a class="sourceLine" id="cb250-3" title="3"></a>
<a class="sourceLine" id="cb250-4" title="4"><span class="co"># use the above function to create the `times2` function</span></a>
<a class="sourceLine" id="cb250-5" title="5"><span class="co"># which doubles the received number</span></a>
<a class="sourceLine" id="cb250-6" title="6"></a>
<a class="sourceLine" id="cb250-7" title="7"><span class="co"># call the `times2` function with parameter 3 and print out the result</span></a></code></pre></div>
<div class="fold s o">
<div class="sourceCode" id="cb251"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb251-1" title="1"><span class="co"># create the `multiplicationFactory` function that creates </span></a>
<a class="sourceLine" id="cb251-2" title="2"><span class="co"># multiplication functions by the pre-set constant</span></a>
<a class="sourceLine" id="cb251-3" title="3">multiplicationFactory &lt;-<span class="st"> </span><span class="cf">function</span>(x) {</a>
<a class="sourceLine" id="cb251-4" title="4">  <span class="cf">function</span>(a) a<span class="op">*</span>x</a>
<a class="sourceLine" id="cb251-5" title="5">}</a>
<a class="sourceLine" id="cb251-6" title="6"></a>
<a class="sourceLine" id="cb251-7" title="7"><span class="co"># use the above function to create the `times2` function</span></a>
<a class="sourceLine" id="cb251-8" title="8"><span class="co"># which doubles the received number</span></a>
<a class="sourceLine" id="cb251-9" title="9">times2 &lt;-<span class="st"> </span><span class="kw">multiplicationFactory</span>(<span class="dv">2</span>)</a>
<a class="sourceLine" id="cb251-10" title="10"></a>
<a class="sourceLine" id="cb251-11" title="11"><span class="co"># call the `times2` function with parameter 3 and print out the result</span></a>
<a class="sourceLine" id="cb251-12" title="12"><span class="kw">times2</span>(<span class="dv">3</span>)</a></code></pre></div>
<pre><code>## [1] 6</code></pre>
</div>
<p>The <code>multiplicationFactory</code> function actually creates a “family” of functions that all provide the multiplication option with the selected number - i.e. parameter selected by the programmer itself. This way of managing functions may be initially confusing, but by using it in practice (which we will show in the next chapter), it is easy to notice the added flexibility and effectiveness of such an approach.</p>
<hr />
<p>If we define a function, and do not bind it to some variable, then we created the so-called “anonymous function”.</p>
<div class="sourceCode" id="cb253"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb253-1" title="1"><span class="co"># anonymous function</span></a>
<a class="sourceLine" id="cb253-2" title="2"><span class="cf">function</span>(x) x <span class="op">*</span><span class="st"> </span>x </a></code></pre></div>
<p>We can notice that each function is initially “anonymous”. If we return to the function definition syntax, we see that it is actually a combination of creating an anonymous function and binding it to a new variable. Of course, leaving the function anonymous as we did in the example above does not make much sense, just as it does not make sense to define a vector or list without creating a reference to that object - in that case the created object is not in any way usable because there are no links to it and will be quickly deleted by R within the “garbage collection” routine.</p>
<p>We can ask ourselves - is there a scenario where the anonymous function is meaningful and useful? Explicit anonymous functions are used when a “disposable” function is needed, for example, as an argument for some other function. If the function we want to send as an argument is easy to define in a single line, and we do not plan to use it afterwards in the program, then it makes no sense to define it separately and assign it its own reference. An example of this will be seen in the <code>apply</code> family of functions.</p>
<hr />
<p>At the end of this section, we repeat the most important things - in R, the function is an object like any other, the only specificity is that it is an object that is “executable”, ie, which, using the function call syntax, does some work and returns some value. Even anonymous function can be executed (although only once, since we do not have a reference for future calls).</p>
<div class="sourceCode" id="cb254"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb254-1" title="1"><span class="co"># calling the anonymous function</span></a>
<a class="sourceLine" id="cb254-2" title="2">(<span class="cf">function</span>(x) x <span class="op">+</span><span class="st"> </span><span class="dv">1</span>)(<span class="dv">2</span>)</a></code></pre></div>
<pre><code>## [1] 3</code></pre>
<hr />
<h3 id="generic-functions-1"><span class="header-section-number">4.2</span> Generic functions</h3>
<p>We have already mentioned generic functions in the chapter on objects, but let’s briefly recall what they are all about. The programming language R is not based on the so-called “message exchange principle” of the object-oriented languages, where, for example, the drawing of the graph might be performed like this:</p>
<div class="sourceCode" id="cb256"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb256-1" title="1"><span class="co"># the usual OOP principle invokes object methods</span></a>
<a class="sourceLine" id="cb256-2" title="2"><span class="kw">graph.draw</span>()</a></code></pre></div>
<p>but like this:</p>
<div class="sourceCode" id="cb257"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb257-1" title="1"><span class="co"># R just calls the method unto an object</span></a>
<a class="sourceLine" id="cb257-2" title="2"><span class="kw">draw</span>(graph)</a></code></pre></div>
<p>In the first case, a graph is an object that implements a special drawing method, and we have to call it in order to get the required graph image. In the second, there is an “external” function that “knows” how to draw a graph. This function is called a “generic function”.</p>
<hr />
<p>The properties of the generic function are as follows:</p>
<ul>
<li>the function has an intuitive, clearly defined purpose</li>
<li>expected mode of operation is similar for multiple object types (eg drawing will always result in an image of sorts)</li>
<li>each type of object requires its own implementation depending on the characteristics of the object (e.g. the way the method of drawing the circle differs from drawing a square)</li>
</ul>
<p>The method of implementing generic functions (for S3 objects!) is actually extremely simple, which is probably the reason for their wide acceptance and great popularity in the R community. The process is reduced to three simple steps:</p>
<ul>
<li>choose the name of a generic function (eg <code>infoAbout</code>) and declare that it is a generic function
<ul>
<li>alternatively, choose one of the existing generic functions</li>
</ul></li>
<li>create an object and declare its class (eg <code>Person</code>)</li>
<li>we implement the function called <code>gen_function_name.class_name</code> (e.g. <code>infoAbout.Person</code>)</li>
</ul>
<p>And that’s all! R does not require any additional steps, the above is quite sufficient for R to recognize the new generic function and apply it to all objects for whose class this generic function is implemented in the form <code>gen_function_name.class_name</code> (or <code>gen_function_name.default</code> for all classes for which there is no special implementation).</p>
<p>In the next exercise, let’s try to implement the generic <code>infoAbout</code> method for the <code>Person</code> class.</p>
<hr />
<p><strong>Assignment 7.7 - new generic function</strong></p>
<div class="sourceCode" id="cb258"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb258-1" title="1">peter &lt;-<span class="st"> </span><span class="kw">Person</span>(<span class="dt">id =</span> <span class="st">&quot;12345678&quot;</span>, <span class="dt">surname =</span> <span class="st">&quot;Parker&quot;</span>, <span class="dt">weight =</span> <span class="dv">78</span>)</a>
<a class="sourceLine" id="cb258-2" title="2"></a>
<a class="sourceLine" id="cb258-3" title="3"><span class="co"># create a new generic `infoAbout` function using the `UseMethod` function</span></a>
<a class="sourceLine" id="cb258-4" title="4">infoAbout &lt;-<span class="st"> </span><span class="cf">function</span>(x) <span class="kw">UseMethod</span>(<span class="st">&quot;infoAbout&quot;</span>)</a>
<a class="sourceLine" id="cb258-5" title="5"></a>
<a class="sourceLine" id="cb258-6" title="6"><span class="co"># implement a `infoAbout.Person` function which takes a `Person`</span></a>
<a class="sourceLine" id="cb258-7" title="7"><span class="co"># and writes the following on screen</span></a>
<a class="sourceLine" id="cb258-8" title="8"><span class="co"># ID: &lt;id&gt;, surname: &lt;surname&gt;, weight: &lt;weight&gt;</span></a>
<a class="sourceLine" id="cb258-9" title="9"><span class="co"># use the `paste` function to prepare the printout</span></a>
<a class="sourceLine" id="cb258-10" title="10"><span class="co"># and `cat` to put it on screen</span></a>
<a class="sourceLine" id="cb258-11" title="11"></a>
<a class="sourceLine" id="cb258-12" title="12"><span class="co"># implement a `infoAbout.default` function</span></a>
<a class="sourceLine" id="cb258-13" title="13"><span class="co"># which simply fowards the input parameter to the `cat` function</span></a>
<a class="sourceLine" id="cb258-14" title="14"></a>
<a class="sourceLine" id="cb258-15" title="15"><span class="co"># call `infoAbout` with `peter` as parameter</span></a>
<a class="sourceLine" id="cb258-16" title="16"></a>
<a class="sourceLine" id="cb258-17" title="17"><span class="co"># call `infoAbout` with `1:5` as parameter</span></a></code></pre></div>
<div class="fold s o">
<div class="sourceCode" id="cb259"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb259-1" title="1"><span class="co"># implement a `infoAbout.Person` function which takes a `Person`</span></a>
<a class="sourceLine" id="cb259-2" title="2"><span class="co"># and writes the following on screen</span></a>
<a class="sourceLine" id="cb259-3" title="3"><span class="co"># ID: &lt;id&gt;, surname: &lt;surname&gt;, weight: &lt;weight&gt;</span></a>
<a class="sourceLine" id="cb259-4" title="4"><span class="co"># use the `paste` function to prepare the printout</span></a>
<a class="sourceLine" id="cb259-5" title="5"><span class="co"># and `cat` to put it on screen</span></a>
<a class="sourceLine" id="cb259-6" title="6"></a>
<a class="sourceLine" id="cb259-7" title="7">infoAbout.Person &lt;-<span class="st"> </span><span class="cf">function</span>(p) {</a>
<a class="sourceLine" id="cb259-8" title="8">    rez &lt;-<span class="st"> </span><span class="kw">paste</span>(<span class="st">&quot;ID:&quot;</span>, p<span class="op">$</span>id, <span class="st">&quot;, surname:&quot;</span>, p<span class="op">$</span>surname, <span class="st">&quot;, weight:&quot;</span>, p<span class="op">$</span>weight, <span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>)</a>
<a class="sourceLine" id="cb259-9" title="9">    <span class="kw">cat</span>(rez)</a>
<a class="sourceLine" id="cb259-10" title="10">}</a>
<a class="sourceLine" id="cb259-11" title="11"></a>
<a class="sourceLine" id="cb259-12" title="12"><span class="co"># implement a `infoAbout.default` function</span></a>
<a class="sourceLine" id="cb259-13" title="13"><span class="co"># which simply fowards the input parameter to the `cat` function</span></a>
<a class="sourceLine" id="cb259-14" title="14">infoAbout.default &lt;-<span class="st"> </span><span class="cf">function</span>(x) <span class="kw">cat</span>(x)</a>
<a class="sourceLine" id="cb259-15" title="15"></a>
<a class="sourceLine" id="cb259-16" title="16"><span class="co"># call `infoAbout` with `peter` as parameter</span></a>
<a class="sourceLine" id="cb259-17" title="17"><span class="kw">infoAbout</span>(peter)</a>
<a class="sourceLine" id="cb259-18" title="18"></a>
<a class="sourceLine" id="cb259-19" title="19"><span class="co"># call `infoAbout` with `1:5` as parameter</span></a>
<a class="sourceLine" id="cb259-20" title="20"><span class="kw">infoAbout</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">5</span>)</a></code></pre></div>
<pre><code>## ID: 12345678 , surname: Parker , weight: 78 
## 1 2 3 4 5</code></pre>
</div>
<hr />
<p>Of course, we did not necessarily have to create our own function to get the “print” functionality for our new class - it would probably be better to use already existing generic functions such as <code>print</code> or <code>cat</code>.</p>
<hr />
<p><strong>Assignment 7.8 - augmenting the existing generic functions</strong></p>
<div class="sourceCode" id="cb261"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb261-1" title="1"><span class="co"># make sure `print` is a generic function</span></a>
<a class="sourceLine" id="cb261-2" title="2"><span class="co"># (print out its source code by referencing its name)</span></a>
<a class="sourceLine" id="cb261-3" title="3"></a>
<a class="sourceLine" id="cb261-4" title="4"><span class="co"># augmnet the `print` function so it allows pretty printing</span></a>
<a class="sourceLine" id="cb261-5" title="5"><span class="co"># of the `Person` class</span></a>
<a class="sourceLine" id="cb261-6" title="6"><span class="co"># (you may use the already created `infoAbout.Person` class)</span></a>
<a class="sourceLine" id="cb261-7" title="7"></a>
<a class="sourceLine" id="cb261-8" title="8"><span class="co"># call `print` with `peter` as parameter (or try the autoprint!)</span></a></code></pre></div>
<div class="fold s o">
<div class="sourceCode" id="cb262"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb262-1" title="1"><span class="co"># make sure `print` is a generic function</span></a>
<a class="sourceLine" id="cb262-2" title="2"><span class="co"># (print out its source code by referencing its name)</span></a>
<a class="sourceLine" id="cb262-3" title="3">print</a>
<a class="sourceLine" id="cb262-4" title="4"></a>
<a class="sourceLine" id="cb262-5" title="5"><span class="co"># augmnet the `print` function so it allows pretty printing</span></a>
<a class="sourceLine" id="cb262-6" title="6"><span class="co"># of the `Person` class</span></a>
<a class="sourceLine" id="cb262-7" title="7"><span class="co"># (you may use the already created `infoAbout.Person` class)</span></a>
<a class="sourceLine" id="cb262-8" title="8">print.Person &lt;-<span class="st"> </span>infoAbout.Person</a>
<a class="sourceLine" id="cb262-9" title="9"></a>
<a class="sourceLine" id="cb262-10" title="10"></a>
<a class="sourceLine" id="cb262-11" title="11"><span class="co"># call `print` with `peter` as parameter (or try the autoprint!)</span></a>
<a class="sourceLine" id="cb262-12" title="12"><span class="kw">print</span>(peter)</a></code></pre></div>
<pre><code>## function (x, ...) 
## UseMethod(&quot;print&quot;)
## &lt;bytecode: 0x000000000f8c1990&gt;
## &lt;environment: namespace:base&gt;
## ID: 12345678 , surname: Parker , weight: 78</code></pre>
</div>
<hr />
<p>Finally, we demonstrate the ability of R to list all the currently known implementations of a generic method. To do this we simply use the <code>methods</code> function to which we pass the name of the method concerned. With the same function we can also check which generic functions implementations exist for a particular class. For this we use the <code>class</code> parameter to which we are passing the class name for which we are interested in finding generic functions implemented for it.</p>
<hr />
<p><strong>Assignment 7.9 - <code>methods</code> function</strong></p>
<div class="sourceCode" id="cb264"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb264-1" title="1"><span class="co"># list all implementations of the `summary` function</span></a>
<a class="sourceLine" id="cb264-2" title="2"></a>
<a class="sourceLine" id="cb264-3" title="3"><span class="co"># check with generic function implementations exist for the `factor` class</span></a></code></pre></div>
<div class="fold s o">
<div class="sourceCode" id="cb265"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb265-1" title="1"><span class="co"># list all implementations of the `summary` function</span></a>
<a class="sourceLine" id="cb265-2" title="2"><span class="co">#methods(summary)   # try on console!</span></a>
<a class="sourceLine" id="cb265-3" title="3"></a>
<a class="sourceLine" id="cb265-4" title="4"><span class="kw">cat</span>(<span class="st">&quot;-----------------------</span><span class="ch">\n</span><span class="st">&quot;</span>)</a>
<a class="sourceLine" id="cb265-5" title="5"></a>
<a class="sourceLine" id="cb265-6" title="6"><span class="co"># check with generic function implementations exist for the `factor` class</span></a>
<a class="sourceLine" id="cb265-7" title="7"><span class="kw">methods</span>(<span class="dt">class =</span> <span class="st">&quot;factor&quot;</span>)</a></code></pre></div>
<pre><code>## -----------------------
##  [1] -             /             [             [[            [[&lt;-         
##  [6] [&lt;-           +             all.equal     Arith         as.character 
## [11] as.data.frame as.Date       as.duration   as.interval   as.list      
## [16] as.logical    as.period     as.POSIXlt    as.vector     as_date      
## [21] as_datetime   as_factor     brief         cbind2        coerce       
## [26] Compare       corresp       droplevels    fixed         format       
## [31] histogram     initialize    is.na&lt;-       is_vector_s3  length&lt;-     
## [36] levels&lt;-      Logic         Math          Ops           plot         
## [41] print         rbind2        recode        relevel       relist       
## [46] rep           scale_type    show          slotsFromS3   summary      
## [51] Summary       type_sum      xtfrm        
## see &#39;?methods&#39; for accessing help and source code</code></pre>
</div>
<hr />
<h2 id="exercises-5" class="unnumbered">Exercises</h2>
<ol style="list-style-type: decimal">
<li><p>R has a <code>which</code> function which converts a logical vector into a numeric one containing indexes where the original vector has a <code>TRUE</code> value (so <code>c(T, F, F, F, F, T, F, T)</code> becomes <code>c(1, 6, 8)</code>). Create a function which replicates this behaviour.</p></li>
<li><p>Take the numerical vector <code>x</code> of length <code>n</code>. In statistics, the standardized moment of the k-th order is calculated like this:</p></li>
</ol>
<p><span class="math display">\[\frac{1}{n}\sum_{i=1}^n{(x_i - \bar{x})}^{k+1}\]</span></p>
<p>Create a factory of moment functions (<code>moment(k)</code>) for calculating the standardized central moment of the k-th order.</p>
<p>Create the functions <code>zero_moment (x)</code> and <code>first_moment (x)</code> with parameter values <code>k</code> set to <code>0</code> and <code>1</code> accordingly.</p>
<p>Test the functions on vector <code>1:1000</code>. Compare the results given by the <code>sd</code> (standard deviation) function over the vector <code>1: 1000</code> and root of the first moment you have calculated.</p>
<ol start="3" style="list-style-type: decimal">
<li>Implement a constructor for the class <code>Employee</code> which inherits the <code>Person</code> class defined by the following constructor and print implemenation:</li>
</ol>
<div class="sourceCode" id="cb267"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb267-1" title="1">Person &lt;-<span class="st"> </span><span class="cf">function</span>(id, surname, weight) {</a>
<a class="sourceLine" id="cb267-2" title="2">    p &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">id =</span> id, <span class="dt">surname =</span> surname, <span class="dt">weight =</span> weight)</a>
<a class="sourceLine" id="cb267-3" title="3">    <span class="kw">class</span>(p) &lt;-<span class="st"> &quot;Person&quot;</span></a>
<a class="sourceLine" id="cb267-4" title="4"></a>
<a class="sourceLine" id="cb267-5" title="5">    p</a>
<a class="sourceLine" id="cb267-6" title="6">}</a>
<a class="sourceLine" id="cb267-7" title="7"></a>
<a class="sourceLine" id="cb267-8" title="8">print.Person &lt;-<span class="st"> </span><span class="cf">function</span>(p) {</a>
<a class="sourceLine" id="cb267-9" title="9">    rez &lt;-<span class="st"> </span><span class="kw">paste</span>(<span class="st">&quot;ID:&quot;</span>, p<span class="op">$</span>id, <span class="st">&quot;, surname:&quot;</span>, p<span class="op">$</span>surname, <span class="st">&quot;, weight:&quot;</span>, p<span class="op">$</span>weight, <span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>)</a>
<a class="sourceLine" id="cb267-10" title="10">    <span class="kw">cat</span>(rez)</a>
<a class="sourceLine" id="cb267-11" title="11">}</a></code></pre></div>
<p><code>Employee</code> has all the attributes of the <code>Person</code> class as well as the <code>superior</code> attribute which represents a reference to a employee who is his/her superior (if such exists, otherwise it should be <code>NA</code>).</p>
<p>Create two objects of the <code>Employee</code> class (one superior to another) and print them with the <code>print</code> function. Then implement your own version of the generic function <code>print</code> for the <code>Employee</code> class that prints employee data and his/her superior employee data (if it exists, otherwise it prints a message that there is no superior employee). Reprint both employees with the <code>print</code> function.</p>
<hr />
<p><a rel="license" href="http://creativecommons.org/licenses/by-nc-nd/4.0/"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by-nc-nd/4.0/88x31.png" /></a><br /><span xmlns:dct="http://purl.org/dc/terms/" property="dct:title">Programirajmo u R-u</span> by <a xmlns:cc="http://creativecommons.org/ns#" href="https://www.fer.unizg.hr/en/damir.pintar" property="cc:attributionName" rel="cc:attributionURL">Damir Pintar</a> is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-nc-nd/4.0/">Creative Commons Attribution-NonCommercial-NoDerivatives 4.0 International License</a>.<br />Based on a work at <a xmlns:dct="http://purl.org/dc/terms/" href="https://ratnip.github.io/FER_OPJR/" rel="dct:source">https://ratnip.github.io/FER_OPJR/</a></p>

<h1 id="apply"><span class="header-section-number">4.2</span> ‘Apply’ family of functions</h1>
<hr />
<h2 id="what-are-apply-functions"><span class="header-section-number">4.2</span> What are <code>apply</code> functions?</h2>
<p>Very often, knowledge of the basics of the language R is reflected by the skill of using the so-called <code>apply</code> family of functions, available in the<code>base</code> package. These functions are specifically designed to perform repetitive tasks over various data structures, and as such they replace the program logic that would usually be realized in a through program loops. Additionally, these functions typically receive other functions as input arguments and, to a certain extent, encourage the functional programming paradigm.</p>
<p>The family name comes from the fact that these functions commonly have a suffix “apply”. Some of the functions from this family are:</p>
<ul>
<li><code>apply</code></li>
<li><code>lapply</code></li>
<li><code>sapply</code></li>
<li><code>vapply</code></li>
<li><code>tapply</code>,<code>mapply</code>, <code>rapply</code> …</li>
</ul>
<p>All of these functions work in a similar way - they receive a data set, a function that we want to apply to elements of that set, and optional additional parameters, and as the output give a set of function results, most often “packaged” in an appropriate format. The difference is mainly in the types of input and output arguments, as well as specific details about the implementation of the function itself and/or the way results are prepared.</p>
<p>This family of functions is best learned through examples. We will begin with the “basic” function - <code>apply</code>.</p>
<h2 id="the-apply-function"><span class="header-section-number">4.2</span> The <code>apply</code> function</h2>
<p>The <code>apply</code> function is the only one that literally shares the name with the family of these functions. It is intended to work with <strong>matrices</strong> (actually with arrays, but since it is relatively rare to use data structures that have more than two dimensions, here we will focus only on matrices).</p>
<p>The command syntax is as follows:</p>
<div class="sourceCode" id="cb268"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb268-1" title="1">result &lt;-<span class="st"> </span><span class="kw">apply</span>( <span class="op">&lt;</span>matrix<span class="op">&gt;</span>, <span class="op">&lt;</span><span class="kw">rows</span> (<span class="dv">1</span>) or <span class="kw">columns</span> (<span class="dv">2</span>)<span class="op">&gt;</span>, <span class="op">&lt;</span>function_name<span class="op">&gt;</span><span class="st"> </span>)</a></code></pre></div>
<p>Or, described in words, to implement the <code>apply</code> function, we:</p>
<ul>
<li>choose a matrix</li>
<li>decide whether to “cut it” by rows or columns</li>
<li>declare which function we want applied to each row (or column)</li>
</ul>
<p>Depending on how function works, as a result we get a matrix or (which is a more frequent case) a vector.</p>
<p>Let’s try to use this function in a concrete example.</p>
<hr />
<p><strong>Assignment 8.1 - the <code>apply</code> function</strong></p>
<div class="sourceCode" id="cb269"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb269-1" title="1">m &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">9</span>, <span class="dt">nrow =</span> <span class="dv">3</span>, <span class="dt">ncol =</span> <span class="dv">3</span>, <span class="dt">byrow =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb269-2" title="2"></a>
<a class="sourceLine" id="cb269-3" title="3"><span class="co"># print matrix `m`</span></a>
<a class="sourceLine" id="cb269-4" title="4"></a>
<a class="sourceLine" id="cb269-5" title="5"><span class="co"># use the `apply` function to calculate</span></a>
<a class="sourceLine" id="cb269-6" title="6"><span class="co"># and print the column sums of the `m` matrix</span></a>
<a class="sourceLine" id="cb269-7" title="7"></a>
<a class="sourceLine" id="cb269-8" title="8"></a>
<a class="sourceLine" id="cb269-9" title="9"><span class="co"># use the `apply` function to calculate</span></a>
<a class="sourceLine" id="cb269-10" title="10"><span class="co"># and print the multiplicaton of row elements </span></a>
<a class="sourceLine" id="cb269-11" title="11"><span class="co"># from the `m` matrix </span></a></code></pre></div>
<div class="fold s o">
<div class="sourceCode" id="cb270"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb270-1" title="1"><span class="co"># print matrix `m`</span></a>
<a class="sourceLine" id="cb270-2" title="2">m</a>
<a class="sourceLine" id="cb270-3" title="3"></a>
<a class="sourceLine" id="cb270-4" title="4"><span class="kw">cat</span>(<span class="st">&quot;------------</span><span class="ch">\n</span><span class="st">&quot;</span>)  </a>
<a class="sourceLine" id="cb270-5" title="5"></a>
<a class="sourceLine" id="cb270-6" title="6"><span class="co"># use the `apply` function to calculate</span></a>
<a class="sourceLine" id="cb270-7" title="7"><span class="co"># and print the column sums of the `m` matrix</span></a>
<a class="sourceLine" id="cb270-8" title="8"><span class="kw">apply</span>(m, <span class="dv">2</span>, sum)</a>
<a class="sourceLine" id="cb270-9" title="9"></a>
<a class="sourceLine" id="cb270-10" title="10"><span class="kw">cat</span>(<span class="st">&quot;------------</span><span class="ch">\n</span><span class="st">&quot;</span>) </a>
<a class="sourceLine" id="cb270-11" title="11"></a>
<a class="sourceLine" id="cb270-12" title="12"><span class="co"># use the `apply` function to calculate</span></a>
<a class="sourceLine" id="cb270-13" title="13"><span class="co"># and print the multiplicaton of row elements </span></a>
<a class="sourceLine" id="cb270-14" title="14"><span class="co"># from the `m` matrix </span></a>
<a class="sourceLine" id="cb270-15" title="15"><span class="kw">apply</span>(m, <span class="dv">1</span>, prod)</a></code></pre></div>
<pre><code>##      [,1] [,2] [,3]
## [1,]    1    2    3
## [2,]    4    5    6
## [3,]    7    8    9
## ------------
## [1] 12 15 18
## ------------
## [1]   6 120 504</code></pre>
</div>
<hr />
<p>If we want to perform a custom task to the rows/columns, we often use an anonymous function, for example:</p>
<div class="sourceCode" id="cb272"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb272-1" title="1"><span class="kw">apply</span>(m, <span class="dv">1</span>, <span class="cf">function</span>(x) x[<span class="dv">1</span>])   <span class="co"># return the first element of each row</span></a></code></pre></div>
<hr />
<p><strong>Assignment 8.2 - the <code>apply</code> function and anonymous functions</strong></p>
<div class="sourceCode" id="cb273"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb273-1" title="1"><span class="co"># for each row of `m` calculate the natural logarithm</span></a>
<a class="sourceLine" id="cb273-2" title="2"><span class="co"># of the sum of row elements</span></a>
<a class="sourceLine" id="cb273-3" title="3"><span class="co"># rounded to 2 decimals</span></a>
<a class="sourceLine" id="cb273-4" title="4"><span class="co"># use the `apply` function</span></a></code></pre></div>
<div class="fold s o">
<div class="sourceCode" id="cb274"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb274-1" title="1"><span class="co"># for each row of `m` calculate the natural logarithm</span></a>
<a class="sourceLine" id="cb274-2" title="2"><span class="co"># of the sum of row elements</span></a>
<a class="sourceLine" id="cb274-3" title="3"><span class="co"># rounded to 2 decimals</span></a>
<a class="sourceLine" id="cb274-4" title="4"><span class="co"># use the `apply` function</span></a>
<a class="sourceLine" id="cb274-5" title="5"><span class="kw">apply</span>(m, <span class="dv">1</span>, <span class="cf">function</span>(x) <span class="kw">round</span>(<span class="kw">log</span>(<span class="kw">sum</span>(x)),<span class="dv">2</span>))</a></code></pre></div>
<pre><code>## [1] 1.79 2.71 3.18</code></pre>
</div>
<hr />
<p>Let’s repeat - <code>apply</code> (and related functions) implicitly * disassembles the input data structure into elements<em>. In the examples above, these elements - rows or columns - are actually numeric vectors. The argument <code>x</code> received by an anonymous function is exactly that vector, or, better said </em>each of these vectors* that are sent one by one. <em>The results of the function are “remembered” and “packed”</em> into the final result.</p>
<p>Let’s try to program the last example without using the <code>apply</code> function.</p>
<hr />
<p><strong>Assignment 8.3 - loop as the alternative to the <code>apply</code> function</strong></p>
<div class="sourceCode" id="cb276"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb276-1" title="1"><span class="co"># for each row of `m` calculate the natural logarithm</span></a>
<a class="sourceLine" id="cb276-2" title="2"><span class="co"># of the sum of row elements</span></a>
<a class="sourceLine" id="cb276-3" title="3"><span class="co"># rounded to 2 decimals</span></a>
<a class="sourceLine" id="cb276-4" title="4"><span class="co"># use the for program loop</span></a></code></pre></div>
<div class="fold s o">
<div class="sourceCode" id="cb277"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb277-1" title="1"><span class="co"># for each row of `m` calculate the natural logarithm</span></a>
<a class="sourceLine" id="cb277-2" title="2"><span class="co"># of the sum of row elements</span></a>
<a class="sourceLine" id="cb277-3" title="3"><span class="co"># rounded to 2 decimals</span></a>
<a class="sourceLine" id="cb277-4" title="4"><span class="co"># use the for program loop</span></a>
<a class="sourceLine" id="cb277-5" title="5">rez &lt;-<span class="st"> </span><span class="kw">numeric</span>(<span class="kw">nrow</span>(m))</a>
<a class="sourceLine" id="cb277-6" title="6"><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="kw">nrow</span>(m)) rez[i] &lt;-<span class="st"> </span><span class="kw">round</span>(<span class="kw">log</span>(<span class="kw">sum</span>(m[i,])), <span class="dv">2</span>)</a>
<a class="sourceLine" id="cb277-7" title="7">rez</a></code></pre></div>
<pre><code>## [1] 1.79 2.71 3.18</code></pre>
</div>
<hr />
<p>If we compare the syntax of the examples with and without using the <code>apply</code> function, we can see how much the syntax which uses <code>apply</code> s actually “cleaner”. If we use loops, we must explicitly specify the logic of passing through the structure, which draws attention away from the job description that we actually want to do.</p>
<p>What if we want to send to the <code>apply</code> function a function which needs several parameters? For example, let’s say that instead of the upper function that extracts the first line element we want a function with two parameters - the first a vector (matrix row or column), and the second an integer that indicates the index of the element to extract. The answer is simple - just add additional parameters at the end of the function call.</p>
<div class="sourceCode" id="cb279"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb279-1" title="1"><span class="co"># apply function and input function with multiple parameters</span></a>
<a class="sourceLine" id="cb279-2" title="2"><span class="kw">apply</span>(m, <span class="dv">1</span>, <span class="cf">function</span>(x,y) x[y], <span class="dv">2</span>)  <span class="co"># second element of each row</span></a></code></pre></div>
<p>Finally, it should be noted that for similar processing of data in the matrix form, we do not necessarily need to use <code>apply</code> - many popular operations such as adding row or column elements, calculating the average of the elements of the rows and columns, and the like. This has already been implemented through functions such as <code>rowSums</code>,<code>colSums</code>, <code>rowMeans</code>,<code>colMeans</code> and the like. They are easier to use, but specialized - for more flexibility, the most common option is <code>apply</code>.</p>
<hr />
<h2 id="the-lapply-sapply-and-vapply-functions"><span class="header-section-number">4.2</span> The <code>lapply</code>, <code>sapply</code> and <code>vapply</code> functions</h2>
<p>The name of the <code>lapply</code> function comes from <em>list apply</em> - i.e. <strong>apply the function to the elements of lists</strong>. To put simply - it is a function that will receive the <strong>list and a function</strong> as the input arguments, apply the functions to <strong>each individual list element</strong> and return again <strong>a new list</strong> as a result.</p>
<hr />
<p><strong>Assignment 8.4 - the <code>lapply</code> function</strong></p>
<div class="sourceCode" id="cb280"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb280-1" title="1">l &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">a =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">3</span>, <span class="dt">b =</span> <span class="kw">rep</span>(<span class="kw">c</span>(T, F), <span class="dv">10</span>), <span class="dt">c =</span> LETTERS)</a>
<a class="sourceLine" id="cb280-2" title="2"></a>
<a class="sourceLine" id="cb280-3" title="3"><span class="co"># use the `lapply` function to calculate the length (number of elements)</span></a>
<a class="sourceLine" id="cb280-4" title="4"><span class="co"># of each element of the `l` list</span></a></code></pre></div>
<div class="fold s o">
<div class="sourceCode" id="cb281"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb281-1" title="1"><span class="co"># use the `lapply` function to calculate the length (number of elements)</span></a>
<a class="sourceLine" id="cb281-2" title="2"><span class="co"># of each element of the `l` list</span></a>
<a class="sourceLine" id="cb281-3" title="3"><span class="kw">lapply</span>(l, length)</a></code></pre></div>
<pre><code>## $a
## [1] 3
## 
## $b
## [1] 20
## 
## $c
## [1] 26</code></pre>
</div>
<hr />
<p>Just like with the <code>apply</code> function, for the<code>lapply</code> function, we often use anonymous functions as a parameter. The following task has no special practical use, but it will help us understand the functionality of the <code>lapply</code> function in combination with a slightly more complex anonymous function.</p>
<hr />
<p><strong>Assignment 8.5 - the <code>lapply</code> function and anonymous functions</strong></p>
<div class="sourceCode" id="cb283"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb283-1" title="1"><span class="co"># process the elements of the `l &#39;list as follows:</span></a>
<a class="sourceLine" id="cb283-2" title="2"></a>
<a class="sourceLine" id="cb283-3" title="3"><span class="co"># - Calculate the mean value if it is a numerical vector</span></a>
<a class="sourceLine" id="cb283-4" title="4"><span class="co"># - count the values of TRUE if it is a logical vector</span></a>
<a class="sourceLine" id="cb283-5" title="5"><span class="co"># - calculate the length of the vector for all other cases</span></a>
<a class="sourceLine" id="cb283-6" title="6"></a>
<a class="sourceLine" id="cb283-7" title="7"><span class="co"># use the `lapply` function and an anonymous function</span></a>
<a class="sourceLine" id="cb283-8" title="8"></a>
<a class="sourceLine" id="cb283-9" title="9"><span class="co"># do not forget that anonymous function can also use blocks!</span></a></code></pre></div>
<div class="fold s o">
<div class="sourceCode" id="cb284"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb284-1" title="1"><span class="co"># process the elements of the `l &#39;list as follows:</span></a>
<a class="sourceLine" id="cb284-2" title="2"></a>
<a class="sourceLine" id="cb284-3" title="3"><span class="co"># - Calculate the mean value if it is a numerical vector</span></a>
<a class="sourceLine" id="cb284-4" title="4"><span class="co"># - count the values of TRUE if it is a logical vector</span></a>
<a class="sourceLine" id="cb284-5" title="5"><span class="co"># - calculate the length of the vector for all other cases</span></a>
<a class="sourceLine" id="cb284-6" title="6"></a>
<a class="sourceLine" id="cb284-7" title="7"><span class="co"># use the `lapply` function and an anonymous function</span></a>
<a class="sourceLine" id="cb284-8" title="8"></a>
<a class="sourceLine" id="cb284-9" title="9"><span class="co"># do not forget that anonymous function can also use blocks!</span></a>
<a class="sourceLine" id="cb284-10" title="10"></a>
<a class="sourceLine" id="cb284-11" title="11"><span class="kw">lapply</span>(l, <span class="cf">function</span>(x) {</a>
<a class="sourceLine" id="cb284-12" title="12">    <span class="cf">if</span> (<span class="kw">is.numeric</span>(x)) {</a>
<a class="sourceLine" id="cb284-13" title="13">        <span class="kw">mean</span>(x)</a>
<a class="sourceLine" id="cb284-14" title="14">    } <span class="cf">else</span> <span class="cf">if</span> (<span class="kw">is.logical</span>(x)) {</a>
<a class="sourceLine" id="cb284-15" title="15">        <span class="kw">sum</span>(x)</a>
<a class="sourceLine" id="cb284-16" title="16">    } <span class="cf">else</span> <span class="kw">length</span>(x)</a>
<a class="sourceLine" id="cb284-17" title="17">})</a></code></pre></div>
<pre><code>## $a
## [1] 2
## 
## $b
## [1] 10
## 
## $c
## [1] 26</code></pre>
</div>
<hr />
<p>The <code>lapply</code> function is essentially quite simple to use and is very popular due to this fact. But once we use it for a while, we can find it irritating that t it always returns the list as a result, although some other data structure would be more suitable for us - for example a vector, especially if the resulting list has just simple numbers as elements. For this reason, R offers the <code>unlist</code> function to simplify the list to a vector.</p>
<hr />
<p><strong>Assignment 8.6 - the <code>unlist</code> function</strong></p>
<div class="sourceCode" id="cb286"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb286-1" title="1">l &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">a =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">10</span>, <span class="dt">b =</span> <span class="dv">10</span><span class="op">:</span><span class="dv">20</span>, <span class="dt">c =</span> <span class="dv">100</span><span class="op">:</span><span class="dv">200</span>)</a>
<a class="sourceLine" id="cb286-2" title="2"></a>
<a class="sourceLine" id="cb286-3" title="3"><span class="co"># calculate the mean value of the elements of the `l` list</span></a>
<a class="sourceLine" id="cb286-4" title="4"><span class="co"># print the results as a numeric vector</span></a>
<a class="sourceLine" id="cb286-5" title="5"><span class="co"># use `lapply` and `unlist`</span></a></code></pre></div>
<div class="fold s o">
<div class="sourceCode" id="cb287"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb287-1" title="1"><span class="co"># calculate the mean value of the elements of the `l` list</span></a>
<a class="sourceLine" id="cb287-2" title="2"><span class="co"># print the results as a numeric vector</span></a>
<a class="sourceLine" id="cb287-3" title="3"><span class="co"># use `lapply` and `unlist`</span></a>
<a class="sourceLine" id="cb287-4" title="4"><span class="kw">unlist</span>(<span class="kw">lapply</span>(l, mean))</a></code></pre></div>
<pre><code>##     a     b     c 
##   5.5  15.0 150.0</code></pre>
</div>
<hr />
<p>The displayed combination of <code>lapply</code> and<code>unlist</code> will give us as a result a one-dimensional vector, which in many cases is what we want. But sometimes some other data structure would suit us - for example, a matrix. In this case we need an additional step in transforming a one-dimensional vector into a matrix using the <code>matrix</code> function, with the number of rows and columns being explicitly assigned.</p>
<p>The question may arise - why is <code>lapply</code> not able to check the structure of the result it has created and determine the optimal data structure for formatting it (vector, matrix, or list)? That’s exactly the idea behind the <code>sapply</code> function, or <em>simplified list apply</em>. This function first performs <code>lapply</code> internally, and then simplifies the result to a vector, matrix or array, depending on the characteristics of the results obtained.</p>
<hr />
<p><strong>Assignment 8.7 - the <code>sapply</code> function</strong></p>
<div class="sourceCode" id="cb289"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb289-1" title="1">l &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">a =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">10</span>, <span class="dt">b =</span> <span class="dv">10</span><span class="op">:</span><span class="dv">20</span>, <span class="dt">c =</span> <span class="dv">100</span><span class="op">:</span><span class="dv">200</span>)</a>
<a class="sourceLine" id="cb289-2" title="2"></a>
<a class="sourceLine" id="cb289-3" title="3"><span class="co"># calculate the median of elements of the `l` list</span></a>
<a class="sourceLine" id="cb289-4" title="4"><span class="co"># and collect the results in a numeric vector</span></a>
<a class="sourceLine" id="cb289-5" title="5"><span class="co"># use the `sapply` function</span></a>
<a class="sourceLine" id="cb289-6" title="6"></a>
<a class="sourceLine" id="cb289-7" title="7"></a>
<a class="sourceLine" id="cb289-8" title="8"><span class="co"># extract the first and last element of each of the elements of the `l` list</span></a>
<a class="sourceLine" id="cb289-9" title="9"><span class="co"># use `sapply` and anonymous function</span></a></code></pre></div>
<div class="fold s o">
<div class="sourceCode" id="cb290"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb290-1" title="1"><span class="co"># calculate the median of elements of the `l` list</span></a>
<a class="sourceLine" id="cb290-2" title="2"><span class="co"># and collect the results in a numeric vector</span></a>
<a class="sourceLine" id="cb290-3" title="3"><span class="co"># use the `sapply` function</span></a>
<a class="sourceLine" id="cb290-4" title="4"><span class="kw">sapply</span>(l, median)</a>
<a class="sourceLine" id="cb290-5" title="5"></a>
<a class="sourceLine" id="cb290-6" title="6"><span class="kw">cat</span>(<span class="st">&quot;------------</span><span class="ch">\n</span><span class="st">&quot;</span>) </a>
<a class="sourceLine" id="cb290-7" title="7"></a>
<a class="sourceLine" id="cb290-8" title="8"><span class="co"># extract the first and last element of each of the elements of the `l` list</span></a>
<a class="sourceLine" id="cb290-9" title="9"><span class="co"># use `sapply` and anonymous function</span></a>
<a class="sourceLine" id="cb290-10" title="10"><span class="kw">sapply</span>(l, <span class="cf">function</span>(x) <span class="kw">c</span>(x[<span class="dv">1</span>], x[<span class="kw">length</span>(x)]))</a></code></pre></div>
<pre><code>##     a     b     c 
##   5.5  15.0 150.0 
## ------------
##       a  b   c
## [1,]  1 10 100
## [2,] 10 20 200</code></pre>
</div>
<hr />
<p>Note that as a result in the last example, we received a matrix, but that R formed it “by columns”. If we wanted a matrix with elements arranged in rows, we can not use <code>sapply</code> for this directly, because the matrix is formed internally, without the possibility of forwarding the<code>byrow = T</code> parameter. To obtain such a matrix, one option is already mentioned with the combination of <code>lapply</code>,<code>unlist</code> and <code>matrix</code>, or - more simply - transposing the<code>sapply</code> results using <code>t</code> function (from <em>transpose</em>).</p>
<hr />
<p>The <code>sapply</code> function is quite popular due to its simplicity and efficiency, so it is relatively often used in interactive analysis. On the other hand, the use of this function in program scripts is not recommended since its result is unpredictable in the general case - e.g. the script can expect a matrix in the continuation of the code, and the <code>sapply</code> function, due to the specificity of the input data, returns the vector, which can cause unforeseen results, which is not easy to spot later and diagnose where the error occurred.</p>
<p>If we are developing our own programs in R and want to use <code>sapply</code>, then the better choice will be the<code>vapply</code> function, which works identically to <code>sapply</code>, but uses an additional parameter called <code>FUN.VALUE</code> with which we explicitly define what kind of “simplification” we expect. For example. <code>numeric(3)</code> means that the result of applying the function to each element of the original list should be a numeric vector of three elements. If the result for any list item differs from the expected one, the function will raise an error.</p>
<hr />
<p><strong>Assignment 8.8 - the <code>vapply</code> function</strong></p>
<div class="sourceCode" id="cb292"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb292-1" title="1">myList &lt;-<span class="st"> </span><span class="kw">list</span>(numbers &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">5</span>), </a>
<a class="sourceLine" id="cb292-2" title="2">               names &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Ivo&quot;</span>, <span class="st">&quot;Pero&quot;</span>, <span class="st">&quot;Ana&quot;</span>), </a>
<a class="sourceLine" id="cb292-3" title="3">               alphabet &lt;-<span class="st"> </span>LETTERS)</a>
<a class="sourceLine" id="cb292-4" title="4"></a>
<a class="sourceLine" id="cb292-5" title="5"></a>
<a class="sourceLine" id="cb292-6" title="6"><span class="co"># think which of the following calls will be successful,</span></a>
<a class="sourceLine" id="cb292-7" title="7"><span class="co"># and which will throw out the error</span></a>
<a class="sourceLine" id="cb292-8" title="8"><span class="co"># check the results on the console</span></a>
<a class="sourceLine" id="cb292-9" title="9"></a>
<a class="sourceLine" id="cb292-10" title="10"><span class="kw">vapply</span>(myList, length, <span class="dt">FUN.VALUE =</span> <span class="kw">numeric</span>(<span class="dv">1</span>))</a>
<a class="sourceLine" id="cb292-11" title="11"><span class="kw">vapply</span>(myList, <span class="cf">function</span>(x) <span class="kw">as.character</span>(<span class="kw">c</span>(x[<span class="dv">1</span>], x[<span class="dv">2</span>])), <span class="dt">FUN.VALUE =</span> <span class="kw">character</span>(<span class="dv">2</span>))</a>
<a class="sourceLine" id="cb292-12" title="12"><span class="kw">vapply</span>(myList, <span class="cf">function</span>(x) <span class="kw">as.logical</span>(x), <span class="dt">FUN.VALUE =</span> <span class="kw">character</span>(<span class="dv">1</span>))</a></code></pre></div>
<hr />
<p>Finally, let’s return briefly to <code>lapply</code> and consider one important fact - it is intended for use on lists, and <strong>data frames are actually lists</strong>. In other words, the <code>lapply</code> function is very handy for processing tabular datasets when we want to apply a particular function to the columns of the data frame.</p>
<p>One of the more frequent operations performed in data analysis is the so-called. “normalization” of the numeric columns of the data frame - i.e. reducing all numerical values to “normal” distribution with the arithmetic mean of 0 and standard deviation of 1. This can be done by reducing each individual value by the arithmetic mean of the column (the <code>mean</code> function) and dividing with standard deviation of the column (function <code>sd</code>). This is a great way to demonstrate the use of <code>lapply</code> with data frames.</p>
<hr />
<p><strong>Assignment 8.9 - the <code>lapply</code> function and data frames</strong></p>
<div class="sourceCode" id="cb293"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb293-1" title="1">df &lt;-<span class="st"> </span><span class="kw">data.frame</span>( <span class="dt">a =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">10</span>, <span class="dt">b =</span> <span class="kw">seq</span>(<span class="dv">100</span>, <span class="dv">550</span>, <span class="dv">50</span>), </a>
<a class="sourceLine" id="cb293-2" title="2">                  <span class="dt">c =</span> LETTERS[<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>], <span class="dt">d =</span> <span class="kw">rep</span>(<span class="kw">c</span>(T,F), <span class="dv">5</span>), </a>
<a class="sourceLine" id="cb293-3" title="3">                  <span class="dt">e =</span> <span class="dv">-10</span><span class="op">:-</span><span class="dv">1</span>)</a>
<a class="sourceLine" id="cb293-4" title="4"></a>
<a class="sourceLine" id="cb293-5" title="5"><span class="co"># normalize numerical columns using `lapply`</span></a>
<a class="sourceLine" id="cb293-6" title="6"><span class="co"># do not change the remaining columns</span></a>
<a class="sourceLine" id="cb293-7" title="7"><span class="co"># round the normalized values to three decimal places</span></a>
<a class="sourceLine" id="cb293-8" title="8"><span class="co"># save the result in the df variable</span></a>
<a class="sourceLine" id="cb293-9" title="9"></a>
<a class="sourceLine" id="cb293-10" title="10"><span class="co"># print df</span></a></code></pre></div>
<div class="fold s o">
<div class="sourceCode" id="cb294"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb294-1" title="1"><span class="co"># normalize numerical columns using `lapply`</span></a>
<a class="sourceLine" id="cb294-2" title="2"><span class="co"># do not change the remaining columns</span></a>
<a class="sourceLine" id="cb294-3" title="3"><span class="co"># round the normalized values to three decimal places</span></a>
<a class="sourceLine" id="cb294-4" title="4"><span class="co"># save the result in the df variable</span></a>
<a class="sourceLine" id="cb294-5" title="5">df &lt;-<span class="st"> </span><span class="kw">lapply</span>(df, <span class="cf">function</span>(x) {</a>
<a class="sourceLine" id="cb294-6" title="6">    <span class="cf">if</span> (<span class="kw">is.numeric</span>(x)) {</a>
<a class="sourceLine" id="cb294-7" title="7">        <span class="kw">round</span>((x <span class="op">-</span><span class="st"> </span><span class="kw">mean</span>(x))<span class="op">/</span><span class="kw">sd</span>(x), <span class="dv">3</span>)</a>
<a class="sourceLine" id="cb294-8" title="8">    } <span class="cf">else</span> x })</a>
<a class="sourceLine" id="cb294-9" title="9"></a>
<a class="sourceLine" id="cb294-10" title="10"><span class="co"># print df</span></a>
<a class="sourceLine" id="cb294-11" title="11">df</a></code></pre></div>
<pre><code>## $a
##  [1] -1.486 -1.156 -0.826 -0.495 -0.165  0.165  0.495  0.826  1.156  1.486
## 
## $b
##  [1] -1.486 -1.156 -0.826 -0.495 -0.165  0.165  0.495  0.826  1.156  1.486
## 
## $c
##  [1] A B C D E F G H I J
## Levels: A B C D E F G H I J
## 
## $d
##  [1]  TRUE FALSE  TRUE FALSE  TRUE FALSE  TRUE FALSE  TRUE FALSE
## 
## $e
##  [1] -1.486 -1.156 -0.826 -0.495 -0.165  0.165  0.495  0.826  1.156  1.486</code></pre>
</div>
<hr />
<p>We see that after using <code>lapply</code> we get a list and that if we want the result in the form of a data frame we need to add another step using the<code>as.data.frame</code> function. If we are looking for a simpler way that immediately gives the data frame as a result, there is one convenient “trick” that we will explain below.</p>
<p>Let’s look at the solution of the previous problem, and put the following little change in the assignment of the result of the <code>lapply</code> function:</p>
<div class="sourceCode" id="cb296"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb296-1" title="1">df[] &lt;-<span class="st"> </span><span class="kw">lapply</span>(...)</a></code></pre></div>
<p>In this way, R will not create a “new” variable named <code>df</code>, but rather the<code>lapply</code> result will be entered in the ’all rows and columns of the <code>df</code> data frame. This made it possible for us to get the result in the form of a data frame, which we actually wanted. For this very reason, in R scripts, we will often see a similar syntax (<code>df [] &lt;- lapply ...</code>). Try to modify the above example in the above manner and make sure that the result will be a data frame.</p>
<p>Another commonly used trick in working with data frames is the following command:</p>
<div class="sourceCode" id="cb297"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb297-1" title="1"><span class="kw">sapply</span>(df, class)   </a></code></pre></div>
<p>This command actually gives us the answer to the question - which types are the columns of the given data frame? Although there are other ways to get this information, this method is popular both because of the compactness of the results and the independence of additional packages.</p>
<h2 id="other-functions-from-the-apply-family-and-the-available-alternatives"><span class="header-section-number">4.2</span> Other functions from the <code>apply</code> family and the available alternatives</h2>
<p>In the previous chapters, we have probably listed the most popular members of the <code>apply</code> family. This family has more members, including some who do not have a suffix <em>-apply</em>:</p>
<ul>
<li><code>mapply</code>, which works in parallel over multiple data structures</li>
<li><code>rapply</code>, which recursively applies functions within the structure</li>
<li><code>tapply</code>, which applies functions over sub-groups within a structure defined by factors</li>
<li><code>Map</code>, the<code>mapply</code> version, which does not simplify the result</li>
<li><code>by</code>, the<code>tapply</code> version for data frames</li>
<li>etc.</li>
</ul>
<p>The reason why these functions will not be explained in detail is twofold: firstly, as already mentioned, these functions are in practice applied much less often than the functions we have shown in the previous chapters. Secondly, with the increase in popularity of the language R, a large number of packages are oriented to improve the existing functions of the language R in the sense of easier and more efficient programming, especially when working with data frames.</p>
<p>If we are looking for convenient alternative functions to those from the <code>apply</code> family, it’s recommended to look at some of the following packages</p>
<ul>
<li><code>plyr</code> - an extremely popular package that, among other things, offers a number of functions very similar to <code>apply</code> functions, but derived in a way that they have a consistent signature and explicitly defined input and output formats that are easily read from the function name itself (in particular, the first letters ); so the <code>llply</code> function uses a list as both the input and the output, while<code>mdply</code> needs a matrix as input and outputs a data frame</li>
<li><code>purrr</code> - a package that replaces the functions of the<code>apply</code> family with functions corresponding to similar functions from other programming languages; since the application of the same function to a number of elements of a data structure in functional languages is often called “mapping”, the set of functions of this package carries the prefix <code>maps_</code>, and the function names often correspond to the expected results (for example<code>map2_lgl</code> means that as a result we expect a logical vector , and the <code>map2_df</code> a data frame)</li>
<li><code>dplyr</code> - a relatively new package, which in a certain sense represents the successor of the <code>plyr</code> package but oriented almost exclusively toward data frames; the functions of this package are not so much oriented to replace the <code>apply</code> family functions as providing a specific platform for working with data frames in a manner similar to languages oriented precisely for this purpose, such as, for example, the SQL language</li>
</ul>
<p>In future lectures we will introduce the <code>dplyr</code> package precisely because this package greatly facilitates and accelerates the data analysis process and is extremely well accepted in the R community.</p>
<hr />
<h2 id="exercises-6" class="unnumbered">Exercises</h2>
<ol style="list-style-type: decimal">
<li>Take the <code>m</code> matrix created by the following command:</li>
</ol>
<div class="sourceCode" id="cb298"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb298-1" title="1">m &lt;-<span class="st"> </span><span class="kw">rbind</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">5</span>, <span class="kw">seq</span>(<span class="dv">2</span>, <span class="dv">10</span>, <span class="dv">2</span>), <span class="kw">rep</span>(<span class="dv">3</span>, <span class="dv">5</span>), <span class="dv">3</span><span class="op">:</span><span class="dv">7</span>, <span class="kw">seq</span>(<span class="dv">100</span>, <span class="dv">500</span>, <span class="dv">100</span>))</a></code></pre></div>
<p>With the <code>apply</code> function and the new anonymous function, create a vector that will contain the first even element of each row, or zero if the corresponding row does not have even elements.</p>
<ol start="2" style="list-style-type: decimal">
<li>The following commands will create a list of 100 elements where each element will be a numeric vector of a random length of 1 to 10.</li>
</ol>
<div class="sourceCode" id="cb299"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb299-1" title="1"><span class="kw">set.seed</span>(<span class="dv">1234</span>)</a>
<a class="sourceLine" id="cb299-2" title="2">myList &lt;-<span class="st"> </span><span class="kw">replicate</span>(<span class="dv">100</span>, <span class="kw">sample</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>, <span class="kw">sample</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>, <span class="dv">1</span>)))</a></code></pre></div>
<p>With the help of <code>lapply</code> / <code>sapply</code> (and additional commands if necessary), create:</p>
<ul>
<li>the numerical vector <code>v</code> with the lengths of the list elements</li>
<li>list <code>l</code> with normalized numerical vectors of the original list</li>
<li>numerical vector <code>ind4</code> with indexes of all list elements containing number 4</li>
<li>the <code>df5</code> data frame containing columns which have all the elements of the length of 5 from the original list</li>
</ul>
<hr />
<p><a rel="license" href="http://creativecommons.org/licenses/by-nc-nd/4.0/"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by-nc-nd/4.0/88x31.png" /></a><br /><span xmlns:dct="http://purl.org/dc/terms/" property="dct:title">Programirajmo u R-u</span> by <a xmlns:cc="http://creativecommons.org/ns#" href="https://www.fer.unizg.hr/en/damir.pintar" property="cc:attributionName" rel="cc:attributionURL">Damir Pintar</a> is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-nc-nd/4.0/">Creative Commons Attribution-NonCommercial-NoDerivatives 4.0 International License</a>.<br />Based on a work at <a xmlns:dct="http://purl.org/dc/terms/" href="https://ratnip.github.io/FER_OPJR/" rel="dct:source">https://ratnip.github.io/FER_OPJR/</a></p>

<h1 id="part-data-management-and-visualizations" class="unnumbered">(PART) Data management and visualizations</h1>
<h1 id="pipe"><span class="header-section-number">4.2</span> Pipeline operator and tidy data</h1>
<p>Let’s look at the following example: imagine that in R we want to create 100 random real variables from the range of [0,100], round them to two decimals, select a sample of 10 variables from this set, calculate the arithmetic mean of the sample and print it on the screen. One possible solution could be:</p>
<div class="sourceCode" id="cb300"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb300-1" title="1"><span class="kw">set.seed</span>(<span class="dv">1234</span>) <span class="co"># (for repeatability)</span></a>
<a class="sourceLine" id="cb300-2" title="2"></a>
<a class="sourceLine" id="cb300-3" title="3">res &lt;-<span class="st"> </span><span class="kw">runif</span>(<span class="dv">100</span>, <span class="dv">0</span>, <span class="dv">100</span>) <span class="co"># 100 random variables from uniform distribution from 0 to 100</span></a>
<a class="sourceLine" id="cb300-4" title="4">res &lt;-<span class="st"> </span><span class="kw">round</span>(res, <span class="dv">2</span>)</a>
<a class="sourceLine" id="cb300-5" title="5">res &lt;-<span class="st"> </span><span class="kw">sample</span>(res, <span class="dv">10</span>)</a>
<a class="sourceLine" id="cb300-6" title="6">res &lt;-<span class="st"> </span><span class="kw">mean</span>(res)</a>
<a class="sourceLine" id="cb300-7" title="7">res</a></code></pre></div>
<pre><code>## [1] 51.123</code></pre>
<p>This kind of code has a lot of unnecessary repetition - in every line we use the <code>res</code> variable as well as the assignment operator <code>res</code> variable so we can store the in-between results. Alternatively, we could do everything in one row:</p>
<hr />
<p><strong>Assignment 9.1 - Nested functions</strong></p>
<div class="sourceCode" id="cb302"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb302-1" title="1"><span class="kw">set.seed</span>(<span class="dv">1234</span>)</a>
<a class="sourceLine" id="cb302-2" title="2"></a>
<a class="sourceLine" id="cb302-3" title="3"><span class="co"># repeat the above example, but with only one line of code</span></a></code></pre></div>
<div class="fold s o">
<div class="sourceCode" id="cb303"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb303-1" title="1"><span class="kw">mean</span>(<span class="kw">sample</span>(<span class="kw">round</span>(<span class="kw">runif</span>(<span class="dv">100</span>, <span class="dv">0</span>, <span class="dv">100</span>), <span class="dv">2</span>), <span class="dv">10</span>))</a></code></pre></div>
<pre><code>## [1] 51.123</code></pre>
</div>
<hr />
<p>Here we see a typical example of a “code sandwich” which is not only often seen in R, but also appears in most programming languages. When we use the result of one function as an input to another, we have to “nest” it in the subsequent function call ending up with an error-prone code which is equally difficult to both write and read.</p>
<p>A natural way of “solving” a series of instructions from the previous example would be to resolve them sequentially, i.e. from “left to right”; when we finish one task, the result becomes the input for the following task and so on until the process is complete. It would be benefitial if we apply this approach through programming code. This was precisely the motivation for the development of the so-called <em>pipeline</em> operator, provided by the package <code>magrittr</code> <span class="citation">(Bache and Wickham <a href="#ref-R-magrittr">2014</a>)</span>.</p>
<p>The weird name package is actually inspired by the name of abstract painter Rene Magritte, more specifically his famous painting <em>La trahison des images </em> depicting a pipe under which are the words <em>Ceci n’est pas une pipe</em>. In the same way, the <code>magrittr</code> package delivers a <em>pipeline</em> or <em>pipe</em> operator <code>%&gt;%</code>which is “not really a pipe”. Whatever you may think about this play on words or the painting itself which inspired this package, what is undeniable is the fact that the <em>pipeline</em> operator makes the code much more readable and as such has quickly become a strong favorite in the R community, especially when programming heavily relies on chaining function calls.</p>
<p>How does the <code>%&gt;%</code> operator work? It’s rather simple - we place it between function calls to designate that the output from the function on the left should be the input for the function on the right. The place where the result from the previous function should go is denoted by the <code>.</code> symbol. We can do this as many times as we want, that is, depending on how many functions calls we “chain”.</p>
<div class="sourceCode" id="cb305"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb305-1" title="1"><span class="kw">h</span>(<span class="kw">g</span>(<span class="kw">f</span>(x), y), z, w) <span class="co"># code without the %&gt;% operator</span></a>
<a class="sourceLine" id="cb305-2" title="2"></a>
<a class="sourceLine" id="cb305-3" title="3"><span class="kw">f</span>(x) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">g</span>(., y) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">h</span>(., z, w) <span class="co"># code with the %&gt;% operator</span></a></code></pre></div>
<p>If the result of the previous function the first argument of the next function, then the <code>.</code> symbol (or in effect the whole argument) can be thrown out, so the syntax is even shorter:</p>
<div class="sourceCode" id="cb306"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb306-1" title="1"><span class="kw">f</span>(x) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">g</span>(y) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">h</span>(z, w) <span class="co"># code without dots</span></a></code></pre></div>
<p>Notice that these function calls are actually formally incorrect because they have an “invisible” first argument. Nevertheless, many R programmers prefer this syntax because it requires less typing and is somewhat more transparent, while the mentioned irregularity does not really matter in practice as long as the developer is aware of the existence of an “invisible” argument.</p>
<p>Now let’s try to reformat our first example with the help of the `%&gt;% ’operator.</p>
<hr />
<p><strong>Assignment 9.2 - operator <code>%&gt;%</code></strong></p>
<div class="sourceCode" id="cb307"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb307-1" title="1"><span class="kw">set.seed</span>(<span class="dv">1234</span>)</a>
<a class="sourceLine" id="cb307-2" title="2"></a>
<a class="sourceLine" id="cb307-3" title="3"><span class="co"># solve the first example again using the %&gt;% operator</span></a></code></pre></div>
<div class="fold s o">
<div class="sourceCode" id="cb308"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb308-1" title="1"><span class="kw">set.seed</span>(<span class="dv">1234</span>)</a>
<a class="sourceLine" id="cb308-2" title="2"></a>
<a class="sourceLine" id="cb308-3" title="3"><span class="kw">runif</span>(<span class="dv">100</span>, <span class="dv">0</span>, <span class="dv">100</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">round</span>(<span class="dv">2</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">sample</span>(<span class="dv">10</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mean</span>() <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">print</span>()</a></code></pre></div>
<pre><code>## [1] 51.123</code></pre>
</div>
<hr />
<p>Note that by reading the above program code, we very easily interpret the meaning of that line of program code, especially when compared to the same command written in the form of a “sandwich”.</p>
<p>We can store the end result of our “chain” of functions in the usual way:</p>
<div class="sourceCode" id="cb310"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb310-1" title="1">sum1to10 &lt;-<span class="st"> </span><span class="dv">1</span><span class="op">:</span><span class="dv">10</span> <span class="op">%&gt;%</span><span class="st"> </span>sum <span class="co"># result is stored in variable &#39;sum1to10&#39;</span></a></code></pre></div>
<p>but it may be more visually consistent to use the “inverted” assignment operator: <code>-&gt;</code>.</p>
<div class="sourceCode" id="cb311"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb311-1" title="1"><span class="dv">1</span><span class="op">:</span><span class="dv">10</span> <span class="op">%&gt;%</span><span class="st"> </span>sum -&gt;<span class="st"> </span>sum1to10 <span class="co"># works the same as the example above</span></a></code></pre></div>
<p>Note that in situations where the result of the previous function is the only parameter of the following function, we can completely leave out the parentheses (so in the examples above, <code>sum</code>,<code>sum()</code>or<code>sum(.)</code> would all work equally).</p>
<p>Now let’s try to combine the <code>%&gt;%</code> operator and <code>lapply</code> with the example already seen in the section on functions in the<code>apply</code> family.</p>
<hr />
<p><strong>Assignment 9.3 - <code>lapply</code> function and <code>%&gt;%</code> operator</strong></p>
<div class="sourceCode" id="cb312"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb312-1" title="1">l &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">a =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">10</span>, <span class="dt">b =</span> <span class="dv">10</span><span class="op">:</span><span class="dv">20</span>, <span class="dt">c =</span> <span class="dv">100</span><span class="op">:</span><span class="dv">200</span>)</a>
<a class="sourceLine" id="cb312-2" title="2"></a>
<a class="sourceLine" id="cb312-3" title="3"><span class="co"># create a matrix which contains the first and last element of each list element</span></a>
<a class="sourceLine" id="cb312-4" title="4"><span class="co"># these elements must be in their own rows</span></a>
<a class="sourceLine" id="cb312-5" title="5"><span class="co"># use functions lapply, unlist and matrix as well as the %&gt;% operator</span></a>
<a class="sourceLine" id="cb312-6" title="6"><span class="co"># save the result in the `res` variable</span></a>
<a class="sourceLine" id="cb312-7" title="7"></a>
<a class="sourceLine" id="cb312-8" title="8">    </a>
<a class="sourceLine" id="cb312-9" title="9"><span class="co"># print &#39;res&#39;</span></a></code></pre></div>
<div class="fold s o">
<div class="sourceCode" id="cb313"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb313-1" title="1">l &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">a =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">10</span>, <span class="dt">b =</span> <span class="dv">10</span><span class="op">:</span><span class="dv">20</span>, <span class="dt">c =</span> <span class="dv">100</span><span class="op">:</span><span class="dv">200</span>)</a>
<a class="sourceLine" id="cb313-2" title="2"></a>
<a class="sourceLine" id="cb313-3" title="3">l <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">lapply</span>(<span class="cf">function</span>(x) <span class="kw">c</span>(x [<span class="dv">1</span>], x [<span class="kw">length</span>(x)])) <span class="op">%&gt;%</span><span class="st"> </span>unlist <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">matrix</span>(<span class="dt">ncol =</span> <span class="dv">2</span>, <span class="dt">byrow =</span> T) -&gt;<span class="st"> </span>res</a>
<a class="sourceLine" id="cb313-4" title="4">    </a>
<a class="sourceLine" id="cb313-5" title="5">res</a></code></pre></div>
<pre><code>##      [,1] [,2]
## [1,]    1   10
## [2,]   10   20
## [3,]  100  200</code></pre>
</div>
<hr />
<p>The pipeline operator is very convenient in conjunction with “classic” functions, but we may encounter a problem when we want to combine it with other operators. The cause of the problem is the syntax - the pipeline operator achieves its efficiency by imposing a new, “sequential” syntax, which is not compatible with the syntax imposed by other operators, such as <code>+</code>, <code>%%</code> or <code>[</code>.</p>
<p>If it is really important for us to have a “continuous” function call chain in our code that will contain not only functions but also other operators, then one solution is to use operators as “ordinary” functions. Namely, each operator is actually a function that shares a name with the operator (using the <em>backtick</em> quotation mark which allows the use of symbols as variable names), so the following pairs of expressions are actually equivalent:</p>
<hr />
<p><strong>Example - operators as functions</strong></p>
<div class="sourceCode" id="cb315"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb315-1" title="1"><span class="co"># each pair of instructions is equivalent</span></a>
<a class="sourceLine" id="cb315-2" title="2"><span class="dv">2</span> <span class="op">+</span><span class="st"> </span><span class="dv">3</span></a>
<a class="sourceLine" id="cb315-3" title="3"><span class="st">`</span><span class="dt">+</span><span class="st">`</span>(<span class="dv">2</span>, <span class="dv">3</span>)</a>
<a class="sourceLine" id="cb315-4" title="4"></a>
<a class="sourceLine" id="cb315-5" title="5"><span class="dv">1</span><span class="op">:</span><span class="dv">5</span></a>
<a class="sourceLine" id="cb315-6" title="6"><span class="st">`</span><span class="dt">:</span><span class="st">`</span>(<span class="dv">1</span>, <span class="dv">5</span>)</a>
<a class="sourceLine" id="cb315-7" title="7"></a>
<a class="sourceLine" id="cb315-8" title="8">x &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>)</a>
<a class="sourceLine" id="cb315-9" title="9"><span class="st">`</span><span class="dt">&lt;-</span><span class="st">`</span>(<span class="st">&quot;x&quot;</span>, <span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>))</a>
<a class="sourceLine" id="cb315-10" title="10"></a>
<a class="sourceLine" id="cb315-11" title="11">x[<span class="dv">1</span>]</a>
<a class="sourceLine" id="cb315-12" title="12"><span class="st">`</span><span class="dt">[</span><span class="st">`</span>(x, <span class="dv">1</span>)</a></code></pre></div>
<pre><code>## [1] 5
## [1] 5
## [1] 1 2 3 4 5
## [1] 1 2 3 4 5
## [1] 1
## [1] 1</code></pre>
<hr />
<p>Let’s try to use this principle in the next exercise.</p>
<hr />
<p><strong>Assignment 9.4 - combining pipe operator with other operators</strong></p>
<div class="sourceCode" id="cb317"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb317-1" title="1"><span class="kw">set.seed</span>(<span class="dv">1234</span>)</a>
<a class="sourceLine" id="cb317-2" title="2"></a>
<a class="sourceLine" id="cb317-3" title="3"><span class="co"># &quot;clean up &quot; the following command with the help of the pipeline operator</span></a>
<a class="sourceLine" id="cb317-4" title="4"><span class="kw">matrix</span>(<span class="kw">table</span>(<span class="kw">sample</span>(<span class="kw">round</span>(<span class="kw">sqrt</span>(<span class="kw">sample</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">10000</span>, <span class="dv">10000</span>, <span class="dt">replace =</span> T))), <span class="dv">100</span>))[<span class="dv">1</span><span class="op">:</span><span class="dv">9</span>], <span class="dv">3</span>, <span class="dv">3</span>)</a></code></pre></div>
<pre><code>##      [,1] [,2] [,3]
## [1,]    1    2    1
## [2,]    1    3    1
## [3,]    1    1    2</code></pre>
<div class="fold s o">
<div class="sourceCode" id="cb319"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb319-1" title="1"><span class="kw">set.seed</span>(<span class="dv">1234</span>)</a>
<a class="sourceLine" id="cb319-2" title="2"></a>
<a class="sourceLine" id="cb319-3" title="3"><span class="co"># &quot;clean up &quot; the following command with the help of the pipeline operator</span></a>
<a class="sourceLine" id="cb319-4" title="4"><span class="dv">1</span><span class="op">:</span><span class="dv">10000</span> <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">sample</span>(<span class="dv">10000</span>, <span class="dt">replace =</span> T) <span class="op">%&gt;%</span><span class="st"> </span>sqrt <span class="op">%&gt;%</span><span class="st"> </span>round <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb319-5" title="5"><span class="st">  </span><span class="kw">sample</span>(<span class="dv">100</span>) <span class="op">%&gt;%</span><span class="st"> </span>table <span class="op">%&gt;%</span><span class="st"> `</span><span class="dt">[</span><span class="st">`</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">9</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">matrix</span>(<span class="dv">3</span>, <span class="dv">3</span>)</a></code></pre></div>
<pre><code>##      [,1] [,2] [,3]
## [1,]    1    2    1
## [2,]    1    3    1
## [3,]    1    1    2</code></pre>
</div>
<p>The <code>%&gt;%</code> operator is particularly well suited when dealing with data frames, especially in scenarios when we have a defined data transformation procedure (e.g. filtering some rows, then selecting columns, then grouping the data according to a categorical variable etc.). With the help of this operator, the code itself acts as a readily interpretable representation of our data transformation process which we can easily customize and extend later. Future examples and exercises will often extensively rely on this operator, so we recommend that you master it well before proceeding with the lessons that follow.</p>
<hr />
<h2 id="tidy-data"><span class="header-section-number">4.2</span> Tidy data</h2>
<p>It is often stated in various literature that in data analysis, data preparation is often the most time consuming segment of the process. The book <a href="https://books.google.com/books/about/Exploratory_Data_Mining_and_Data_Cleanin.html?id=2OWJVkevamQC&redir_esc=y&hl=en">“Exploratory Data Mining and Data Cleaning”</a> mentions that preparation often requires from 50% to 80% of the total time devoted to analysis. Also, as Hadley Wickham states in his article <a href="http://vita.had.co.nz/papers/tidy-data.pdf"> “Tidy Data”</a>, data preparation is often not just the first step of the analysis, but rather a process that gets repeated as new knowledge is discovered or new data is collected.</p>
<p>Hadley Wickham also introduced the term “tidy data” to refer to the organization of a data in such a way as to facilitate its further processing and analysis. In practice, datasets we get are often not originally intended for the purposes of analysis and as such are not organized in a way that would allow them to be easily used in the analytical process. “Tidy data” is actually a set of principles which may guides us how to “rearrange” data so that its structure matches the standard, expected metadata.</p>
<p>Tidz data principles have similarities with the relational data model, but are defined in a way that is more appropriate for statisticians and developers. These principles can be summarized as follows:</p>
<ul>
<li>the data is organized into a table</li>
<li>each line represents an observation</li>
<li>each column represents a property or variable of that observation</li>
</ul>
<p>Since this may sound too trivial, let’s take a look at what properties Hadley lists as typical of “messy” data:</p>
<ul>
<li>column names are not variable names but rather their values</li>
<li>multiple different variables are stored in the same column</li>
<li>variables are saved in rows</li>
<li>multiple types of different observations are stored in the same table</li>
<li>one type of observation is stored in multiple tables</li>
</ul>
<p>Below, we will give some examples of tables that do not fully conform to the definition of tidy data, and show how to easily “tidy them up”. For this, we will leverage functions provided by the <code>tidyr</code> package.</p>
<hr />
<h3 id="the-gather-andspread-functions"><span class="header-section-number">4.2</span> The <code>gather</code> and<code>spread</code> functions</h3>
<p>The workbook which corresponds to this leeson should have a file called <code>students.csv</code>. Let’s load it into our work environment. Since the file is stored using UTF-8 encoding (since it contains Croatian letters), you can also add a <code>fileEncoding ="UTF-8"</code> parameter to the <code>read.csv</code> command to get the special characters correctly printed.</p>
<hr />
<p><strong>Assignment 9.5 - <code>students</code> data set</strong></p>
<div class="sourceCode" id="cb321"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb321-1" title="1"><span class="co"># load data from `students.csv` file into` students` variable</span></a>
<a class="sourceLine" id="cb321-2" title="2"><span class="co"># don&#39;t forget the `stringsAsFactors` parameter!</span></a>
<a class="sourceLine" id="cb321-3" title="3"></a>
<a class="sourceLine" id="cb321-4" title="4"><span class="co"># familiarize yourself with the data using standard functions for this purpose</span></a>
<a class="sourceLine" id="cb321-5" title="5"><span class="co"># (names, sapply/class, str, head, summary ...)</span></a>
<a class="sourceLine" id="cb321-6" title="6"><span class="co"># in the following examples for this process, we will use the phrase &quot;briefly explore the data frame&quot; </span></a>
<a class="sourceLine" id="cb321-7" title="7"><span class="co"># as a shortcut for the above process</span></a></code></pre></div>
<div class="fold s o">
<div class="sourceCode" id="cb322"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb322-1" title="1">students &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;students.csv&quot;</span>, <span class="dt">fileEncoding =</span><span class="st">&quot;UTF-8&quot;</span>, <span class="dt">stringsAsFactors =</span> F)</a>
<a class="sourceLine" id="cb322-2" title="2"></a>
<a class="sourceLine" id="cb322-3" title="3"><span class="kw">str</span>(students)</a>
<a class="sourceLine" id="cb322-4" title="4"><span class="kw">head</span>(students)</a></code></pre></div>
<pre><code>## &#39;data.frame&#39;:    27 obs. of  10 variables:
##  $ JMBAG        : int  1341 1342 1343 1344 1345 1346 1347 1348 1349 1350 ...
##  $ Surname      : chr  &quot;Anic&quot; &quot;Babic&quot; &quot;Crnoja&quot; &quot;Crnjac&quot; ...
##  $ Name         : chr  &quot;Iva&quot; &quot;Josip&quot; &quot;Petra&quot; &quot;Lucija&quot; ...
##  $ Math.1       : chr  &quot;2&quot; &quot;5&quot; &quot;4&quot; &quot;2&quot; ...
##  $ Physics.1    : chr  &quot;2&quot; &quot;3&quot; &quot;3&quot; &quot;5&quot; ...
##  $ Programming  : chr  &quot;NULL&quot; &quot;4&quot; &quot;4&quot; &quot;2&quot; ...
##  $ Electronics  : chr  &quot;NULL&quot; &quot;3&quot; &quot;2&quot; &quot;2&quot; ...
##  $ Digital.Logic: chr  &quot;4&quot; &quot;NULL&quot; &quot;3&quot; &quot;3&quot; ...
##  $ Math.2       : chr  &quot;2&quot; &quot;5&quot; &quot;4&quot; &quot;3&quot; ...
##  $ Algorithms.1 : chr  &quot;2&quot; &quot;5&quot; &quot;3&quot; &quot;4&quot; ...
##   JMBAG Surname   Name Math.1 Physics.1 Programming Electronics
## 1  1341    Anic    Iva      2         2        NULL        NULL
## 2  1342   Babic  Josip      5         3           4           3
## 3  1343  Crnoja  Petra      4         3           4           2
## 4  1344  Crnjac Lucija      2         5           2           2
## 5  1345   Dizla  Stipe   NULL         4           3           5
## 6  1346   Ermic   Igor   NULL         3        NULL           5
##   Digital.Logic Math.2 Algorithms.1
## 1             4      2            2
## 2          NULL      5            5
## 3             3      4            3
## 4             3      3            4
## 5             2      2            2
## 6             5      5            5</code></pre>
</div>
<hr />
<p>Note that this dataset has a lot of missing values that are written as <code>NULL</code>. Because R does not recognize this as a missing value, it loaded the data as character strings (or as factors if we forgot the <code>stringsAsFactors</code> parameter). Because the columns that relate to the ratings are obviously numeric, we can easily convert them to such using the <code>as.numeric ()</code> (or <code>as.numeric(as.character())</code> command if they are factors!). But there is a simpler way - if we know how the missing value is represented in the dataset, we can directly embed it in the <code>read.csv</code> command using the <code>na.strings</code> parameter.</p>
<hr />
<p><strong>Assignment 9.6 - using the <code>na.strings</code> parameter</strong></p>
<div class="sourceCode" id="cb324"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb324-1" title="1"><span class="co"># reload the data from the `students.csv` file into the` students` variable</span></a>
<a class="sourceLine" id="cb324-2" title="2"><span class="co"># add the `na.strings` parameter to the` read.csv` command with a character string representing NA</span></a>
<a class="sourceLine" id="cb324-3" title="3"></a>
<a class="sourceLine" id="cb324-4" title="4"></a>
<a class="sourceLine" id="cb324-5" title="5"><span class="co"># briefly explore the `students` data frame</span></a></code></pre></div>
<div class="fold s o">
<div class="sourceCode" id="cb325"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb325-1" title="1">students &lt;-<span class="st"> </span><span class="kw">read.csv</span> (<span class="st">&quot;students.csv&quot;</span>, <span class="dt">fileEncoding =</span> <span class="st">&quot;UTF-8&quot;</span>, <span class="dt">stringsAsFactors =</span> F, <span class="dt">na.strings =</span> <span class="st">&quot;NULL&quot;</span>)</a>
<a class="sourceLine" id="cb325-2" title="2"></a>
<a class="sourceLine" id="cb325-3" title="3"></a>
<a class="sourceLine" id="cb325-4" title="4"><span class="kw">str</span>(students)</a>
<a class="sourceLine" id="cb325-5" title="5"><span class="kw">head</span>(students)</a></code></pre></div>
<pre><code>## &#39;data.frame&#39;:    27 obs. of  10 variables:
##  $ JMBAG        : int  1341 1342 1343 1344 1345 1346 1347 1348 1349 1350 ...
##  $ Surname      : chr  &quot;Anic&quot; &quot;Babic&quot; &quot;Crnoja&quot; &quot;Crnjac&quot; ...
##  $ Name         : chr  &quot;Iva&quot; &quot;Josip&quot; &quot;Petra&quot; &quot;Lucija&quot; ...
##  $ Math.1       : int  2 5 4 2 NA NA NA 3 3 4 ...
##  $ Physics.1    : int  2 3 3 5 4 3 3 4 2 2 ...
##  $ Programming  : int  NA 4 4 2 3 NA 3 3 3 4 ...
##  $ Electronics  : int  NA 3 2 2 5 5 3 4 2 2 ...
##  $ Digital.Logic: int  4 NA 3 3 2 5 2 4 3 5 ...
##  $ Math.2       : int  2 5 4 3 2 5 2 5 NA 4 ...
##  $ Algorithms.1 : int  2 5 3 4 2 5 5 4 3 2 ...
##   JMBAG Surname   Name Math.1 Physics.1 Programming Electronics
## 1  1341    Anic    Iva      2         2          NA          NA
## 2  1342   Babic  Josip      5         3           4           3
## 3  1343  Crnoja  Petra      4         3           4           2
## 4  1344  Crnjac Lucija      2         5           2           2
## 5  1345   Dizla  Stipe     NA         4           3           5
## 6  1346   Ermic   Igor     NA         3          NA           5
##   Digital.Logic Math.2 Algorithms.1
## 1             4      2            2
## 2            NA      5            5
## 3             3      4            3
## 4             3      3            4
## 5             2      2            2
## 6             5      5            5</code></pre>
</div>
<hr />
<p>We see that the columns are now of the appropriate type - but still the data frame does not fully fit the definition of “tidy data”. The names of the columns are actually the categories of the variable <code>course</code> and the ‘observation’ in this table is represented by the student, even though a more logical granularity would be to have each grade as a specific observation. Now, adding a new grade from a course is only possible by adding a new column, making sure to add grades for <em>all</em> students, which would inevitably mean immediately entering a lot of <code>NA</code> values for all student/course combinations where no grade yet exists (and maybe never will, if the student never takes that course at all).</p>
<p>Let’s try to reorganize the table so each row represents “a grade student received in a particular course”. Consider what steps should be taken to create such a table. We need to:</p>
<ul>
<li>create a categorical variable <code>course</code> which would have the names of all the courses (currently spread over column names)</li>
<li>create all student/course combinations that make sense (i.e. have a grade assigned to them)</li>
<li>fill in the combinations with the corresponding grade value</li>
</ul>
<p>This process is not impossible, but it does require a lot of jumping through hoops to redesign the data frame. To simplify this process, we can use the <code>gather</code> function from the<code>tidyr</code> package, which performs the exact procedure we described above: it “gathers” columns into a single variable and then populates the valuesof that variable with the existing column/row combinations. The function signature looks like this:</p>
<div class="sourceCode" id="cb327"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb327-1" title="1"><span class="kw">gather</span>(data, key, value, ..., <span class="dt">na.rm =</span> <span class="ot">FALSE</span>, <span class="dt">convert =</span> <span class="ot">FALSE</span>, <span class="dt">factor_key =</span> <span class="ot">FALSE</span>)</a></code></pre></div>
<p>You can get a detailed description of the function by calling <code>?gather</code>, but here we will just briefly explain some of the parameters:</p>
<ul>
<li><code>data</code> obviously represents our data frame</li>
<li><code>key</code> represents the name of the new column - the categorical variable we want to create (in our case <code>course</code>); this function does not require that the column name be quoted</li>
<li><code>value</code> represents the name of the new column (variable) which will hold values with values (in our case <code>grade</code>)</li>
<li><code>...</code> represents the set of columns we “gather”; we can specify column names separated by commas (quotes are also not required), use the syntax <code>first_column:last_column</code>, or even just name the columns we do NOT want to gather by prefacing them with the <code>-</code> sign</li>
<li><code>na.rm</code> describes whether we want to omit observations with <code>NA</code> values</li>
<li><code>convert</code> will convert the data if we deem it necessary</li>
<li><code>factor_key</code> asks us if we want to factorize the new variable we are creating</li>
</ul>
<p>Let’s try out this function with our untidy data frame.</p>
<hr />
<p><strong>Assignment 9.7 - <code>gather</code> function</strong></p>
<div class="sourceCode" id="cb328"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb328-1" title="1"><span class="co"># create a &#39;grades&#39; data frame by using the &#39;gather&#39; function on the &#39;students&#39; data frame</span></a>
<a class="sourceLine" id="cb328-2" title="2"></a>
<a class="sourceLine" id="cb328-3" title="3"></a>
<a class="sourceLine" id="cb328-4" title="4"><span class="co"># briefly explore the `grades` data frame</span></a></code></pre></div>
<div class="fold s o">
<div class="sourceCode" id="cb329"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb329-1" title="1"><span class="co">#library(tidyr)  # if necessary</span></a>
<a class="sourceLine" id="cb329-2" title="2">grades &lt;-<span class="st"> </span><span class="kw">gather</span>(students, course, grade, Math<span class="fl">.1</span><span class="op">:</span>Algorithms<span class="fl">.1</span>, <span class="dt">na.rm =</span> T, <span class="dt">factor_key =</span> T)</a>
<a class="sourceLine" id="cb329-3" title="3"></a>
<a class="sourceLine" id="cb329-4" title="4"><span class="kw">str</span>(grades)</a>
<a class="sourceLine" id="cb329-5" title="5"><span class="kw">head</span>(grades)</a></code></pre></div>
<pre><code>## &#39;data.frame&#39;:    168 obs. of  5 variables:
##  $ JMBAG  : int  1341 1342 1343 1344 1348 1349 1350 1351 1352 1353 ...
##  $ Surname: chr  &quot;Anic&quot; &quot;Babic&quot; &quot;Crnoja&quot; &quot;Crnjac&quot; ...
##  $ Name   : chr  &quot;Iva&quot; &quot;Josip&quot; &quot;Petra&quot; &quot;Lucija&quot; ...
##  $ course : Factor w/ 7 levels &quot;Math.1&quot;,&quot;Physics.1&quot;,..: 1 1 1 1 1 1 1 1 1 1 ...
##  $ grade  : int  2 5 4 2 3 3 4 2 4 5 ...
##   JMBAG Surname   Name course grade
## 1  1341    Anic    Iva Math.1     2
## 2  1342   Babic  Josip Math.1     5
## 3  1343  Crnoja  Petra Math.1     4
## 4  1344  Crnjac Lucija Math.1     2
## 8  1348 Grubiša   Ivan Math.1     3
## 9  1349   Gobac  Davor Math.1     3</code></pre>
</div>
<hr />
<p>The <code>spread</code> function does the inverse job from the <code>gather</code> function. It will “expand” data from a combination of a categorical column and a corresponding “value” column so the categories become column names, and the values from the value column get appropriately “spread” over the corresponding columns.</p>
<p>The function signature looks like this:</p>
<div class="sourceCode" id="cb331"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb331-1" title="1"><span class="kw">spread</span>(data, key, value, <span class="dt">fill =</span> <span class="ot">NA</span>, <span class="dt">convert =</span> <span class="ot">FALSE</span>, <span class="dt">drop =</span> <span class="ot">TRUE</span>, <span class="dt">sep =</span> <span class="ot">NULL</span>)</a></code></pre></div>
<p>Documentation of this function is easily retrieved by using <code>?spread</code>, and some elements can already be easily identified by using the knowledge of how the <code>gather</code> function works. Some of the parameters which might be useful to us will be described bellow:</p>
<ul>
<li><code>fill</code> describes what value to put in “non-existent” combinations after the spread is performed</li>
<li><code>drop</code> describes whether columns for non-existent categories should be worked (if we were spreading a factor column and not or levels were represented)</li>
<li><code>sep</code> allows us to have a column name which is not only a category value but a combination of the name of an category column we are spreading and the category level (with a defined separator)</li>
</ul>
<p>Let’s try to “reconstruct” the original <code>students</code> data frame with this command.</p>
<hr />
<p><strong>Assignment 9.8 - <code>spread</code> function</strong></p>
<div class="sourceCode" id="cb332"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb332-1" title="1"><span class="co"># &quot;spread&quot; the &#39;grades&#39; data frame to reconstruct the</span></a>
<a class="sourceLine" id="cb332-2" title="2"><span class="co"># original data frame</span></a>
<a class="sourceLine" id="cb332-3" title="3"><span class="co"># store the results in a `students2` data frame</span></a>
<a class="sourceLine" id="cb332-4" title="4"></a>
<a class="sourceLine" id="cb332-5" title="5"><span class="co"># compare `students` and` students2` data frames</span></a></code></pre></div>
<div class="fold s o">
<div class="sourceCode" id="cb333"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb333-1" title="1">students2 &lt;-<span class="st"> </span><span class="kw">spread</span>(grades, course, grade)</a>
<a class="sourceLine" id="cb333-2" title="2"></a>
<a class="sourceLine" id="cb333-3" title="3"><span class="kw">head</span>(students)</a>
<a class="sourceLine" id="cb333-4" title="4"><span class="kw">head</span>(students2)</a>
<a class="sourceLine" id="cb333-5" title="5"><span class="kw">str</span>(students)</a>
<a class="sourceLine" id="cb333-6" title="6"><span class="kw">str</span>(students2)</a></code></pre></div>
<pre><code>##   JMBAG Surname   Name Math.1 Physics.1 Programming Electronics
## 1  1341    Anic    Iva      2         2          NA          NA
## 2  1342   Babic  Josip      5         3           4           3
## 3  1343  Crnoja  Petra      4         3           4           2
## 4  1344  Crnjac Lucija      2         5           2           2
## 5  1345   Dizla  Stipe     NA         4           3           5
## 6  1346   Ermic   Igor     NA         3          NA           5
##   Digital.Logic Math.2 Algorithms.1
## 1             4      2            2
## 2            NA      5            5
## 3             3      4            3
## 4             3      3            4
## 5             2      2            2
## 6             5      5            5
##   JMBAG Surname   Name Math.1 Physics.1 Programming Electronics
## 1  1341    Anic    Iva      2         2          NA          NA
## 2  1342   Babic  Josip      5         3           4           3
## 3  1343  Crnoja  Petra      4         3           4           2
## 4  1344  Crnjac Lucija      2         5           2           2
## 5  1345   Dizla  Stipe     NA         4           3           5
## 6  1346   Ermic   Igor     NA         3          NA           5
##   Digital.Logic Math.2 Algorithms.1
## 1             4      2            2
## 2            NA      5            5
## 3             3      4            3
## 4             3      3            4
## 5             2      2            2
## 6             5      5            5
## &#39;data.frame&#39;:    27 obs. of  10 variables:
##  $ JMBAG        : int  1341 1342 1343 1344 1345 1346 1347 1348 1349 1350 ...
##  $ Surname      : chr  &quot;Anic&quot; &quot;Babic&quot; &quot;Crnoja&quot; &quot;Crnjac&quot; ...
##  $ Name         : chr  &quot;Iva&quot; &quot;Josip&quot; &quot;Petra&quot; &quot;Lucija&quot; ...
##  $ Math.1       : int  2 5 4 2 NA NA NA 3 3 4 ...
##  $ Physics.1    : int  2 3 3 5 4 3 3 4 2 2 ...
##  $ Programming  : int  NA 4 4 2 3 NA 3 3 3 4 ...
##  $ Electronics  : int  NA 3 2 2 5 5 3 4 2 2 ...
##  $ Digital.Logic: int  4 NA 3 3 2 5 2 4 3 5 ...
##  $ Math.2       : int  2 5 4 3 2 5 2 5 NA 4 ...
##  $ Algorithms.1 : int  2 5 3 4 2 5 5 4 3 2 ...
## &#39;data.frame&#39;:    27 obs. of  10 variables:
##  $ JMBAG        : int  1341 1342 1343 1344 1345 1346 1347 1348 1349 1350 ...
##  $ Surname      : chr  &quot;Anic&quot; &quot;Babic&quot; &quot;Crnoja&quot; &quot;Crnjac&quot; ...
##  $ Name         : chr  &quot;Iva&quot; &quot;Josip&quot; &quot;Petra&quot; &quot;Lucija&quot; ...
##  $ Math.1       : int  2 5 4 2 NA NA NA 3 3 4 ...
##  $ Physics.1    : int  2 3 3 5 4 3 3 4 2 2 ...
##  $ Programming  : int  NA 4 4 2 3 NA 3 3 3 4 ...
##  $ Electronics  : int  NA 3 2 2 5 5 3 4 2 2 ...
##  $ Digital.Logic: int  4 NA 3 3 2 5 2 4 3 5 ...
##  $ Math.2       : int  2 5 4 3 2 5 2 5 NA 4 ...
##  $ Algorithms.1 : int  2 5 3 4 2 5 5 4 3 2 ...</code></pre>
</div>
<hr />
<p>In the previous example, we demonstrated the inverse functionality of the <code>gather</code> and<code>spread</code> functions, but our usage <code>spread</code> did not serve to tidy up the data, it just enabled us to revert to the original data frame. Let us now look at an example where <code>spread</code> is sed to actually make the data tidier.</p>
<p>Let’s retrieve data from the <code>cars.csv</code> file that stores the technical characteristics of specific cars.</p>
<hr />
<p><strong>Assignment 9.9 - <code>cars</code> data set</strong></p>
<div class="sourceCode" id="cb335"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb335-1" title="1"><span class="co">#load the `cars.csv` file into a data frame called `cars`</span></a>
<a class="sourceLine" id="cb335-2" title="2"></a>
<a class="sourceLine" id="cb335-3" title="3"><span class="co">#briefly explore the `cars` data frame</span></a></code></pre></div>
<div class="fold s o">
<div class="sourceCode" id="cb336"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb336-1" title="1">cars &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;cars.csv&quot;</span>, <span class="dt">fileEncoding =</span> <span class="st">&quot;UTF-8&quot;</span>, <span class="dt">stringsAsFactors =</span> F)</a>
<a class="sourceLine" id="cb336-2" title="2"></a>
<a class="sourceLine" id="cb336-3" title="3"><span class="kw">str</span>(cars)</a>
<a class="sourceLine" id="cb336-4" title="4"><span class="kw">head</span>(cars)</a></code></pre></div>
<pre><code>## &#39;data.frame&#39;:    18 obs. of  3 variables:
##  $ Car.model               : chr  &quot;Opel Astra&quot; &quot;Opel Astra&quot; &quot;Opel Astra&quot; &quot;Opel Astra&quot; ...
##  $ Technical.Characteristic: chr  &quot;Cylinders&quot; &quot;HP&quot; &quot;Length m&quot; &quot;Mass kg&quot; ...
##  $ Value                   : num  4 125 4.27 1285 4 ...
##    Car.model Technical.Characteristic    Value
## 1 Opel Astra                Cylinders    4.000
## 2 Opel Astra                       HP  125.000
## 3 Opel Astra                 Length m    4.267
## 4 Opel Astra                  Mass kg 1285.000
## 5    Audi A4                Cylinders    4.000
## 6    Audi A4                       HP  136.000</code></pre>
</div>
<hr />
<p>This table clearly violates the principles of tidy data which dictate that only one type of variable should be stored in a column - the technical characteristics of the car are placed in a unique column called <code>Technical.Characteristic</code> and in the <code>value</code> column holds very heterogenous values (we have mass in kilograms, length in meters, etc.).</p>
<p>Try tidying up this data frame with the <code>spread</code> function.</p>
<hr />
<p><strong>Assignment 9.10 - <code>spread</code> function (2)</strong></p>
<div class="sourceCode" id="cb338"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb338-1" title="1"><span class="co"># create an `cars2` data frame which will have </span></a>
<a class="sourceLine" id="cb338-2" title="2"><span class="co"># the tidied data from the `cars` data frame</span></a>
<a class="sourceLine" id="cb338-3" title="3"></a>
<a class="sourceLine" id="cb338-4" title="4"><span class="co"># briefly explore the `cars2` dat frame</span></a></code></pre></div>
<div class="fold s o">
<div class="sourceCode" id="cb339"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb339-1" title="1">cars2 &lt;-<span class="st"> </span><span class="kw">spread</span> (cars, Technical.Characteristic, Value)</a>
<a class="sourceLine" id="cb339-2" title="2"></a>
<a class="sourceLine" id="cb339-3" title="3"><span class="kw">str</span>(cars2)</a>
<a class="sourceLine" id="cb339-4" title="4"><span class="kw">head</span>(cars2)</a></code></pre></div>
<pre><code>## &#39;data.frame&#39;:    5 obs. of  6 variables:
##  $ Car.model: chr  &quot;Audi A4&quot; &quot;Citroen C6&quot; &quot;Fiat 500L&quot; &quot;Opel Astra&quot; ...
##  $ Cylinders: num  4 6 2 4 4
##  $ HP       : num  136 215 103 125 110
##  $ Length m : num  4.7 NA NA 4.27 4.56
##  $ Mass kg  : num  1470 1816 1260 1285 NA
##  $ Valves   : num  NA NA NA NA 16
##              Car.model Cylinders  HP Length m Mass kg Valves
## 1              Audi A4         4 136    4.703    1470     NA
## 2           Citroen C6         6 215       NA    1816     NA
## 3            Fiat 500L         2 103       NA    1260     NA
## 4           Opel Astra         4 125    4.267    1285     NA
## 5 Renault Grand Scenic         4 110    4.560      NA     16</code></pre>
</div>
<hr />
<p>The <code>gather</code> and<code>spread</code> commands are not only used for ‘messy’ data. They can be very useful when converting so-called “wide” data into “long” data. Let’s show this on the example of shopping cart data.</p>
<p>Shopping cart data (or “consumer basket data”) is a record of items purchased by a customer during their visit to the store (be it a virtual store or a real retail outlet). If we write consumer basket information in a “wide” format, then we organize the information so that the columns represent individual items and the rows represent one successful “visit” to the story (or simply “invoice”). Here, a value of <code>1</code> means that the item ultimately ended up in the cart, while <code>0</code> means it was not present there (alternative way would be to use numbers over <code>1</code> to denote the exact quantity). This kind of representation is suitable for different types of analysis, but it is not economical - if the store has a large number of items on offer, data will often have long rows mostly filled with “zeros”. The “long” format on the other hand simply puts a combination of a shopping cart identifier (or account number) and the name (or code) of the item purchased in each row. Such a record will have significantly more rows, but it is much more suitable in cases where the number of items in the range is far greater than the number of items in the average basket.</p>
<hr />
<p><strong>Assignment 9.11 - Consumer basket data</strong></p>
<div class="sourceCode" id="cb341"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb341-1" title="1"><span class="co"># Load data from the `ConsumersBasket.csv` file into the &#39;invoices&#39; data frame</span></a>
<a class="sourceLine" id="cb341-2" title="2"></a>
<a class="sourceLine" id="cb341-3" title="3"><span class="co"># briefly explore the `invoioces` data frame</span></a></code></pre></div>
<div class="fold s o">
<div class="sourceCode" id="cb342"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb342-1" title="1">invoices &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;ConsumerBasket.csv&quot;</span>, <span class="dt">stringsAsFactors =</span> F, <span class="dt">encoding =</span> <span class="st">&quot;UTF-8&quot;</span>)</a>
<a class="sourceLine" id="cb342-2" title="2"></a>
<a class="sourceLine" id="cb342-3" title="3"><span class="kw">str</span>(invoices)</a>
<a class="sourceLine" id="cb342-4" title="4"><span class="kw">head</span>(invoices)</a></code></pre></div>
<pre><code>## &#39;data.frame&#39;:    104 obs. of  21 variables:
##  $ invoiceID           : int  15671 15672 15673 15674 15675 15676 15677 15678 15679 15680 ...
##  $ Coca.cola.2l        : int  0 1 1 0 1 0 0 0 0 0 ...
##  $ Chips.150g          : int  0 0 1 0 0 0 0 1 0 0 ...
##  $ Nutella.400.g       : int  0 1 0 0 1 0 0 0 0 0 ...
##  $ Light.Beer          : int  0 1 0 0 0 0 0 0 0 1 ...
##  $ Dark.Beer           : int  1 0 0 1 0 0 0 0 0 1 ...
##  $ Fabric.Softener.1.5l: int  0 0 0 0 0 0 0 1 0 1 ...
##  $ Water.2l            : int  0 0 1 0 0 0 0 0 1 1 ...
##  $ Oranges             : int  0 0 0 1 1 0 0 0 1 1 ...
##  $ Apples              : int  1 0 0 1 0 0 0 0 0 0 ...
##  $ Pineapples          : int  0 0 1 0 0 0 0 1 1 1 ...
##  $ Napkins             : int  0 0 0 0 1 1 0 0 0 0 ...
##  $ Patte               : int  0 0 1 1 0 0 0 0 0 1 ...
##  $ Ketchup             : int  1 0 0 1 0 0 0 0 0 1 ...
##  $ Mustard             : int  1 0 0 0 0 0 0 1 0 0 ...
##  $ Milk.0.5l           : int  0 1 0 1 1 0 0 0 0 0 ...
##  $ Sour.Cream          : int  0 1 0 0 0 0 1 0 0 1 ...
##  $ Feta.cheese         : int  0 0 0 1 0 0 0 0 0 0 ...
##  $ Sardines            : int  0 0 0 0 0 0 0 0 0 1 ...
##  $ Tuna.patte          : int  1 1 1 0 0 1 0 0 0 0 ...
##  $ Nescaffe            : int  0 0 1 0 0 0 0 0 1 0 ...
##   invoiceID Coca.cola.2l Chips.150g Nutella.400.g Light.Beer Dark.Beer
## 1     15671            0          0             0          0         1
## 2     15672            1          0             1          1         0
## 3     15673            1          1             0          0         0
## 4     15674            0          0             0          0         1
## 5     15675            1          0             1          0         0
## 6     15676            0          0             0          0         0
##   Fabric.Softener.1.5l Water.2l Oranges Apples Pineapples Napkins Patte
## 1                    0        0       0      1          0       0     0
## 2                    0        0       0      0          0       0     0
## 3                    0        1       0      0          1       0     1
## 4                    0        0       1      1          0       0     1
## 5                    0        0       1      0          0       1     0
## 6                    0        0       0      0          0       1     0
##   Ketchup Mustard Milk.0.5l Sour.Cream Feta.cheese Sardines Tuna.patte
## 1       1       1         0          0           0        0          1
## 2       0       0         1          1           0        0          1
## 3       0       0         0          0           0        0          1
## 4       1       0         1          0           1        0          0
## 5       0       0         1          0           0        0          0
## 6       0       0         0          0           0        0          1
##   Nescaffe
## 1        0
## 2        0
## 3        1
## 4        0
## 5        0
## 6        0</code></pre>
</div>
<hr />
<p><strong>Assignment 9.12 - converting data frame to a ‘long’ format</strong></p>
<div class="sourceCode" id="cb344"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb344-1" title="1"><span class="co"># convert `invoices` data frame to a &quot;long&quot; format</span></a>
<a class="sourceLine" id="cb344-2" title="2"><span class="co"># each row needs to have invoiceID and itemName </span></a>
<a class="sourceLine" id="cb344-3" title="3"><span class="co"># only bought items need to be present</span></a>
<a class="sourceLine" id="cb344-4" title="4"><span class="co"># name the new data frame `invoicesLong`</span></a>
<a class="sourceLine" id="cb344-5" title="5"></a>
<a class="sourceLine" id="cb344-6" title="6"><span class="co"># store the new data frame in a new CSV file</span></a>
<a class="sourceLine" id="cb344-7" title="7"><span class="co"># called &quot;ConsumerBasketLong.csv&quot;</span></a></code></pre></div>
<div class="fold s o">
<div class="sourceCode" id="cb345"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb345-1" title="1">invoicesLong &lt;-<span class="st"> </span><span class="kw">gather</span>(invoices, item, value, <span class="op">-</span>invoiceID)</a>
<a class="sourceLine" id="cb345-2" title="2">invoicesLong  &lt;-<span class="st"> </span>invoicesLong[invoicesLong<span class="op">$</span>value <span class="op">!=</span><span class="st"> </span><span class="dv">0</span>, <span class="dv">1</span><span class="op">:</span><span class="dv">2</span>]</a>
<a class="sourceLine" id="cb345-3" title="3">invoicesLong &lt;-<span class="st"> </span>invoicesLong[<span class="kw">order</span>(invoicesLong<span class="op">$</span>invoiceID),]</a>
<a class="sourceLine" id="cb345-4" title="4"><span class="kw">head</span>(invoicesLong)</a>
<a class="sourceLine" id="cb345-5" title="5"><span class="kw">write.csv</span>(invoicesLong, <span class="dt">file =</span> <span class="st">&#39;ConsumerBasketLong.csv&#39;</span>, <span class="dt">row.names =</span> F)</a></code></pre></div>
<pre><code>##      invoiceID         item
## 417      15671    Dark.Beer
## 833      15671       Apples
## 1249     15671      Ketchup
## 1353     15671      Mustard
## 1873     15671   Tuna.patte
## 2        15672 Coca.cola.2l</code></pre>
</div>
<hr />
<p><strong>Assignment 9.13 - converting data frame to a ‘wide’ format</strong></p>
<div class="sourceCode" id="cb347"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb347-1" title="1"><span class="co"># try formatting the &quot;long&quot; format back to &quot;wide&quot;</span></a>
<a class="sourceLine" id="cb347-2" title="2"></a>
<a class="sourceLine" id="cb347-3" title="3"><span class="co"># store the new data frame in a new CSV file</span></a>
<a class="sourceLine" id="cb347-4" title="4"><span class="co"># called &quot;ConsumerBasketWide.csv&quot;</span></a></code></pre></div>
<div class="fold s o">
<div class="sourceCode" id="cb348"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb348-1" title="1">invoicesWide &lt;-<span class="st"> </span>invoicesLong</a>
<a class="sourceLine" id="cb348-2" title="2">invoicesWide<span class="op">$</span>value &lt;-<span class="st"> </span><span class="dv">1</span></a>
<a class="sourceLine" id="cb348-3" title="3">invoicesWide &lt;-<span class="st"> </span><span class="kw">spread</span>(invoicesWide, item, value, <span class="dt">fill =</span> <span class="dv">0</span>)</a>
<a class="sourceLine" id="cb348-4" title="4"><span class="kw">write.csv</span>(invoicesWide, <span class="dt">file =</span> <span class="st">&#39;ConsumerBasketWide.csv&#39;</span>, <span class="dt">row.names =</span> F)</a></code></pre></div>
</div>
<hr />
<h3 id="the-separate-and-unite-functions"><span class="header-section-number">4.2</span> The <code>separate</code> and <code>unite</code> functions</h3>
<hr />
<p>The <code>tidyr</code> package has a number of other useful features for efficient transformation and clean up of our data frames, and here we will address two more commonly used onesm called <code>separate</code> and <code>unite</code>.</p>
<p>The <code>separate</code> function is useful when a column has “complex” values that we want to separate into two or more columns.</p>
<p><strong>Assignment 9.14 - <code>Deparments</code> data set</strong></p>
<div class="sourceCode" id="cb349"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb349-1" title="1"><span class="co"># read data from the `departments.csv` file into the` departments` variable</span></a>
<a class="sourceLine" id="cb349-2" title="2"></a>
<a class="sourceLine" id="cb349-3" title="3"><span class="co"># briefly explore the `departments` data frame</span></a></code></pre></div>
<div class="fold s o">
<div class="sourceCode" id="cb350"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb350-1" title="1">departments &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;departments.csv&quot;</span>, <span class="dt">stringsAsFactors =</span> F)</a>
<a class="sourceLine" id="cb350-2" title="2"></a>
<a class="sourceLine" id="cb350-3" title="3"><span class="kw">str</span>(departments)</a>
<a class="sourceLine" id="cb350-4" title="4"><span class="kw">head</span>(departments)</a></code></pre></div>
<pre><code>## &#39;data.frame&#39;:    28 obs. of  4 variables:
##  $ Department: chr  &quot;A&quot; &quot;A&quot; &quot;A&quot; &quot;A&quot; ...
##  $ Quarter   : chr  &quot;Q1-2015&quot; &quot;Q2-2015&quot; &quot;Q3-2015&quot; &quot;Q4-2015&quot; ...
##  $ RevenuesKn: num  12416 224290 10644 191229 258697 ...
##  $ ExpensesKn: num  23101 63886 35468 12249 61515 ...
##   Department Quarter RevenuesKn ExpensesKn
## 1          A Q1-2015    12416.2    23100.5
## 2          A Q2-2015   224290.1    63886.1
## 3          A Q3-2015    10643.7    35467.8
## 4          A Q4-2015   191229.3    12249.1
## 5          A Q1-2016   258697.4    61514.6
## 6          A Q2-2016   121865.3    46092.6</code></pre>
</div>
<hr />
<p>This table shows the revenues and expenditures of a company departments by quarter. Quarters are currently stored in a complex variable called <code>Quarter</code> consisting of identifiers of the annual quarter (<code>Q1</code>, <code>Q2</code>, <code>Q3</code> or <code>Q4</code>) and year. For analysis purposes, it would probably be more convenient to break this down into two columns - <code>Quarter</code> (which would store only the quarter identifier) and <code>Year</code>.</p>
<p>The <code>tidyr</code> package for this purpose offers a <code>separate</code> function with the following signature:</p>
<div class="sourceCode" id="cb352"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb352-1" title="1"><span class="kw">separate</span>(data, col, into, <span class="dt">sep =</span> <span class="st">&quot;[^[:alnum:]] +&quot;</span>, <span class="dt">remove =</span> <span class="ot">TRUE</span>,</a>
<a class="sourceLine" id="cb352-2" title="2">  <span class="dt">convert =</span> <span class="ot">FALSE</span>, <span class="dt">extra =</span> <span class="st">&quot;warn&quot;</span>, <span class="dt">fill =</span> <span class="st">&quot;warn&quot;</span>, ...)</a></code></pre></div>
<p>The complete documentation of the function can be viewed with the command <code>?separate</code> while here we explain some important parameters:</p>
<ul>
<li><code>col</code> - column to be separated (no quotes required)</li>
<li><code>into</code> - names of new columns (character vector is recommended)</li>
<li><code>sep</code> - value separator in original column, <em>default</em> value is actually a regular expression for “something that is not an alphanumeric character”</li>
<li><code>remove</code> - describes whether or not to remove the original column</li>
</ul>
<p>Let’s try to apply this function to the <code>departments</code> data frame.</p>
<hr />
<p><strong>Assignment 9.15 - the <code>separate</code> function</strong></p>
<div class="sourceCode" id="cb353"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb353-1" title="1"><span class="co"># Separate the `Quarter` column into the` Quarter` and `Year` columns while removing the original column</span></a>
<a class="sourceLine" id="cb353-2" title="2"><span class="co"># save the resulting data grame to the `departments2` variable</span></a>
<a class="sourceLine" id="cb353-3" title="3"><span class="co"># try to do everything within one command with the help of the `%&gt;%` operator</span></a>
<a class="sourceLine" id="cb353-4" title="4"></a>
<a class="sourceLine" id="cb353-5" title="5"></a>
<a class="sourceLine" id="cb353-6" title="6"><span class="co"># briefly explore the `departments2` data frame</span></a></code></pre></div>
<div class="fold s o">
<div class="sourceCode" id="cb354"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb354-1" title="1">departments <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">separate</span>(Quarter, <span class="kw">c</span>(<span class="st">&quot;Quarter&quot;</span>, <span class="st">&quot;Year&quot;</span>), <span class="st">&quot;-&quot;</span>) -&gt;<span class="st"> </span>departments2</a>
<a class="sourceLine" id="cb354-2" title="2"></a>
<a class="sourceLine" id="cb354-3" title="3"><span class="kw">str</span>(departments2)</a>
<a class="sourceLine" id="cb354-4" title="4"><span class="kw">head</span>(departments2)</a></code></pre></div>
<pre><code>## &#39;data.frame&#39;:    28 obs. of  5 variables:
##  $ Department: chr  &quot;A&quot; &quot;A&quot; &quot;A&quot; &quot;A&quot; ...
##  $ Quarter   : chr  &quot;Q1&quot; &quot;Q2&quot; &quot;Q3&quot; &quot;Q4&quot; ...
##  $ Year      : chr  &quot;2015&quot; &quot;2015&quot; &quot;2015&quot; &quot;2015&quot; ...
##  $ RevenuesKn: num  12416 224290 10644 191229 258697 ...
##  $ ExpensesKn: num  23101 63886 35468 12249 61515 ...
##   Department Quarter Year RevenuesKn ExpensesKn
## 1          A      Q1 2015    12416.2    23100.5
## 2          A      Q2 2015   224290.1    63886.1
## 3          A      Q3 2015    10643.7    35467.8
## 4          A      Q4 2015   191229.3    12249.1
## 5          A      Q1 2016   258697.4    61514.6
## 6          A      Q2 2016   121865.3    46092.6</code></pre>
</div>
<hr />
<p>Note that the <code>Quarter</code> and<code>Year</code> columns are actually categorical variables so it would probably be a good idea to factorize them if we are to use them in further analysis.</p>
<p>The <code>separate</code> function is often used to disassemble dates (eg <code>2016-10-28</code> into the year, month and day), but in such situations it is recommended to use the <code>lubridate</code> package created precisely for easier date management. We will introduce this package in one of the following chapters.</p>
<hr />
<p>Finally, let’s learn the <code>unite</code> function, which is somewhat less commonly used and is actually an inverse of the <code>separate</code> function. The <code>unite</code> function signature is:</p>
<div class="sourceCode" id="cb356"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb356-1" title="1"><span class="kw">unite</span>(data, col, ..., <span class="dt">sep =</span> <span class="st">&quot;_&quot;</span>, <span class="dt">remove =</span> <span class="ot">TRUE</span>)</a></code></pre></div>
<p>In this case, too, we can easily retrieve the documentation for <code>unite</code>, and will just briefly describe the parameters that potentially require additional explanation:</p>
<ul>
<li><code>col</code> - new column name (quotes not required)</li>
<li><code>...</code> - the names of the columns we merge - we don’t have to use quotation marks, and if there are many columns we can use the same syntax to select as with the <code>gather</code> function</li>
</ul>
<p>Let’s try using this function on the <code>departments2</code> data frame.</p>
<hr />
<p><strong>Assignment 9.16 - the <code>unite</code> function</strong></p>
<div class="sourceCode" id="cb357"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb357-1" title="1"><span class="co"># merge the `Quarter` and` Year` columns from the `departments2` table into a unique` Quarter` column</span></a>
<a class="sourceLine" id="cb357-2" title="2"><span class="co"># remove the previous `Quarter` and `Year` columns</span></a>
<a class="sourceLine" id="cb357-3" title="3"><span class="co"># use `-` as a separator</span></a>
<a class="sourceLine" id="cb357-4" title="4"><span class="co"># save the result to the `departments3` variable</span></a>
<a class="sourceLine" id="cb357-5" title="5"><span class="co"># use the `%&gt;% &#39;operator to put everything in one line</span></a>
<a class="sourceLine" id="cb357-6" title="6"></a>
<a class="sourceLine" id="cb357-7" title="7"></a>
<a class="sourceLine" id="cb357-8" title="8"><span class="co"># compare `departments` and` departments3` data frames</span></a></code></pre></div>
<div class="fold s o">
<div class="sourceCode" id="cb358"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb358-1" title="1">departments2 <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">unite</span>(Quarter, Quarter, Year, <span class="dt">sep =</span> <span class="st">&quot;-&quot;</span>) -&gt;<span class="st"> </span>departments3</a>
<a class="sourceLine" id="cb358-2" title="2"></a>
<a class="sourceLine" id="cb358-3" title="3"><span class="kw">str</span>(departments2)</a>
<a class="sourceLine" id="cb358-4" title="4"><span class="kw">head</span>(departments2)</a>
<a class="sourceLine" id="cb358-5" title="5"><span class="kw">str</span>(departments3)</a>
<a class="sourceLine" id="cb358-6" title="6"><span class="kw">head</span>(departments3)</a></code></pre></div>
<pre><code>## &#39;data.frame&#39;:    28 obs. of  5 variables:
##  $ Department: chr  &quot;A&quot; &quot;A&quot; &quot;A&quot; &quot;A&quot; ...
##  $ Quarter   : chr  &quot;Q1&quot; &quot;Q2&quot; &quot;Q3&quot; &quot;Q4&quot; ...
##  $ Year      : chr  &quot;2015&quot; &quot;2015&quot; &quot;2015&quot; &quot;2015&quot; ...
##  $ RevenuesKn: num  12416 224290 10644 191229 258697 ...
##  $ ExpensesKn: num  23101 63886 35468 12249 61515 ...
##   Department Quarter Year RevenuesKn ExpensesKn
## 1          A      Q1 2015    12416.2    23100.5
## 2          A      Q2 2015   224290.1    63886.1
## 3          A      Q3 2015    10643.7    35467.8
## 4          A      Q4 2015   191229.3    12249.1
## 5          A      Q1 2016   258697.4    61514.6
## 6          A      Q2 2016   121865.3    46092.6
## &#39;data.frame&#39;:    28 obs. of  4 variables:
##  $ Department: chr  &quot;A&quot; &quot;A&quot; &quot;A&quot; &quot;A&quot; ...
##  $ Quarter   : chr  &quot;Q1-2015&quot; &quot;Q2-2015&quot; &quot;Q3-2015&quot; &quot;Q4-2015&quot; ...
##  $ RevenuesKn: num  12416 224290 10644 191229 258697 ...
##  $ ExpensesKn: num  23101 63886 35468 12249 61515 ...
##   Department Quarter RevenuesKn ExpensesKn
## 1          A Q1-2015    12416.2    23100.5
## 2          A Q2-2015   224290.1    63886.1
## 3          A Q3-2015    10643.7    35467.8
## 4          A Q4-2015   191229.3    12249.1
## 5          A Q1-2016   258697.4    61514.6
## 6          A Q2-2016   121865.3    46092.6</code></pre>
</div>
<hr />
<h2 id="exercise-tasks" class="unnumbered">Exercise Tasks</h2>
<ol style="list-style-type: decimal">
<li>Initialize the random number generator using the command <code>set.seed (1234)</code>. Then, with the help of a single command and the `%&gt;% ’operator, perform the following:</li>
</ol>
<ul>
<li>create 100,000 random numbers drawn from the normal distribution with arithmetic mean of 10000 and standard deviation of 1000</li>
<li>round the numbers to the first larger integer</li>
<li>drop duplicates from the set</li>
<li>sort the set in ascending order</li>
<li>randomly select 100 elements from the set</li>
<li>organize these 100 elements into a 10x10 matrix, arranged in rows</li>
<li>calculate sums of rows of the matrix</li>
<li>print the mean of line sums on the screen.</li>
</ul>
<ol start="2" style="list-style-type: decimal">
<li>The <code>weather.csv</code> file contains meteorological station meteorological data which measures the temperature, pressure, humidity and wind speed every hour (data are downloaded and adapted from the data set of the<code>weatherData</code> package available on CRAN). Do the following:</li>
</ol>
<ul>
<li>load the file into the data frame and examine the loaded data (<code>names</code>, <code>str</code>, <code>summary</code>,<code>head</code> …)</li>
<li>answer: is it a tidy dataset? Why?</li>
<li>Take the appropriate steps to obtain a data frame that complies with the tidy data principle</li>
<li>save the new data frame to the file called <code>weatherClean.csv</code></li>
</ul>
<hr />
<p><a rel="license" href="http://creativecommons.org/licenses/by-nc-nd/4.0/"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by-nc-nd/4.0/88x31.png" /></a><br /><span xmlns:dct="http://purl.org/dc/terms/" property="dct:title">Programirajmo u R-u</span> by <a xmlns:cc="http://creativecommons.org/ns#" href="https://www.fer.unizg.hr/en/damir.pintar" property="cc:attributionName" rel="cc:attributionURL">Damir Pintar</a> is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-nc-nd/4.0/">Creative Commons Attribution-NonCommercial-NoDerivatives 4.0 International License</a>.<br />Based on a work at <a xmlns:dct="http://purl.org/dc/terms/" href="https://ratnip.github.io/FER_OPJR/" rel="dct:source">https://ratnip.github.io/FER_OPJR/</a></p>

<h1 id="dates"><span class="header-section-number">4.2</span> Working with dates and character strings</h1>
<hr />
<h2 id="working-with-dates"><span class="header-section-number">4.2</span> Working with dates</h2>
<p>Managing dates and timestamps is always a challenge when working with real-life datasets, since we have to take into account things like:</p>
<ul>
<li>different date and time format specifications</li>
<li>different internal representations</li>
<li>different time zones</li>
<li>difference between mathematical and calendar understanding of time periods</li>
</ul>
<p>One of the more commonly used standards is the so-called “unix time” (or “POSIX time”), which counts as the number of seconds elapsed since midnight on January 1, 1970 UTC (<em>Coordinated Universal Time</em>). This is not an universal standard for all operations systems or applications; for example, Microsoft Excel has its own format where it counts the days since 1.1.1900 and then the number of hours, minutes and seconds elapsed since midnight.</p>
<p>The R programming language has offers three main classes for date/time management:</p>
<ul>
<li><code>Date</code> for dates</li>
<li><code>POSIXct</code> for compact representation of timestamps</li>
<li><code>POSIXlt</code> for “long” representation of timestamps (in list format)</li>
</ul>
<h3 id="the-date-class"><span class="header-section-number">4.2</span> The <code>Date</code> class</h3>
<p>We use the Date class when we want to note the date but not the exact time of an observation or event. This class does not have a constructor, and we most commonly create <code>Date</code> objects using the following functions:</p>
<ul>
<li><code>Sys.Date()</code> which returns today’s date</li>
<li><code>as.Date(&lt;date_string&gt;)</code> which accepts a character string as a parameter</li>
</ul>
<p>The function <code>as.Date()</code> by default accepts dates in the following format: <code>%Y-%m-%d</code>. Here, <code>%Y</code> represents a four-digit year, while <code>%m</code> and <code>%d</code> are two-digit months and days. If we want to interpret a date that is written in another format then we need to add an additional parameter called <code>format</code> which will parametrically describe the format we are using (e.g. for <code>28/10/1978</code> the format parameter value should be <code>%d/%m/%Y</code>). Other format specifications can easily be viewed using the <code>?strptime</code> command, although a much simpler approach entails using functions of the<code>lubridate</code> package (to be introduced later in this chapter).</p>
<hr />
<p><strong>Assignment 10.1 - class <code>Date</code></strong></p>
<div class="sourceCode" id="cb360"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb360-1" title="1"><span class="co"># print out today&#39;s date</span></a>
<a class="sourceLine" id="cb360-2" title="2"></a>
<a class="sourceLine" id="cb360-3" title="3"><span class="co"># convert the following character strings to a `Date` type object and print the result on the screen:</span></a>
<a class="sourceLine" id="cb360-4" title="4"><span class="co"># &#39;1986-12-27&#39;, &#39;2016-31-05&#39;, &#39;17.10.2015 &#39;, &#39;01#01#2001&#39;</span></a></code></pre></div>
</div>
<div class="sourceCode" id="cb361"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb361-1" title="1"><span class="co"># print out today&#39;s date</span></a>
<a class="sourceLine" id="cb361-2" title="2"><span class="kw">Sys.Date</span>()</a>
<a class="sourceLine" id="cb361-3" title="3"></a>
<a class="sourceLine" id="cb361-4" title="4"><span class="co"># convert the following character strings to a Date type object and print the result on the screen:</span></a>
<a class="sourceLine" id="cb361-5" title="5"><span class="co"># &#39;1986-12-27&#39;, &#39;2016-31-05&#39;, &#39;17.10.2015 &#39;, &#39;01#01#2001&#39;</span></a>
<a class="sourceLine" id="cb361-6" title="6"><span class="kw">as.Date</span>(<span class="st">&quot;27/12/1986&quot;</span>)</a>
<a class="sourceLine" id="cb361-7" title="7"><span class="kw">as.Date</span>(<span class="st">&#39;2016-31-05&#39;</span>, <span class="dt">format =</span> <span class="st">&#39;%Y-%d-%m&#39;</span>)</a>
<a class="sourceLine" id="cb361-8" title="8"><span class="kw">as.Date</span>(<span class="st">&#39;17.10.2015&#39;</span>, <span class="dt">format =</span> <span class="st">&#39;%d.%m.%Y&#39;</span>)</a>
<a class="sourceLine" id="cb361-9" title="9"><span class="kw">as.Date</span>(<span class="st">&#39;01#01#2001&#39;</span>, <span class="dt">format =</span> <span class="st">&#39;%d#%m#%Y&#39;</span>)</a></code></pre></div>
<pre><code>## [1] &quot;2019-12-06&quot;
## [1] &quot;0027-12-19&quot;
## [1] &quot;2016-05-31&quot;
## [1] &quot;2015-10-17&quot;
## [1] &quot;2001-01-01&quot;</code></pre>
</div>
<hr />
<p>Dates allow using simple arithmetic operations. We can add or substract days from a date by using operators <code>+</code> and <code>-</code> with integers, or we can calculate the difference between two dates with the operator <code>-</code>.
***</p>
<p><strong>Assignment 10.2 - date arithmetics</strong></p>
<div class="sourceCode" id="cb363"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb363-1" title="1"><span class="co"># print out what date was 1000 days before today</span></a>
<a class="sourceLine" id="cb363-2" title="2"></a>
<a class="sourceLine" id="cb363-3" title="3"><span class="co"># add one day to 2/28/2015. and 2/28/2016 and print the result</span></a>
<a class="sourceLine" id="cb363-4" title="4"></a>
<a class="sourceLine" id="cb363-5" title="5"><span class="co"># print out how many days have passed since 1.1.2000. until today</span></a></code></pre></div>
</div>
<div class="sourceCode" id="cb364"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb364-1" title="1"><span class="co"># print out what date was 1000 days before today</span></a>
<a class="sourceLine" id="cb364-2" title="2"><span class="kw">Sys.Date</span>() <span class="op">-</span><span class="st"> </span><span class="dv">1000</span></a>
<a class="sourceLine" id="cb364-3" title="3"></a>
<a class="sourceLine" id="cb364-4" title="4"><span class="co"># add one day to 2/28/2015. and 2/28/2016 and print the result</span></a>
<a class="sourceLine" id="cb364-5" title="5"><span class="kw">as.Date</span>(<span class="st">&#39;2015-02-28&#39;</span>) <span class="op">+</span><span class="st"> </span><span class="dv">1</span></a>
<a class="sourceLine" id="cb364-6" title="6"><span class="kw">as.Date</span>(<span class="st">&#39;2016-02-28&#39;</span>) <span class="op">+</span><span class="st"> </span><span class="dv">1</span></a>
<a class="sourceLine" id="cb364-7" title="7"></a>
<a class="sourceLine" id="cb364-8" title="8"><span class="co"># print out how many days have passed since 1.1.2000. until today</span></a>
<a class="sourceLine" id="cb364-9" title="9"><span class="kw">Sys.Date</span>() <span class="op">-</span><span class="st"> </span><span class="kw">as.Date</span>(<span class="st">&#39;2000-01-01&#39;</span>)</a></code></pre></div>
<pre><code>## [1] &quot;2017-03-11&quot;
## [1] &quot;2015-03-01&quot;
## [1] &quot;2016-02-29&quot;
## Time difference of 7279 days</code></pre>
</div>
<hr />
<p>The last expression will actually result in an object of class <code>difftime</code> which is an object representation of a time interval. Printing this object uses so-called “automatic” unit selection (specifically, the <code>units</code> parameter is by defaykt set to <code>auto</code>) that will attempt to select the most appropriate time unit for printing. If we want to explicitly choose which time unit we want (seconds, minutes, hours, days or weeks), then it’s easier to forgo using the <code>-</code> operator and leverage the <code>difftime()</code> function directly. Specific time unit can then be chosen by setting the <code>units</code> parameter to <code>seconds</code>, <code>minutes</code> etc.</p>
<hr />
<p><strong>Assignment 10.3 - function <code>difftime</code></strong></p>
<div class="sourceCode" id="cb366"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb366-1" title="1"><span class="co"># How many weeks passed between 1.3.2016. i 1.3.2015.?</span></a>
<a class="sourceLine" id="cb366-2" title="2"><span class="co"># use the `difftime` function</span></a>
<a class="sourceLine" id="cb366-3" title="3"><span class="co"># </span><span class="al">NOTE</span><span class="co">: You do not need to explicitly call the `as.Date` function, the `difftime()` function</span></a>
<a class="sourceLine" id="cb366-4" title="4"><span class="co"># will do it by itself if you submit the date in the default format</span></a>
<a class="sourceLine" id="cb366-5" title="5"></a>
<a class="sourceLine" id="cb366-6" title="6"><span class="co"># how many hours have passed between 1.3.2015. and today?</span></a></code></pre></div>
</div>
<div class="sourceCode" id="cb367"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb367-1" title="1"><span class="co"># How many weeks passed between 1.3.2016. i 1.3.2015.?</span></a>
<a class="sourceLine" id="cb367-2" title="2"><span class="co"># use the `difftime` function</span></a>
<a class="sourceLine" id="cb367-3" title="3"><span class="co"># </span><span class="al">NOTE</span><span class="co">: You do not need to explicitly call the `as.Date` function, the `difftime()` function</span></a>
<a class="sourceLine" id="cb367-4" title="4"><span class="co"># will do it by itself if you submit the date in the default format</span></a>
<a class="sourceLine" id="cb367-5" title="5"><span class="kw">difftime</span>(<span class="st">&#39;2016-03-01&#39;</span>, <span class="st">&#39;2015-03-01&#39;</span>, <span class="dt">units =</span> <span class="st">&quot;weeks&quot;</span>)</a>
<a class="sourceLine" id="cb367-6" title="6"></a>
<a class="sourceLine" id="cb367-7" title="7"><span class="co"># how many hours have passed between 1.3.2015. and today?</span></a>
<a class="sourceLine" id="cb367-8" title="8"><span class="kw">difftime</span>(<span class="kw">Sys.Date</span>(), <span class="st">&#39;2015-03-01&#39;</span>, <span class="dt">units =</span> <span class="st">&quot;hours&quot;</span>)</a></code></pre></div>
<pre><code>## Time difference of 52.28571 weeks
## Time difference of 41785 hours</code></pre>
</div>
<hr />
<p>The <code>difftime</code> function actually works with timestamps as well, i.e. we don’t necessarily have to work at the date level, we can get information on finer granularity when it comes to time units. We will show this in more detail after we learn the class <code>POSIXct</code>. Also, if we only require a number (of seconds, hours, days, etc.), we can easily transform the <code>difftime</code> output into an integer using the <code>as.numeric</code> function.</p>
<p>The R language also implements a special variant of the <code>seq</code> function for working with dates, which has the following signature:</p>
<div class="sourceCode" id="cb369"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb369-1" title="1"><span class="kw">seq</span>(from, to, by, <span class="dt">length.out =</span> <span class="ot">NULL</span>, <span class="dt">along.with =</span> <span class="ot">NULL</span>, ...)</a></code></pre></div>
<p>The parameters of this function are as follows:</p>
<ul>
<li><code>from</code> - start date (required parameter)</li>
<li><code>to</code> - final date</li>
<li><code>by</code> - step of the sequence in days, or a character string which denotes the time interval such as <code>"7 days"</code>, <code>"2 weeks"</code> etc. (for all possibilities see the documentation!)</li>
<li><code>length.out</code> - length of sequence</li>
<li><code>along.with</code> - vector whose length we take for reference (<code>along.with(x)</code> is the same as <code>length.out = length(x)</code>)</li>
</ul>
<p>Let’s try this function.</p>
<hr />
<p><strong>Assignment 10.4 - function <code>seq</code> and dates </strong></p>
<div class="sourceCode" id="cb370"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb370-1" title="1"><span class="co"># print the date sequence from 1/1/2010. to 1/1/2030. in 6-month increments</span></a>
<a class="sourceLine" id="cb370-2" title="2"></a>
<a class="sourceLine" id="cb370-3" title="3"></a>
<a class="sourceLine" id="cb370-4" title="4"><span class="co"># make a schedule for one round of cleaning the common areas of an apartment building</span></a>
<a class="sourceLine" id="cb370-5" title="5"><span class="co"># common areas must be cleaned every 3 weeks</span></a>
<a class="sourceLine" id="cb370-6" title="6"><span class="co"># each apartment must get their own date</span></a>
<a class="sourceLine" id="cb370-7" title="7"></a>
<a class="sourceLine" id="cb370-8" title="8"><span class="co"># apartments are described by the following data frame</span></a>
<a class="sourceLine" id="cb370-9" title="9">apartments &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">appId =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">10</span>,</a>
<a class="sourceLine" id="cb370-10" title="10">                      <span class="dt">surname =</span> <span class="kw">c</span>(<span class="st">&quot;Ebert&quot;</span>, <span class="st">&quot;Ladovac&quot;</span>, <span class="st">&quot;Cerić&quot;</span>, <span class="st">&quot;Dikla&quot;</span>, <span class="st">&quot;Anic&quot;</span>,</a>
<a class="sourceLine" id="cb370-11" title="11">                                  <span class="st">&quot;Perić&quot;</span>, <span class="st">&quot;Žužić&quot;, &quot;</span>Babić<span class="st">&quot;, &quot;</span>Ibiza<span class="st">&quot;, &quot;</span>Radler<span class="st">&quot;))</span></a>
<a class="sourceLine" id="cb370-12" title="12"></a>
<a class="sourceLine" id="cb370-13" title="13"><span class="st"># Add a `cleaningDate` column with one date for each apartment</span></a>
<a class="sourceLine" id="cb370-14" title="14"><span class="st"># in order of apartment numbers, starting today</span></a>
<a class="sourceLine" id="cb370-15" title="15"></a>
<a class="sourceLine" id="cb370-16" title="16"></a>
<a class="sourceLine" id="cb370-17" title="17"><span class="st"># print out the &#39;apartments&#39; data frame</span></a></code></pre></div>
</div>
<div class="sourceCode" id="cb371"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb371-1" title="1"><span class="co"># print the date sequence from 1/1/2010. to 1/1/2030. in 6-month increments</span></a>
<a class="sourceLine" id="cb371-2" title="2"><span class="kw">seq</span>(<span class="kw">as.Date</span>(<span class="st">&#39;2010-01-01&#39;</span>), <span class="kw">as.Date</span>(<span class="st">&#39;2030-01-01&#39;</span>), <span class="dt">by =</span> <span class="st">&quot;6 months&quot;</span>)</a>
<a class="sourceLine" id="cb371-3" title="3"></a>
<a class="sourceLine" id="cb371-4" title="4"><span class="co"># Add a `cleaningDate` column with one date for each apartment</span></a>
<a class="sourceLine" id="cb371-5" title="5"><span class="co"># in order of apartment numbers, starting today</span></a>
<a class="sourceLine" id="cb371-6" title="6"><span class="kw">seq</span>(<span class="kw">Sys.Date</span>(), <span class="dt">by =</span> <span class="st">&quot;3 weeks&quot;</span>,</a>
<a class="sourceLine" id="cb371-7" title="7">    <span class="dt">along.with =</span> apartments<span class="op">$</span>appId) -&gt;<span class="st"> </span>apartments<span class="op">$</span>cleaningDate</a>
<a class="sourceLine" id="cb371-8" title="8"></a>
<a class="sourceLine" id="cb371-9" title="9"><span class="co"># print out the &#39;apartments&#39; data frame</span></a>
<a class="sourceLine" id="cb371-10" title="10">apartments</a></code></pre></div>
<pre><code>##  [1] &quot;2010-01-01&quot; &quot;2010-07-01&quot; &quot;2011-01-01&quot; &quot;2011-07-01&quot; &quot;2012-01-01&quot;
##  [6] &quot;2012-07-01&quot; &quot;2013-01-01&quot; &quot;2013-07-01&quot; &quot;2014-01-01&quot; &quot;2014-07-01&quot;
## [11] &quot;2015-01-01&quot; &quot;2015-07-01&quot; &quot;2016-01-01&quot; &quot;2016-07-01&quot; &quot;2017-01-01&quot;
## [16] &quot;2017-07-01&quot; &quot;2018-01-01&quot; &quot;2018-07-01&quot; &quot;2019-01-01&quot; &quot;2019-07-01&quot;
## [21] &quot;2020-01-01&quot; &quot;2020-07-01&quot; &quot;2021-01-01&quot; &quot;2021-07-01&quot; &quot;2022-01-01&quot;
## [26] &quot;2022-07-01&quot; &quot;2023-01-01&quot; &quot;2023-07-01&quot; &quot;2024-01-01&quot; &quot;2024-07-01&quot;
## [31] &quot;2025-01-01&quot; &quot;2025-07-01&quot; &quot;2026-01-01&quot; &quot;2026-07-01&quot; &quot;2027-01-01&quot;
## [36] &quot;2027-07-01&quot; &quot;2028-01-01&quot; &quot;2028-07-01&quot; &quot;2029-01-01&quot; &quot;2029-07-01&quot;
## [41] &quot;2030-01-01&quot;
##    appId surname cleaningDate
## 1      1   Ebert   2019-12-06
## 2      2 Ladovac   2019-12-27
## 3      3   Ceric   2020-01-17
## 4      4   Dikla   2020-02-07
## 5      5    Anic   2020-02-28
## 6      6   Peric   2020-03-20
## 7      7   Žužic   2020-04-10
## 8      8   Babic   2020-05-01
## 9      9   Ibiza   2020-05-22
## 10    10  Radler   2020-06-12</code></pre>
</div>
<hr />
<div id="theposixct-andposixlt-classes" class="section level3">
<h3><span class="header-section-number">4.2.1</span> The<code>POSIXct</code> and<code>POSIXlt</code> classes</h3>
<p>The class <code>POSIXct</code> is when in addition to the date we also need to know the exact time for some observation or event. The usual way of creating an object of this class is using the following functions:</p>
<ul>
<li><code>Sys.time()</code> which returns the current timestamp (using the timezone set by the operating system)</li>
<li><code>as.POSIXct(&lt;timestamp_string&gt;)</code> which uses a character string representing the date and time</li>
</ul>
<p>The function <code>as.POSIXct()</code> expects a timestamp character string that uses the following format: <code>%Y-%m-%d %H:%M:%S</code>. First three format specifications are identical to the date format specification, while <code>%H</code>, <code>%M</code> and <code>%S</code> represent two-digit hours, minutes and seconds (24-hour time format is assumed unless <code>am</code> or <code>pm</code> is noted). The <code>as.POSIXct</code> function can also accept an optional <code>tz</code> parameter which explicitly sets the timezone. To parse other timestamp formats, it is necessary - as with the class <code>Date</code> - to add a <code>format</code> parameter containing a specification on how to interpret the given character string. Again, for the list of all parameters we can refer to the the <code>?strptime</code> command, although as with the <code>Date</code> class we will later learn it’s often easier to use one of the functions of the <code>lubridate</code> package.</p>
<hr />
<p><strong>Assignment 10.5 - class <code>POSIXct</code> </strong></p>
<div class="sourceCode" id="cb373"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb373-1" title="1"><span class="co"># print the current date and time</span></a>
<a class="sourceLine" id="cb373-2" title="2"></a>
<a class="sourceLine" id="cb373-3" title="3"><span class="co"># convert the following character strings to timestamps and print them on the screen:</span></a>
<a class="sourceLine" id="cb373-4" title="4"><span class="co"># &quot;2015-10-28 15:30:42&quot;</span></a>
<a class="sourceLine" id="cb373-5" title="5"><span class="co"># &quot;01-12-2001 14:30&quot; &lt;- timestamp read in New York, USA, EST time zone</span></a></code></pre></div>
</div>
<div class="sourceCode" id="cb374"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb374-1" title="1"><span class="co"># print the current date and time</span></a>
<a class="sourceLine" id="cb374-2" title="2"><span class="kw">Sys.time</span>()</a>
<a class="sourceLine" id="cb374-3" title="3"></a>
<a class="sourceLine" id="cb374-4" title="4"><span class="co"># convert the following character strings to timestamps and print them on the screen:</span></a>
<a class="sourceLine" id="cb374-5" title="5"><span class="co"># &quot;2015-10-28 15:30:42&quot;</span></a>
<a class="sourceLine" id="cb374-6" title="6"><span class="co"># &quot;01-12-2001 14:30&quot; &lt;- timestamp read in New York, USA, EST time zone</span></a>
<a class="sourceLine" id="cb374-7" title="7"><span class="kw">as.POSIXct</span>(<span class="st">&quot;2015-10-28 15:30:42&quot;</span>)</a>
<a class="sourceLine" id="cb374-8" title="8"><span class="kw">as.POSIXct</span>(<span class="st">&quot;01-12-2001 14:30&quot;</span>, <span class="dt">tz =</span> <span class="st">&quot;EST&quot;</span>, <span class="dt">format =</span> <span class="st">&quot;% d-% m-% Y% H:% M&quot;</span>)</a></code></pre></div>
<pre><code>## [1] &quot;2019-12-06 10:12:20 CET&quot;
## [1] &quot;2015-10-28 15:30:42 CET&quot;
## [1] NA</code></pre>
</div>
<hr />
<p>Time zone names are standardized (so-called “Olson time zones”) and are retrieved from the underlying operating system. We can explicitly retrieve them using the <code>OlsonNames()</code> function. Also, we can easily print the current platform’s time zone by using the <code>Sys.timezone()</code> function.</p>
<hr />
<p><strong>Assignment 10.6 - time zones</strong></p>
<div class="sourceCode" id="cb376"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb376-1" title="1"><span class="co"># print the current time zone</span></a>
<a class="sourceLine" id="cb376-2" title="2"></a>
<a class="sourceLine" id="cb376-3" title="3"><span class="co"># print out 10 randomly selected time zone names installed on the current platform</span></a></code></pre></div>
</div>
<div class="sourceCode" id="cb377"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb377-1" title="1"><span class="co"># print the current time zone</span></a>
<a class="sourceLine" id="cb377-2" title="2"><span class="kw">Sys.timezone</span>()</a>
<a class="sourceLine" id="cb377-3" title="3"></a>
<a class="sourceLine" id="cb377-4" title="4"><span class="co"># print out 10 randomly selected time zone names installed on the current platform</span></a>
<a class="sourceLine" id="cb377-5" title="5"><span class="kw">sample</span>(<span class="kw">OlsonNames</span>(), <span class="dv">10</span>)</a></code></pre></div>
<pre><code>## [1] &quot;Europe/Warsaw&quot;
##  [1] &quot;Pacific/Kosrae&quot;       &quot;America/Havana&quot;       &quot;Asia/Aqtau&quot;          
##  [4] &quot;Africa/Timbuktu&quot;      &quot;Israel&quot;               &quot;America/Campo_Grande&quot;
##  [7] &quot;Asia/Hong_Kong&quot;       &quot;Pacific/Johnston&quot;     &quot;Asia/Tashkent&quot;       
## [10] &quot;Etc/GMT-2&quot;</code></pre>
</div>
<hr />
<p>Timestamps can also use <code>+</code> and <code>-</code> operators (with integers as the second operand) to add or substract seconds from the timestamp. Additionally, we can subtract two timestamps to get the difference in seconds, or use the <code>difftime</code> function with the selected time unit value.</p>
<hr />
<p><strong>Assignment 10.7 - timestamp arithmetics</strong></p>
<div class="sourceCode" id="cb379"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb379-1" title="1"><span class="co"># print out what the time will be 1000 seconds from now</span></a>
<a class="sourceLine" id="cb379-2" title="2"></a>
<a class="sourceLine" id="cb379-3" title="3"><span class="co"># print out how many hours have passed since midnight 1/1/2015 </span></a></code></pre></div>
</div>
<div class="sourceCode" id="cb380"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb380-1" title="1"><span class="co"># print out what the time will be 1000 seconds from now</span></a>
<a class="sourceLine" id="cb380-2" title="2"><span class="kw">Sys.time</span>() <span class="op">+</span><span class="st"> </span><span class="dv">1000</span></a>
<a class="sourceLine" id="cb380-3" title="3"></a>
<a class="sourceLine" id="cb380-4" title="4"><span class="co"># print out how many hours have passed since midnight 1/1/2015. by far</span></a>
<a class="sourceLine" id="cb380-5" title="5"><span class="kw">difftime</span>(<span class="kw">Sys.time</span>(), <span class="st">&quot;2015-01-01 00:00:00&quot;</span>, <span class="dt">units =</span> <span class="st">&quot;hours&quot;</span>)</a></code></pre></div>
<pre><code>## [1] &quot;2019-12-06 10:29:01 CET&quot;
## Time difference of 43210.21 hours</code></pre>
</div>
<hr />
<p>The class <code>POSIXlt</code> is very similar to its compact relative <code>POSIXct</code>. We use the similarly fashioned <code>as.POSIXlt</code> function to create one, however the difference is that we end up with a list which allows us to easily extract certain parameters from a timestamp, such as number of seconds, minutes, day of the week, etc. We can easily see all the elements of the list if we create a <code>POSIXlt</code> object and then call the <code>unclass</code> function on it, which will convert it to an “ordinary” list. We can even go a step further - if we put this list through the <code>unlist</code> function, we get a simple, easily interpretable character vector as a result.</p>
<hr />
<p><strong>Assignment 10.8 - class <code>POSIXlt</code> </strong></p>
<div class="sourceCode" id="cb382"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb382-1" title="1"><span class="co"># convert the following character string to a timestamp of type `POSIXlt`</span></a>
<a class="sourceLine" id="cb382-2" title="2"><span class="co"># store the result in the variable `t_long`</span></a>
<a class="sourceLine" id="cb382-3" title="3"><span class="co"># &quot;01/05/2013 13:35&quot;</span></a>
<a class="sourceLine" id="cb382-4" title="4"></a>
<a class="sourceLine" id="cb382-5" title="5"><span class="co"># print just the number of hours of the timestamp `t_long`</span></a>
<a class="sourceLine" id="cb382-6" title="6"><span class="co"># then just the number of minutes</span></a>
<a class="sourceLine" id="cb382-7" title="7"><span class="co"># you can find this information in subelements called `hour` and `minute`</span></a>
<a class="sourceLine" id="cb382-8" title="8"></a>
<a class="sourceLine" id="cb382-9" title="9"><span class="co"># remove the class and list property of the variable `t_long`</span></a>
<a class="sourceLine" id="cb382-10" title="10"><span class="co"># and print it on the screen</span></a></code></pre></div>
</div>
<div class="sourceCode" id="cb383"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb383-1" title="1"><span class="co"># convert the following character string to a timestamp of type `POSIXlt`</span></a>
<a class="sourceLine" id="cb383-2" title="2"><span class="co"># store the result in the variable `t_long`</span></a>
<a class="sourceLine" id="cb383-3" title="3"><span class="co"># &quot;01/05/2013 13:35&quot;</span></a>
<a class="sourceLine" id="cb383-4" title="4">t_long &lt;-<span class="st"> </span><span class="kw">as.POSIXlt</span>(<span class="st">&quot;5/1/2013 1:35PM&quot;</span>, <span class="dt">format =</span> <span class="st">&quot;%d.%m.%Y %H:%M&quot;</span>)</a>
<a class="sourceLine" id="cb383-5" title="5"></a>
<a class="sourceLine" id="cb383-6" title="6"><span class="co"># print just the number of hours of the timestamp `t_long`</span></a>
<a class="sourceLine" id="cb383-7" title="7"><span class="co"># then just the number of minutes</span></a>
<a class="sourceLine" id="cb383-8" title="8"><span class="co"># you can find this information in subelements called `hour` and `minute`</span></a>
<a class="sourceLine" id="cb383-9" title="9">t_long<span class="op">$</span>hour</a>
<a class="sourceLine" id="cb383-10" title="10">t_long<span class="op">$</span>min</a>
<a class="sourceLine" id="cb383-11" title="11"></a>
<a class="sourceLine" id="cb383-12" title="12"><span class="co"># remove the class and list property of the variable `t_long`</span></a>
<a class="sourceLine" id="cb383-13" title="13"><span class="co"># and print it on the screen</span></a>
<a class="sourceLine" id="cb383-14" title="14">t_long <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">unclass</span>() <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">unlist</span>()</a></code></pre></div>
<pre><code>## [1] NA
## [1] NA
##    sec    min   hour   mday    mon   year   wday   yday  isdst   zone 
##     NA     NA     NA     NA     NA     NA     NA     NA   &quot;-1&quot;     &quot;&quot; 
## gmtoff 
##     NA</code></pre>
</div>
<hr />
</div>
<div id="the-lubridate-package" class="section level3">
<h3><span class="header-section-number">4.2.2</span> The <code>lubridate</code> package</h3>
<p>Although the R language has relatively good support for working with dates and timestamps, we can make managing them significantly more efficient by using a package called <code>lubridate</code> package. If we analyze data where the time component is very important, or manage data sets that use exotic ways of noting date and time, then we can greatly simplify and accelerate the analysis process by using the features provided by this package.</p>
<p>One of the things that may be most helpful to developers who don’t like to write formatted date parsing specifications is the family of date parsing functions whose names match the overall “structure” of the record we want to parse. For example, the function called <code>ymd</code> can parse character strings in which the date is written in the order <em>year-month-day</em>. The function is “smart” enough to interpret the details of the record itself, such as delimiters, character fields, etc. If the record has a different day, month, and year layout, it is only necessary to arrange the letters appropriately in the function name.</p>
<hr />
<p><strong>Assignment 10.9 - date parsing functions of the <code>lubridate</code> package</strong></p>
<div class="sourceCode" id="cb385"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb385-1" title="1"><span class="co"># library(lubridate) # load if needed!</span></a>
<a class="sourceLine" id="cb385-2" title="2"></a>
<a class="sourceLine" id="cb385-3" title="3"><span class="co"># using the functions in the `lubridate` package</span></a>
<a class="sourceLine" id="cb385-4" title="4"><span class="co"># parse the following character strings into dates and print them on the screen</span></a>
<a class="sourceLine" id="cb385-5" title="5"><span class="co"># &quot;2016-07-31&quot;</span></a>
<a class="sourceLine" id="cb385-6" title="6"><span class="co"># &quot;2/28/1983.&quot;</span></a>
<a class="sourceLine" id="cb385-7" title="7"><span class="co"># &quot;07#31#1996&quot;</span></a>
<a class="sourceLine" id="cb385-8" title="8"><span class="co"># &quot;20010830&quot;</span></a></code></pre></div>
</div>
<div class="sourceCode" id="cb386"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb386-1" title="1"><span class="co"># using the functions in the `lubridate` package</span></a>
<a class="sourceLine" id="cb386-2" title="2"><span class="co"># parse the following character strings into dates and print them on the screen</span></a>
<a class="sourceLine" id="cb386-3" title="3"><span class="co"># &quot;2016-07-31&quot;</span></a>
<a class="sourceLine" id="cb386-4" title="4"><span class="co"># &quot;2/28/1983.&quot;</span></a>
<a class="sourceLine" id="cb386-5" title="5"><span class="co"># &quot;07#31#1996&quot;</span></a>
<a class="sourceLine" id="cb386-6" title="6"><span class="co"># &quot;20010830&quot;</span></a>
<a class="sourceLine" id="cb386-7" title="7"><span class="kw">ymd</span>(<span class="st">&quot;7/31/2016&quot;</span>)</a></code></pre></div>
<pre><code>## Warning: All formats failed to parse. No formats found.</code></pre>
<div class="sourceCode" id="cb388"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb388-1" title="1"><span class="kw">dmy</span>(<span class="st">&quot;02/28/1983.&quot;</span>)</a></code></pre></div>
<pre><code>## Warning: All formats failed to parse. No formats found.</code></pre>
<div class="sourceCode" id="cb390"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb390-1" title="1"><span class="kw">mdy</span>(<span class="st">&quot;07#31#1996&quot;</span>)</a>
<a class="sourceLine" id="cb390-2" title="2"><span class="kw">ymd</span>(<span class="st">&quot;20010830&quot;</span>)</a></code></pre></div>
<pre><code>## [1] NA
## [1] NA
## [1] &quot;1996-07-31&quot;
## [1] &quot;2001-08-30&quot;</code></pre>
</div>
<hr />
<p>The aforementioned approach can also be used for timestamps, we just add the underscore and then the “letters” for hours, minutes and/or seconds (e.g. <code>ymd_hms</code>).</p>
<hr />
<p><strong>Assignment 10.10 - timestamp parsing functions of the <code>lubridate</code> package</strong></p>
<div class="sourceCode" id="cb392"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb392-1" title="1"><span class="co"># using the functions in the `lubridate` package</span></a>
<a class="sourceLine" id="cb392-2" title="2"><span class="co"># parse the following character strings to timestamps and print them on the screen</span></a>
<a class="sourceLine" id="cb392-3" title="3"><span class="co"># &quot;5/17/1977 10:15 pm&quot;</span></a>
<a class="sourceLine" id="cb392-4" title="4"><span class="co"># &quot;20160429 05/10/17&quot;</span></a></code></pre></div>
</div>
<div class="sourceCode" id="cb393"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb393-1" title="1"><span class="co"># using the functions in the `lubridate` package</span></a>
<a class="sourceLine" id="cb393-2" title="2"><span class="co"># parse the following character strings to timestamps and print them on the screen</span></a>
<a class="sourceLine" id="cb393-3" title="3"><span class="co"># &quot;5/17/1977 10:15 pm&quot;</span></a>
<a class="sourceLine" id="cb393-4" title="4"><span class="co"># &quot;20160429 05/10/17&quot;</span></a>
<a class="sourceLine" id="cb393-5" title="5"><span class="kw">dmy_hm</span>(<span class="st">&quot;5/17/1977 10:15 pm&quot;</span>)</a></code></pre></div>
<pre><code>## Warning: All formats failed to parse. No formats found.</code></pre>
<div class="sourceCode" id="cb395"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb395-1" title="1"><span class="kw">ymd_hms</span>(<span class="st">&quot;20160429 05/10/17&quot;</span>)</a></code></pre></div>
<pre><code>## [1] NA
## [1] &quot;2016-04-29 05:10:17 UTC&quot;</code></pre>
</div>
<hr />
<p>Note that these functions always sets <code>UTC</code> for the time zone. This was intentionally designed to motivate the use of a consistent time zone in the data set we are analyzing. If desired, we can set the time zone with the <code>tz</code> parameter during parsing. Similarly, with timestamps already initialized, we can manage time zones using the following functions</p>
<ul>
<li><code>force_tz</code> - “enforces” the change to a new time zone while leaving the timestamp values the same</li>
<li><code>with_tz</code> - converts a timestamp into one that matches the requested time zone</li>
</ul>
<div class="sourceCode" id="cb397"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb397-1" title="1">t &lt;-<span class="st"> </span><span class="kw">ymd_hms</span>(<span class="st">&quot;20161129 05/10/17&quot;</span>, <span class="dt">tz =</span> <span class="st">&quot;EST&quot;</span>)</a>
<a class="sourceLine" id="cb397-2" title="2">t</a>
<a class="sourceLine" id="cb397-3" title="3"></a>
<a class="sourceLine" id="cb397-4" title="4"><span class="kw">force_tz</span>(t, <span class="dt">tz =</span> <span class="st">&quot;CET&quot;</span>)</a>
<a class="sourceLine" id="cb397-5" title="5"><span class="kw">with_tz</span>(t, <span class="dt">tz =</span> <span class="st">&quot;CET&quot;</span>)</a></code></pre></div>
<pre><code>## [1] &quot;2016-11-29 05:10:17 EST&quot;
## [1] &quot;2016-11-29 05:10:17 CET&quot;
## [1] &quot;2016-11-29 11:10:17 CET&quot;</code></pre>
<hr />
<p>The <code>lubridate</code> package also makes it easy to extract date and time segments from timestamps with functions such as<code>year</code>, <code>week</code>, <code>month</code>, etc. The same functions can also be used to change any of the timestamp components.</p>
<hr />
<p><strong>Assignment 10.11 - extracting timestamp elements </strong></p>
<div class="sourceCode" id="cb399"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb399-1" title="1">x &lt;-<span class="st"> </span><span class="kw">dmy_hms</span>(<span class="st">&quot;7/19/1996 4:15:27 PM&quot;</span>)</a></code></pre></div>
<pre><code>## Warning: All formats failed to parse. No formats found.</code></pre>
<div class="sourceCode" id="cb401"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb401-1" title="1"><span class="co"># extract and print hours from the timestamp above, followed by minutes</span></a>
<a class="sourceLine" id="cb401-2" title="2"></a>
<a class="sourceLine" id="cb401-3" title="3"><span class="co"># set the year of the above timestamp to 2011, and the month to June</span></a>
<a class="sourceLine" id="cb401-4" title="4"></a>
<a class="sourceLine" id="cb401-5" title="5"><span class="co"># print timestamp `x` on the screen</span></a></code></pre></div>
</div>
<div class="sourceCode" id="cb402"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb402-1" title="1">x &lt;-<span class="st"> </span><span class="kw">dmy_hms</span>(<span class="st">&quot;7/19/1996 4:15:27 PM&quot;</span>)</a></code></pre></div>
<pre><code>## Warning: All formats failed to parse. No formats found.</code></pre>
<div class="sourceCode" id="cb404"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb404-1" title="1"><span class="co"># extract and print hours from the timestamp above, followed by minutes</span></a>
<a class="sourceLine" id="cb404-2" title="2"><span class="kw">hour</span>(x)</a>
<a class="sourceLine" id="cb404-3" title="3"><span class="kw">minute</span>(x)</a>
<a class="sourceLine" id="cb404-4" title="4"></a>
<a class="sourceLine" id="cb404-5" title="5"><span class="co"># set the year of the above timestamp to 2011, and the month to June</span></a>
<a class="sourceLine" id="cb404-6" title="6"><span class="kw">year</span>(x) &lt;-<span class="st"> </span><span class="dv">2011</span></a>
<a class="sourceLine" id="cb404-7" title="7"><span class="kw">month</span>(x) &lt;-<span class="st"> </span><span class="dv">6</span></a>
<a class="sourceLine" id="cb404-8" title="8"></a>
<a class="sourceLine" id="cb404-9" title="9"><span class="co"># print timestamp `x` on the screen</span></a>
<a class="sourceLine" id="cb404-10" title="10">x</a></code></pre></div>
<pre><code>## [1] NA
## [1] NA
## [1] NA</code></pre>
</div>
<hr />
<p>See the <code>lubridate</code> documentation for a complete list of features.</p>
<p>For the current date and time, <code>lubridate</code> offers alternatives to the <code>Sys.Date()</code> and <code>Sys.time()</code> functions, which are simply called <code>today()</code> and <code>now()</code>.</p>
<hr />
<p><strong>Assignment 10.12 - functions <code>today</code> and <code>now</code></strong></p>
<div class="sourceCode" id="cb406"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb406-1" title="1"><span class="co"># print out tomorrow&#39;s date</span></a>
<a class="sourceLine" id="cb406-2" title="2"></a>
<a class="sourceLine" id="cb406-3" title="3"><span class="co"># print the timestamp which happened exactly an hour ago</span></a></code></pre></div>
</div>
<div class="sourceCode" id="cb407"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb407-1" title="1"><span class="co"># print out tomorrow&#39;s date</span></a>
<a class="sourceLine" id="cb407-2" title="2"><span class="kw">today</span>() <span class="op">+</span><span class="st"> </span><span class="dv">1</span></a>
<a class="sourceLine" id="cb407-3" title="3"></a>
<a class="sourceLine" id="cb407-4" title="4"><span class="co"># print the timestamp which happened exactly an hour ago</span></a>
<a class="sourceLine" id="cb407-5" title="5"><span class="kw">now</span>() <span class="op">-</span><span class="st"> </span><span class="dv">60</span> <span class="op">*</span><span class="st"> </span><span class="dv">60</span></a></code></pre></div>
<pre><code>## [1] &quot;2019-12-07&quot;
## [1] &quot;2019-12-06 09:12:22 CET&quot;</code></pre>
</div>
<hr />
<p>We already mentioned that managing time-related data can become very complex, especially considering that time intervals can be expressed generically (e.g., “2 years”) or specifically (the span of two dates), and that mathematical and calendar ways of expressing time intervals do not necessarily match (e.g., “period of one year” can mathematically mean “the exact number of seconds in 365 days” but also the contextually dependent “period until the same date next year”).</p>
<p>The <code>lubridate</code> package defines four options for defining time-related objects:</p>
<ul>
<li><strong>instant</strong> - timestamp rounded to the second</li>
<li><strong>duration</strong> - “generically” defined interval in seconds</li>
<li><strong>period</strong> - similar to duration, but allows you to define durations that do not always last mathematically (e.g. “3 months”)</li>
<li><strong>interval</strong> - the time interval between two specific moments</li>
</ul>
<p>We have already met the “istants”, these are the timestamps we have already shown. To create durations and periods, we have intuitively defined functions that are named by English names for time units, with durations having the letter <code>d</code> as a prefix (from <em>duration</em>). Hence, we have the functions called <code>minutes</code>/<code>dminutes</code>, <code>hours</code>/<code>dhours</code>, <code>weeks</code>/<code>dweeks</code> etc. (note that there is no <code>dmonths</code> function, since we cannot unambiguously convert one month into seconds).</p>
<hr />
<p><strong>Assignment 10.13 - durations and periods</strong></p>
<div class="sourceCode" id="cb409"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb409-1" title="1"><span class="co"># print out objects which represent the duration and period of 3 weeks</span></a>
<a class="sourceLine" id="cb409-2" title="2"></a>
<a class="sourceLine" id="cb409-3" title="3"><span class="co"># use the variable `v` to store a period of 5 years, 3 months and 2 days</span></a>
<a class="sourceLine" id="cb409-4" title="4"></a>
<a class="sourceLine" id="cb409-5" title="5"><span class="co"># add the above period to today&#39;s date</span></a></code></pre></div>
</div>
<div class="sourceCode" id="cb410"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb410-1" title="1"><span class="co"># print out objects which represent the duration and period of 3 weeks</span></a>
<a class="sourceLine" id="cb410-2" title="2"><span class="kw">weeks</span>(<span class="dv">3</span>)</a>
<a class="sourceLine" id="cb410-3" title="3"><span class="kw">dweeks</span>(<span class="dv">3</span>)</a>
<a class="sourceLine" id="cb410-4" title="4"></a>
<a class="sourceLine" id="cb410-5" title="5"><span class="co"># use the variable `v` to store a period of 5 years, 3 months and 2 days</span></a>
<a class="sourceLine" id="cb410-6" title="6">v &lt;-<span class="st"> </span><span class="kw">years</span>(<span class="dv">5</span>) <span class="op">+</span><span class="st"> </span><span class="kw">months</span>(<span class="dv">3</span>) <span class="op">+</span><span class="st"> </span><span class="kw">days</span>(<span class="dv">2</span>)</a>
<a class="sourceLine" id="cb410-7" title="7"></a>
<a class="sourceLine" id="cb410-8" title="8"><span class="co"># add the above period to today&#39;s date</span></a>
<a class="sourceLine" id="cb410-9" title="9"><span class="kw">today</span>() <span class="op">+</span><span class="st"> </span>v</a></code></pre></div>
<pre><code>## [1] &quot;21d 0H 0M 0S&quot;
## [1] &quot;1814400s (~3 weeks)&quot;
## [1] &quot;2025-03-08&quot;</code></pre>
</div>
<hr />
<p>Notice that the above expression would not be consistent if obtained “mathematically”.</p>
<p>Finally, we can create an interval by using the <code>interval</code> function and providing the <strong>start</strong> and <strong>end</strong> timestamps, or by using the<code>as.interval</code> function and giving the <strong>duration/period</strong> and the <strong>start</strong> timestamp. We can also use the operator <code>%--%</code> with two timestamps as operands.</p>
<hr />
<p><strong>Assignment 10.14 - intervals</strong></p>
<div class="sourceCode" id="cb412"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb412-1" title="1"><span class="co"># create a variable `interval1` to store the interval</span></a>
<a class="sourceLine" id="cb412-2" title="2"><span class="co"># between 6 months before today and 6 months after today</span></a>
<a class="sourceLine" id="cb412-3" title="3"></a>
<a class="sourceLine" id="cb412-4" title="4"><span class="co"># create a variable `interval2` and store the interval from today</span></a>
<a class="sourceLine" id="cb412-5" title="5"><span class="co"># until the date that will happen in 4 months, 3 weeks and 2 days</span></a>
<a class="sourceLine" id="cb412-6" title="6"></a>
<a class="sourceLine" id="cb412-7" title="7"><span class="co"># create a variable `interval3` that will store the interval</span></a>
<a class="sourceLine" id="cb412-8" title="8"><span class="co"># between 1.5.2002. and 1.7.2002.</span></a>
<a class="sourceLine" id="cb412-9" title="9"></a>
<a class="sourceLine" id="cb412-10" title="10"><span class="co"># print out all three intervals</span></a></code></pre></div>
</div>
<div class="sourceCode" id="cb413"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb413-1" title="1"><span class="co"># create a variable `interval1` to store the interval</span></a>
<a class="sourceLine" id="cb413-2" title="2"><span class="co"># between 6 months before today and 6 months after today</span></a>
<a class="sourceLine" id="cb413-3" title="3">interval1 &lt;-<span class="st"> </span><span class="kw">interval</span>(<span class="kw">today</span>() <span class="op">-</span><span class="st"> </span><span class="kw">months</span>(<span class="dv">6</span>), <span class="kw">today</span>() <span class="op">+</span><span class="st"> </span><span class="kw">months</span>(<span class="dv">6</span>))</a>
<a class="sourceLine" id="cb413-4" title="4"></a>
<a class="sourceLine" id="cb413-5" title="5"><span class="co"># create a variable `interval2` and store the interval from today</span></a>
<a class="sourceLine" id="cb413-6" title="6"><span class="co"># until the date that will happen in 4 months, 3 weeks and 2 days</span></a>
<a class="sourceLine" id="cb413-7" title="7">interval2 &lt;-<span class="st"> </span><span class="kw">as.interval</span>(<span class="kw">months</span>(<span class="dv">4</span>) <span class="op">+</span><span class="st"> </span><span class="kw">weeks</span>(<span class="dv">3</span>) <span class="op">+</span><span class="st"> </span><span class="kw">days</span>(<span class="dv">2</span>), <span class="kw">today</span>())</a>
<a class="sourceLine" id="cb413-8" title="8"></a>
<a class="sourceLine" id="cb413-9" title="9"><span class="co"># create a variable `interval3` that will store the interval</span></a>
<a class="sourceLine" id="cb413-10" title="10"><span class="co"># between 1.5.2002. and 1.7.2002.</span></a>
<a class="sourceLine" id="cb413-11" title="11">interval3 &lt;-<span class="st"> </span><span class="kw">dmy</span>(<span class="st">&quot;1.5.2002&quot;</span>) <span class="op">%--%</span><span class="st"> </span><span class="kw">dmy</span>(<span class="st">&quot;1.7.2002&quot;</span>)</a>
<a class="sourceLine" id="cb413-12" title="12"></a>
<a class="sourceLine" id="cb413-13" title="13"><span class="co"># print out all three intervals</span></a>
<a class="sourceLine" id="cb413-14" title="14">interval1</a>
<a class="sourceLine" id="cb413-15" title="15">interval2</a>
<a class="sourceLine" id="cb413-16" title="16">interval3</a></code></pre></div>
<pre><code>## [1] 2019-06-06 UTC--2020-06-06 UTC
## [1] 2019-12-06 UTC--2020-04-29 UTC
## [1] 2002-05-01 UTC--2002-07-01 UTC</code></pre>
</div>
<hr />
<p>When we have intervals defined we can then:</p>
<ul>
<li>check if a timestamp is within an interval with the help of the operator <code>%within%</code></li>
<li>check whether the intervals overlap by using the function <code>int_overlaps()</code></li>
<li>easily retrieve the start and end of intervals using the functions <code>int_start()</code> and <code>int_end()</code></li>
<li>“merge” two intervals with the help of the <code>union</code> function or find the intersection between them with the help of the<code>intersect</code> function</li>
<li>other stuff we can learn by looking at the documentation</li>
</ul>
<hr />
<p><strong>Assignment 10.15 - working with intervals</strong></p>
<div class="sourceCode" id="cb415"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb415-1" title="1"><span class="co"># check whether today is within the interval defined by the variable `interval1`</span></a>
<a class="sourceLine" id="cb415-2" title="2"></a>
<a class="sourceLine" id="cb415-3" title="3"><span class="co"># if `interval1` and` interval2` overlap</span></a>
<a class="sourceLine" id="cb415-4" title="4"><span class="co"># print out their intersection</span></a></code></pre></div>
</div>
<div class="sourceCode" id="cb416"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb416-1" title="1"><span class="co"># check whether today is within the interval defined by the variable `interval1`</span></a>
<a class="sourceLine" id="cb416-2" title="2"><span class="kw">today</span>() <span class="op">%within%</span><span class="st"> </span>interval1</a>
<a class="sourceLine" id="cb416-3" title="3"></a>
<a class="sourceLine" id="cb416-4" title="4"></a>
<a class="sourceLine" id="cb416-5" title="5"><span class="co"># if `interval1` and` interval2` overlap</span></a>
<a class="sourceLine" id="cb416-6" title="6"><span class="co"># print out their intersection</span></a>
<a class="sourceLine" id="cb416-7" title="7"><span class="cf">if</span>(<span class="kw">int_overlaps</span>(interval1, interval1)) <span class="kw">intersect</span>(interval1, interval2)</a></code></pre></div>
<pre><code>## [1] TRUE
## [1] 2019-12-06 UTC--2020-04-29 UTC</code></pre>
</div>
<hr />
<p>In this section, we are introduced to some of the functionality offered by the base R’s date and time classes as well as some of the functionalities offered by the <code>lubridate</code> package. For more information, see the official documentation of the R language and the <code>lubridate</code> package, or the article called “Dates and Times Made Easy with lubridate” written by the author of the package Hadley Wickham, available at <a href = "https://www.jstatsoft.org/article/view/v040i03/v40i03.pdf"> this link </a>.</p>
</div>
</div>
<div id="working-with-character-strings" class="section level2">
<h2><span class="header-section-number">4.3</span> Working with character strings</h2>
<p><em>R</em> has very good support for character strings. However, the functions offered by base R are a bit unintuitive and inconsistent when compared to similar functions offered by other programming languages commonly used for text analysis (such as <em>Perl</em> or <em>Python</em>).</p>
<p>It is for these specific reasons that the <code>stringr</code> package emerged, offering a very popular alternative to existing character string functions. However, before getting acquainted with the features offered by this package, it is necessary to briefly address the general issues of managing character strings in data analysis as well as introduce a technology without which the implementation of character string analysis is almost unthinkable - “regular expressions”.</p>
<div id="text-analysis-and-regular-expressions" class="section level3">
<h3><span class="header-section-number">4.3.1</span> Text analysis and regular expressions</h3>
<p>Text analysis is an inevitable element of data analysis. Whether it’s simple category identification, searching for specific patterns, or something performing more complex tasks commonly known as <em>text mining</em>, it’s hard to imagine any meaningful data analysis that doesn’t at some point require knowledge of at least the basic methods of managing sets of character strings.</p>
<p>Regardless of the complexity of character string analysis we want to perform, one technology is ubiquitous and universally applicable - <strong>regular expressions</strong>. This is a special “language” that we use to define “patterns” which we use to search or process textual information in various ways.</p>
<p>A thorough review of regular expression technology is beyond the scope of this coursebook. Below, we will provide only a brief overview. If you have never encountered this technology before, we strongly recommend that you make the effort and master at least the basic concepts, preferably using one of many excellent web resources. One very short yet effective regular expression mini-courses can be found <a href = "https://regexone.com/"> here </a>.</p>
<p>A regular expression is simply a string of characters that represents the pattern we are looking for within a text. Eg. the regular expression <code>gram</code> is contained in the character string <code>Programming language R</code> but is not in the character string <code>Text analysis</code>. We say we found a “match” with the first string but not with the second.</p>
<p>This kind of regular expression is not too flexible - the true power of regular expressions lies in using special symbols which enable describing patterns in a more “generic” way. Let’s demonsrate this on a simple example.</p>
<p>One common scenarios of using regular expressions is checking whether the user has entered an address that corresponds to the “general” form of the email address. One possibility is to simply use the expression <code>@</code> as a regular expression we want to find a “match” with the email adress we are checking for validity. This can help with filtering out a certain number of invalid email adresses, but will also allow “addresses” such as <code>@@@</code> and <code>@23456</code>. With a little “work” on the expression, you could come up with a slightly better solution, which may look something like this:</p>
<div class="sourceCode" id="cb418"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb418-1" title="1">\w<span class="op">+</span><span class="er">@</span>\w<span class="op">+</span>\.\w<span class="op">+</span></a></code></pre></div>
<p>Although it looks like a series of random characters, with basic knowledge of regular expressions (and, in this case, using the “Perl” standard) we can interpret the above expression relatively easily. The character <code>\w</code> stands for “letter, number or underscore”, the sign <code>+</code> means “1 or more”, etc. If you wanted to “transcribe” the above regular expression in a spoken language, it would be “one or more letters, digits or underscores’, followed by the sign <code>@</code>, then again one or more letters, digits or underscores, then a dot and then finally one or more letters, digits or underscores.” While this is not an overly sophisticated regular expression, it is still better than the first attempt. Further refinement is certainly possible, and although subsequent additions are increasingly making it harder to be easily interpreted by the human, we are also gaining more and more control over the formal definitions of what an email address should look like (for such specific uses, it is often worthwhile to check publicly available regular expression repositories where we can find complex but of high quality and carefully tested expressions that are easy enough to copy into our program code).</p>
<p>We already stated that the above expression is written in so-called “Perl standard”. Unfortunately, today there isn’t a single standard for regular expressions. Most often used are so-called <em>“POSIX standard”</em> in two versions - <em>BRE</em> and <em>ERE</em> (<em>Basic Regular Expressions</em> and <em>Extended Regular Expressions</em>) which are pretty similar, except for the fact that <em>BRE</em> relies a bit on the <code>\</code> character and doesn’t recognize some of the “newer” symbols that ERE uses. Another popular standard is the already mentioned <em>“Perl standard”</em> which is a version of regular expressions implemented in the <em>Perl</em> programming language. Because <em>Perl</em> is one of the leading languages for text processing, this standard has become one of the most widely accepted methods of using regular expressions.</p>
<p>In general, almost all popular programming languages have support for regular expressions, either embedded in the language or with the help of additional packages. <em>R</em> is one of the languages that already includes support for regular expressions in its base package. What’s more, <em>R</em> has built-in parallel support for the three most widely used standards mentioned above - <em>POSIX ERE</em>, <em>POSIX BRE</em> and <em>Perl</em>. <em>POSIX ERE</em> is the default setting, and with certain parameters we can easily “switch” to <em>BRE</em> (<code>extended = FALSE</code>) or <em>Perl</em> (<code>perl = TRUE</code>). In the following paragraphs, we will stick with the <em>ERE</em> standard, but it is also important to know that the above settings may be used if we already have previously constructed regular expressions that have been developed in another standard (and we do not want to be bothered by switching from one standard to another).</p>
<p>The following table gives a brief overview of some of the more commonly used regular expression elements in the language <em>R</em>:</p>
<table>
<thead>
<tr class="header">
<th>Element</th>
<th>Meaning</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>abcd</code></td>
<td>literal string “abcd”</td>
</tr>
<tr class="even">
<td><code>1234</code></td>
<td>literal string “1234”</td>
</tr>
<tr class="odd">
<td><code>\\d</code> or <code>[:digit:]</code> or <code>[0-9]</code></td>
<td>any digit</td>
</tr>
<tr class="even">
<td><code>\\D</code> or <code>[:alpha:]</code> or <code>[A-Za-z]</code></td>
<td>any letter</td>
</tr>
<tr class="odd">
<td><code>[:alnum:]</code></td>
<td>any alphanumeric character</td>
</tr>
<tr class="even">
<td><code>.</code></td>
<td>any character</td>
</tr>
<tr class="odd">
<td><code>\\.</code></td>
<td>dot (full stop)</td>
</tr>
<tr class="even">
<td><code>[abc]</code></td>
<td>only the characters listed</td>
</tr>
<tr class="odd">
<td><code>[^abc]</code></td>
<td>all characters except those listed</td>
</tr>
<tr class="even">
<td><code>*</code></td>
<td>zero or more repetitions</td>
</tr>
<tr class="odd">
<td><code>+</code></td>
<td>one or more repetitions</td>
</tr>
<tr class="even">
<td><code>{n}</code></td>
<td>exactly n repetitions</td>
</tr>
<tr class="odd">
<td><code>{m, n}</code></td>
<td>at least m, at most n repetitions</td>
</tr>
<tr class="even">
<td><code>?</code></td>
<td>optional character</td>
</tr>
<tr class="odd">
<td><code>[:space:]</code> or <code>\\ s</code></td>
<td>any blank (space, tab, new line)</td>
</tr>
<tr class="even">
<td><code>[:punct:]</code></td>
<td>punctuation marks</td>
</tr>
<tr class="odd">
<td><code>^ ... $</code></td>
<td>a start and end markers</td>
</tr>
<tr class="even">
<td><code>(ab|cd)</code></td>
<td>string “ab” or string “cd”</td>
</tr>
</tbody>
</table>
<p>Note that when using the special character <code>\</code> as a part of a regular expression we actually have to use the double character <code>\\</code> (the first time to indicate to <em>R</em> that a special character follows, the second time to literally use it as part of the regular expression).</p>
<p>The basic functions of the <em>R</em> language to work with character strings (and thus regular expressions) are, among other things, <code>grep</code>,<code>grepl</code>, <code>regexrp</code>,<code>gregexrp</code>, <code>regmatches</code>, <code>sub</code>, <code>gsub</code> etc. But since the <code>stringr</code> package offers a set of alternative functions with almost the same functionality but with far more intuitive names and more consistent signatures, we will focus on functions from that package, leaving the base functions to readers as an optional exercise to be learned from the official documentation.</p>
</div>
<div id="the-stringr-package" class="section level3">
<h3><span class="header-section-number">4.3.2</span> The <code>stringr</code> package</h3>
<p>We have already stated that the <code>stringr</code> package actually reimplements to some extent the already existing functions of the language <em>R</em>, but in a more intuitive and consistent way. To be more precise, the functions of the <code>stringr</code> package have slightly reduced functionality, which is actually by design - one of the imperatives when designing this package was to identify the most commonly used functionalities for text analysis and focus on that primarily. Functionality that is “thrown out” concerns specific cases for which the developer will need to look for alternative solutions (often in the form of basic functions), but the benefit is in simpler, more intuitive features that are easier to learn and use effectively in the long-term effectively.</p>
<p>Additional benefits of using the <code>stringr</code> package are:</p>
<ul>
<li>consistent treatment of factors as character strings</li>
<li>consistent ordering of parameters, which is especially useful when used in conjunction with the operator <code>%&gt;%</code></li>
</ul>
<p>We can start with some simpler functions for which we do not need regular expressions (we list simplified function signatures, for more precise definitions consult the package documentation):</p>
<ul>
<li><code>str_c(string1, string2, ...)</code> - merge character strings, alternative to <code>paste0</code></li>
<li><code>str_length(string)</code> - returns the length of the character string</li>
<li><code>str_sub(string, start, end)</code> - returns a substring using <code>start</code> and <code>end</code> as letter indexes (negative index means “counting from the back”)</li>
<li><code>str_sub(string, start, end) &lt;- string2</code> - modifies <code>string</code> by exchanging the defined substring with <code>string2</code> (which does need not be the same length as the dropped substring!)</li>
<li><code>str_trim(string)</code> - returns a string with removed blanks from the beginning and end of a string</li>
</ul>
<hr />
<p><strong>Assignment 10.16 - basic functions for working with character strings </strong></p>
<div class="sourceCode" id="cb419"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb419-1" title="1">string1 &lt;-<span class="st"> &quot;             This is an example&quot;</span></a>
<a class="sourceLine" id="cb419-2" title="2">string2 &lt;-<span class="st"> &quot;of string concatenation!         &quot;</span></a>
<a class="sourceLine" id="cb419-3" title="3"></a>
<a class="sourceLine" id="cb419-4" title="4"><span class="co"># using one line of instructions concatenate the above strings, </span></a>
<a class="sourceLine" id="cb419-5" title="5"><span class="co"># remove the blanks at the beginning and end of the string from the result,</span></a>
<a class="sourceLine" id="cb419-6" title="6"><span class="co"># then select the substring from 35th to 55th character</span></a>
<a class="sourceLine" id="cb419-7" title="7"><span class="co"># and print the final result on the screen</span></a>
<a class="sourceLine" id="cb419-8" title="8"></a>
<a class="sourceLine" id="cb419-9" title="9">string &lt;-<span class="st"> &quot;R is overly complicated and not an easy language!&quot;</span></a>
<a class="sourceLine" id="cb419-10" title="10"></a>
<a class="sourceLine" id="cb419-11" title="11"><span class="co"># in the upper character string, replace all the characters </span></a>
<a class="sourceLine" id="cb419-12" title="12"><span class="co"># from 6th place (counted from the start)</span></a>
<a class="sourceLine" id="cb419-13" title="13"><span class="co"># to 14th (counting from the end) </span></a>
<a class="sourceLine" id="cb419-14" title="14"><span class="co"># with an empty string</span></a>
<a class="sourceLine" id="cb419-15" title="15"></a>
<a class="sourceLine" id="cb419-16" title="16"><span class="co"># print the string</span></a></code></pre></div>
</div>
<div class="sourceCode" id="cb420"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb420-1" title="1">string1 &lt;-<span class="st"> &quot;             This is an example&quot;</span></a>
<a class="sourceLine" id="cb420-2" title="2">string2 &lt;-<span class="st"> &quot;of string concatenation!         &quot;</span></a>
<a class="sourceLine" id="cb420-3" title="3"></a>
<a class="sourceLine" id="cb420-4" title="4"><span class="co"># using one line of instructions concatenate the above strings, </span></a>
<a class="sourceLine" id="cb420-5" title="5"><span class="co"># remove the blanks at the beginning and end of the string from the result,</span></a>
<a class="sourceLine" id="cb420-6" title="6"><span class="co"># then select the substring from 35th to 55th character</span></a>
<a class="sourceLine" id="cb420-7" title="7"><span class="co"># and print the final result on the screen</span></a>
<a class="sourceLine" id="cb420-8" title="8"><span class="kw">str_c</span>(string1, string2) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">str_trim</span>() <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">str_sub</span>(<span class="dv">35</span>, <span class="dv">55</span>)</a>
<a class="sourceLine" id="cb420-9" title="9"></a>
<a class="sourceLine" id="cb420-10" title="10">string &lt;-<span class="st"> &quot;R is overly complicated and not an easy language!&quot;</span></a>
<a class="sourceLine" id="cb420-11" title="11"></a>
<a class="sourceLine" id="cb420-12" title="12"><span class="co"># in the upper character string, replace all the characters </span></a>
<a class="sourceLine" id="cb420-13" title="13"><span class="co"># from 6th place (counted from the start)</span></a>
<a class="sourceLine" id="cb420-14" title="14"><span class="co"># to 14th (counting from the end) </span></a>
<a class="sourceLine" id="cb420-15" title="15"><span class="co"># with an empty string</span></a>
<a class="sourceLine" id="cb420-16" title="16"><span class="kw">str_sub</span>(string, <span class="dv">6</span>, <span class="dv">-14</span>) &lt;-<span class="st"> &quot;&quot;</span></a>
<a class="sourceLine" id="cb420-17" title="17"></a>
<a class="sourceLine" id="cb420-18" title="18"><span class="co"># print the string</span></a>
<a class="sourceLine" id="cb420-19" title="19">string</a></code></pre></div>
<pre><code>## [1] &quot;enation!&quot;
## [1] &quot;R is asy language!&quot;</code></pre>
</div>
<hr />
<p>The <code>str_c</code> function also has a <code>sep</code> parameter if we want to paste the strings with a specific separator, and the <code>collapse</code> parameter which is <code>NULL</code> by default, but which can be used to merge elements of a character vector into a single string (with the value of the parameter used as a separator).</p>
<hr />
<p><strong>Assignment 10.17 - merging character strings</strong></p>
<div class="sourceCode" id="cb422"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb422-1" title="1">string1 &lt;-<span class="st"> &quot;To merge&quot;</span></a>
<a class="sourceLine" id="cb422-2" title="2">string2 &lt;-<span class="st"> &quot;these strings&quot;</span></a>
<a class="sourceLine" id="cb422-3" title="3">string3 &lt;-<span class="st"> &quot;you need some space!&quot;</span></a>
<a class="sourceLine" id="cb422-4" title="4"></a>
<a class="sourceLine" id="cb422-5" title="5"><span class="co"># merge the above strings into a single string and print the result</span></a>
<a class="sourceLine" id="cb422-6" title="6"></a>
<a class="sourceLine" id="cb422-7" title="7">pieces &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;These&quot;</span>, <span class="st">&quot;vector&quot;</span>, <span class="st">&quot;elements&quot;</span>, <span class="st">&quot;should&quot;</span>, <span class="st">&quot;be&quot;</span>, <span class="st">&quot;joined...&quot;</span>)</a>
<a class="sourceLine" id="cb422-8" title="8"></a>
<a class="sourceLine" id="cb422-9" title="9"><span class="co"># merge the elements of the above vector into one string and print the result</span></a></code></pre></div>
</div>
<div class="sourceCode" id="cb423"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb423-1" title="1">string1 &lt;-<span class="st"> &quot;To merge&quot;</span></a>
<a class="sourceLine" id="cb423-2" title="2">string2 &lt;-<span class="st"> &quot;these strings&quot;</span></a>
<a class="sourceLine" id="cb423-3" title="3">string3 &lt;-<span class="st"> &quot;you need some space!&quot;</span></a>
<a class="sourceLine" id="cb423-4" title="4"></a>
<a class="sourceLine" id="cb423-5" title="5"><span class="co"># merge the above strings into a single string and print the result</span></a>
<a class="sourceLine" id="cb423-6" title="6"><span class="kw">str_c</span>(string1, string2, string3, <span class="dt">sep =</span> <span class="st">&quot; &quot;</span>)</a>
<a class="sourceLine" id="cb423-7" title="7"></a>
<a class="sourceLine" id="cb423-8" title="8">pieces &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;A&quot;</span>, <span class="st">&quot;these&quot;</span>, <span class="st">&quot;arrays&quot;</span>, <span class="st">&quot;are&quot;</span>, <span class="st">&quot;elements&quot;</span>, <span class="st">&quot;vectors ...&quot;</span>)</a>
<a class="sourceLine" id="cb423-9" title="9"></a>
<a class="sourceLine" id="cb423-10" title="10"><span class="co"># merge the elements of the above vector into one string and print the result</span></a>
<a class="sourceLine" id="cb423-11" title="11"><span class="kw">str_c</span>(pieces, <span class="dt">collapse =</span> <span class="st">&quot; &quot;</span>)</a></code></pre></div>
<pre><code>## [1] &quot;To merge these strings you need some space!&quot;
## [1] &quot;A these arrays are elements vectors ...&quot;</code></pre>
</div>
<hr />
<p>Let’s look at some <code>stringr</code> functions that work with regular expressions:</p>
<ul>
<li><code>str_detect(string, pattern)</code> - returns <code>TRUE</code> if <code>string</code> contains <code>pattern</code>, otherwise<code>FALSE</code></li>
<li><code>str_extract(string, pattern)</code> - returns a string of characters corresponding to the first occurrence of a pattern</li>
<li><code>str_extract_all(string, pattern)</code> - returns a list with all occurrences that match the pattern</li>
<li><code>str_replace(string, pattern, replacement)</code> - changes the first occurrence of a pattern with the replacement</li>
<li><code>str_replace_all(string, pattern, replacement)</code> - changes all occurrences of a pattern with the replacement</li>
</ul>
<p>All of these functions are vectorized, which means that they behave logically (ie, “parallelized”) when we use a character vector with multiple elements in place of a specific parameter. For example, if we give a vector of strings and a vector of replacements to the <code>str_replace</code> function, elements of the first vector and replacements will “pair up” in place of a given pattern. We can have other combinations, such as a vector of original elements and a vector of patterns, all three parameters as vectors with multiple elements etc. but every time the behavior of the function is consistent with the already learned principle of vectorization.</p>
<hr />
<p><strong>Assignment 10.18 - functions and regular expressions</strong></p>
<div class="sourceCode" id="cb425"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb425-1" title="1">addresses &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;pero.peric@fer.hr&quot;</span>, <span class="st">&quot;iva.ivic@etfos.hr&quot;</span>, <span class="st">&quot;ppetrovic@gmail.com&quot;</span>,</a>
<a class="sourceLine" id="cb425-2" title="2">            <span class="st">&quot;branko1987@yahoo.com&quot;</span>, <span class="st">&quot;jaRULZ4EVR@gmail.nz&quot;</span>, <span class="st">&quot;dperkovic@efzg.hr&quot;</span>,</a>
<a class="sourceLine" id="cb425-3" title="3">            <span class="st">&quot;lalaic1998@gmail.co.uk&quot;</span>, <span class="st">&quot;perica.markic@fer.hr&quot;</span>)</a>
<a class="sourceLine" id="cb425-4" title="4"></a>
<a class="sourceLine" id="cb425-5" title="5"><span class="co"># print the total number of mail addresses which belong to the `fer.hr` subdomain </span></a>
<a class="sourceLine" id="cb425-6" title="6"></a>
<a class="sourceLine" id="cb425-7" title="7"><span class="co"># print all addresses that contain at least one digit</span></a>
<a class="sourceLine" id="cb425-8" title="8"></a>
<a class="sourceLine" id="cb425-9" title="9"><span class="co"># list all addresses that have a vowel as the second character</span></a>
<a class="sourceLine" id="cb425-10" title="10"></a>
<a class="sourceLine" id="cb425-11" title="11"><span class="co"># print all unique email address subdomains </span></a>
<a class="sourceLine" id="cb425-12" title="12"><span class="co"># (subdomain part of the address is everything after behind the `@` character)</span></a>
<a class="sourceLine" id="cb425-13" title="13"></a>
<a class="sourceLine" id="cb425-14" title="14"><span class="co"># anonymize the addresses above: all character strings in front of &#39;@&#39;</span></a>
<a class="sourceLine" id="cb425-15" title="15"><span class="co"># should be replaced with random 6-digit numbers</span></a></code></pre></div>
</div>
<div class="sourceCode" id="cb426"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb426-1" title="1"><span class="co"># print the total number of mail addresses which belong to the `fer.hr` subdomain </span></a>
<a class="sourceLine" id="cb426-2" title="2"><span class="kw">str_detect</span>(addresses, <span class="st">&quot;fer</span><span class="ch">\\</span><span class="st">.hr&quot;</span>)<span class="op">%&gt;%</span><span class="st"> </span>sum</a>
<a class="sourceLine" id="cb426-3" title="3"></a>
<a class="sourceLine" id="cb426-4" title="4"><span class="co"># print all addresses that contain at least one digit</span></a>
<a class="sourceLine" id="cb426-5" title="5">addresses[<span class="kw">str_detect</span>(addresses, <span class="st">&#39;[:digit:]&#39;</span>)]</a>
<a class="sourceLine" id="cb426-6" title="6"></a>
<a class="sourceLine" id="cb426-7" title="7"><span class="co"># list all addresses that have a vowel as the second character</span></a>
<a class="sourceLine" id="cb426-8" title="8"><span class="kw">str_detect</span>(addresses, <span class="st">&quot;^. [aeiouAEIOU]&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span>addresses[.]</a>
<a class="sourceLine" id="cb426-9" title="9"><span class="co"># or str_detect(addresses, &quot;^.(a|e|i|o|u|A|E|I|O|U)&quot;) %&gt;% `[`(addresses, .)</span></a>
<a class="sourceLine" id="cb426-10" title="10"></a>
<a class="sourceLine" id="cb426-11" title="11"><span class="co"># print all unique email address subdomains </span></a>
<a class="sourceLine" id="cb426-12" title="12"><span class="co"># (subdomain part of the address is everything after behind the `@` character)</span></a>
<a class="sourceLine" id="cb426-13" title="13"><span class="kw">str_extract</span>(addresses, <span class="st">&#39;@(.*)&#39;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">str_sub</span>(<span class="dv">2</span>) <span class="op">%&gt;%</span><span class="st"> </span>unique</a>
<a class="sourceLine" id="cb426-14" title="14"></a>
<a class="sourceLine" id="cb426-15" title="15"><span class="co"># anonymize the addresses above: all character strings in front of &#39;@&#39;</span></a>
<a class="sourceLine" id="cb426-16" title="16"><span class="co"># should be replaced with random 6-digit numbers</span></a>
<a class="sourceLine" id="cb426-17" title="17"><span class="kw">sample</span>(<span class="dv">100000</span><span class="op">:</span><span class="st"> </span><span class="dv">999999</span>, <span class="kw">length</span>(addresses)) <span class="op">%&gt;%</span><span class="st"> </span>as.character <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb426-18" title="18"><span class="st">    </span><span class="kw">str_replace</span>(addresses, <span class="st">&#39;^[^@]*&#39;</span>, .)</a></code></pre></div>
<pre><code>## [1] 2
## [1] &quot;branko1987@yahoo.com&quot;   &quot;jaRULZ4EVR@gmail.nz&quot;   
## [3] &quot;lalaic1998@gmail.co.uk&quot;
## character(0)
## [1] &quot;fer.hr&quot;      &quot;etfos.hr&quot;    &quot;gmail.com&quot;   &quot;yahoo.com&quot;   &quot;gmail.nz&quot;   
## [6] &quot;efzg.hr&quot;     &quot;gmail.co.uk&quot;
## [1] &quot;755066@fer.hr&quot;      &quot;477550@etfos.hr&quot;    &quot;521135@gmail.com&quot;  
## [4] &quot;733004@yahoo.com&quot;   &quot;812154@gmail.nz&quot;    &quot;609008@efzg.hr&quot;    
## [7] &quot;371161@gmail.co.uk&quot; &quot;736284@fer.hr&quot;</code></pre>
</div>
<hr />
<p>Finally, we learn one relatively useful function called <code>str_split</code>. This function splits the character string into a vector of character strings, depending on the given separator (which may be a space, some other chosen character(s), or even a regular expression), and is often used as a “more primitive” alternative to the <code>read.csv</code> and<code>read.table</code> functions when we want to parse the input “manually”, or - more commonly - to break a column of text into individual words for the purposes of text analysis. This function accepts a character string (or a collection of strings) as input, disassembles it according to the chosen separator and then returns the <strong>list</strong> of pieces as a result; if we disassemble only one string, we can easily translate the result into a vector using the <code>unlist</code> function.</p>
<div class="sourceCode" id="cb428"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb428-1" title="1"><span class="kw">str_split</span>(<span class="st">&quot;Example of str_split function&quot;</span>, <span class="dt">pattern =</span> <span class="st">&quot;[:space:]&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span>unlist</a></code></pre></div>
<pre><code>## [1] &quot;Example&quot;   &quot;of&quot;        &quot;str_split&quot; &quot;function&quot;</code></pre>
<p>We will now try to perform a very simple example of text analysis - figuring out which words happen most frequently in a chosen text. To do this we first need to read a text file into an R object. One of the simplest ways to achieve this is using the <code>file</code> function (which opens up the connection towards the textual file) and then the <code>readLines</code> function which will read a chosen number of lines and store them in a character vector. For smaller files we can also immediately read the entire file simply by omitting the number of lines we want to read. An example of using these two functions may look like this:</p>
<div class="sourceCode" id="cb430"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb430-1" title="1">con &lt;-<span class="st"> </span><span class="kw">file</span>(<span class="st">&quot;textFile.txt&quot;</span>, <span class="st">&quot;r&quot;</span>)    <span class="co"># r = &quot;read&quot;</span></a>
<a class="sourceLine" id="cb430-2" title="2">rows &lt;-<span class="st"> </span><span class="kw">readLines</span>(con)   <span class="co"># or readLines(con, n = 100) </span></a>
<a class="sourceLine" id="cb430-3" title="3"><span class="kw">close</span>(con)   <span class="co"># closing the connection</span></a></code></pre></div>
<p>The next assignment will use two files</p>
<ul>
<li><code>HobbitChapterOne.txt</code> - the text we want to analyse and</li>
<li><code>stopwords.txt</code> - file with frequent words which are “uninteresting” from the analysis point of view</li>
</ul>
<hr />
<p><strong>Assignment 10.19 - simple text analysis</strong></p>
<div class="sourceCode" id="cb431"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb431-1" title="1"><span class="co"># store the text from `HobbitChapterOne.txt` into a variable called `hobbit`</span></a>
<a class="sourceLine" id="cb431-2" title="2"><span class="co"># and text from `stopwords.txt` into a variable called `stopwords`</span></a>
<a class="sourceLine" id="cb431-3" title="3"></a>
<a class="sourceLine" id="cb431-4" title="4"><span class="co"># perform the next steps:</span></a>
<a class="sourceLine" id="cb431-5" title="5"><span class="co"># - merge all text segments from `hobbit` into one long character strings</span></a>
<a class="sourceLine" id="cb431-6" title="6"><span class="co"># - remove all punctuation marks from the text</span></a>
<a class="sourceLine" id="cb431-7" title="7"><span class="co"># - change all text to &quot;lowercase&quot; (use `tolower`)</span></a>
<a class="sourceLine" id="cb431-8" title="8"><span class="co"># - split the text using spaces as a separator</span></a>
<a class="sourceLine" id="cb431-9" title="9"><span class="co"># - remove &quot;empty words&quot; (words of length 0) if such exist</span></a>
<a class="sourceLine" id="cb431-10" title="10"><span class="co"># - remove all words which are present in the `stopwords` variable too</span></a>
<a class="sourceLine" id="cb431-11" title="11"><span class="co"># - count the frequencies of the words</span></a>
<a class="sourceLine" id="cb431-12" title="12"><span class="co"># - print on screen 20 most frequent words</span></a></code></pre></div>
<div class="fold s o">
<div class="sourceCode" id="cb432"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb432-1" title="1"><span class="co"># store the text from `HobbitChapterOne.txt` into a variable called `hobbit`</span></a>
<a class="sourceLine" id="cb432-2" title="2"><span class="co"># and text from `stopwords.txt` into a variable called `stopwords`</span></a>
<a class="sourceLine" id="cb432-3" title="3"></a>
<a class="sourceLine" id="cb432-4" title="4">con &lt;-<span class="st"> </span><span class="kw">file</span>(<span class="st">&quot;HobbitChapterOne.txt&quot;</span>)</a>
<a class="sourceLine" id="cb432-5" title="5">hobbit &lt;-<span class="st"> </span><span class="kw">readLines</span>(con)</a>
<a class="sourceLine" id="cb432-6" title="6"><span class="kw">close</span>(con)</a>
<a class="sourceLine" id="cb432-7" title="7"></a>
<a class="sourceLine" id="cb432-8" title="8">con &lt;-<span class="st"> </span><span class="kw">file</span>(<span class="st">&quot;stopwords.txt&quot;</span>)</a>
<a class="sourceLine" id="cb432-9" title="9">stopwords &lt;-<span class="st"> </span><span class="kw">readLines</span>(con)</a>
<a class="sourceLine" id="cb432-10" title="10"><span class="kw">close</span>(con)</a></code></pre></div>
</div>
<div class="fold s o">
<div class="sourceCode" id="cb433"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb433-1" title="1"><span class="co"># perform the next steps:</span></a>
<a class="sourceLine" id="cb433-2" title="2"><span class="co"># - merge all text segments from `hobbit` into one long character strings</span></a>
<a class="sourceLine" id="cb433-3" title="3"><span class="co"># - remove all punctuation marks from the text</span></a>
<a class="sourceLine" id="cb433-4" title="4"><span class="co"># - change all text to &quot;lowercase&quot; (use `tolower`)</span></a>
<a class="sourceLine" id="cb433-5" title="5"><span class="co"># - split the text using spaces as a separator</span></a>
<a class="sourceLine" id="cb433-6" title="6"><span class="co"># - remove &quot;empty words&quot; (words of length 0) if such exist</span></a>
<a class="sourceLine" id="cb433-7" title="7"><span class="co"># - remove all words which are present in the `stopwords` variable too</span></a>
<a class="sourceLine" id="cb433-8" title="8"><span class="co"># - count the frequencies of the words</span></a>
<a class="sourceLine" id="cb433-9" title="9"><span class="co"># - print on screen 20 most frequent words</span></a>
<a class="sourceLine" id="cb433-10" title="10"></a>
<a class="sourceLine" id="cb433-11" title="11">hobbit  <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">str_c</span>(<span class="dt">collapse =</span> <span class="st">&quot; &quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb433-12" title="12"><span class="kw">str_replace_all</span>(<span class="st">&#39;[:punct:]&#39;</span>, <span class="st">&#39;&#39;</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb433-13" title="13"><span class="st">  </span>tolower <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">str_split</span>(<span class="st">&#39;[:space:]&#39;</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb433-14" title="14"><span class="st">  </span>unlist -&gt;<span class="st"> </span>hobbit2</a>
<a class="sourceLine" id="cb433-15" title="15"></a>
<a class="sourceLine" id="cb433-16" title="16">hobbit3 &lt;-<span class="st"> </span>hobbit2[<span class="op">!</span>(hobbit2 <span class="op">%in%</span><span class="st"> </span>stopwords <span class="op">|</span><span class="st"> </span><span class="kw">nchar</span>(hobbit2) <span class="op">==</span><span class="st"> </span><span class="dv">0</span>)]</a>
<a class="sourceLine" id="cb433-17" title="17"></a>
<a class="sourceLine" id="cb433-18" title="18">freq &lt;-<span class="st"> </span><span class="kw">table</span>(hobbit3) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">sort</span>(<span class="dt">decreasing =</span> T)</a>
<a class="sourceLine" id="cb433-19" title="19"></a>
<a class="sourceLine" id="cb433-20" title="20">freq[<span class="dv">1</span><span class="op">:</span><span class="dv">20</span>]</a></code></pre></div>
<pre><code>## hobbit3
##   bilbo gandalf     one  thorin dwarves    door baggins    good  hobbit 
##      39      36      36      34      31      27      25      25      25 
##  little    long    went    know    time    away      go     old  things 
##      24      24      23      20      19      17      17      17      17 
##    come morning 
##      16      16</code></pre>
</div>
<hr />
</div>
</div>
<div id="exercise-tasks-1" class="section level2 unnumbered">
<h2>Exercise Tasks</h2>
<p>The following tasks relate to the data set stored in the CSV file <code>crimeSample.csv</code>, which is a sample from the record of criminal incidents in the City of Philadelphia (the original data set can be found at <a href =" https://www.opendataphilly.org/ dataset / crime-incidents "> this link </a>). The original set of columns was reduced and 1000 incidents were randomly sampled from the set of all observations.</p>
<p>Before solving problems, load the data into the crimes data box and familiarize yourself with the data set (<code>str</code>,<code>head</code>, etc.)</p>
<ol style="list-style-type: decimal">
<li><p>Convert the timestamp column from character type to <code>POSIXct</code> type.</p></li>
<li><p>Add the following columns to the data frame: <code>Year</code>,<code>Month</code>, <code>Hour</code>. Fill in the columns with the appropriate information from the timestamp. Answer the question: in what month does the most crime occur? Which hour of the day is “most dangerous” according to the data?</p></li>
<li><p>Answer the question: What is the percentage of incidents where the incident description contains the word <code>burglary '' or</code> robbery ’’? (tip: convert the entire crime description column to lowercase using the <code>tolower()</code> function.</p></li>
<li><p>Print any unique four-digit numbers you can find on street names where a criminal incident is recorded.</p></li>
</ol>
<hr />
<p><a rel="license" href="http://creativecommons.org/licenses/by-nc-nd/4.0/"> <img alt = "Creative Commons License" style = "border-width: 0" src = "https://i.creativecommons.org/l/by-nc-nd/4.0/88x31.png" /> </a> <br /> <span xmlns:="" dct="http://purl.org/ dc / terms / " property=" dct: title "> Let’s Program in Ru </span> by <a xmlns: cc =" http://creativecommons.org/ns# "href =" https: //www.fer. unizg.hr/en/damir.pintar "property =" cc: attributionName "rel =" cc: attributionURL "> Damir Pintar </a> is licensed under a <a rel =" license "href =" http: // creativecommons .org / licenses / by-nc-nd / 4.0 / "> Creative Commons Attribution-NonCommercial-NoDerivatives 4.0 International License </a>. <br /> Based on work at <a xmlns: dct =" http: // purl.org/dc/terms/ "href =" https://ratnip.github.io/FER_OPJR/ "rel =" dct: source "> https://ratnip.github.io/FER_OPJR/ </a></p>

<div id="refs" class="references">
<div>
<p>Bache, Stefan Milton, and Hadley Wickham. 2014. <em>Magrittr: A Forward-Pipe Operator for R</em>. <a href="https://CRAN.R-project.org/package=magrittr">https://CRAN.R-project.org/package=magrittr</a>.</p>
</div>
</div>
</div>
</div>
<h3>References</h3>
<div id="refs" class="references">
<div id="ref-R-magrittr">
<p>Bache, Stefan Milton, and Hadley Wickham. 2014. <em>Magrittr: A Forward-Pipe Operator for R</em>. <a href="https://CRAN.R-project.org/package=magrittr">https://CRAN.R-project.org/package=magrittr</a>.</p>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="vektori.html" class="navigation navigation-prev navigation-unique" aria-label="Previous page"><i class="fa fa-angle-left"></i></a>

    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"google": false,
"linkedin": false,
"weibo": false,
"instapper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "section",
"scroll_highlight": true
},
"toolbar": {
"position": "fixed",
"edit": null,
"download": null,
"search": true
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdn.bootcss.com/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:" && /^https?:/.test(src))
      src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
