<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Let’s program in R</title>
  <meta name="description" content="R Coursebook">
  <meta name="generator" content="bookdown 0.7 and GitBook 2.6.7">

  <meta property="og:title" content="Let’s program in R" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="R Coursebook" />
  <meta name="github-repo" content="rstudio/bookdown-demo" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Let’s program in R" />
  
  <meta name="twitter:description" content="R Coursebook" />
  

<meta name="author" content="Damir Pintar">


<meta name="date" content="2020-01-13">

  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  
<link rel="prev" href="dates.html">
<link rel="next" href="ggplot2.html">
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />








<style type="text/css">
.showopt {
  background-color: #004c93;
  color: #FFFFFF; 
  width: 140px;
  height: 4	0px;
  text-align: center;
  vertical-align: middle !important;
  float: right;
  font-family: sans-serif;
  font-size:10 pt;
  border-radius: 8px;
}

.showopt:hover {
    background-color: #dfe4f2;
    color: #004c93;
}

pre.plot {
  background-color: white !important;
}
</style>

<script>
 $(document).ready(function() {

  $chunks = $('.fold');

  $chunks.each(function () {

    // add button to source code chunks
    if ( $(this).hasClass('s') ) {
      $('pre.r', this).prepend("<div class=\"showopt\">Show solution</div><br style=\"line-height:22px;\"/>");
      $('pre.r', this).children('code').attr('class', 'folded');
    }

    // add button to output chunks
    if ( $(this).hasClass('o') ) {
      $('pre:not(.r)', this).has('code').prepend("<div class=\"showopt\">Show results</div><br style=\"line-height:22px;\"/>");
      $('pre:not(.r)', this).children('code:not(r)').addClass('folded');

      // add button to plots
      $(this).find('img').wrap('<pre class=\"plot\"></pre>');
      $('pre.plot', this).prepend("<div class=\"showopt\">Show figure</div><br style=\"line-height:22px;\"/>");
      $('pre.plot', this).children('img').addClass('folded');

    }
  });

  // hide all chunks when document is loaded
  $('.folded').css('display', 'none')

  // function to toggle the visibility
  $('.showopt').click(function() {
    var label = $(this).html();
    if (label.indexOf("Show") >= 0) {
      $(this).html(label.replace("Show", "Hide"));
    } else {
      $(this).html(label.replace("Hide", "Show"));
    }
    $(this).siblings('code, img').slideToggle('fast', 'swing');
  });
});
</script>


<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(title);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>(“Introduction to programming language R” course book)</a><ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#foreword"><i class="fa fa-check"></i>Foreword</a></li>
</ul></li>
<li class="part"><span><b>I Basic elements of R</b></span></li>
<li class="chapter" data-level="1" data-path="introduction.html"><a href="introduction.html"><i class="fa fa-check"></i><b>1</b> Introduction</a><ul>
<li class="chapter" data-level="1.1" data-path="introduction.html"><a href="introduction.html#what-is-r"><i class="fa fa-check"></i><b>1.1</b> What is R?</a><ul>
<li class="chapter" data-level="1.1.1" data-path="introduction.html"><a href="introduction.html#general-facts-about-r"><i class="fa fa-check"></i><b>1.1.1</b> General facts about R</a></li>
<li class="chapter" data-level="1.1.2" data-path="introduction.html"><a href="introduction.html#r-alternatives"><i class="fa fa-check"></i><b>1.1.2</b> R alternatives</a></li>
</ul></li>
<li class="chapter" data-level="1.2" data-path="introduction.html"><a href="introduction.html#installing-software-support"><i class="fa fa-check"></i><b>1.2</b> Installing Software Support</a></li>
<li class="chapter" data-level="1.3" data-path="introduction.html"><a href="introduction.html#overview-of-the-development-interface-rstudio"><i class="fa fa-check"></i><b>1.3</b> Overview of the development interface <em>RStudio</em></a><ul>
<li class="chapter" data-level="1.3.1" data-path="introduction.html"><a href="introduction.html#interactive-console"><i class="fa fa-check"></i><b>1.3.1</b> Interactive console</a></li>
<li class="chapter" data-level="1.3.2" data-path="introduction.html"><a href="introduction.html#writing-r-scripts"><i class="fa fa-check"></i><b>1.3.2</b> Writing R scripts</a></li>
<li class="chapter" data-level="1.3.3" data-path="introduction.html"><a href="introduction.html#r-markdown"><i class="fa fa-check"></i><b>1.3.3</b> <em>R Markdown</em></a></li>
</ul></li>
<li class="chapter" data-level="1.4" data-path="introduction.html"><a href="introduction.html#how-to-use-this-coursebook"><i class="fa fa-check"></i><b>1.4</b> How to use this coursebook?</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="tipovi.html"><a href="tipovi.html"><i class="fa fa-check"></i><b>2</b> Basic data types and operators</a><ul>
<li class="chapter" data-level="2.1" data-path="tipovi.html"><a href="tipovi.html#basic-data-types"><i class="fa fa-check"></i><b>2.1</b> Basic data types</a></li>
<li class="chapter" data-level="2.2" data-path="tipovi.html"><a href="tipovi.html#operators"><i class="fa fa-check"></i><b>2.2</b> Operators</a></li>
<li class="chapter" data-level="2.3" data-path="tipovi.html"><a href="tipovi.html#missing-unknown-and-non-existent-values"><i class="fa fa-check"></i><b>2.3</b> Missing, unknown, and non-existent values</a></li>
<li class="chapter" data-level="" data-path="tipovi.html"><a href="tipovi.html#exercises"><i class="fa fa-check"></i>Exercises</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="vektori.html"><a href="vektori.html"><i class="fa fa-check"></i><b>3</b> Vectors, matrices and lists</a><ul>
<li class="chapter" data-level="3.1" data-path="vektori.html"><a href="vektori.html#vector"><i class="fa fa-check"></i><b>3.1</b> Vector</a><ul>
<li class="chapter" data-level="3.1.1" data-path="vektori.html"><a href="vektori.html#create-a-vector"><i class="fa fa-check"></i><b>3.1.1</b> Create a vector</a></li>
<li class="chapter" data-level="3.1.2" data-path="vektori.html"><a href="vektori.html#operator"><i class="fa fa-check"></i><b>3.1.2</b> Operator <code>[</code></a></li>
<li class="chapter" data-level="3.1.3" data-path="vektori.html"><a href="vektori.html#principle-of-vectorization-and-recycling"><i class="fa fa-check"></i><b>3.1.3</b> Principle of vectorization and recycling</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="vektori.html"><a href="vektori.html#index-vectors"><i class="fa fa-check"></i><b>3.2</b> Index vectors</a><ul>
<li class="chapter" data-level="3.2.1" data-path="vektori.html"><a href="vektori.html#location-indexing"><i class="fa fa-check"></i><b>3.2.1</b> Location Indexing</a></li>
<li class="chapter" data-level="3.2.2" data-path="vektori.html"><a href="vektori.html#conditional-indexing"><i class="fa fa-check"></i><b>3.2.2</b> Conditional indexing</a></li>
<li class="chapter" data-level="3.2.3" data-path="vektori.html"><a href="vektori.html#label-based-indexing"><i class="fa fa-check"></i><b>3.2.3</b> Label-based indexing</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="vektori.html"><a href="vektori.html#matrices-and-arrays"><i class="fa fa-check"></i><b>3.3</b> Matrices and arrays</a><ul>
<li class="chapter" data-level="3.3.1" data-path="vektori.html"><a href="vektori.html#matrix-splicing"><i class="fa fa-check"></i><b>3.3.1</b> Matrix splicing</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="vektori.html"><a href="vektori.html#lists"><i class="fa fa-check"></i><b>3.4</b> Lists</a></li>
<li class="chapter" data-level="" data-path="vektori.html"><a href="vektori.html#exercises-1"><i class="fa fa-check"></i>Exercises</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="okviri.html"><a href="okviri.html"><i class="fa fa-check"></i><b>4</b> Data frames and factors</a><ul>
<li class="chapter" data-level="4.1" data-path="okviri.html"><a href="okviri.html#data-frames"><i class="fa fa-check"></i><b>4.1</b> Data frames</a></li>
<li class="chapter" data-level="4.2" data-path="okviri.html"><a href="okviri.html#selecting-rows-and-columns"><i class="fa fa-check"></i><b>4.2</b> Selecting rows and columns</a></li>
<li class="chapter" data-level="4.3" data-path="okviri.html"><a href="okviri.html#adding-and-deleting-rows-and-columns"><i class="fa fa-check"></i><b>4.3</b> Adding and deleting rows and columns</a></li>
<li class="chapter" data-level="4.4" data-path="okviri.html"><a href="okviri.html#factors"><i class="fa fa-check"></i><b>4.4</b> Factors</a></li>
<li class="chapter" data-level="" data-path="okviri.html"><a href="okviri.html#exercises-2"><i class="fa fa-check"></i>Exercises</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="control.html"><a href="control.html"><i class="fa fa-check"></i><b>5</b> Flow control and objects</a><ul>
<li class="chapter" data-level="5.1" data-path="control.html"><a href="control.html#flow-control-commands"><i class="fa fa-check"></i><b>5.1</b> Flow control commands</a><ul>
<li class="chapter" data-level="5.1.1" data-path="control.html"><a href="control.html#conditional-execution-of-commands"><i class="fa fa-check"></i><b>5.1.1</b> Conditional execution of commands</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="control.html"><a href="control.html#program-loops"><i class="fa fa-check"></i><b>5.2</b> Program Loops</a><ul>
<li class="chapter" data-level="5.2.1" data-path="control.html"><a href="control.html#loop-repeat"><i class="fa fa-check"></i><b>5.2.1</b> Loop <code>repeat</code></a></li>
<li class="chapter" data-level="5.2.2" data-path="control.html"><a href="control.html#while-loop"><i class="fa fa-check"></i><b>5.2.2</b> <code>while</code> loop</a></li>
<li class="chapter" data-level="5.2.3" data-path="control.html"><a href="control.html#for-loop"><i class="fa fa-check"></i><b>5.2.3</b> <code>for</code> loop</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="control.html"><a href="control.html#object-models-in-r-language"><i class="fa fa-check"></i><b>5.3</b> Object models in R language</a><ul>
<li class="chapter" data-level="5.3.1" data-path="control.html"><a href="control.html#overview-of-the-s3-object-model"><i class="fa fa-check"></i><b>5.3.1</b> Overview of the S3 object model</a></li>
<li class="chapter" data-level="5.3.2" data-path="control.html"><a href="control.html#generic-functions"><i class="fa fa-check"></i><b>5.3.2</b> Generic functions</a></li>
<li class="chapter" data-level="5.3.3" data-path="control.html"><a href="control.html#conclusion-on-s3-objects"><i class="fa fa-check"></i><b>5.3.3</b> Conclusion on S3 objects</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="control.html"><a href="control.html#exercises-3"><i class="fa fa-check"></i>Exercises</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="packages.html"><a href="packages.html"><i class="fa fa-check"></i><b>6</b> Packages, built-in functions and environments</a><ul>
<li class="chapter" data-level="6.1" data-path="packages.html"><a href="packages.html#working-with-packages"><i class="fa fa-check"></i><b>6.1</b> Working with packages</a></li>
<li class="chapter" data-level="6.2" data-path="packages.html"><a href="packages.html#built-in-functions"><i class="fa fa-check"></i><b>6.2</b> Built-in functions</a></li>
<li class="chapter" data-level="6.3" data-path="packages.html"><a href="packages.html#environments"><i class="fa fa-check"></i><b>6.3</b> Environments</a></li>
<li class="chapter" data-level="" data-path="packages.html"><a href="packages.html#exercises-4"><i class="fa fa-check"></i>Exercises</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="user.html"><a href="user.html"><i class="fa fa-check"></i><b>7</b> User Defined Functions</a><ul>
<li class="chapter" data-level="7.1" data-path="user.html"><a href="user.html#how-to-define-a-function"><i class="fa fa-check"></i><b>7.1</b> How to define a function</a><ul>
<li class="chapter" data-level="7.1.1" data-path="user.html"><a href="user.html#the-copy-on-modify-principle"><i class="fa fa-check"></i><b>7.1.1</b> The “copy-on-modify” principle</a></li>
<li class="chapter" data-level="7.1.2" data-path="user.html"><a href="user.html#function-as-an-object"><i class="fa fa-check"></i><b>7.1.2</b> Function as an object</a></li>
<li class="chapter" data-level="7.1.3" data-path="user.html"><a href="user.html#generic-functions-1"><i class="fa fa-check"></i><b>7.1.3</b> Generic functions</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="user.html"><a href="user.html#exercises-5"><i class="fa fa-check"></i>Exercises</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="apply.html"><a href="apply.html"><i class="fa fa-check"></i><b>8</b> ‘Apply’ family of functions</a><ul>
<li class="chapter" data-level="8.1" data-path="apply.html"><a href="apply.html#what-are-apply-functions"><i class="fa fa-check"></i><b>8.1</b> What are <code>apply</code> functions?</a></li>
<li class="chapter" data-level="8.2" data-path="apply.html"><a href="apply.html#the-apply-function"><i class="fa fa-check"></i><b>8.2</b> The <code>apply</code> function</a></li>
<li class="chapter" data-level="8.3" data-path="apply.html"><a href="apply.html#the-lapply-sapply-and-vapply-functions"><i class="fa fa-check"></i><b>8.3</b> The <code>lapply</code>, <code>sapply</code> and <code>vapply</code> functions</a></li>
<li class="chapter" data-level="8.4" data-path="apply.html"><a href="apply.html#other-functions-from-the-apply-family-and-the-available-alternatives"><i class="fa fa-check"></i><b>8.4</b> Other functions from the <code>apply</code> family and the available alternatives</a></li>
<li class="chapter" data-level="" data-path="apply.html"><a href="apply.html#exercises-6"><i class="fa fa-check"></i>Exercises</a></li>
</ul></li>
<li class="part"><span><b>II Data management and visualizations</b></span></li>
<li class="chapter" data-level="9" data-path="pipe.html"><a href="pipe.html"><i class="fa fa-check"></i><b>9</b> Pipeline operator and tidy data</a><ul>
<li class="chapter" data-level="9.1" data-path="pipe.html"><a href="pipe.html#tidy-data"><i class="fa fa-check"></i><b>9.1</b> Tidy data</a><ul>
<li class="chapter" data-level="9.1.1" data-path="pipe.html"><a href="pipe.html#the-gather-andspread-functions"><i class="fa fa-check"></i><b>9.1.1</b> The <code>gather</code> and<code>spread</code> functions</a></li>
<li class="chapter" data-level="9.1.2" data-path="pipe.html"><a href="pipe.html#the-separate-and-unite-functions"><i class="fa fa-check"></i><b>9.1.2</b> The <code>separate</code> and <code>unite</code> functions</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="pipe.html"><a href="pipe.html#exercise-tasks"><i class="fa fa-check"></i>Exercise Tasks</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="dates.html"><a href="dates.html"><i class="fa fa-check"></i><b>10</b> Working with dates and character strings</a><ul>
<li class="chapter" data-level="10.1" data-path="dates.html"><a href="dates.html#working-with-dates"><i class="fa fa-check"></i><b>10.1</b> Working with dates</a><ul>
<li class="chapter" data-level="10.1.1" data-path="dates.html"><a href="dates.html#the-date-class"><i class="fa fa-check"></i><b>10.1.1</b> The <code>Date</code> class</a></li>
<li class="chapter" data-level="10.1.2" data-path="dates.html"><a href="dates.html#theposixct-andposixlt-classes"><i class="fa fa-check"></i><b>10.1.2</b> The<code>POSIXct</code> and<code>POSIXlt</code> classes</a></li>
<li class="chapter" data-level="10.1.3" data-path="dates.html"><a href="dates.html#the-lubridate-package"><i class="fa fa-check"></i><b>10.1.3</b> The <code>lubridate</code> package</a></li>
</ul></li>
<li class="chapter" data-level="10.2" data-path="dates.html"><a href="dates.html#working-with-character-strings"><i class="fa fa-check"></i><b>10.2</b> Working with character strings</a><ul>
<li class="chapter" data-level="10.2.1" data-path="dates.html"><a href="dates.html#text-analysis-and-regular-expressions"><i class="fa fa-check"></i><b>10.2.1</b> Text analysis and regular expressions</a></li>
<li class="chapter" data-level="10.2.2" data-path="dates.html"><a href="dates.html#the-stringr-package"><i class="fa fa-check"></i><b>10.2.2</b> The <code>stringr</code> package</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="dates.html"><a href="dates.html#exercise-tasks-1"><i class="fa fa-check"></i>Exercise Tasks</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="dplyr.html"><a href="dplyr.html"><i class="fa fa-check"></i><b>11</b> Managing data frames with <code>dplyr</code> package -</a><ul>
<li class="chapter" data-level="11.1" data-path="dplyr.html"><a href="dplyr.html#dataset-titanic"><i class="fa fa-check"></i><b>11.1</b> Dataset: <em>Titanic</em></a></li>
<li class="chapter" data-level="11.2" data-path="dplyr.html"><a href="dplyr.html#creating-a-subset-of-observations-with-filter-andslice"><i class="fa fa-check"></i><b>11.2</b> Creating a subset of observations with <code>filter</code> and<code>slice</code></a></li>
<li class="chapter" data-level="11.3" data-path="dplyr.html"><a href="dplyr.html#creating-a-subset-of-columns-with-select"><i class="fa fa-check"></i><b>11.3</b> Creating a subset of columns with <code>select</code></a></li>
<li class="chapter" data-level="11.4" data-path="dplyr.html"><a href="dplyr.html#creating-new-columns-with-mutate"><i class="fa fa-check"></i><b>11.4</b> Creating new columns with <code>mutate</code></a></li>
<li class="chapter" data-level="11.5" data-path="dplyr.html"><a href="dplyr.html#sample-dataset-houston-flights"><i class="fa fa-check"></i><b>11.5</b> Sample Dataset: <em>Houston flights</em></a></li>
<li class="chapter" data-level="11.6" data-path="dplyr.html"><a href="dplyr.html#grouping-and-aggregation-with-group_by-andsummarise"><i class="fa fa-check"></i><b>11.6</b> Grouping and aggregation with <code>group_by</code> and<code>summarise</code></a></li>
<li class="chapter" data-level="11.7" data-path="dplyr.html"><a href="dplyr.html#merging-data-frames-with-join-functions"><i class="fa fa-check"></i><b>11.7</b> Merging data frames with join functions</a></li>
<li class="chapter" data-level="11.8" data-path="dplyr.html"><a href="dplyr.html#integrating-dplyr-with-relational-databases"><i class="fa fa-check"></i><b>11.8</b> Integrating <code>dplyr</code> with relational databases</a></li>
<li class="chapter" data-level="" data-path="dplyr.html"><a href="dplyr.html#exercises-7"><i class="fa fa-check"></i>Exercises</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="ggplot2.html"><a href="ggplot2.html"><i class="fa fa-check"></i><b>12</b> Visualising data with <code>ggplot2</code> package</a><ul>
<li class="chapter" data-level="12.1" data-path="ggplot2.html"><a href="ggplot2.html#exploratory-data-analysis"><i class="fa fa-check"></i><b>12.1</b> Exploratory data analysis</a></li>
<li class="chapter" data-level="12.2" data-path="ggplot2.html"><a href="ggplot2.html#data-visualization-using-the-r-language"><i class="fa fa-check"></i><b>12.2</b> Data visualization using the R language</a></li>
<li class="chapter" data-level="12.3" data-path="ggplot2.html"><a href="ggplot2.html#grammar-of-graphics-and-the-ggplot2-package"><i class="fa fa-check"></i><b>12.3</b> Grammar of graphics and the <code>ggplot2</code> package</a><ul>
<li class="chapter" data-level="12.3.1" data-path="ggplot2.html"><a href="ggplot2.html#aspects-of-data-aesthetics-and-geometries"><i class="fa fa-check"></i><b>12.3.1</b> Aspects of data, aesthetics and geometries</a></li>
<li class="chapter" data-level="12.3.2" data-path="ggplot2.html"><a href="ggplot2.html#fixed-geometry-parameters"><i class="fa fa-check"></i><b>12.3.2</b> Fixed geometry parameters</a></li>
<li class="chapter" data-level="12.3.3" data-path="ggplot2.html"><a href="ggplot2.html#the-aspects-of-statistics-and-position"><i class="fa fa-check"></i><b>12.3.3</b> The aspects of statistics and position</a></li>
<li class="chapter" data-level="12.3.4" data-path="ggplot2.html"><a href="ggplot2.html#the-relationship-between-geometry-and-statistics"><i class="fa fa-check"></i><b>12.3.4</b> The relationship between geometry and statistics</a></li>
<li class="chapter" data-level="12.3.5" data-path="ggplot2.html"><a href="ggplot2.html#storing-a-graph-to-a-file"><i class="fa fa-check"></i><b>12.3.5</b> Storing a graph to a file</a></li>
<li class="chapter" data-level="12.3.6" data-path="ggplot2.html"><a href="ggplot2.html#aspects-of-scale-coordinate-system-and-theme"><i class="fa fa-check"></i><b>12.3.6</b> Aspects of scale, coordinate system and theme</a></li>
<li class="chapter" data-level="12.3.7" data-path="ggplot2.html"><a href="ggplot2.html#conditional-faceted-graphs"><i class="fa fa-check"></i><b>12.3.7</b> Conditional (faceted) graphs</a></li>
</ul></li>
<li class="chapter" data-level="12.4" data-path="ggplot2.html"><a href="ggplot2.html#graphs-in-exploratory-analysis-and-reporting"><i class="fa fa-check"></i><b>12.4</b> Graphs in Exploratory Analysis and Reporting</a></li>
<li class="chapter" data-level="" data-path="ggplot2.html"><a href="ggplot2.html#exercises-8"><i class="fa fa-check"></i>Exercises</a></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Let’s program in R</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="dplyr" class="section level1">
<h1><span class="header-section-number">11</span> Managing data frames with <code>dplyr</code> package -</h1>
<hr />
<p>The <code>dplyr</code> package is one of the newer <em>R</em> language packages whose main function is to efficiently and easily manage data frames with a set of intuitively designed functions. At the time of writing this lesson, <a href = "https://www.rdocumentation.org/"> is at the top of the list of most popular packages</a> despite strong “competition” in this area made up of extremely popular packages such as <code>plyr</code>, <code>data.table</code> and base, traditional methods for working with data frames. Either of these options is a good choice, and although the <code>dplyr</code> package is not the most efficient in terms of performance (by far the best performance is currently offered by the<code>data.table</code> package), the advantage of this package is its intuitive, readable syntax that makes programming and working with data frames fast and easy, representing a great choice for developers who are familiar with <em>R</em> or simply want to focus on working with data through readable, easy-to-use program code.</p>
<p>The specific advantages of the <code>dplyr</code> package are:</p>
<ul>
<li>simple syntax (similar to SQL but procedural) that uses the five main “verbs” to manipulate data frames and as such defines a standalone language-within-language of sorts</li>
<li>higher efficiency compared to the methods offered by the basic package (initially <code>dplyr</code> was designed for greater programming efficiency, not necessarily for better performance, but in the meantime the implementation of certain routines in C also allowed for improved computational performance)</li>
<li>integration with relational databases and big data sources (certain <code>dplyr</code> functions can be used directly on tables in the database by automatically translating those functions into SQL commands)</li>
</ul>
<p>The aforementioned basic “five verbs” offered by the <code>dplyr</code> package are as follows:</p>
<ul>
<li><code>filter</code> - for filtering the dataset by rows</li>
<li><code>select</code> - for selecting individual columns</li>
<li><code>arrange</code> - for changing the order of the rows</li>
<li><code>mutate</code> - for creating new columns from existing ones</li>
<li><code>summarise</code> - for data aggregation</li>
</ul>
<p>In addition to these five basic verbs, we often use:</p>
<ul>
<li><code>group_by</code> for grouping data within a dataset</li>
<li>the <code>join</code> family of functions for merging data frames</li>
</ul>
<p>SQL language experts will easily notice the parallels between the SQL language and the stated <code>dplyr</code> functionality. The biggest difference is that SQL works “declaratively”, i.e. we have to follow the rules of building an SQL command that “does everything at once”, while in <em>R</em> using the functions of the <code>dplyr</code> package and the already familiar operator<code>%&gt;%</code>actions can be performed on datasets procedurally, with clear data processing flow going from left to right.</p>
<p>Before we do a detailed look at the functionality of the <code>dplyr</code> package, let’s get acquainted with one of the two datasets we will be using during this lesson.</p>
<div id="dataset-titanic" class="section level2">
<h2><span class="header-section-number">11.1</span> Dataset: <em>Titanic</em></h2>
<p>We will choose one commonly used dataset - <em>“Titanic Passenger Survival Dataset”</em>. This dataset contains information about the passengers of the cruise shipTitanic which sank on 14 April 1912, whereupon only 706 out of 2223 passengers survived. This dataset contains, amongst other things, passengers’ names, gender, date of arrival, passenger class, etc. There is a version of this dataset that comes with <em>R</em> distribution itself, but we will use its extended version from a <em>Kaggle</em> competition <em>“Titanic: Machine Learning From Disaster”</em> which can be found more at <a href = "https://www.kaggle.com/c/titanic"> this link</a>.</p>
<p>Let’s load this data set using the <code>read_csv</code> function, a<code>readr</code> package function that “upgrades” the <code>read.csv</code> function. Also, instead of the <code>str</code> function, let’s try to use its equivalent, the <code>glimpse</code> function, provided by the <code>dplyr</code> package.</p>
<hr />
<p><strong>Assignment 11.1 - dataset <code>Titanic</code></strong></p>
<div class="sourceCode" id="cb435"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb435-1" title="1"><span class="co"># load the data set from the file `Titanic.csv` into the variable` # `titanic` using the `read_csv` function from the `readr` package</span></a>
<a class="sourceLine" id="cb435-2" title="2"><span class="co"># please read the documentation before using the function</span></a>
<a class="sourceLine" id="cb435-3" title="3"></a>
<a class="sourceLine" id="cb435-4" title="4"><span class="co"># view the structure of the `titanic` dataframe </span></a>
<a class="sourceLine" id="cb435-5" title="5"><span class="co"># using the `glimps` function</span></a>
<a class="sourceLine" id="cb435-6" title="6"><span class="co"># and check the first few lines with the `head` function</span></a></code></pre></div>
<div class="fold s o">
<div class="sourceCode" id="cb436"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb436-1" title="1"><span class="co"># load the data set from the file `Titanic.csv` into the variable` # `titanic` using the `read_csv` function from the `readr` package</span></a>
<a class="sourceLine" id="cb436-2" title="2"><span class="co"># please read the documentation before using the function</span></a>
<a class="sourceLine" id="cb436-3" title="3">titanic &lt;-<span class="st"> </span><span class="kw">read_csv</span>(<span class="st">&quot;Titanic.csv&quot;</span>)</a>
<a class="sourceLine" id="cb436-4" title="4"></a>
<a class="sourceLine" id="cb436-5" title="5"><span class="co"># view the structure of the `titanic` dataframe </span></a>
<a class="sourceLine" id="cb436-6" title="6"><span class="co"># using the `glimps` function</span></a>
<a class="sourceLine" id="cb436-7" title="7"><span class="co"># and check the first few lines with the `head` function</span></a>
<a class="sourceLine" id="cb436-8" title="8"><span class="kw">glimpse</span>(titanic)</a>
<a class="sourceLine" id="cb436-9" title="9"><span class="kw">head</span>(titanic)</a></code></pre></div>
<pre><code>## Parsed with column specification:
## cols(
##   PassengerId = col_integer(),
##   Survived = col_integer(),
##   Pclass = col_integer(),
##   Name = col_character(),
##   Sex = col_character(),
##   Age = col_double(),
##   SibSp = col_integer(),
##   Parch = col_integer(),
##   Ticket = col_character(),
##   Fare = col_double(),
##   Cabin = col_character(),
##   Embarked = col_character()
## )</code></pre>
<pre><code>## Observations: 891
## Variables: 12
## $ PassengerId &lt;int&gt; 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15,...
## $ Survived    &lt;int&gt; 0, 1, 1, 1, 0, 0, 0, 0, 1, 1, 1, 1, 0, 0, 0, 1, 0,...
## $ Pclass      &lt;int&gt; 3, 1, 3, 1, 3, 3, 1, 3, 3, 2, 3, 1, 3, 3, 3, 2, 3,...
## $ Name        &lt;chr&gt; &quot;Braund, Mr. Owen Harris&quot;, &quot;Cumings, Mrs. John Bra...
## $ Sex         &lt;chr&gt; &quot;male&quot;, &quot;female&quot;, &quot;female&quot;, &quot;female&quot;, &quot;male&quot;, &quot;mal...
## $ Age         &lt;dbl&gt; 22, 38, 26, 35, 35, NA, 54, 2, 27, 14, 4, 58, 20, ...
## $ SibSp       &lt;int&gt; 1, 1, 0, 1, 0, 0, 0, 3, 0, 1, 1, 0, 0, 1, 0, 0, 4,...
## $ Parch       &lt;int&gt; 0, 0, 0, 0, 0, 0, 0, 1, 2, 0, 1, 0, 0, 5, 0, 0, 1,...
## $ Ticket      &lt;chr&gt; &quot;A/5 21171&quot;, &quot;PC 17599&quot;, &quot;STON/O2. 3101282&quot;, &quot;1138...
## $ Fare        &lt;dbl&gt; 7.2500, 71.2833, 7.9250, 53.1000, 8.0500, 8.4583, ...
## $ Cabin       &lt;chr&gt; NA, &quot;C85&quot;, NA, &quot;C123&quot;, NA, NA, &quot;E46&quot;, NA, NA, NA, ...
## $ Embarked    &lt;chr&gt; &quot;S&quot;, &quot;C&quot;, &quot;S&quot;, &quot;S&quot;, &quot;S&quot;, &quot;Q&quot;, &quot;S&quot;, &quot;S&quot;, &quot;S&quot;, &quot;C&quot;, ...
## # A tibble: 6 x 12
##   PassengerId Survived Pclass Name  Sex     Age SibSp Parch Ticket  Fare
##         &lt;int&gt;    &lt;int&gt;  &lt;int&gt; &lt;chr&gt; &lt;chr&gt; &lt;dbl&gt; &lt;int&gt; &lt;int&gt; &lt;chr&gt;  &lt;dbl&gt;
## 1           1        0      3 Brau~ male     22     1     0 A/5 2~  7.25
## 2           2        1      1 Cumi~ fema~    38     1     0 PC 17~ 71.3 
## 3           3        1      3 Heik~ fema~    26     0     0 STON/~  7.92
## 4           4        1      1 Futr~ fema~    35     1     0 113803 53.1 
## 5           5        0      3 Alle~ male     35     0     0 373450  8.05
## 6           6        0      3 Mora~ male     NA     0     0 330877  8.46
## # ... with 2 more variables: Cabin &lt;chr&gt;, Embarked &lt;chr&gt;</code></pre>
</div>
<hr />
<p>Why use the function <code>read_csv</code> instead of its counterpart with a similar name, <code>read.csv</code>? There are several reasons:</p>
<ul>
<li>greater autonomy, i.e. better inference of column types</li>
<li>faster processing speed</li>
<li>provides status information for easier error detection</li>
<li><strong>no automatic categorization</strong></li>
<li>the loaded object is automatically converted into a “<em>tibble</em>”</li>
</ul>
<p>All these reasons are clear, except perhaps the last one. What is a “<em>tibble</em>”? This is a colloquial name for an object of class <code>tbl_df</code>, which is an upgrade of sorts of the <code>data.frame</code> class, i.e. the basic data frame. The biggest advantage of this type of object is that when you try to print the whole data frame to the screen (which usually happens by mistake and which can result in a “freezing” of the <em>R</em> console), a special function will be called that will print only part of the frame and be able to resume operation immediately .</p>
<p>If we want to “upgrade” an existing dataframe to a <em>tibble</em>, we can do this with the <code>as_tibble</code> command (note that functions in the <code>tidyverse</code> collection often contain an underscore <code>_</code>, to help distinguish them as upgrades of basic <em>R</em> constructs which have similar names but use a dot <code>.</code>).</p>
<p>We can fine tune how tibbles get printed by using the <code>options</code> function and the parameters <code>tibble.print_max</code> and `tibble.width, for example:</p>
<div class="sourceCode" id="cb439"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb439-1" title="1"><span class="co"># I want to see a maximum of 10 rows and always print all columns</span></a>
<a class="sourceLine" id="cb439-2" title="2"><span class="kw">options</span>(<span class="dt">tibble.print_max =</span> <span class="dv">10</span>, <span class="dt">tibble.width =</span> <span class="ot">Inf</span>)</a></code></pre></div>
<p>An easier way for a one-off printing of more than 10 rows we can simply add a paramter <code>n</code> to the default <code>print</code> function:</p>
<div class="sourceCode" id="cb440"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb440-1" title="1"><span class="co"># `df` is of class `tbl_df`, I want to see 50 lines printed</span></a>
<a class="sourceLine" id="cb440-2" title="2"><span class="kw">print</span>(df, <span class="dt">n =</span> <span class="dv">50</span>)</a></code></pre></div>
<hr />
<p>Before proceeding, it would be a good idea to get acquainted with the data set we will be using, either through a more detailed research of the dataset, or by collecting documentation on the dataset. The brief description of the dataset itself, collected from the official Keggle page of the competition, is as follows:</p>
<div class="sourceCode" id="cb441"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb441-1" title="1">VARIABLE DESCRIPTIONS<span class="op">:</span></a>
<a class="sourceLine" id="cb441-2" title="2">survival        Survival</a>
<a class="sourceLine" id="cb441-3" title="3">                (<span class="dv">0</span> =<span class="st"> </span>No; <span class="dv">1</span> =<span class="st"> </span>Yes)</a>
<a class="sourceLine" id="cb441-4" title="4">pclass          Passenger Class</a>
<a class="sourceLine" id="cb441-5" title="5">                (<span class="dv">1</span> =<span class="st"> </span>1st; <span class="dv">2</span> =<span class="st"> </span>2nd; <span class="dv">3</span> =<span class="st"> </span>3rd)</a>
<a class="sourceLine" id="cb441-6" title="6">name            Name</a>
<a class="sourceLine" id="cb441-7" title="7">sex             Sex</a>
<a class="sourceLine" id="cb441-8" title="8">age             Age</a>
<a class="sourceLine" id="cb441-9" title="9">sibsp           Number of Siblings<span class="op">/</span>Spouses Aboard</a>
<a class="sourceLine" id="cb441-10" title="10">parch           Number of Parents<span class="op">/</span>Children Aboard</a>
<a class="sourceLine" id="cb441-11" title="11">ticket          Ticket Number</a>
<a class="sourceLine" id="cb441-12" title="12">fare            Passenger Fare</a>
<a class="sourceLine" id="cb441-13" title="13">cabin           Cabin</a>
<a class="sourceLine" id="cb441-14" title="14">embarked        Port of Embarkation</a>
<a class="sourceLine" id="cb441-15" title="15">                (<span class="dt">C =</span> Cherbourg; <span class="dt">Q =</span> Queenstown; <span class="dt">S =</span> Southampton)</a>
<a class="sourceLine" id="cb441-16" title="16"></a>
<a class="sourceLine" id="cb441-17" title="17">SPECIAL NOTES<span class="op">:</span></a>
<a class="sourceLine" id="cb441-18" title="18">Pclass is a proxy <span class="cf">for</span> socio<span class="op">-</span>economic <span class="kw">status</span> (SES)</a>
<a class="sourceLine" id="cb441-19" title="19"> 1st <span class="op">~</span><span class="st"> </span>Upper; 2nd <span class="op">~</span><span class="st"> </span>Middle; 3rd <span class="op">~</span><span class="st"> </span>Lower</a>
<a class="sourceLine" id="cb441-20" title="20"></a>
<a class="sourceLine" id="cb441-21" title="21">Age is <span class="cf">in</span> Years; Fractional <span class="cf">if</span> Age less than <span class="kw">One</span> (<span class="dv">1</span>)</a>
<a class="sourceLine" id="cb441-22" title="22"> If the Age is Estimated, it is <span class="cf">in</span> the form xx<span class="fl">.5</span></a>
<a class="sourceLine" id="cb441-23" title="23"></a>
<a class="sourceLine" id="cb441-24" title="24">With respect to the family relation <span class="kw">variables</span> (i.e. sibsp and parch)</a>
<a class="sourceLine" id="cb441-25" title="25">some relations were ignored.  The following are the definitions used</a>
<a class="sourceLine" id="cb441-26" title="26"><span class="cf">for</span> sibsp and parch.</a>
<a class="sourceLine" id="cb441-27" title="27"></a>
<a class="sourceLine" id="cb441-28" title="28">Sibling<span class="op">:</span><span class="st">  </span>Brother, Sister, Stepbrother, or Stepsister of Passenger Aboard Titanic</a>
<a class="sourceLine" id="cb441-29" title="29">Spouse<span class="op">:</span><span class="st">   </span>Husband or Wife of Passenger Aboard <span class="kw">Titanic</span> (Mistresses and Fiances Ignored)</a>
<a class="sourceLine" id="cb441-30" title="30">Parent<span class="op">:</span><span class="st">   </span>Mother or Father of Passenger Aboard Titanic</a>
<a class="sourceLine" id="cb441-31" title="31">Child<span class="op">:</span><span class="st">    </span>Son, Daughter, Stepson, or Stepdaughter of Passenger Aboard Titanic</a>
<a class="sourceLine" id="cb441-32" title="32"></a>
<a class="sourceLine" id="cb441-33" title="33">Other family relatives excluded from this study include cousins,</a>
<a class="sourceLine" id="cb441-34" title="34">nephews<span class="op">/</span>nieces, aunts<span class="op">/</span>uncles, and <span class="cf">in</span><span class="op">-</span>laws.  Some children travelled</a>
<a class="sourceLine" id="cb441-35" title="35">only with a nanny, therefore parch=<span class="dv">0</span> <span class="cf">for</span> them.  As well, some</a>
<a class="sourceLine" id="cb441-36" title="36">travelled with very close friends or neighbors <span class="cf">in</span> a village, however,</a>
<a class="sourceLine" id="cb441-37" title="37">the definitions do not support such relations.</a></code></pre></div>
<p>At this point, it should be considered whether the dataset includes some categorical data. As we have learned, unlike the <code>read.csv</code> function that automatically factorizes all character columns (which is not recommended), the <code>read_csv</code> function from the <code>readr</code> package does not factorize anything, but rather leaves that to the analyst. While this represents additional work for the analyst, the level of control and robustness that is obtained is more than a sufficient compromise.</p>
<p>In the <code>titanic</code> dataset we notice the following categorical variables:</p>
<ul>
<li><em>Survival</em> (survival - 2 categories: 0 and 1)</li>
<li><em>Pclass</em> (passenger class - 3 categories: 1, 2 and 3)</li>
<li><em>Sex</em> (gender - 2 categories: “M” and “F”)</li>
<li><em>Embarked</em> (port of embarkation - 3 categories: “C”, “Q” and “S”)</li>
</ul>
<p>Let’s factorize the columns listed.</p>
<p><strong>Assignment 11.2 - factorizing the columns of the <code>Titanic</code> dataset</strong></p>
<div class="sourceCode" id="cb442"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb442-1" title="1"><span class="co"># convert the `Survival`,` Pclass`, `Sex` and` Embarked` columns</span></a>
<a class="sourceLine" id="cb442-2" title="2"><span class="co"># of the `titanic` data frame into factors</span></a>
<a class="sourceLine" id="cb442-3" title="3"></a>
<a class="sourceLine" id="cb442-4" title="4"><span class="co"># briefly explore the `titanic` data frame</span></a>
<a class="sourceLine" id="cb442-5" title="5"><span class="co"># using the &#39;glimpse&#39; function</span></a></code></pre></div>
<div class="fold s o">
<div class="sourceCode" id="cb443"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb443-1" title="1"><span class="co"># convert the `Survival`,` Pclass`, `Sex` and` Embarked` columns</span></a>
<a class="sourceLine" id="cb443-2" title="2"><span class="co"># of the `titanic` data frame into factors</span></a>
<a class="sourceLine" id="cb443-3" title="3">titanic<span class="op">$</span>Survived &lt;-<span class="st"> </span><span class="kw">as.factor</span>(titanic<span class="op">$</span>Survived)</a>
<a class="sourceLine" id="cb443-4" title="4">titanic<span class="op">$</span>Pclass &lt;-<span class="st"> </span><span class="kw">as.factor</span>(titanic<span class="op">$</span>Pclass)</a>
<a class="sourceLine" id="cb443-5" title="5">titanic<span class="op">$</span>Sex &lt;-<span class="st"> </span><span class="kw">as.factor</span>(titanic<span class="op">$</span>Sex)</a>
<a class="sourceLine" id="cb443-6" title="6">titanic<span class="op">$</span>Embarked &lt;-<span class="st"> </span><span class="kw">as.factor</span>(titanic<span class="op">$</span>Embarked)</a>
<a class="sourceLine" id="cb443-7" title="7"></a>
<a class="sourceLine" id="cb443-8" title="8"></a>
<a class="sourceLine" id="cb443-9" title="9"><span class="co"># briefly explore the `titanic` data frame</span></a>
<a class="sourceLine" id="cb443-10" title="10"><span class="co"># using the &#39;glimpse&#39; function</span></a>
<a class="sourceLine" id="cb443-11" title="11"><span class="kw">glimpse</span>(titanic)</a></code></pre></div>
<pre><code>## Observations: 891
## Variables: 12
## $ PassengerId &lt;int&gt; 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15,...
## $ Survived    &lt;fct&gt; 0, 1, 1, 1, 0, 0, 0, 0, 1, 1, 1, 1, 0, 0, 0, 1, 0,...
## $ Pclass      &lt;fct&gt; 3, 1, 3, 1, 3, 3, 1, 3, 3, 2, 3, 1, 3, 3, 3, 2, 3,...
## $ Name        &lt;chr&gt; &quot;Braund, Mr. Owen Harris&quot;, &quot;Cumings, Mrs. John Bra...
## $ Sex         &lt;fct&gt; male, female, female, female, male, male, male, ma...
## $ Age         &lt;dbl&gt; 22, 38, 26, 35, 35, NA, 54, 2, 27, 14, 4, 58, 20, ...
## $ SibSp       &lt;int&gt; 1, 1, 0, 1, 0, 0, 0, 3, 0, 1, 1, 0, 0, 1, 0, 0, 4,...
## $ Parch       &lt;int&gt; 0, 0, 0, 0, 0, 0, 0, 1, 2, 0, 1, 0, 0, 5, 0, 0, 1,...
## $ Ticket      &lt;chr&gt; &quot;A/5 21171&quot;, &quot;PC 17599&quot;, &quot;STON/O2. 3101282&quot;, &quot;1138...
## $ Fare        &lt;dbl&gt; 7.2500, 71.2833, 7.9250, 53.1000, 8.0500, 8.4583, ...
## $ Cabin       &lt;chr&gt; NA, &quot;C85&quot;, NA, &quot;C123&quot;, NA, NA, &quot;E46&quot;, NA, NA, NA, ...
## $ Embarked    &lt;fct&gt; S, C, S, S, S, Q, S, S, S, C, S, S, S, S, S, S, Q,...</code></pre>
</div>
<p>There is also a more concise way to factorizing columns which leverages the <code>lapply</code> function:</p>
<div class="sourceCode" id="cb445"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb445-1" title="1">categories &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Survived&quot;</span>, <span class="st">&quot;Pclass&quot;</span>, <span class="st">&quot;Sex&quot;</span>, <span class="st">&quot;Embarked&quot;</span>)</a>
<a class="sourceLine" id="cb445-2" title="2"></a>
<a class="sourceLine" id="cb445-3" title="3">titanic[categories] &lt;-<span class="st"> </span><span class="kw">lapply</span>(titanic[categories], as.factor)</a></code></pre></div>
<p>Now that we have a good understanding of our data set and have made the initial preparations in terms of column categorization, we can begin with the introduction of <code>dplyr</code> package functions.</p>
</div>
<div id="creating-a-subset-of-observations-with-filter-andslice" class="section level2">
<h2><span class="header-section-number">11.2</span> Creating a subset of observations with <code>filter</code> and<code>slice</code></h2>
<p>In the chapter on data frames, we have already learned that “slicing” data frames can be done similar to slicing matrices - using index vectors to define which rows/columns are retained. We have also learned that index vectors can be numerical (location), logical, and character-typed.</p>
<p>When defining a subset of rows, by far the most common type of index vector is logical - with the help of variables, i.e. data frame columns, we define a specific criterion that “filters” the rows. Unfortunately, the basic <em>R</em> syntax of using logical index vectors to determine a subset of rows is somewhat clumsy, as can be seen from this example:</p>
<div class="sourceCode" id="cb446"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb446-1" title="1">df[df<span class="op">$</span>a <span class="op">&gt;</span><span class="st"> </span><span class="dv">5</span> <span class="op">&amp;</span><span class="st"> </span>df<span class="op">$</span>b <span class="op">!=</span><span class="st"> </span><span class="dv">3</span>,]</a></code></pre></div>
<p>The first and obvious issue is the need to repeat the name of the data frame (which we can eliminate with the help of the <code>attach</code> function, which we said was not an ideal solution because it brings a number of new potential problems). The second issue is the readability problem - the above command is not easy to interpret visually, that is, it is not easy to see immediately afte that it is an instruction which aims to reduce the number of rows in a data frame.</p>
<p>The alternative is to use the <code>filter</code> function from the package <code>dplyr</code> which uses explicitely indicates that it is filtering rows, and also allows the use of column names without having to reference the name of the data frame:</p>
<div class="sourceCode" id="cb447"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb447-1" title="1"><span class="kw">filter</span>(df, a <span class="op">&gt;</span><span class="st"> </span><span class="dv">5</span> <span class="op">&amp;</span><span class="st"> </span>b <span class="op">!=</span><span class="st"> </span><span class="dv">3</span>)</a></code></pre></div>
<p>Also, it is good to note that the first argument of the function is the data frame itself, which allows us to easily chain it. Most of the <code>dplyr</code> package functions are designed on this principle.</p>
<p>The above function is the most common way to select a subset of rows (readers who are acquainted with the SQL language will notice a similarity to the WHERE segment of SQL queries). In addition to the <code>filter</code> function, to specify a subset of rows we want to keep we can also use some of the following functions, which also have very intuitive names (for easier interpretation rather than signature functions, we give examples of parameters):</p>
<ul>
<li><code>distinct(df)</code> - for removing duplicates</li>
<li><code>slice(df, 1:10)</code> - for location indexing</li>
<li><code>sample_frac(df, 0.2)</code> - random selection of a certain percentage of rows</li>
<li><code>sample_n(df, 50)</code> - randomly select of a specific number of rows</li>
<li><code>top_n(df, 10, a)</code> - returns the first 10 rows, ordered by the values of attribute <code>a</code></li>
</ul>
<p>We can use the following to rearrange the rows in the result:</p>
<ul>
<li><code>arrange(df, a, desc(b))</code> - sort by column <code>a</code> in ascending order and then by <code>b</code> in descending order</li>
</ul>
<p>Let’s try this in the following examples:</p>
<hr />
<p><strong>Assignment 11.3 - row selection</strong></p>
<div class="sourceCode" id="cb448"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb448-1" title="1"><span class="co"># print information about all first class passengers over 60 years of age</span></a>
<a class="sourceLine" id="cb448-2" title="2"></a>
<a class="sourceLine" id="cb448-3" title="3"><span class="co"># print information about all surviving male travelers who</span></a>
<a class="sourceLine" id="cb448-4" title="4"><span class="co"># have `George` or` Frank` in their name</span></a>
<a class="sourceLine" id="cb448-5" title="5"></a>
<a class="sourceLine" id="cb448-6" title="6"><span class="co"># check whether the dataset contains duplicate observations</span></a>
<a class="sourceLine" id="cb448-7" title="7"></a>
<a class="sourceLine" id="cb448-8" title="8"><span class="co"># randomly select and print information about five passengers who</span></a>
<a class="sourceLine" id="cb448-9" title="9"><span class="co"># have not survived the sinking</span></a>
<a class="sourceLine" id="cb448-10" title="10"><span class="co"># print order in descending order of ticket price</span></a>
<a class="sourceLine" id="cb448-11" title="11"></a>
<a class="sourceLine" id="cb448-12" title="12"><span class="co"># print information about the five oldest first class passengers</span></a>
<a class="sourceLine" id="cb448-13" title="13"><span class="co"># arrange the result in ascending order of age</span></a></code></pre></div>
<div class="fold s o">
<div class="sourceCode" id="cb449"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb449-1" title="1"><span class="co"># print information about all first class passengers over 60 years of age</span></a>
<a class="sourceLine" id="cb449-2" title="2"><span class="kw">filter</span>(titanic, Pclass <span class="op">==</span><span class="st"> </span><span class="dv">1</span> <span class="op">&amp;</span><span class="st"> </span>Age<span class="op">&gt;</span><span class="st"> </span><span class="dv">60</span>)</a></code></pre></div>
<pre><code>## # A tibble: 14 x 12
##    PassengerId Survived Pclass Name  Sex     Age SibSp Parch Ticket  Fare
##          &lt;int&gt; &lt;fct&gt;    &lt;fct&gt;  &lt;chr&gt; &lt;fct&gt; &lt;dbl&gt; &lt;int&gt; &lt;int&gt; &lt;chr&gt;  &lt;dbl&gt;
##  1          55 0        1      Ostb~ male     65     0     1 113509  62.0
##  2          97 0        1      Gold~ male     71     0     0 PC 17~  34.7
##  3         171 0        1      Van ~ male     61     0     0 111240  33.5
##  4         253 0        1      Stea~ male     62     0     0 113514  26.6
##  5         276 1        1      Andr~ fema~    63     1     0 13502   78.0
##  6         439 0        1      Fort~ male     64     1     4 19950  263  
##  7         457 0        1      Mill~ male     65     0     0 13509   26.6
##  8         494 0        1      Arta~ male     71     0     0 PC 17~  49.5
##  9         546 0        1      Nich~ male     64     0     0 693     26  
## 10         556 0        1      Wrig~ male     62     0     0 113807  26.6
## 11         626 0        1      Sutt~ male     61     0     0 36963   32.3
## 12         631 1        1      Bark~ male     80     0     0 27042   30  
## 13         746 0        1      Cros~ male     70     1     1 WE/P ~  71  
## 14         830 1        1      Ston~ fema~    62     0     0 113572  80  
## # ... with 2 more variables: Cabin &lt;chr&gt;, Embarked &lt;fct&gt;</code></pre>
</div>
<div class="fold s o">
<div class="sourceCode" id="cb451"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb451-1" title="1"><span class="co"># print information about all surviving male travelers who</span></a>
<a class="sourceLine" id="cb451-2" title="2"><span class="co"># have `George` or` Frank` in their name</span></a>
<a class="sourceLine" id="cb451-3" title="3"><span class="kw">filter</span>(titanic, <span class="kw">str_detect</span>(Name, <span class="st">&quot;(George|Frank)&quot;</span>) <span class="op">&amp;</span><span class="st"> </span>Sex <span class="op">==</span><span class="st"> &quot;male&quot;</span> <span class="op">&amp;</span><span class="st"> </span>Survived <span class="op">==</span><span class="st"> </span><span class="dv">1</span>)</a></code></pre></div>
<pre><code>## # A tibble: 6 x 12
##   PassengerId Survived Pclass Name  Sex     Age SibSp Parch Ticket  Fare
##         &lt;int&gt; &lt;fct&gt;    &lt;fct&gt;  &lt;chr&gt; &lt;fct&gt; &lt;dbl&gt; &lt;int&gt; &lt;int&gt; &lt;chr&gt;  &lt;dbl&gt;
## 1         166 1        3      &quot;Gol~ male   9        0     2 363291  20.5
## 2         371 1        1      Hard~ male  25        1     0 11765   55.4
## 3         508 1        1      &quot;Bra~ male  NA        0     0 111427  26.6
## 4         571 1        2      Harr~ male  62        0     0 S.W./~  10.5
## 5         710 1        3      &quot;Mou~ male  NA        1     1 2661    15.2
## 6         832 1        2      Rich~ male   0.83     1     1 29106   18.8
## # ... with 2 more variables: Cabin &lt;chr&gt;, Embarked &lt;fct&gt;</code></pre>
</div>
<div class="fold s o">
<div class="sourceCode" id="cb453"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb453-1" title="1"><span class="co"># check whether the dataset contains duplicate observations</span></a>
<a class="sourceLine" id="cb453-2" title="2"><span class="kw">nrow</span>(titanic) <span class="op">==</span><span class="st"> </span><span class="kw">nrow</span>(<span class="kw">distinct</span>(titanic))</a></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
</div>
<div class="fold s o">
<div class="sourceCode" id="cb455"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb455-1" title="1"><span class="co"># randomly select and print information about five passengers who</span></a>
<a class="sourceLine" id="cb455-2" title="2"><span class="co"># have not survived the sinking</span></a>
<a class="sourceLine" id="cb455-3" title="3"><span class="co"># print order in descending order of ticket price</span></a>
<a class="sourceLine" id="cb455-4" title="4"><span class="kw">filter</span>(titanic, Survived <span class="op">==</span><span class="st"> </span><span class="dv">0</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">sample_n</span>(<span class="dv">5</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">arrange</span>(<span class="kw">desc</span>(Fare))</a></code></pre></div>
<pre><code>## # A tibble: 5 x 12
##   PassengerId Survived Pclass Name  Sex     Age SibSp Parch Ticket  Fare
##         &lt;int&gt; &lt;fct&gt;    &lt;fct&gt;  &lt;chr&gt; &lt;fct&gt; &lt;dbl&gt; &lt;int&gt; &lt;int&gt; &lt;chr&gt;  &lt;dbl&gt;
## 1         496 0        3      Yous~ male     NA     0     0 2627   14.5 
## 2         464 0        2      Mill~ male     48     0     0 234360 13   
## 3         869 0        3      van ~ male     NA     0     0 345777  9.5 
## 4          92 0        3      Andr~ male     20     0     0 347466  7.85
## 5          61 0        3      Sira~ male     22     0     0 2669    7.23
## # ... with 2 more variables: Cabin &lt;chr&gt;, Embarked &lt;fct&gt;</code></pre>
</div>
<div class="fold s o">
<div class="sourceCode" id="cb457"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb457-1" title="1"><span class="co"># print information about the five oldest first class passengers</span></a>
<a class="sourceLine" id="cb457-2" title="2"><span class="co"># arrange the result in ascending order of age</span></a>
<a class="sourceLine" id="cb457-3" title="3"><span class="kw">filter</span>(titanic, Pclass <span class="op">==</span><span class="st"> </span><span class="dv">1</span> <span class="op">&amp;</span><span class="st"> </span>Sex <span class="op">==</span><span class="st"> &quot;female&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">top_n</span>(<span class="dv">5</span>, Age) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">arrange</span>(Age)</a></code></pre></div>
<pre><code>## # A tibble: 6 x 12
##   PassengerId Survived Pclass Name  Sex     Age SibSp Parch Ticket  Fare
##         &lt;int&gt; &lt;fct&gt;    &lt;fct&gt;  &lt;chr&gt; &lt;fct&gt; &lt;dbl&gt; &lt;int&gt; &lt;int&gt; &lt;chr&gt;  &lt;dbl&gt;
## 1          12 1        1      Bonn~ fema~    58     0     0 113783  26.6
## 2         196 1        1      Lure~ fema~    58     0     0 PC 17~ 147. 
## 3         269 1        1      Grah~ fema~    58     0     1 PC 17~ 153. 
## 4         367 1        1      Warr~ fema~    60     1     0 110813  75.2
## 5         830 1        1      Ston~ fema~    62     0     0 113572  80  
## 6         276 1        1      Andr~ fema~    63     1     0 13502   78.0
## # ... with 2 more variables: Cabin &lt;chr&gt;, Embarked &lt;fct&gt;</code></pre>
</div>
<hr />
<p>Notice that the <code>top_n</code> function returns the “first n” rows but does not necessarily arrange them in that order. If we want them arranged we also need to use the <code>arrange</code> function.</p>
</div>
<div id="creating-a-subset-of-columns-with-select" class="section level2">
<h2><span class="header-section-number">11.3</span> Creating a subset of columns with <code>select</code></h2>
<p>Another method of slixing a data frame selecting a subset of columns. Unlike selecting a subset of rows, where we most often use logical indexing, columns or variables are most often referenced by their name. The syntax for selecting a subset of columns by name using the basic indexing method in <em>R</em> looks like this:</p>
<div class="sourceCode" id="cb459"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb459-1" title="1">df[, <span class="kw">c</span>(<span class="st">&quot;a&quot;</span>, <span class="st">&quot;b&quot;</span>, <span class="st">&quot;c&quot;</span>)]</a></code></pre></div>
<p>Here we also notice a certain clumsiness in the syntax and difficulty in interpretation. Column names must be wrapped in a <code>c</code> function, which reduces readability, and the command doesn’t explicitly state that it is selecting columns of the data frame, we have to conclude it from the position of the index vector. In addition, there is no easy way to select a range of columns by name, the existence of a substring or pattern within the name, etc.</p>
<p>The <code>select</code> function allows us to explicitly select columns using syntax:</p>
<div class="sourceCode" id="cb460"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb460-1" title="1"><span class="kw">select</span>(df, a, b, c)</a></code></pre></div>
<p>So we simply list the data frame and the row of columns we want to select. It is also notice the similarity to SQL, specifically the SELECT part of SQL queries.</p>
<p>But the above syntax is not all that this feature has to offer - <code>select</code> has a number of helper functions and operators that greatly extend its functionality, such as:</p>
<ul>
<li><code>select(df, a:c)</code> - select columns from <code>a</code> to<code>c</code></li>
<li><code>select(df, -a, -b)</code> - select all columns except <code>a</code> and<code>b</code></li>
<li><code>select(df, starts_with("PO")))</code> - select columns beginning with the letters <code>"PO"</code></li>
<li><code>select(df, contains("col"))</code> - select columns containing the letters<code>"col"</code></li>
<li><code>select(df, matches("[123]{2,3}"))</code> - select columns that match the given regular expression</li>
</ul>
<p>Additional options are easy to find in the official documentation.</p>
<p>Let’s try this command, also on our dataset.</p>
<hr />
<p><strong>Assignment 11.4 - selecting the columns</strong></p>
<div class="sourceCode" id="cb461"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb461-1" title="1"><span class="co"># for randomly selected 10 rows, print the passenger&#39;s name, age and</span></a>
<a class="sourceLine" id="cb461-2" title="2"><span class="co"># whether he survived the sinking or not</span></a>
<a class="sourceLine" id="cb461-3" title="3"></a>
<a class="sourceLine" id="cb461-4" title="4"><span class="co"># for the 10 oldest passengers, print all attributes from name to ticket price</span></a>
<a class="sourceLine" id="cb461-5" title="5"></a>
<a class="sourceLine" id="cb461-6" title="6"><span class="co"># print all attributes except for the identifier and cabin number</span></a>
<a class="sourceLine" id="cb461-7" title="7"><span class="co"># for a randomly selected 1% of rows</span></a>
<a class="sourceLine" id="cb461-8" title="8"></a>
<a class="sourceLine" id="cb461-9" title="9"><span class="co"># for rows from number 10 to number 20, print out all columns beginning with a vowel</span></a>
<a class="sourceLine" id="cb461-10" title="10"></a>
<a class="sourceLine" id="cb461-11" title="11"><span class="co"># for randomly selected 10 passengers whose age is unknown, print all</span></a>
<a class="sourceLine" id="cb461-12" title="12"><span class="co"># attributes from name to ticket price, then the passenger class </span></a>
<a class="sourceLine" id="cb461-13" title="13"><span class="co"># and finally whether or not the passenger survived</span></a>
<a class="sourceLine" id="cb461-14" title="14"><span class="co"># sort the rows alphabetically by name</span></a></code></pre></div>
<div class="fold s o">
<div class="sourceCode" id="cb462"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb462-1" title="1"><span class="co"># for randomly selected 10 rows, print the passenger&#39;s name, age and</span></a>
<a class="sourceLine" id="cb462-2" title="2"><span class="co"># whether he survived the sinking or not</span></a>
<a class="sourceLine" id="cb462-3" title="3"><span class="kw">sample_n</span>(titanic, <span class="dv">10</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(Name, Age, Survived)</a></code></pre></div>
<pre><code>## # A tibble: 10 x 3
##    Name                                                        Age Survived
##    &lt;chr&gt;                                                     &lt;dbl&gt; &lt;fct&gt;   
##  1 Panula, Mrs. Juha (Maria Emilia Ojala)                    41    0       
##  2 Taussig, Miss. Ruth                                       18    1       
##  3 Sirayanian, Mr. Orsen                                     22    0       
##  4 Lemore, Mrs. (Amelia Milley)                              34    1       
##  5 Hamalainen, Master. Viljo                                  0.67 1       
##  6 Sandstrom, Miss. Marguerite Rut                            4    1       
##  7 Baclini, Miss. Marie Catherine                             5    1       
##  8 Stead, Mr. William Thomas                                 62    0       
##  9 Penasco y Castellana, Mrs. Victor de Satode (Maria Josef~ 17    1       
## 10 Hassan, Mr. Houssein G N                                  11    0</code></pre>
</div>
<div class="fold s o">
<div class="sourceCode" id="cb464"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb464-1" title="1"><span class="co"># for the 10 oldest passengers, print all attributes from name to ticket price</span></a>
<a class="sourceLine" id="cb464-2" title="2"><span class="kw">top_n</span>(titanic, <span class="dv">10</span>, Age) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(Name<span class="op">:</span>Fare)</a></code></pre></div>
<pre><code>## # A tibble: 11 x 7
##    Name                             Sex     Age SibSp Parch Ticket     Fare
##    &lt;chr&gt;                            &lt;fct&gt; &lt;dbl&gt; &lt;int&gt; &lt;int&gt; &lt;chr&gt;     &lt;dbl&gt;
##  1 Wheadon, Mr. Edward H            male   66       0     0 C.A. 245~ 10.5 
##  2 Ostby, Mr. Engelhart Cornelius   male   65       0     1 113509    62.0 
##  3 Goldschmidt, Mr. George B        male   71       0     0 PC 17754  34.7 
##  4 Connors, Mr. Patrick             male   70.5     0     0 370369     7.75
##  5 Duane, Mr. Frank                 male   65       0     0 336439     7.75
##  6 Millet, Mr. Francis Davis        male   65       0     0 13509     26.6 
##  7 Artagaveytia, Mr. Ramon          male   71       0     0 PC 17609  49.5 
##  8 Barkworth, Mr. Algernon Henry W~ male   80       0     0 27042     30   
##  9 Mitchell, Mr. Henry Michael      male   70       0     0 C.A. 245~ 10.5 
## 10 Crosby, Capt. Edward Gifford     male   70       1     1 WE/P 5735 71   
## 11 Svensson, Mr. Johan              male   74       0     0 347060     7.78</code></pre>
</div>
<div class="fold s o">
<div class="sourceCode" id="cb466"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb466-1" title="1"><span class="co"># print all attributes except for the identifier and cabin number</span></a>
<a class="sourceLine" id="cb466-2" title="2"><span class="co"># for a randomly selected 1% of rows</span></a>
<a class="sourceLine" id="cb466-3" title="3"><span class="kw">sample_frac</span>(titanic, <span class="fl">0.01</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(<span class="op">-</span>PassengerId, <span class="op">-</span>Cabin)</a></code></pre></div>
<pre><code>## # A tibble: 9 x 10
##   Survived Pclass Name        Sex     Age SibSp Parch Ticket  Fare Embarked
##   &lt;fct&gt;    &lt;fct&gt;  &lt;chr&gt;       &lt;fct&gt; &lt;dbl&gt; &lt;int&gt; &lt;int&gt; &lt;chr&gt;  &lt;dbl&gt; &lt;fct&gt;   
## 1 0        3      Thorneycro~ male     NA     1     0 376564 16.1  S       
## 2 1        3      Nilsson, M~ fema~    26     0     0 347470  7.85 S       
## 3 1        2      Faunthorpe~ fema~    29     1     0 2926   26    S       
## 4 1        3      Jansson, M~ male     21     0     0 350034  7.80 S       
## 5 0        2      Eitemiller~ male     23     0     0 29751  13    S       
## 6 0        3      Sdycoff, M~ male     NA     0     0 349222  7.90 S       
## 7 1        2      Davies, Ma~ male      8     1     1 C.A. ~ 36.8  S       
## 8 0        3      Reed, Mr. ~ male     NA     0     0 362316  7.25 S       
## 9 1        2      Leitch, Mi~ fema~    NA     0     0 248727 33    S</code></pre>
</div>
<div class="fold s o">
<div class="sourceCode" id="cb468"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb468-1" title="1"><span class="co"># for rows from number 10 to number 20, print out all columns beginning with a vowel</span></a>
<a class="sourceLine" id="cb468-2" title="2"><span class="kw">slice</span>(titanic, <span class="dv">10</span><span class="op">:</span><span class="dv">20</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(<span class="kw">matches</span>(<span class="st">&quot;^[AEIOUaeiou]&quot;</span>))</a></code></pre></div>
<pre><code>## # A tibble: 11 x 2
##      Age Embarked
##    &lt;dbl&gt; &lt;fct&gt;   
##  1    14 C       
##  2     4 S       
##  3    58 S       
##  4    20 S       
##  5    39 S       
##  6    14 S       
##  7    55 S       
##  8     2 Q       
##  9    NA S       
## 10    31 S       
## 11    NA C</code></pre>
</div>
<div class="fold s o">
<div class="sourceCode" id="cb470"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb470-1" title="1"><span class="co"># for randomly selected 10 passengers whose age is unknown, print all</span></a>
<a class="sourceLine" id="cb470-2" title="2"><span class="co"># attributes from name to ticket price, then the passenger class </span></a>
<a class="sourceLine" id="cb470-3" title="3"><span class="co"># and finally whether or not the passenger survived</span></a>
<a class="sourceLine" id="cb470-4" title="4"><span class="co"># sort the rows alphabetically by name</span></a>
<a class="sourceLine" id="cb470-5" title="5"><span class="kw">filter</span>(titanic, <span class="kw">is.na</span>(Age)) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">sample_n</span>(<span class="dv">10</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb470-6" title="6"><span class="st">  </span><span class="kw">select</span>(Name<span class="op">:</span>Fare, Pclass, Survived) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">arrange</span>(Name)</a></code></pre></div>
<pre><code>## # A tibble: 10 x 9
##    Name               Sex      Age SibSp Parch Ticket  Fare Pclass Survived
##    &lt;chr&gt;              &lt;fct&gt;  &lt;dbl&gt; &lt;int&gt; &lt;int&gt; &lt;chr&gt;  &lt;dbl&gt; &lt;fct&gt;  &lt;fct&gt;   
##  1 Boulos, Mr. Hanna  male      NA     0     0 2664    7.22 3      0       
##  2 Klaber, Mr. Herman male      NA     0     0 113028 26.6  1      0       
##  3 Lennon, Mr. Denis  male      NA     1     0 370371 15.5  3      0       
##  4 &quot;O&#39;Dwyer, Miss. E~ female    NA     0     0 330959  7.88 3      1       
##  5 Peter, Miss. Anna  female    NA     1     1 2668   22.4  3      1       
##  6 Peters, Miss. Kat~ female    NA     0     0 330935  8.14 3      0       
##  7 Plotcharsky, Mr. ~ male      NA     0     0 349227  7.90 3      0       
##  8 Razi, Mr. Raihed   male      NA     0     0 2629    7.23 3      0       
##  9 Sage, Mr. Frederi~ male      NA     8     2 CA. 2~ 69.6  3      0       
## 10 Zabour, Miss. Tha~ female    NA     1     0 2665   14.5  3      0</code></pre>
</div>
<hr />
</div>
<div id="creating-new-columns-with-mutate" class="section level2">
<h2><span class="header-section-number">11.4</span> Creating new columns with <code>mutate</code></h2>
<p>When working with datasets, there is often a need to create additional variables with the help of information stored in one or more existing variables. Most often, we create a new column using an expression that describes how we transform existing data; motivation can be the normalization of a numerical variable, the creation of an indicator or categorical variable, the summation of multiple variables into one single variable, or any other transformation in order to obtain a new variable that is in some way required for the further steps of the analysis process.</p>
<p>Assuming that we want to create a new column that stores the sum of two numerical values of the existing columns, then the base <em>R</em> syntax might look as follows:</p>
<div class="sourceCode" id="cb472"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb472-1" title="1">df<span class="op">$</span>c &lt;-<span class="st"> </span>df<span class="op">$</span>a <span class="op">+</span><span class="st"> </span>df<span class="op">$</span>b</a></code></pre></div>
<p>The <code>dplyr</code> package offers us an alternative in the form of<code>mutate</code> and <code>transmute</code> functions:</p>
<div class="sourceCode" id="cb473"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb473-1" title="1"><span class="kw">mutate</span>(df, <span class="dt">c =</span> a <span class="op">+</span><span class="st"> </span>b)</a>
<a class="sourceLine" id="cb473-2" title="2"></a>
<a class="sourceLine" id="cb473-3" title="3"><span class="kw">transmute</span>(df, <span class="dt">c =</span> a <span class="op">+</span><span class="st"> </span>b)</a></code></pre></div>
<p>Difference between these two function is that <code>mutate</code> returns the entire original data frame with newly created columns, while <code>transmute</code> retains only the columns specified inside the function call. Therefore, we can use <code>transmute</code> as a shortened combination of <code>mutate</code> and <code>select</code>:</p>
<div class="sourceCode" id="cb474"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb474-1" title="1"><span class="kw">transmute</span>(df, a, <span class="dt">c =</span> a <span class="op">+</span><span class="st"> </span>b)</a>
<a class="sourceLine" id="cb474-2" title="2"><span class="co"># same as mutate(df, c = a + b) %&gt;% select(a, c)</span></a></code></pre></div>
<p>(NOTE: We don’t have to necessarily expect a degradation of peformance here as a result of copying data frames, since <em>R</em> does a “shallow copy” when adding a column, that is, a new data frame only references a new column while retaining references to the remaining columns. If we were creating a “deep copy”, i.e. if we were copying all columns into the new frame, which would make this operation “expensive” when it comes to processing)</p>
<p>Note that <code>mutate</code> and<code>transmute</code> are not alternatives to the <em>UPDATE</em> command from <em>SQL</em>, but rather correspond to the expressions used in the <em>SELECT</em> [segment of the command in scenarios when we do not select individual columns but combine them as part of an expression part of the SQL <em>query</em>.</p>
<p>The <code>mutate</code> and <code>transmute</code> functions use common (vectorized) functions and operators, but we also have a number of additional so-called “window” functions that give us additional flexibility when creating new variables, such as:</p>
<ul>
<li><code>ntile</code>,<code>cut</code> - for transforming a numerical column into a categorical; <code>ntile</code> will make categories of the same size, while <code>cut</code> will cut the range in equally sized intervals</li>
<li><code>dense_rank</code>,<code>min_rank</code> - for ranking of observations (the difference is only in handling observations with the same values)</li>
<li><code>between</code> - for creating an indicator column explaining whether a given variable is in the interval given by two other columns</li>
<li><code>pmin</code>,<code>pmax</code> - “parallel minimum and maximum”, ie the minimum or maximum values of the selected columns viewed by individual rows</li>
<li>etc.</li>
</ul>
<p>A list of all available functions can be found in the documentation.</p>
<hr />
<p><strong>Assignment 11.5 - creating new columns</strong></p>
<div class="sourceCode" id="cb475"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb475-1" title="1"><span class="co"># add a `hadRelativesOnBoard` logical column to the` titanic` table which </span></a>
<a class="sourceLine" id="cb475-2" title="2"><span class="co"># describes whether the passenger had relatives on board</span></a>
<a class="sourceLine" id="cb475-3" title="3"></a>
<a class="sourceLine" id="cb475-4" title="4"></a>
<a class="sourceLine" id="cb475-5" title="5"><span class="co"># for randomly selected 10 passengers over the age of 20 who boarded in Southampton</span></a>
<a class="sourceLine" id="cb475-6" title="6"><span class="co"># print out passenger&#39;s name, travel class, and transformed ticket price</span></a>
<a class="sourceLine" id="cb475-7" title="7"><span class="co"># replace the ticket price with what it would cost today</span></a>
<a class="sourceLine" id="cb475-8" title="8"><span class="co"># (assume $1 of 1912 equals $23.85 today, calculating in the inflation)</span></a>
<a class="sourceLine" id="cb475-9" title="9"><span class="co"># call the new column `FareToday` </span></a>
<a class="sourceLine" id="cb475-10" title="10"><span class="co"># round the amount to two decimal places and add the prefix `$`</span></a>
<a class="sourceLine" id="cb475-11" title="11"><span class="co"># sort the result by passenger class in descending order</span></a>
<a class="sourceLine" id="cb475-12" title="12"></a>
<a class="sourceLine" id="cb475-13" title="13"></a>
<a class="sourceLine" id="cb475-14" title="14"><span class="co"># create a `FareCategory` column which puts the ticket prices</span></a>
<a class="sourceLine" id="cb475-15" title="15"><span class="co"># into five equally sized categories</span></a>
<a class="sourceLine" id="cb475-16" title="16"><span class="co"># then randomly select 20 passengers and print</span></a>
<a class="sourceLine" id="cb475-17" title="17"><span class="co"># passenger name, travel class, ticket price and category</span></a>
<a class="sourceLine" id="cb475-18" title="18"><span class="co"># sort the result by price category</span></a>
<a class="sourceLine" id="cb475-19" title="19"></a>
<a class="sourceLine" id="cb475-20" title="20"></a>
<a class="sourceLine" id="cb475-21" title="21"><span class="co"># add an `EmbarkationPort` column to the `titanic` table, which will contain</span></a>
<a class="sourceLine" id="cb475-22" title="22"><span class="co"># the full name of the port of embarkation (Southampton, Queenstown or Cherbourg)</span></a>
<a class="sourceLine" id="cb475-23" title="23"><span class="co"># use `mutate` and two `ifelse` functions</span></a>
<a class="sourceLine" id="cb475-24" title="24"></a>
<a class="sourceLine" id="cb475-25" title="25"></a>
<a class="sourceLine" id="cb475-26" title="26"><span class="co"># print the first 10 rows of the `titanic` table</span></a></code></pre></div>
<div class="fold s o">
<div class="sourceCode" id="cb476"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb476-1" title="1"><span class="co"># add a `hadRelativesOnBoard` logical column to the` titanic` table which </span></a>
<a class="sourceLine" id="cb476-2" title="2"><span class="co"># describes whether the passenger had relatives on board</span></a>
<a class="sourceLine" id="cb476-3" title="3">titanic &lt;-<span class="st"> </span><span class="kw">mutate</span>(titanic, <span class="dt">hadRelativesOnBoard =</span> SibSp<span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span> <span class="op">|</span><span class="st"> </span>Parch<span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>)</a></code></pre></div>
</div>
<div class="fold s o">
<div class="sourceCode" id="cb477"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb477-1" title="1"><span class="co"># for randomly selected 10 passengers over the age of 20 who boarded in Southampton</span></a>
<a class="sourceLine" id="cb477-2" title="2"><span class="co"># print out passenger&#39;s name, travel class, and transformed ticket price</span></a>
<a class="sourceLine" id="cb477-3" title="3"><span class="co"># replace the ticket price with what it would cost today</span></a>
<a class="sourceLine" id="cb477-4" title="4"><span class="co"># (assume $1 of 1912 equals $23.85 today, calculating in the inflation)</span></a>
<a class="sourceLine" id="cb477-5" title="5"><span class="co"># call the new column `FareToday` </span></a>
<a class="sourceLine" id="cb477-6" title="6"><span class="co"># round the amount to two decimal places and add the prefix `$`</span></a>
<a class="sourceLine" id="cb477-7" title="7"><span class="co"># sort the result by passenger class in descending order</span></a>
<a class="sourceLine" id="cb477-8" title="8"><span class="kw">filter</span>(titanic, Sex <span class="op">==</span><span class="st"> &#39;female&#39;</span>, Age<span class="op">&gt;</span><span class="st"> </span><span class="dv">20</span>, Embarked <span class="op">==</span><span class="st"> &#39;S&#39;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">sample_n</span>(<span class="dv">10</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb477-9" title="9"><span class="kw">transmute</span>(Name, Pclass, <span class="dt">FareToday =</span> <span class="kw">str_c</span>(<span class="st">&quot;$&quot;</span>, <span class="kw">round</span>(Fare <span class="op">*</span><span class="st"> </span><span class="fl">23.85</span>, <span class="dv">2</span>))) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">arrange</span>(<span class="kw">desc</span>(Pclass))</a></code></pre></div>
<pre><code>## # A tibble: 10 x 3
##    Name                                                Pclass FareToday
##    &lt;chr&gt;                                               &lt;fct&gt;  &lt;chr&gt;    
##  1 &quot;Ford, Miss. Doolina Margaret \&quot;Daisy\&quot;&quot;            3      $819.84  
##  2 Sandstrom, Mrs. Hjalmar (Agnes Charlotta Bengtsson) 3      $398.3   
##  3 Panula, Mrs. Juha (Maria Emilia Ojala)              3      $946.55  
##  4 Jussila, Miss. Mari Aina                            3      $234.33  
##  5 Stanley, Miss. Amy Zillah Elsie                     3      $180.07  
##  6 Honkanen, Miss. Eliina                              3      $189.01  
##  7 Nilsson, Miss. Helmina Josefina                     3      $187.32  
##  8 Davis, Miss. Mary                                   2      $310.05  
##  9 Leader, Dr. Alice (Farnham)                         1      $618.41  
## 10 Carter, Mrs. William Ernest (Lucile Polk)           1      $2862</code></pre>
</div>
<div class="fold s o">
<div class="sourceCode" id="cb479"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb479-1" title="1"><span class="co"># create a `FareCategory` column which puts the ticket prices</span></a>
<a class="sourceLine" id="cb479-2" title="2"><span class="co"># into five equally sized categories</span></a>
<a class="sourceLine" id="cb479-3" title="3"><span class="co"># then randomly select 20 passengers and print</span></a>
<a class="sourceLine" id="cb479-4" title="4"><span class="co"># passenger name, travel class, ticket price and category</span></a>
<a class="sourceLine" id="cb479-5" title="5"><span class="co"># sort the result by price category</span></a>
<a class="sourceLine" id="cb479-6" title="6"><span class="kw">mutate</span>(titanic, <span class="dt">FareCategory =</span> <span class="kw">ntile</span>(Fare, <span class="dv">5</span>)) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">sample_n</span>(<span class="dv">20</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb479-7" title="7"><span class="kw">select</span>(Name, Pclass, Fare, FareCategory) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">arrange</span>(FareCategory)</a></code></pre></div>
<pre><code>## # A tibble: 20 x 4
##    Name                                          Pclass   Fare FareCategory
##    &lt;chr&gt;                                         &lt;fct&gt;   &lt;dbl&gt;        &lt;int&gt;
##  1 Charters, Mr. David                           3        7.73            1
##  2 Connolly, Miss. Kate                          3        7.75            1
##  3 Connaghton, Mr. Michael                       3        7.75            1
##  4 Youseff, Mr. Gerious                          3        7.22            1
##  5 Lemore, Mrs. (Amelia Milley)                  2       10.5             2
##  6 Lievens, Mr. Rene Aime                        3        9.5             2
##  7 Larsson, Mr. August Viktor                    3        9.48            2
##  8 Meyer, Mr. August                             2       13               3
##  9 Lindell, Mr. Edvard Bengtsson                 3       15.6             3
## 10 Jerwan, Mrs. Amin S (Marie Marthe Thuillard)  2       13.8             3
## 11 Chapman, Mr. Charles Henry                    2       13.5             3
## 12 Blackwell, Mr. Stephen Weart                  1       35.5             4
## 13 Moran, Miss. Bertha                           3       24.2             4
## 14 Collyer, Mrs. Harvey (Charlotte Annie Tate)   2       26.2             4
## 15 Chip, Mr. Chang                               3       56.5             5
## 16 Chaffee, Mr. Herbert Fuller                   1       61.2             5
## 17 Bissette, Miss. Amelia                        1      136.              5
## 18 Endres, Miss. Caroline Louise                 1      228.              5
## 19 Allison, Mrs. Hudson J C (Bessie Waldo Danie~ 1      152.              5
## 20 Carter, Master. William Thornton II           1      120               5</code></pre>
</div>
<div class="fold s o">
<div class="sourceCode" id="cb481"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb481-1" title="1"><span class="co"># add an `EmbarkationPort` column to the `titanic` table, which will contain</span></a>
<a class="sourceLine" id="cb481-2" title="2"><span class="co"># the full name of the port of embarkation (Southampton, Queenstown or Cherbourg)</span></a>
<a class="sourceLine" id="cb481-3" title="3"><span class="co"># use `mutate` and two `ifelse` functions</span></a>
<a class="sourceLine" id="cb481-4" title="4"><span class="kw">mutate</span>(titanic, <span class="dt">EmbarkationPort =</span> <span class="kw">ifelse</span>(Embarked <span class="op">==</span><span class="st"> &#39;S&#39;</span>, <span class="st">&#39;Southampton&#39;</span>,</a>
<a class="sourceLine" id="cb481-5" title="5">            <span class="kw">ifelse</span>(Embarked <span class="op">==</span><span class="st"> &#39;C&#39;</span>, <span class="st">&#39;Cherbourg&#39;</span>, <span class="st">&#39;Queenstown&#39;</span>))) -&gt;<span class="st"> </span>titanic</a>
<a class="sourceLine" id="cb481-6" title="6"></a>
<a class="sourceLine" id="cb481-7" title="7"><span class="co"># print the first 10 rows of the `titanic` table</span></a>
<a class="sourceLine" id="cb481-8" title="8"><span class="kw">head</span>(titanic, <span class="dv">10</span>)</a></code></pre></div>
<pre><code>## # A tibble: 10 x 14
##    PassengerId Survived Pclass Name  Sex     Age SibSp Parch Ticket  Fare
##          &lt;int&gt; &lt;fct&gt;    &lt;fct&gt;  &lt;chr&gt; &lt;fct&gt; &lt;dbl&gt; &lt;int&gt; &lt;int&gt; &lt;chr&gt;  &lt;dbl&gt;
##  1           1 0        3      Brau~ male     22     1     0 A/5 2~  7.25
##  2           2 1        1      Cumi~ fema~    38     1     0 PC 17~ 71.3 
##  3           3 1        3      Heik~ fema~    26     0     0 STON/~  7.92
##  4           4 1        1      Futr~ fema~    35     1     0 113803 53.1 
##  5           5 0        3      Alle~ male     35     0     0 373450  8.05
##  6           6 0        3      Mora~ male     NA     0     0 330877  8.46
##  7           7 0        1      McCa~ male     54     0     0 17463  51.9 
##  8           8 0        3      Pals~ male      2     3     1 349909 21.1 
##  9           9 1        3      John~ fema~    27     0     2 347742 11.1 
## 10          10 1        2      Nass~ fema~    14     1     0 237736 30.1 
## # ... with 4 more variables: Cabin &lt;chr&gt;, Embarked &lt;fct&gt;,
## #   hadRelativesOnBoard &lt;lgl&gt;, EmbarkationPort &lt;chr&gt;</code></pre>
</div>
</div>
<div id="sample-dataset-houston-flights" class="section level2">
<h2><span class="header-section-number">11.5</span> Sample Dataset: <em>Houston flights</em></h2>
<p>Let’s now load the <code>hflights</code> data frame, which is in a package of the same name and can be retrieved from the CRAN repository. After loading the package, we can move the data frame to the global environment with the help of the <code>data</code> function.</p>
<hr />
<p><strong>Assignment 11.6 - dataset <code>hflights</code></strong></p>
<div class="sourceCode" id="cb483"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb483-1" title="1"><span class="co"># load the `hflights` package</span></a>
<a class="sourceLine" id="cb483-2" title="2"><span class="co"># if necessary install it from the CRAN repository</span></a>
<a class="sourceLine" id="cb483-3" title="3"><span class="co"># put the `hflights` data frame in the global environment using the `data` function</span></a>
<a class="sourceLine" id="cb483-4" title="4"></a>
<a class="sourceLine" id="cb483-5" title="5"><span class="co"># convert the frame to `hflights` into a &#39;tibble&#39;</span></a>
<a class="sourceLine" id="cb483-6" title="6"></a>
<a class="sourceLine" id="cb483-7" title="7"><span class="co"># briefly explore the `hflights` dataset</span></a>
<a class="sourceLine" id="cb483-8" title="8"><span class="co"># you can also check the documentation with the help of command `?hflights`</span></a></code></pre></div>
<div class="fold s o">
<div class="sourceCode" id="cb484"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb484-1" title="1"><span class="co"># install.packages(&quot;hflights&quot;)  #if necessary</span></a>
<a class="sourceLine" id="cb484-2" title="2"><span class="co">#library(dplyr) # if not already loaded</span></a>
<a class="sourceLine" id="cb484-3" title="3"><span class="co">#library(hflights)</span></a>
<a class="sourceLine" id="cb484-4" title="4"><span class="kw">data</span>(hflights)</a>
<a class="sourceLine" id="cb484-5" title="5"></a>
<a class="sourceLine" id="cb484-6" title="6"><span class="co"># convert the frame to `hflights` in &#39;tibble&#39;</span></a>
<a class="sourceLine" id="cb484-7" title="7">hflights &lt;-<span class="st"> </span><span class="kw">as_tibble</span>(hflights)</a>
<a class="sourceLine" id="cb484-8" title="8"></a>
<a class="sourceLine" id="cb484-9" title="9"><span class="kw">glimpse</span>(hflights)</a>
<a class="sourceLine" id="cb484-10" title="10"><span class="kw">head</span>(hflights)</a></code></pre></div>
<pre><code>## Observations: 227,496
## Variables: 21
## $ Year              &lt;int&gt; 2011, 2011, 2011, 2011, 2011, 2011, 2011, 20...
## $ Month             &lt;int&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,...
## $ DayofMonth        &lt;int&gt; 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 1...
## $ DayOfWeek         &lt;int&gt; 6, 7, 1, 2, 3, 4, 5, 6, 7, 1, 2, 3, 4, 5, 6,...
## $ DepTime           &lt;int&gt; 1400, 1401, 1352, 1403, 1405, 1359, 1359, 13...
## $ ArrTime           &lt;int&gt; 1500, 1501, 1502, 1513, 1507, 1503, 1509, 14...
## $ UniqueCarrier     &lt;chr&gt; &quot;AA&quot;, &quot;AA&quot;, &quot;AA&quot;, &quot;AA&quot;, &quot;AA&quot;, &quot;AA&quot;, &quot;AA&quot;, &quot;A...
## $ FlightNum         &lt;int&gt; 428, 428, 428, 428, 428, 428, 428, 428, 428,...
## $ TailNum           &lt;chr&gt; &quot;N576AA&quot;, &quot;N557AA&quot;, &quot;N541AA&quot;, &quot;N403AA&quot;, &quot;N49...
## $ ActualElapsedTime &lt;int&gt; 60, 60, 70, 70, 62, 64, 70, 59, 71, 70, 70, ...
## $ AirTime           &lt;int&gt; 40, 45, 48, 39, 44, 45, 43, 40, 41, 45, 42, ...
## $ ArrDelay          &lt;int&gt; -10, -9, -8, 3, -3, -7, -1, -16, 44, 43, 29,...
## $ DepDelay          &lt;int&gt; 0, 1, -8, 3, 5, -1, -1, -5, 43, 43, 29, 19, ...
## $ Origin            &lt;chr&gt; &quot;IAH&quot;, &quot;IAH&quot;, &quot;IAH&quot;, &quot;IAH&quot;, &quot;IAH&quot;, &quot;IAH&quot;, &quot;I...
## $ Dest              &lt;chr&gt; &quot;DFW&quot;, &quot;DFW&quot;, &quot;DFW&quot;, &quot;DFW&quot;, &quot;DFW&quot;, &quot;DFW&quot;, &quot;D...
## $ Distance          &lt;int&gt; 224, 224, 224, 224, 224, 224, 224, 224, 224,...
## $ TaxiIn            &lt;int&gt; 7, 6, 5, 9, 9, 6, 12, 7, 8, 6, 8, 4, 6, 5, 6...
## $ TaxiOut           &lt;int&gt; 13, 9, 17, 22, 9, 13, 15, 12, 22, 19, 20, 11...
## $ Cancelled         &lt;int&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,...
## $ CancellationCode  &lt;chr&gt; &quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;, ...
## $ Diverted          &lt;int&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,...
## # A tibble: 6 x 21
##    Year Month DayofMonth DayOfWeek DepTime ArrTime UniqueCarrier FlightNum
##   &lt;int&gt; &lt;int&gt;      &lt;int&gt;     &lt;int&gt;   &lt;int&gt;   &lt;int&gt; &lt;chr&gt;             &lt;int&gt;
## 1  2011     1          1         6    1400    1500 AA                  428
## 2  2011     1          2         7    1401    1501 AA                  428
## 3  2011     1          3         1    1352    1502 AA                  428
## 4  2011     1          4         2    1403    1513 AA                  428
## 5  2011     1          5         3    1405    1507 AA                  428
## 6  2011     1          6         4    1359    1503 AA                  428
## # ... with 13 more variables: TailNum &lt;chr&gt;, ActualElapsedTime &lt;int&gt;,
## #   AirTime &lt;int&gt;, ArrDelay &lt;int&gt;, DepDelay &lt;int&gt;, Origin &lt;chr&gt;,
## #   Dest &lt;chr&gt;, Distance &lt;int&gt;, TaxiIn &lt;int&gt;, TaxiOut &lt;int&gt;,
## #   Cancelled &lt;int&gt;, CancellationCode &lt;chr&gt;, Diverted &lt;int&gt;</code></pre>
</div>
<hr />
</div>
<div id="grouping-and-aggregation-with-group_by-andsummarise" class="section level2">
<h2><span class="header-section-number">11.6</span> Grouping and aggregation with <code>group_by</code> and<code>summarise</code></h2>
<p>In the data analysis literature, we will often come across a so-called SAC paradigm (<em>Split-Apply-Combine</em>). It’s a strategy that comes down to breaking down a big task into smaller parts, doing some work on each part, and finally combining all the results into a single whole. The need for this paradigm is found in different analysis scenarios - in exploratory data analysis we will want to calculate different statistics or create new variables separately for different subsets of data (eg, depending on a category variable); When processing extremely large amounts of data, we often want to speed up the processing process by breaking the data into smaller sets that will each be processed separately (the well-known <em>Map-Reduce</em> principle).</p>
<p>Users of <em>SQL</em> will easily recognize this principle as grouping and aggregation, which are carried out through the <em>GROUP BY</em> segment of an <em>SQL</em> query with the accompanying elements in the <em>SELECT</em> part. The <code>dplyr</code> package offers very similar functionality (albeit in a procedural way) - we first perform “grouping”, i.e. create subsets of rows of a frame, and then carry out further processing in parallel over each subset, to collect all the results in a single dataframe.</p>
<p>For grouping, <code>dplyr</code> offers the<code>group_by</code> function, which converts a table (data frame) into a <code>grouped table (</code>grouped_tbl`):</p>
<div class="sourceCode" id="cb486"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb486-1" title="1"><span class="kw">group_by</span>(df, a, b, c)</a></code></pre></div>
<p>Let’s try this feature on our <code>hflights</code> framework.</p>
<hr />
<p><strong>Assignment 11.7 - grouped table</strong></p>
<div class="sourceCode" id="cb487"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb487-1" title="1"><span class="co"># create a `flight815` variable that will contain rows from the `hflights` data frame</span></a>
<a class="sourceLine" id="cb487-2" title="2"><span class="co"># related to flight number 815</span></a>
<a class="sourceLine" id="cb487-3" title="3"></a>
<a class="sourceLine" id="cb487-4" title="4"><span class="co"># create a `grouped815` variable that will contain rows from `flight815`</span></a>
<a class="sourceLine" id="cb487-5" title="5"><span class="co"># grouped by month</span></a>
<a class="sourceLine" id="cb487-6" title="6"></a>
<a class="sourceLine" id="cb487-7" title="7"><span class="co"># check the class of variables `flight815` and `grouped815`</span></a>
<a class="sourceLine" id="cb487-8" title="8"></a>
<a class="sourceLine" id="cb487-9" title="9"></a>
<a class="sourceLine" id="cb487-10" title="10"><span class="co"># briefly explore the `flight815` and `grouped815` variable structures </span></a>
<a class="sourceLine" id="cb487-11" title="11"><span class="co"># with the help of the `glimpse` function</span></a></code></pre></div>
<div class="fold s o">
<div class="sourceCode" id="cb488"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb488-1" title="1"><span class="co"># create a `flight815` variable that will contain rows from the `hflights` data frame</span></a>
<a class="sourceLine" id="cb488-2" title="2"><span class="co"># related to flight number 815</span></a>
<a class="sourceLine" id="cb488-3" title="3">flight815 &lt;-<span class="st"> </span><span class="kw">filter</span>(hflights, FlightNum <span class="op">==</span><span class="st"> </span><span class="dv">815</span>)</a>
<a class="sourceLine" id="cb488-4" title="4"></a>
<a class="sourceLine" id="cb488-5" title="5"><span class="co"># create a `grouped815` variable that will contain rows from `flight815`</span></a>
<a class="sourceLine" id="cb488-6" title="6"><span class="co"># grouped by month</span></a>
<a class="sourceLine" id="cb488-7" title="7"></a>
<a class="sourceLine" id="cb488-8" title="8">grouped815 &lt;-<span class="st"> </span><span class="kw">group_by</span>(flight815, Month)</a>
<a class="sourceLine" id="cb488-9" title="9"></a>
<a class="sourceLine" id="cb488-10" title="10"><span class="co"># check the class of variables `flight815` and `grouped815`</span></a>
<a class="sourceLine" id="cb488-11" title="11"><span class="kw">class</span>(flight815)</a>
<a class="sourceLine" id="cb488-12" title="12"><span class="kw">class</span>(grouped815)</a></code></pre></div>
<pre><code>## [1] &quot;tbl_df&quot;     &quot;tbl&quot;        &quot;data.frame&quot;
## [1] &quot;grouped_df&quot; &quot;tbl_df&quot;     &quot;tbl&quot;        &quot;data.frame&quot;</code></pre>
</div>
<div class="fold s o">
<div class="sourceCode" id="cb490"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb490-1" title="1"><span class="co"># briefly explore the `flight815` and `grouped815` variable structures </span></a>
<a class="sourceLine" id="cb490-2" title="2"><span class="co"># with the help of the `glimpse` function</span></a>
<a class="sourceLine" id="cb490-3" title="3"><span class="kw">glimpse</span>(flight815)</a>
<a class="sourceLine" id="cb490-4" title="4"><span class="kw">print</span>(<span class="st">&quot;------------------------&quot;</span>) <span class="co"># for more transparent printing on the console</span></a>
<a class="sourceLine" id="cb490-5" title="5"><span class="kw">glimpse</span>(grouped815)</a></code></pre></div>
<pre><code>## Observations: 95
## Variables: 21
## $ Year              &lt;int&gt; 2011, 2011, 2011, 2011, 2011, 2011, 2011, 20...
## $ Month             &lt;int&gt; 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4,...
## $ DayofMonth        &lt;int&gt; 30, 29, 28, 27, 26, 25, 24, 23, 22, 21, 20, ...
## $ DayOfWeek         &lt;int&gt; 6, 5, 4, 3, 2, 1, 7, 6, 5, 4, 3, 2, 1, 7, 6,...
## $ DepTime           &lt;int&gt; 2116, 2109, 2111, 2112, 2124, 2145, 2114, 21...
## $ ArrTime           &lt;int&gt; 2255, 2252, 2255, 2326, 2321, 2327, 2324, 23...
## $ UniqueCarrier     &lt;chr&gt; &quot;CO&quot;, &quot;CO&quot;, &quot;CO&quot;, &quot;CO&quot;, &quot;CO&quot;, &quot;CO&quot;, &quot;CO&quot;, &quot;C...
## $ FlightNum         &lt;int&gt; 815, 815, 815, 815, 815, 815, 815, 815, 815,...
## $ TailNum           &lt;chr&gt; &quot;N74856&quot;, &quot;N57852&quot;, &quot;N78866&quot;, &quot;N57863&quot;, &quot;N57...
## $ ActualElapsedTime &lt;int&gt; 219, 223, 224, 254, 237, 222, 250, 231, 229,...
## $ AirTime           &lt;int&gt; 194, 191, 190, 197, 198, 200, 192, 187, 186,...
## $ ArrDelay          &lt;int&gt; 12, 6, 9, 40, 35, 41, 38, 18, 19, 10, 29, 33...
## $ DepDelay          &lt;int&gt; 6, -1, 1, 2, 14, 35, 4, 0, 6, 9, 6, 17, 38, ...
## $ Origin            &lt;chr&gt; &quot;IAH&quot;, &quot;IAH&quot;, &quot;IAH&quot;, &quot;IAH&quot;, &quot;IAH&quot;, &quot;IAH&quot;, &quot;I...
## $ Dest              &lt;chr&gt; &quot;LAX&quot;, &quot;LAX&quot;, &quot;LAX&quot;, &quot;LAX&quot;, &quot;LAX&quot;, &quot;LAX&quot;, &quot;L...
## $ Distance          &lt;int&gt; 1379, 1379, 1379, 1379, 1379, 1379, 1379, 13...
## $ TaxiIn            &lt;int&gt; 10, 13, 15, 18, 12, 10, 14, 19, 12, 12, 20, ...
## $ TaxiOut           &lt;int&gt; 15, 19, 19, 39, 27, 12, 44, 25, 31, 13, 39, ...
## $ Cancelled         &lt;int&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,...
## $ CancellationCode  &lt;chr&gt; &quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;, ...
## $ Diverted          &lt;int&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,...
## [1] &quot;------------------------&quot;
## Observations: 95
## Variables: 21
## Groups: Month [6]
## $ Year              &lt;int&gt; 2011, 2011, 2011, 2011, 2011, 2011, 2011, 20...
## $ Month             &lt;int&gt; 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4,...
## $ DayofMonth        &lt;int&gt; 30, 29, 28, 27, 26, 25, 24, 23, 22, 21, 20, ...
## $ DayOfWeek         &lt;int&gt; 6, 5, 4, 3, 2, 1, 7, 6, 5, 4, 3, 2, 1, 7, 6,...
## $ DepTime           &lt;int&gt; 2116, 2109, 2111, 2112, 2124, 2145, 2114, 21...
## $ ArrTime           &lt;int&gt; 2255, 2252, 2255, 2326, 2321, 2327, 2324, 23...
## $ UniqueCarrier     &lt;chr&gt; &quot;CO&quot;, &quot;CO&quot;, &quot;CO&quot;, &quot;CO&quot;, &quot;CO&quot;, &quot;CO&quot;, &quot;CO&quot;, &quot;C...
## $ FlightNum         &lt;int&gt; 815, 815, 815, 815, 815, 815, 815, 815, 815,...
## $ TailNum           &lt;chr&gt; &quot;N74856&quot;, &quot;N57852&quot;, &quot;N78866&quot;, &quot;N57863&quot;, &quot;N57...
## $ ActualElapsedTime &lt;int&gt; 219, 223, 224, 254, 237, 222, 250, 231, 229,...
## $ AirTime           &lt;int&gt; 194, 191, 190, 197, 198, 200, 192, 187, 186,...
## $ ArrDelay          &lt;int&gt; 12, 6, 9, 40, 35, 41, 38, 18, 19, 10, 29, 33...
## $ DepDelay          &lt;int&gt; 6, -1, 1, 2, 14, 35, 4, 0, 6, 9, 6, 17, 38, ...
## $ Origin            &lt;chr&gt; &quot;IAH&quot;, &quot;IAH&quot;, &quot;IAH&quot;, &quot;IAH&quot;, &quot;IAH&quot;, &quot;IAH&quot;, &quot;I...
## $ Dest              &lt;chr&gt; &quot;LAX&quot;, &quot;LAX&quot;, &quot;LAX&quot;, &quot;LAX&quot;, &quot;LAX&quot;, &quot;LAX&quot;, &quot;L...
## $ Distance          &lt;int&gt; 1379, 1379, 1379, 1379, 1379, 1379, 1379, 13...
## $ TaxiIn            &lt;int&gt; 10, 13, 15, 18, 12, 10, 14, 19, 12, 12, 20, ...
## $ TaxiOut           &lt;int&gt; 15, 19, 19, 39, 27, 12, 44, 25, 31, 13, 39, ...
## $ Cancelled         &lt;int&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,...
## $ CancellationCode  &lt;chr&gt; &quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;, ...
## $ Diverted          &lt;int&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,...</code></pre>
</div>
<div class="fold s o">
<div class="sourceCode" id="cb492"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb492-1" title="1"><span class="co"># print the first five rows of the `flight815` variable</span></a>
<a class="sourceLine" id="cb492-2" title="2"><span class="kw">head</span>(flight815)</a>
<a class="sourceLine" id="cb492-3" title="3"></a>
<a class="sourceLine" id="cb492-4" title="4"><span class="kw">print</span>( <span class="st">&quot;------------------------&quot;</span>)</a>
<a class="sourceLine" id="cb492-5" title="5"></a>
<a class="sourceLine" id="cb492-6" title="6"><span class="co"># print the first five rows of the `grouped815` variable</span></a>
<a class="sourceLine" id="cb492-7" title="7"><span class="kw">head</span>(grouped815)</a></code></pre></div>
<pre><code>## # A tibble: 6 x 21
##    Year Month DayofMonth DayOfWeek DepTime ArrTime UniqueCarrier FlightNum
##   &lt;int&gt; &lt;int&gt;      &lt;int&gt;     &lt;int&gt;   &lt;int&gt;   &lt;int&gt; &lt;chr&gt;             &lt;int&gt;
## 1  2011     4         30         6    2116    2255 CO                  815
## 2  2011     4         29         5    2109    2252 CO                  815
## 3  2011     4         28         4    2111    2255 CO                  815
## 4  2011     4         27         3    2112    2326 CO                  815
## 5  2011     4         26         2    2124    2321 CO                  815
## 6  2011     4         25         1    2145    2327 CO                  815
## # ... with 13 more variables: TailNum &lt;chr&gt;, ActualElapsedTime &lt;int&gt;,
## #   AirTime &lt;int&gt;, ArrDelay &lt;int&gt;, DepDelay &lt;int&gt;, Origin &lt;chr&gt;,
## #   Dest &lt;chr&gt;, Distance &lt;int&gt;, TaxiIn &lt;int&gt;, TaxiOut &lt;int&gt;,
## #   Cancelled &lt;int&gt;, CancellationCode &lt;chr&gt;, Diverted &lt;int&gt;
## [1] &quot;------------------------&quot;
## # A tibble: 6 x 21
## # Groups:   Month [1]
##    Year Month DayofMonth DayOfWeek DepTime ArrTime UniqueCarrier FlightNum
##   &lt;int&gt; &lt;int&gt;      &lt;int&gt;     &lt;int&gt;   &lt;int&gt;   &lt;int&gt; &lt;chr&gt;             &lt;int&gt;
## 1  2011     4         30         6    2116    2255 CO                  815
## 2  2011     4         29         5    2109    2252 CO                  815
## 3  2011     4         28         4    2111    2255 CO                  815
## 4  2011     4         27         3    2112    2326 CO                  815
## 5  2011     4         26         2    2124    2321 CO                  815
## 6  2011     4         25         1    2145    2327 CO                  815
## # ... with 13 more variables: TailNum &lt;chr&gt;, ActualElapsedTime &lt;int&gt;,
## #   AirTime &lt;int&gt;, ArrDelay &lt;int&gt;, DepDelay &lt;int&gt;, Origin &lt;chr&gt;,
## #   Dest &lt;chr&gt;, Distance &lt;int&gt;, TaxiIn &lt;int&gt;, TaxiOut &lt;int&gt;,
## #   Cancelled &lt;int&gt;, CancellationCode &lt;chr&gt;, Diverted &lt;int&gt;</code></pre>
</div>
<hr />
<p>We see that by grouping we have not “lost” any information - the grouped data frame still looks identical to the original, “non-grouped” frame. In fact, the only indication that something is different is the new, inherited class and the <code>Groups: ..</code> line in the structure print. This means that grouping a frame is merely an indication that some further (most often aggregation) operations are not necessarily performed over the entire data frame, but over individual groups. Also, if we want, we can always easily “ungroup” the frame with the help of the <code>ungroup</code> function.</p>
<p>For aggregation, we use the <code>summarise</code> function that receives data (a grouped table) and then combinations of aggregation functions and columns over which they are executed, for example:</p>
<div class="sourceCode" id="cb494"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb494-1" title="1"><span class="kw">summarise</span>(df, <span class="dt">meanA =</span> <span class="kw">mean</span>(a), <span class="dt">sdA =</span> <span class="kw">sd</span>(a))</a></code></pre></div>
<p>As a rule, for the aggregation function we can use any function that reduces a vector to a single value (eg <code>mean</code>,<code>max</code>, <code>sd</code> etc.). Also, <code>dplyr</code> offers some useful functions like:</p>
<ul>
<li><code>first</code>,<code>last</code>, <code>nth</code> - retreieves the first, last, or n-th element of the group</li>
<li><code>n</code>,<code>n_distinct</code> - counts the number of (distinct) values</li>
</ul>
<hr />
<p><strong>Assignment 11.8 - function <code>summarise</code> </strong></p>
<div class="sourceCode" id="cb495"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb495-1" title="1"><span class="co"># calculate the average flight arrival delay for the data frames `flight815` and` grouped815`</span></a>
<a class="sourceLine" id="cb495-2" title="2"><span class="co"># use the `summarise` function</span></a></code></pre></div>
<div class="fold s o">
<div class="sourceCode" id="cb496"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb496-1" title="1"><span class="kw">summarise</span>(flight815, <span class="dt">meanDelay =</span> <span class="kw">mean</span>(ArrDelay))</a>
<a class="sourceLine" id="cb496-2" title="2"><span class="kw">print</span>( <span class="st">&quot;------------------------&quot;</span>)</a>
<a class="sourceLine" id="cb496-3" title="3"><span class="kw">summarise</span>(grouped815, <span class="dt">meanDelay =</span> <span class="kw">mean</span>(ArrDelay))</a></code></pre></div>
<pre><code>## # A tibble: 1 x 1
##   meanDelay
##       &lt;dbl&gt;
## 1      21.6
## [1] &quot;------------------------&quot;
## # A tibble: 6 x 2
##   Month meanDelay
##   &lt;int&gt;     &lt;dbl&gt;
## 1     4      21.1
## 2     5      20.9
## 3     6      28.0
## 4     8     -27.5
## 5     9      14  
## 6    10     -13</code></pre>
</div>
<p>Note that it is advisable to name the aggregated columns.</p>
<hr />
<p>In practice, we usually do not create separate “grouped” data frames but rather we carry out the entire process of selecting rows and columns, grouping, and performing aggregation in a single command. If we use the operator <code>%&gt;%</code>, then it a possible example might look like this:</p>
<div class="sourceCode" id="cb498"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb498-1" title="1"><span class="kw">filter</span>(df, a<span class="op">&gt;</span><span class="st"> </span><span class="dv">5</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">group_by</span>(a, b) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">summarise</span>(<span class="dt">meanC =</span> <span class="kw">mean</span>(c)) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">arrange</span>(<span class="kw">desc</span>(b))</a></code></pre></div>
<p>Finally, let us reiterate the readily apparent similarity of the above expression with <em>SQL</em> queries in relational databases, with the essential difference that we perform operations here procedurally, which greatly increases readability and allows us to easily store and check the intermediate result at any time.</p>
<p>Now let’s try to take advantage of all the current knowledge of the <code>dplyr</code> package and solve the following examples. All tasks are related to the entire <code>hflights</code> dataset.</p>
<hr />
<p><strong>Assignment 11.9 - advanced queries</strong></p>
<div class="sourceCode" id="cb499"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb499-1" title="1"><span class="co"># print out how many flights were canceled because of</span></a>
<a class="sourceLine" id="cb499-2" title="2"><span class="co"># bad weather in each month</span></a>
<a class="sourceLine" id="cb499-3" title="3"><span class="co"># result table must have contain only columns called</span></a>
<a class="sourceLine" id="cb499-4" title="4"><span class="co"># `Month` and` BadWeatherCancellations`</span></a>
<a class="sourceLine" id="cb499-5" title="5"></a>
<a class="sourceLine" id="cb499-6" title="6"><span class="co"># print out the average time of arrival delay</span></a>
<a class="sourceLine" id="cb499-7" title="7"><span class="co"># for departing flights to airports</span></a>
<a class="sourceLine" id="cb499-8" title="8"><span class="co"># LAX, JFK and LGA on different days of the week</span></a>
<a class="sourceLine" id="cb499-9" title="9"><span class="co"># name the new column &#39;MeanArrDelay&#39;</span></a>
<a class="sourceLine" id="cb499-10" title="10"><span class="co"># ignore rows with NA values</span></a>
<a class="sourceLine" id="cb499-11" title="11"><span class="co"># sort the result by descending average delay time</span></a></code></pre></div>
<div class="fold s o">
<div class="sourceCode" id="cb500"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb500-1" title="1"><span class="co"># print out how many flights were canceled because of</span></a>
<a class="sourceLine" id="cb500-2" title="2"><span class="co"># bad weather in each month</span></a>
<a class="sourceLine" id="cb500-3" title="3"><span class="co"># result table must have contain only columns called</span></a>
<a class="sourceLine" id="cb500-4" title="4"><span class="co"># `Month` and` BadWeatherCancellations`</span></a>
<a class="sourceLine" id="cb500-5" title="5"><span class="kw">filter</span>(hflights, CancellationCode <span class="op">==</span><span class="st"> &#39;B&#39;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb500-6" title="6"><span class="st">  </span><span class="kw">group_by</span>(Month) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb500-7" title="7"><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">BadWeatherCancellations =</span> <span class="kw">n</span>())</a></code></pre></div>
<pre><code>## # A tibble: 12 x 2
##    Month BadWeatherCancellations
##    &lt;int&gt;                   &lt;int&gt;
##  1     1                     149
##  2     2                     929
##  3     3                      50
##  4     4                      40
##  5     5                     106
##  6     6                      49
##  7     7                      29
##  8     8                     108
##  9     9                      38
## 10    10                      46
## 11    11                      13
## 12    12                      95</code></pre>
</div>
<div class="fold s o">
<div class="sourceCode" id="cb502"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb502-1" title="1"><span class="co"># print out the average time of arrival delay</span></a>
<a class="sourceLine" id="cb502-2" title="2"><span class="co"># for departing flights to airports</span></a>
<a class="sourceLine" id="cb502-3" title="3"><span class="co"># LAX, JFK and LGA on different days of the week</span></a>
<a class="sourceLine" id="cb502-4" title="4"><span class="co"># name the new column &#39;MeanArrDelay&#39;</span></a>
<a class="sourceLine" id="cb502-5" title="5"><span class="co"># ignore rows with NA values</span></a>
<a class="sourceLine" id="cb502-6" title="6"><span class="co"># sort the result by descending average delay time</span></a>
<a class="sourceLine" id="cb502-7" title="7"><span class="kw">filter</span>(hflights, Dest <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&#39;LAX&#39;</span>, <span class="st">&#39;JFK&#39;</span>, <span class="st">&#39;LGA&#39;</span>)) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">group_by</span>(DayOfWeek, Dest) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb502-8" title="8"><span class="kw">summarise</span>(<span class="dt">MeanArrDelay =</span> <span class="kw">round</span>(<span class="kw">mean</span>(ArrDelay,</a>
<a class="sourceLine" id="cb502-9" title="9">         <span class="dt">na.rm =</span> T), <span class="dv">2</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb502-10" title="10"><span class="st">         </span><span class="kw">ungroup</span>() <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">arrange</span>(<span class="kw">desc</span>(MeanArrDelay))</a></code></pre></div>
<pre><code>## # A tibble: 21 x 3
##    DayOfWeek Dest  MeanArrDelay
##        &lt;int&gt; &lt;chr&gt;        &lt;dbl&gt;
##  1         4 LGA          21.3 
##  2         4 JFK          17.2 
##  3         5 LGA          13.6 
##  4         1 LGA          13.5 
##  5         7 JFK          10.8 
##  6         1 LAX          10.7 
##  7         3 LGA          10.5 
##  8         4 LAX          10.3 
##  9         2 LGA           9.85
## 10         6 JFK           9.76
## # ... with 11 more rows</code></pre>
</div>
<p><strong>Assignment 11.10 - advanced queries (2)</strong></p>
<div class="sourceCode" id="cb504"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb504-1" title="1"><span class="co"># in the tasks that follow, imagine you wrote your own </span></a>
<a class="sourceLine" id="cb504-2" title="2"><span class="co"># function that finds the most common category:</span></a>
<a class="sourceLine" id="cb504-3" title="3">mostFreqValue &lt;-<span class="st"> </span><span class="cf">function</span>(x) <span class="kw">table</span>(x) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">sort</span>(<span class="dt">decreasing =</span> T) <span class="op">%&gt;%</span><span class="st"> </span>names<span class="op">%&gt;%</span><span class="st"> `</span><span class="dt">[</span><span class="st">`</span>(<span class="dv">1</span>)</a>
<a class="sourceLine" id="cb504-4" title="4"></a>
<a class="sourceLine" id="cb504-5" title="5"></a>
<a class="sourceLine" id="cb504-6" title="6"><span class="co"># in the `hflights` table, divide the delay time</span></a>
<a class="sourceLine" id="cb504-7" title="7"><span class="co"># in 10 categories with the help of the `ntile` function</span></a>
<a class="sourceLine" id="cb504-8" title="8"><span class="co"># call the new column `ArrDelayCatId`</span></a>
<a class="sourceLine" id="cb504-9" title="9"><span class="co"># then print all the category ids,</span></a>
<a class="sourceLine" id="cb504-10" title="10"><span class="co"># total number of flights within a category,</span></a>
<a class="sourceLine" id="cb504-11" title="11"><span class="co"># minimum and maximum time of arrival delay</span></a>
<a class="sourceLine" id="cb504-12" title="12"><span class="co"># and which airport most often</span></a>
<a class="sourceLine" id="cb504-13" title="13"><span class="co"># appears in this category</span></a>
<a class="sourceLine" id="cb504-14" title="14"></a>
<a class="sourceLine" id="cb504-15" title="15"></a>
<a class="sourceLine" id="cb504-16" title="16"><span class="co"># repeat the previous example but instead of the function</span></a>
<a class="sourceLine" id="cb504-17" title="17"><span class="co"># `ntile` try the` cut` function</span></a></code></pre></div>
<p><strong>Assignment 11.11 - advanced queries (2)</strong></p>
<div class="fold s o">
<div class="sourceCode" id="cb505"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb505-1" title="1"><span class="co"># in the `hflights` table, divide the delay time</span></a>
<a class="sourceLine" id="cb505-2" title="2"><span class="co"># in 10 categories with the help of the `ntile` function</span></a>
<a class="sourceLine" id="cb505-3" title="3"><span class="co"># call the new column `ArrDelayCatId`</span></a>
<a class="sourceLine" id="cb505-4" title="4"><span class="co"># print an identifier for each category</span></a>
<a class="sourceLine" id="cb505-5" title="5"><span class="co"># categories, total number of flights within a category,</span></a>
<a class="sourceLine" id="cb505-6" title="6"><span class="co"># minimum and maximum time of arrival delay</span></a>
<a class="sourceLine" id="cb505-7" title="7"><span class="co"># and which airport is most often</span></a>
<a class="sourceLine" id="cb505-8" title="8"><span class="co"># appears in this category</span></a>
<a class="sourceLine" id="cb505-9" title="9"></a>
<a class="sourceLine" id="cb505-10" title="10"><span class="kw">mutate</span>(hflights, <span class="dt">ArrDelayCatId =</span> <span class="kw">ntile</span>(ArrDelay, <span class="dv">10</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb505-11" title="11"><span class="kw">group_by</span>(ArrDelayCatId) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">summarise</span>(<span class="dt">totalFlights =</span> <span class="kw">n</span>(), <span class="dt">minArrDelay =</span> <span class="kw">min</span>(ArrDelay), <span class="dt">maxArrDelay =</span> <span class="kw">max</span>(ArrDelay), <span class="dt">mostFreqDest =</span> <span class="kw">mostFreqValue</span>(Dest))</a></code></pre></div>
<pre><code>## # A tibble: 11 x 5
##    ArrDelayCatId totalFlights minArrDelay maxArrDelay mostFreqDest
##            &lt;int&gt;        &lt;int&gt;       &lt;dbl&gt;       &lt;dbl&gt; &lt;chr&gt;       
##  1             1        22388         -70         -14 ATL         
##  2             2        22387         -14          -9 ATL         
##  3             3        22388          -9          -6 DAL         
##  4             4        22387          -6          -3 DAL         
##  5             5        22387          -3           0 DAL         
##  6             6        22388           0           3 DAL         
##  7             7        22387           3           8 DAL         
##  8             8        22388           8          15 DAL         
##  9             9        22387          15          32 DAL         
## 10            10        22387          32         978 DAL         
## 11            NA         3622          NA          NA DAL</code></pre>
</div>
<div class="fold s o">
<div class="sourceCode" id="cb507"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb507-1" title="1"><span class="co"># repeat the previous example but instead of the function</span></a>
<a class="sourceLine" id="cb507-2" title="2"><span class="co"># `ntile` try the` cut` function</span></a>
<a class="sourceLine" id="cb507-3" title="3"></a>
<a class="sourceLine" id="cb507-4" title="4"><span class="kw">mutate</span>(hflights, <span class="dt">ArrDelayCat =</span> <span class="kw">cut</span>(ArrDelay, <span class="dv">10</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb507-5" title="5"><span class="kw">group_by</span>(ArrDelayCat) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">summarise</span>(<span class="dt">totalFlights =</span> <span class="kw">n</span>(), <span class="dt">minArrDelay =</span> <span class="kw">min</span>(ArrDelay), <span class="dt">maxArrDelay =</span> <span class="kw">max</span>(ArrDelay), <span class="dt">mostFreqDest =</span> <span class="kw">mostFreqValue</span>(Dest))</a></code></pre></div>
<pre><code>## Warning: Factor `ArrDelayCat` contains implicit NA, consider using
## `forcats::fct_explicit_na`</code></pre>
<pre><code>## # A tibble: 11 x 5
##    ArrDelayCat totalFlights minArrDelay maxArrDelay mostFreqDest
##    &lt;fct&gt;              &lt;int&gt;       &lt;dbl&gt;       &lt;dbl&gt; &lt;chr&gt;       
##  1 (-71,34.8]        203101         -70          34 DAL         
##  2 (34.8,140]         18551          35         139 DAL         
##  3 (140,244]           1849         140         244 ATL         
##  4 (244,349]            294         245         346 ATL         
##  5 (349,454]             48         350         450 ATL         
##  6 (454,559]             16         458         556 ATL         
##  7 (559,664]              4         579         663 DFW         
##  8 (664,768]              4         685         766 DFW         
##  9 (768,873]              4         775         861 DEN         
## 10 (873,979]              3         918         978 DFW         
## 11 &lt;NA&gt;                3622          NA          NA DAL</code></pre>
</div>
<hr />
</div>
<div id="merging-data-frames-with-join-functions" class="section level2">
<h2><span class="header-section-number">11.7</span> Merging data frames with join functions</h2>
<p>Merging data frames is an operation known to all developers who have experience in working with relational databases and <em>SQL</em>. When stored in a relational database, tables are often decomposed into multiple tables by a process called “normalization”. The purpose of normalization is mainly to eliminate unnecessary redundancy - each table retains enough data to reconstruct the original data, i.e. sets of observations, which is done through the “join” operation.</p>
<p>Although there are different forms of joining tables, by far the most common is the so-called a “natural” join where we have unique identifiers in one table related to the data in the other table. For example - suppose we have a <code>student</code> and <code>city</code> tables, where a <code>student</code> table may have a column that stores the zip code of the user’s place of residence, while other location-related information is in the <code>city</code> table. Storing this information in the <code>students</code> table would be redundant, since the zip code as such uniquely identifies a city, and if we want to see the names of the cities when printing users, we perform a natural join of two tables by the zip code of the city. This zip code is the so-called “foreign key” in the <code>student</code> table and at the same time “primary key” in table <code>city</code>.</p>
<p>We will create two simple data frames to demonstrate this.</p>
<div class="sourceCode" id="cb510"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb510-1" title="1"><span class="co"># initializing the `user` and` place` data frames</span></a>
<a class="sourceLine" id="cb510-2" title="2"></a>
<a class="sourceLine" id="cb510-3" title="3">student &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">id =</span> <span class="kw">c</span>(<span class="dv">1</span><span class="op">:</span><span class="st"> </span><span class="dv">3</span>), <span class="dt">lastName =</span> <span class="kw">c</span>(<span class="st">&quot;Ivic&quot;</span>, <span class="st">&quot;Peric&quot;</span>, <span class="st">&quot;Anic&quot;</span>),</a>
<a class="sourceLine" id="cb510-4" title="4">                        <span class="dt">zipResidence =</span> <span class="kw">c</span>(<span class="dv">10000</span>, <span class="dv">31000</span>, <span class="dv">10000</span>))</a>
<a class="sourceLine" id="cb510-5" title="5"></a>
<a class="sourceLine" id="cb510-6" title="6">city &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">zip =</span> <span class="kw">c</span>(<span class="dv">10000</span>, <span class="dv">21000</span>, <span class="dv">31000</span>),</a>
<a class="sourceLine" id="cb510-7" title="7">                      <span class="dt">nameCity =</span> <span class="kw">c</span>(<span class="st">&quot;Zagreb&quot;</span>, <span class="st">&quot;Split&quot;</span>, <span class="st">&quot;Osijek&quot;</span>))</a></code></pre></div>
<p>If we want to have a data frame with columns <em>(id, lastName, zipResidence, nameCity)</em>, then we need to naturally merge the two data frames. For this, the <code>dplyr</code> package offers the<code>inner_join</code> function. For example, if we want to join data frames <code>df1</code> and <code>df2</code>, then we can perform the natural join like this:</p>
<div class="sourceCode" id="cb511"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb511-1" title="1"><span class="kw">inner_join</span>(df1, df2, <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&quot;s1&quot;</span> =<span class="st"> &quot;s2&quot;</span>))</a></code></pre></div>
<p>where the character strings <code>"s1"</code> and <code>"s2"</code> denote the column names of these “left” and “right” frames that we are joining (note only one equality sign! ). If the column we use has the same name in both tables, we can only specify the name of that column (or the character vector of multiple columns if we connect via a so-called “composite” foreign key), or omit this parameter completely (if the columns to which we perform merging are the only columns whose names match).</p>
<hr />
<p><strong>Assignment 11.12 - natural join</strong></p>
<div class="sourceCode" id="cb512"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb512-1" title="1"><span class="co"># print the result of natural joining of data frames `student` and `city`</span></a></code></pre></div>
<div class="fold s o">
<div class="sourceCode" id="cb513"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb513-1" title="1"><span class="co"># print the result of natural joining of data frames `student` and `city`</span></a>
<a class="sourceLine" id="cb513-2" title="2"><span class="kw">inner_join</span>(student, city, <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&quot;zipResidence&quot;</span> =<span class="st"> &quot;zip&quot;</span>))</a></code></pre></div>
<pre><code>##   id lastName zipResidence nameCity
## 1  1     Ivic        10000   Zagreb
## 2  2    Peric        31000   Osijek
## 3  3     Anic        10000   Zagreb</code></pre>
</div>
<hr />
<p>Keep in mind that joining is a very “expensive” operation; if you join frames with a very large number of rows, the operation could take a very long time and take up a lot of memory. In the event that such “large” joins are often required, then it is strongly recommended to use the <code>data.table</code> package, which implements algorithms with significantly better performance in join operations (using indexing), or - if we work with relational database as a data source - perform the joins on the database side and then pull the result in <em>R</em>. In the next section, we will show how this can potentially be done without having to explicitly write separate <em>SQL</em> commands.</p>
<p>If we look at the result of the example above, we can see that we “lost” one row from the <code>city</code> table. Specifically, line <em>(21000, ‘Split’)</em> had no corresponding student and “disappeared” from the result. This is a completely expected result of a natural join, but there are times when we want to keep all the rows from one of the tables we merge. In this case, we have the option of using the so-called “outer natural join” which works identically to the “inner” natural join that we have already seen, but retains all rows from one or both of the tables so that the rows that fail to join remain in the result but with <code>NA</code> values on the opposite side. We distinguish between “left”, “right”, and “full” outer join, depending on whether we want to keep all rows from the left, right or both tables. The <code>dplyr</code> package offers functions that perform all these types of joins, they have a signature identical to the function seen above and are called<code>left_join</code>, <code>right_join</code> and<code>full_join</code>.</p>
<hr />
<p><strong>Assignment 11.13 - outer join</strong></p>
<div class="sourceCode" id="cb515"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb515-1" title="1"><span class="co"># print the result of natural joining of data frames `student` and `city`</span></a>
<a class="sourceLine" id="cb515-2" title="2"><span class="co"># which retains all rows from the `city` table</span></a></code></pre></div>
<div class="fold s o">
<div class="sourceCode" id="cb516"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb516-1" title="1"><span class="co"># print the result of natural joining of data frames `student` and `city`</span></a>
<a class="sourceLine" id="cb516-2" title="2"><span class="co"># which retains all rows from the `city` table</span></a>
<a class="sourceLine" id="cb516-3" title="3"><span class="kw">right_join</span>(student, city, <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&quot;zipResidence&quot;</span> =<span class="st"> &quot;zip&quot;</span>))</a></code></pre></div>
<pre><code>##   id lastName zipResidence nameCity
## 1  1     Ivic        10000   Zagreb
## 2  3     Anic        10000   Zagreb
## 3 NA     &lt;NA&gt;        21000    Split
## 4  2    Peric        31000   Osijek</code></pre>
</div>
<hr />
</div>
<div id="integrating-dplyr-with-relational-databases" class="section level2">
<h2><span class="header-section-number">11.8</span> Integrating <code>dplyr</code> with relational databases</h2>
<p>Relational databases are a common source of data for the analysis done in <em>R</em>. One of the standard procedures for preparing data for the analytical process is the exporting from the database to a <em>CSV</em> file, which is then loaded into <em>R</em>. Often, before creating a <em>CSV</em> file, the data from the database must first be adequately collected and prepared, which means that the overall data preparation process requires initial work done in the <em>SQL</em> language directly on the database. This is especially important if we are working with larger datasets that would unnecessarily burden the machine that runs <em>R</em>, and which could be processed much more efficiently in the database itself.</p>
<p>The above does not necessarily mean that we need a separate tool to run <em>SQL</em> queries for collecting data from the database. <em>R</em> contains a number of packages for directly communicating with more popular databases, such as <em>MySQL</em> or <em>PostgreSQL</em>. With these packages, we can connect to the base and execute <em>SQL</em> queries directly within the <em>R</em> script, all with the help of R commands, with the result being a data frame ready for further analysis in <em>R</em>. For example, communicating with the <em>MySQL</em> database from R might look like this:</p>
<div class="sourceCode" id="cb518"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb518-1" title="1"><span class="kw">install.packages</span>(<span class="st">&quot;RMySQL&quot;</span>)</a>
<a class="sourceLine" id="cb518-2" title="2"></a>
<a class="sourceLine" id="cb518-3" title="3"><span class="kw">library</span>(RMySQL)</a>
<a class="sourceLine" id="cb518-4" title="4"></a>
<a class="sourceLine" id="cb518-5" title="5"><span class="co"># enter real parameters in a realistic scenario!</span></a>
<a class="sourceLine" id="cb518-6" title="6">conn &lt;-<span class="st">  </span><span class="kw">dbConnect</span>(<span class="kw">MySQL</span>(), <span class="dt">user =</span> <span class="st">&#39;user&#39;</span>, <span class="dt">password =</span> <span class="st">&#39;password&#39;</span>, <span class="dt">dbname =</span> <span class="st">&#39;database_name&#39;</span>, <span class="dt">host =</span> <span class="st">&#39;host&#39;</span>)</a>
<a class="sourceLine" id="cb518-7" title="7"></a>
<a class="sourceLine" id="cb518-8" title="8">df &lt;-<span class="st">  </span><span class="kw">dbSendQuery</span>(conn, <span class="st">&quot;SELECT * FROM MY_TABLE&quot;</span>)</a></code></pre></div>
<p>We see that we first need to load the package with support for connecting to the selected database, then establish a connection with that database (parameters are usually provided to us by the database administrator), followed by providing <em>SQL</em> queries wrapped in appropriate function calls. Although this approach is not complicated and is relatively common, it unmistakably requires mixing <em>R</em> and <em>SQL</em> and programming code.</p>
<p>The <code>dplyr</code> package can offer assistance here by relieving the developer of the need to write <em>SQL</em> queries inside the <em>R</em> script. Specifically, <code>dplyr</code> contains integrated support for the automatic conversion of expressions that use <code>dplyr</code> functions directly into an <em>SQL</em> query, which is transparent to the user. In other words, to some extent, we can work on a relational database in the same way as if it we are working on an <em>R</em> data frame. We should be careful here because not all <code>dplyr</code> functionality is translatable into <em>SQL</em>, but most standard preparatory operations such as joining and filtering can be done directly in the database, all the while using just <em>R</em> programming code.</p>
<p>In order to put this into practice, we need a working relational database. As it is somewhat impractical to install or prepare an existing relational database just for the needs of a quick example, we can use an efficient alternative offered by the <code>RSQLite</code> package. It allows us to create an <em>SQLite</em> database, a simple relational database that does not require any special installation, does not use a server and holds all its data in one file.</p>
<p>In the next program section, we load the <em>RSQLite</em> package, create a new database by creating a new file and saving the <code>mtcars</code> dataframe into a relational table called <code>CARS</code>.</p>
<div class="sourceCode" id="cb519"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb519-1" title="1"><span class="co"># installing and loading the `RSQLite` library - perform if necessary</span></a>
<a class="sourceLine" id="cb519-2" title="2"><span class="co"># install.packages ( &quot;RSQLite&quot;)</span></a>
<a class="sourceLine" id="cb519-3" title="3"><span class="co"># library(RSQLite)</span></a>
<a class="sourceLine" id="cb519-4" title="4"></a>
<a class="sourceLine" id="cb519-5" title="5"><span class="co"># opening connection with the &quot;SQLite&quot; database</span></a>
<a class="sourceLine" id="cb519-6" title="6"><span class="co"># (we&#39;re actually creating a file called simply &#39;mybase&#39;)</span></a>
<a class="sourceLine" id="cb519-7" title="7">conn &lt;-<span class="st"> </span><span class="kw">dbConnect</span>(<span class="dt">drv =</span> <span class="kw">SQLite</span>(), <span class="dt">dbname =</span> <span class="st">&quot;mybase&quot;</span>)</a>
<a class="sourceLine" id="cb519-8" title="8"></a>
<a class="sourceLine" id="cb519-9" title="9"><span class="co"># creating the `CARS` relational table</span></a>
<a class="sourceLine" id="cb519-10" title="10"><span class="co"># by using R&#39;s `mtcars` sample dataset</span></a>
<a class="sourceLine" id="cb519-11" title="11"><span class="kw">dbWriteTable</span>(conn, <span class="st">&quot;CARS&quot;</span>, mtcars, <span class="dt">overwrite =</span> T)</a>
<a class="sourceLine" id="cb519-12" title="12"></a>
<a class="sourceLine" id="cb519-13" title="13"><span class="co"># checking the list of all existing tables</span></a>
<a class="sourceLine" id="cb519-14" title="14"><span class="kw">dbListTables</span>(conn)</a></code></pre></div>
<pre><code>## [1] &quot;CARS&quot;</code></pre>
<p>The usual way to collect data from a database is to embed <em>SQL</em> queries directly into the <em>R</em> program code and store the results in a variable.</p>
<div class="sourceCode" id="cb521"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb521-1" title="1"><span class="co"># get information on the maximum speed and weight of all 6-cylinder cars</span></a>
<a class="sourceLine" id="cb521-2" title="2"><span class="kw">dbGetQuery</span>(conn, <span class="st">&quot;SELECT mpg, wt FROM CARS WHERE cyl = 6&quot;</span>)</a></code></pre></div>
<pre><code>##    mpg    wt
## 1 21.0 2.620
## 2 21.0 2.875
## 3 21.4 3.215
## 4 18.1 3.460
## 5 19.2 3.440
## 6 17.8 3.440
## 7 19.7 2.770</code></pre>
<p>If we know SQL well, then this method of data collection probably does not seem overly complex and in fact, many developers and analysts are happy to combine <em>SQL</em> and <em>R</em>, optimizing the process of data collection and preparation. However, if we are not too knowledgable in <em>SQL</em> (or simply want a “cleaner” code), we can use the tools provided by the <code>dplyr</code> package.</p>
<p>In the following example, we will repeat the process of connecting to the database, but we will execute everything with <code>dplyr</code> functions.</p>
<div class="sourceCode" id="cb523"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb523-1" title="1"><span class="co"># connecting to an existing SQLite database!</span></a>
<a class="sourceLine" id="cb523-2" title="2">conn2 &lt;-<span class="st"> </span><span class="kw">src_sqlite</span>(<span class="st">&quot;mybase&quot;</span>, <span class="dt">create =</span> <span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb523-3" title="3"></a>
<a class="sourceLine" id="cb523-4" title="4"><span class="co"># checking the list of the existing tables</span></a>
<a class="sourceLine" id="cb523-5" title="5"><span class="kw">src_tbls</span>(conn2)</a>
<a class="sourceLine" id="cb523-6" title="6"></a>
<a class="sourceLine" id="cb523-7" title="7"><span class="co"># getting a reference to the existing table</span></a>
<a class="sourceLine" id="cb523-8" title="8"><span class="co"># no data gets loaded yet!</span></a>
<a class="sourceLine" id="cb523-9" title="9">cars &lt;-<span class="st"> </span><span class="kw">tbl</span>(conn2, <span class="st">&quot;CARS&quot;</span>)</a>
<a class="sourceLine" id="cb523-10" title="10"></a>
<a class="sourceLine" id="cb523-11" title="11"><span class="co"># get information on the maximum speed and weight of all 6-cylinder cars</span></a>
<a class="sourceLine" id="cb523-12" title="12">cars <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(cyl <span class="op">==</span><span class="st"> </span><span class="dv">6</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(mpg, wt) <span class="op">%&gt;%</span><span class="st"> </span>collect</a></code></pre></div>
<pre><code>## [1] &quot;CARS&quot;
## # A tibble: 7 x 2
##     mpg    wt
##   &lt;dbl&gt; &lt;dbl&gt;
## 1  21    2.62
## 2  21    2.88
## 3  21.4  3.22
## 4  18.1  3.46
## 5  19.2  3.44
## 6  17.8  3.44
## 7  19.7  2.77</code></pre>
<p>One thing to note is that <code>dplyr</code> will not perform anything until we explicitly request the collection of the information, and even then it will retrieve it “in portions” to save memory. This is why we explicitly used the <code>collect</code> function in the example above, essentially forcing <em>R</em> to put the entire result into a data frame (our in our case, simply printting it on the screen). In this way, the <em>R</em> programmer can significantly relieve his <em>R</em> environment by shifting the responsibility of “heavy” operations to the database, while keeping a consistent syntax regardless of whether the operations are done on the database or in memory as <em>R</em> objects.</p>
<hr />
</div>
<div id="exercises-7" class="section level2 unnumbered">
<h2>Exercises</h2>
<p>IThe following exercises use the <em>mammals sleep</em> dataset available in the visualization package <code>ggplot2</code>. Load the <code>ggplot2</code> package and then put the <code>msleep</code> data frame in the global environment using the <code>data</code> function.</p>
<p>Before solving the exercises be sure to explore the dataset and learn its features. Then do the following</p>
<ol style="list-style-type: decimal">
<li><p>For 10 herbivores who sleep the longest, print their name, how many hours per day they sleep and their average body weight in kg. Sort the entries by sleep length in a descending order.</p></li>
<li><p>Print the average, longest and shortest sleep time of the animals depending on their type of diet.</p></li>
<li><p>Categorize the total sleeping time in 5 bins of equal length. For each category, print the total number of animals belonging to the category, and then the total number of class members who are not herbivores. Results should be sorted by sleep length in a descending order. Columns should have meaningful names and the final table should not contain NA values.</p></li>
<li><p>The following data frame contains the status codes for animal conservation status and their descriptions:</p></li>
</ol>
<div class="sourceCode" id="cb525"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb525-1" title="1">conservationStatus &lt;-<span class="st"> </span><span class="kw">data.frame</span>( </a>
<a class="sourceLine" id="cb525-2" title="2">  <span class="dt">code =</span> <span class="kw">c</span>(<span class="st">&quot;ex&quot;</span>, <span class="st">&quot;ew&quot;</span>, <span class="st">&quot;cr&quot;</span>, <span class="st">&quot;en&quot;</span>, <span class="st">&quot;vu&quot;</span>, <span class="st">&quot;nt&quot;</span>, <span class="st">&quot;cd&quot;</span>, <span class="st">&quot;lc&quot;</span>),</a>
<a class="sourceLine" id="cb525-3" title="3">  <span class="dt">description =</span> <span class="kw">c</span>(<span class="st">&quot;extinct&quot;</span>, <span class="st">&quot;extinct in the wild&quot;</span>, </a>
<a class="sourceLine" id="cb525-4" title="4">                 <span class="st">&quot;critically endangered&quot;</span>, <span class="st">&quot;endangered&quot;</span>,</a>
<a class="sourceLine" id="cb525-5" title="5">                 <span class="st">&quot;vulnerable&quot;</span>, <span class="st">&quot;near threatened&quot;</span>, </a>
<a class="sourceLine" id="cb525-6" title="6">                 <span class="st">&quot;conservation dependent&quot;</span>, <span class="st">&quot;least concern&quot;</span>))</a></code></pre></div>
<p>Add a <code>conservationDesc</code> column to ¸the <code>msleep</code> dataframe which will contain the correspoding conservation status descriptions. Be sure not to lose any rows from the <code>msleep</code> data frame.</p>
<hr />
<p><a rel="license" href="http://creativecommons.org/licenses/by-nc-nd/4.0/"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by-nc-nd/4.0/88x31.png" /></a><br /><span xmlns:dct="http://purl.org/dc/terms/" property="dct:title">Programirajmo u R-u</span> by <a xmlns:cc="http://creativecommons.org/ns#" href="https://www.fer.unizg.hr/en/damir.pintar" property="cc:attributionName" rel="cc:attributionURL">Damir Pintar</a> is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-nc-nd/4.0/">Creative Commons Attribution-NonCommercial-NoDerivatives 4.0 International License</a>.<br />Based on a work at <a xmlns:dct="http://purl.org/dc/terms/" href="https://ratnip.github.io/FER_OPJR/" rel="dct:source">https://ratnip.github.io/FER_OPJR/</a></p>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="dates.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="ggplot2.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"google": false,
"linkedin": false,
"weibo": false,
"instapper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "section",
"scroll_highlight": true
},
"toolbar": {
"position": "fixed",
"edit": null,
"download": null,
"search": true
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdn.bootcss.com/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:" && /^https?:/.test(src))
      src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
